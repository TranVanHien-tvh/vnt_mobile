{"remainingRequest":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\VNT_vue\\src\\components\\msgridviewer\\msGridViewer.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\VNT_vue\\src\\components\\msgridviewer\\msGridViewer.vue","mtime":1670055812039},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQovKiBlc2xpbnQtZGlzYWJsZSAqLw0KaW1wb3J0IG1zVHIgZnJvbSAiLi9tc1RyIjsNCmltcG9ydCBtc1RoIGZyb20gIi4vbXNUaCI7DQppbXBvcnQgbXNQYWdpbmF0aW9uIGZyb20gIi4vbXNQYWdpbmF0aW9uIjsNCmltcG9ydCBjb21tb25GbiBmcm9tICJAL2NvbW1vbnMvY29tbW9uRnVuY3Rpb24uanMiOw0KaW1wb3J0IHsgTVNFdmVudE5hbWUgfSBmcm9tICJAL2NvbW1vbnMvZXZlbnROYW1lIjsNCmltcG9ydCBFdmVudEJ1c0dsb2JhbCwgeyBHbG9iYWxFdmVudE5hbWUgfSBmcm9tICJAL2NvbW1vbnMvZXZlbnRCdXNHbG9iYWwiOw0KaW1wb3J0IHsgZ3JpZEdyb3VwRGF0YSB9IGZyb20gIkAvbWl4aW5zL2NvbXBvbmVudC9ncmlkR3JvdXBEYXRhIjsNCmltcG9ydCBkcmFnZ2FibGUgZnJvbSAidnVlZHJhZ2dhYmxlIjsNCmltcG9ydCB7IE1TRW51bSB9IGZyb20gIkAvY29tbW9ucy9lbnVtZXJhdGlvbiI7DQppbXBvcnQgbXNDb25maWdDb2x1bW4gZnJvbSAiLi9tc0NvbmZpZ0NvbHVtbiI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIk1zR3JpZFZpZXdlciIsDQogIGNvbXBvbmVudHM6IHsNCiAgICBtc1RyLA0KICAgIG1zVGgsDQogICAgbXNQYWdpbmF0aW9uLA0KICAgIGRyYWdnYWJsZSwNCiAgICBtc0NvbmZpZ0NvbHVtbiwNCiAgfSwNCiAgbWl4aW5zOiBbZ3JpZEdyb3VwRGF0YV0sDQogIHByb3BzOiB7DQogICAgZmxleDogew0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBjw7Mgc2hvdyB0ZXh0IGZpbHRlciBraGkgbOG7jWMgcmEga2jDtG5nDQogICAgICovDQogICAgaGFzQmluZGluZ0ZpbHRlckhlYWRlcjogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAgLy9WYWx1ZSB0aOG7sWMgaGnhu4duIGzGsHUgZ2nDoSB0cuG7iyBjw6FjIGPhu5l0IMSRxrDhu6NjIGNo4buNbg0KICAgIHZhbHVlOiB7DQogICAgICB0eXBlOiBBcnJheSwNCiAgICAgIHJldHVybjogKCkgPT4gW10sDQogICAgfSwNCiAgICAvL0RhdGEgZOG7ryBsaeG7h3UgZ3JpZCB04burIG5nb8OgaSB0cnV54buBbiB2w6BvDQogICAgZGF0YTogew0KICAgICAgdHlwZTogQXJyYXksDQogICAgICByZXR1cm46ICgpID0+IFtdLA0KICAgIH0sDQogICAgLyoqDQogICAgICogVMOqbiB0csaw4budbmcga2jDs2EgY2jDrW5oDQogICAgICovDQogICAgaWRGaWVsZDogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgIH0sDQogICAgLyoqDQogICAgICogbm5sYW0gMTMvMDMvMjAyMQ0KICAgICAqIGPhuqV1IGjDrG5oIGPDoWMgdHLGsOG7nW5nIGPhuqduIHNvcnQgbeG6t2MgxJHhu4tuaCBraGkgbG9hZCB0cmFuZw0KICAgICAqIEtp4buDdSBk4buvIGxp4buHdSBBcnJheSBjaOG7qWEgZGFuaCBzw6FjaCBjw6FjIG9iamVjdCwgY+G6pXUgdHLDumMgb2JqZWN0IGPDsyDDrXQgbmjhuqV0IDIgdHLGsOG7nW5nIGzDoCBzb3J0RmllbGQodMOqbiBwcm9wZXJ0eSBj4bqnbiBzb3J0KSB2w6Agc29ydFR5cGUgKGzDoCBkZXNjIGhheSBhc2MpDQogICAgICogdsOtIGThu6UgOiBbe3NvcnRGaWVsZDogJ0Fzc2V0Q29kZScsIHNvcnRUeXBlIDogdGhpcy4kbXMuZW51bS5Tb3J0U3RhdHVzLmFzY31dDQogICAgICovDQogICAgZGVmYXVsdFNvcnQ6IHsNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgICAgcmV0dXJuOiAoKSA9PiBbXSwNCiAgICB9LA0KICAgIC8vQ+G6pXUgaMOsbmggY8OhYyBj4buZdCB0cnV54buBbiB2w6BvDQogICAgLyoqDQogICAgICogQ8OhYyB0aHXhu5ljIHTDrW5oIHRyb25nIGNvbHVtbnMNCiAgICAgKiBAcGFyYW1zIGRhdGFGaWVsZCBGaWVsZCBk4buvIGxp4buHdSBkw7luZyDEkeG7gyBuaOG6rW4gZ2nDoSB0cuG7iyB0aGF5IMSR4buVaSB2w6AgaGnhu4duIHRo4buLLg0KICAgICAqIEBwYXJhbXMgdGl0bGU6VGnDqnUgxJHhu4EgY+G7p2EgY+G7mXQNCiAgICAgKiBAcGFyYW1zIHdpZHRoOsSR4buZIHLhu5luZyBj4bunYSBj4buZdA0KICAgICAqIEBwYXJhbXMgYXV0b1Jlc2l6ZTpD4buZdCB04buxIMSR4buZbmcgdG8gcmEga2hpIG3DoG4gaMOsbmggbOG7m24NCiAgICAgKiBAcGFyYW1zIGZvcm1hdFR5cGU6ROG7ryBsaeG7h3UgZMO5bmcgxJHhu4MgZm9ybWF0IGzhuqV5IHThu6sgdHJvbmcgZmlsZSBlbnVtZXJhdGlvbi5qcyBGb3JtYXRUeXBlDQogICAgICogQHBhcmFtcyB0ZW1wbGF0ZTpT4butIGThu6VuZyAxIGZpbGUga2jDoWMg4bufIG5nb8OgaSB0cnV54buBbiB2w6BvIMSR4buDIHJlbmRlcg0KICAgICAqLw0KICAgIGNvbHVtbnM6IHsNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgICAgcmV0dXJuOiAoKSA9PiBbXSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEPhuqV1IGjDrG5oIGNobyBj4buZdCBjaOG7qWMgbsSDbmcgbMOgIDEgxJHhu5FpIHTGsOG7o25nIGfhu5NtIGPDsw0KICAgICAqIHRpdGxlOiB0w6puIHRpw6p1IMSR4buBIGPhu5l0IGNo4bupYyBuxINuZw0KICAgICAqIGNvbXBvbmVudHM6J2NvbXBvbmVudHMgaW1wb3J0IHbDoG8nDQogICAgICogd2lkdGg6xJDhu5kgcuG7mW5nIGPhu6dhIGPhu5l0DQogICAgICovDQogICAgd2lkZ2V0T3B0aW9uczoge30sDQogICAgLy9TZXQgxJHhu5kgcuG7mW5nIGNobyBncmlkDQogICAgbWF4SGVpZ2h0OiB7DQogICAgICBkZWZhdWx0OiBudWxsLA0KICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSwNCiAgICB9LA0KICAgIC8vQ+G6pXUgaMOsbmggY8OzIHBow6JuIHRyYW5nIGhheSBraMO0bmcNCiAgICBwYWdpbmF0aW9uOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICAvKg0KICAgIENobyBwaMOpcCBoaeG7g24gdGjhu4sgaGVhZGVyIGPhu6dhIGzGsOG7m2kgaGF5IGtow7RuZz8gbeG6t2MgxJHhu4tuaCBjw7MNCiAgICBDcmVhdGU6IDE0LzAxLzIwMjANCiAgICBBdXRob3I6IMSQVlRoaSAgICANCiAgICAqLw0KICAgIGlzU2hvd0hlYWRlcjogew0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCg0KICAgIC8qDQogICAgQ2hvIHBow6lwIGhp4buDbiB0aOG7iyBjb21ib3ggc+G7kSBkw7JuZyB0csOqbiBt4buZdCB0cmFuZyBoYXkga2jDtG5nPyBt4bq3YyDEkeG7i25oIGPDsw0KICAgIENyZWF0ZTogMTQvMDEvMjAyMA0KICAgIEF1dGhvcjogxJBWVGhpICAgIA0KICAgICovDQogICAgaXNTaG93UGFnZVNpemVDb21ib3g6IHsNCiAgICAgIGRlZmF1bHQ6IHRydWUsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQoNCiAgICAvKg0KICAgIENobyBwaMOpcCBoaeG7g24gdGjhu4sgY29tYm94IHPhu5EgZMOybmcgdHLDqm4gbeG7mXQgdHJhbmcgaGF5IGtow7RuZz8NCiAgICBDcmVhdGU6IDE0LzAxLzIwMjANCiAgICBBdXRob3I6IMSQVlRoaSAgICANCiAgICAqLw0KICAgIHBhZ2VUb3RhbENhcHRpb246IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIFRleHQgaGnhu4NuIHRo4buLIGLhuqNuIGdoaQ0KICAgICAqLw0KICAgIHBhZ2VGcm9tVG9DYXB0aW9uOiB7DQogICAgICBkZWZhdWx0OiBudWxsLA0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgIH0sDQoNCiAgICAvL05o4bqtbiAyIGdpw6EgdHLhu4sgcmVtb3RlL2xvY2FsIMSR4buDIGzhuqV5IGdpw6EgdHLhu4sg4bufIHNlcnZlciBob+G6t2MgbG9jYWwNCiAgICBxdWVyeU1vZGU6IHsNCiAgICAgIGRlZmF1bHQ6ICJyZW1vdGUiLA0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgIH0sDQogICAgLy9T4buRIGLhuqNuIGdoaSB0csOqbiBt4bubaSB0cmFuZyB0csaw4budbmcgaOG7o3AgcGjDom4gdHJhbmcgbG9jYWwNCiAgICBwYWdlU2l6ZTogew0KICAgICAgZGVmYXVsdDogNTAsDQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgfSwNCiAgICAvL0Phu5l0IGNobyBwaMOpcCB0w61jaCBjaOG7jW4gbmhp4buBdSBkw7JuZw0KICAgIG11bHRpcGxlOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICBpbmRleEZsZXhSaWdodDogew0KICAgICAgZGVmYXVsdDogMSwNCiAgICAgIHR5cGU6IE51bWJlciwNCiAgICB9LA0KICAgIC8vVOG7lW5nIHPhu5EgYuG6o24gZ2hpDQogICAgcGFnZVRvdGFsOiB7DQogICAgICBkZWZhdWx0OiAwLA0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgIH0sDQogICAgLyoqDQogICAgICogdGjDtG5nIHRpbiBzdW1tYXJ5DQogICAgICogdHJvbmcgbsOgeSBz4bq9IGPDsyB0b3RhbCBsdcO0bg0KICAgICAqLw0KICAgIHN1bW1hcnk6IHt9LA0KICAgIC8vSGnhu4duIHRo4buLIGPhu5l0IHPhu5EgdGjhu6kgdOG7sQ0KICAgIHNlcmlhbDogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAgLy9DaG8gcGjDqXAgZGkgY2h1eeG7g24gxJHhu5kgcuG7mW5nIGPhu6dhIGPhu5l0IGhheSBraMO0bmcNCiAgICByZXNpemVDb2w6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIC8vVHLGsOG7nW5nIMSR4buDIGtp4buDbSB0cmEgc29ydCBkxrDhu5tpIGNsaWVudCBoYXkgdHLDqm4gc2V2ZXINCiAgICAvL0xvY2FsL1NlcnZlDQogICAgcmVtb3RlU29ydDogew0KICAgICAgZGVmYXVsdDogInJlbW90ZSIsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICAvL0RhdGEgbMOgIGThuqFuZyBNYXN0ZXIvRGV0YWlsDQogICAgaXNNYXN0ZXJEZXRhaWw6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIGRldGFpbEZpZWxkOiB7DQogICAgICBkZWZhdWx0OiAiRGV0YWlscyIsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICBoYXNGaWx0ZXJFbXB0eTogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAgbG9hZGluZzogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCiAgICBsb2FkaW5nU3VtbWFyeTogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCiAgICBjdXN0b21DbGFzc1Jvdzogew0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIGxvYWRDaGlsZHJlbkRhdGE6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBBY3Rpb24gY+G7p2Egcm93DQogICAgICovDQogICAgcm93QWN0aW9uczogew0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICAgIHR5cGU6IFtPYmplY3QsIEFycmF5XSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFPhu5EgbMaw4bujbmcgaXRlbSBoaeG7g24gdGjhu4sgaW5saW5lIGtoaSBob3ZlciB2w6BvIGTDsm5nDQogICAgICogbuG6v3Ugdsaw4bujdCBxdcOhIHPhu5EgbMaw4bujbmcgbsOgeSB0aMOsIHPhur0gxJHhurd0IHRyb25nIG1vcmUgLi4uDQogICAgICovDQogICAgYWN0aW9uSW5saW5lQ291bnQ6IHsNCiAgICAgIGRlZmF1bHQ6IDUsDQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBEaXNhYmxlIGNvbnRyb2wNCiAgICAgKi8NCiAgICBkaXNhYmxlZDogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgLyoqDQogICAgICogU+G7kSBkw7JuZyBzaGltbWVyIGxvYWRpbmcNCiAgICAgKi8NCiAgICBzaGltbWVyUm93OiB7DQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgICBkZWZhdWx0OiA1LA0KICAgIH0sDQogICAgLyoNCiAgICAgKiB0aMOqbSBj4bqldSBow6xuaCBuaOG7r25nIGPhu5l0IGx1w7RuIGzhuqV5IGtoaSBsb2FkIGdyaWQNCiAgICAgKiBwdmR1eSAxOS8wMS8yMDIxDQogICAgICovDQogICAgYWx3YXlUYWtlQ29sdW1uczogew0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgIH0sDQogICAgLyoqDQogICAgICogY8OzIGZpbHRlciBj4buZdCBraMO0bmcNCiAgICAgKi8NCiAgICBmaWx0ZXJhYmxlOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KICAgIC8qDQogICAgICogY+G7nSDEkcOhbmggZOG6pXUgbMOgIGdyaWQgc+G7rSBk4bulbmcgdHJvbmcgZm9ybSBjaGkgdGnhur90IC0tIGTDuW5nIMSR4buDIOG6qW4gaGnhu4duIHBow6JuIHRyYW5nDQogICAgICogcHZkdXkgMDMvMDEvMjAyMQ0KICAgICAqLw0KICAgIGlzR3JpZEluVmlld0RldGFpbDogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQ2hvIHBow6lwIHPhuq9wIHjhur9wIGzhuqFpIGThu68gbGnhu4d1DQogICAgICovDQogICAgZGF0YURyYWdhYmxlOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICAvKg0KICAgICAqIHB2ZHV5IDE5LzAzLzIwMjENCiAgICAgKiBj4budIHjDoWMgbmjhuq1uIHhlbSBjw7MgY2hvIGhp4buHbiDhuqNuaCB0cuG7kW5nIGtoaSBncmlkIGtvIGPDsyBk4buvIGxp4buHdSBoYXkga2jDtG5nPyA9PT4gc+G7rSBk4bulbmcgdHJvbmcgZ3JpZCBkZXRhaWwgZMO5IHRy4buRbmcgduG6q24g4bqpbiDhuqNuaCDEkWkuDQogICAgICovDQogICAgaXNTaG93SW1hZ2VHcmlkRW1wdHk6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KDQogICAgLy9Dw7MgZm9vdGVyIGhheSBraMO0bmcgPw0KICAgIGZvb3Rlcjogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAgLyoNCiAgICAgKiBubmxhbSAxNC8wNC8yMDIxDQogICAgICogY8OzIGNhY2hlIGPhuqV1IGjDrG5oIGPhu5l0IGtow7RuZywgaGnhu4duIHThuqFpIG7hur91IGzGsHUgY2FjaGUgc+G6vSBsxrB1IGtoaSByZXNpemUgY+G7mXQNCiAgICAgKi8NCiAgICBoYXNDYWNoZUNvbDogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAgLyoNCiAgICAgKiBubmxhbSAxNC8wNC8yMDIxDQogICAgICoga2hpIHF1ZXJ5TW9kZSA9ICdsb2NhbCcgdGjDrCBkw7luZyBjw6FpIG7DoHkgxJHhu4MgZmlsdGVyDQogICAgICovDQogICAgZmlsdGVyRm46IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogW0Jvb2xlYW4sIEZ1bmN0aW9uXSwNCiAgICB9LA0KICAgIC8qDQogICAgICogbm5sYW0gMTQvMDQvMjAyMQ0KICAgICAqIGNobyBwaMOpcCBjaGVjayBkaXNhYmxlIMO0IGNoZWNrYm94IOG7nyByb3cNCiAgICAgKi8NCiAgICBkaXNhYmxlZENoZWNrZWRNdWx0aXBsZVRib2R5OiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IFtCb29sZWFuLCBGdW5jdGlvbl0sDQogICAgfSwNCg0KICAgIC8vbW9kdWxlIMSR4buDIHRo4buxYyBoaeG7h24gYXV0b2NvbXBsZXRlIGtoaSBs4buNYyB0csOqbiB0aA0KICAgIG1vZHVsZUF1dG9jb21wbGV0ZTogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEThu68gbGnhu4d1IHThu5VuZw0KICAgICAqIETDuW5nIGNobyBzdW0gbOG6pXkgdOG7qyBzZXJ2ZXIgdHJ1eeG7gW4gdsOgbyAoa2jDtG5nIHBo4bulIHRodeG7mWMgdsOgbyB0cmFuZyDEkWFuZyBoaeG7g24gdGjhu4spDQogICAgICovDQogICAgc3VtbWFyeURhdGE6IHsNCiAgICAgIHR5cGU6IE9iamVjdCwNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBj4budIHThu7EgxJHhu5luZyBjaOG7jW4gZMOybmcgxJHhuqd1IGdyaWQNCiAgICAgKi8NCiAgICBpc0F1dG9Gb2N1c0ZpcnN0Um93OiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KICAgIGlkUHJvcGVydHk6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCg0KICAgIC8qDQogICAgICogY+G7nSBjaOG7iSBoaeG7g24gdGjhu4sgdOG7lW5nIHPhu5EgdHJhbmcNCiAgICAgKiBOTVRVQU4yIDAxLjEwLjIwMjENCiAgICAgKi8NCiAgICBpc09ubHlTaG93UGFnZVRvdGFsOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCg0KICAgIHBhZ2luZ0Zyb21Ub0NhcHRpb246IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIGJp4bq/biDEkcOhbmggZOG6pXUgZ3JpZCBjw7MgdGjhu4MgY2hvIHRvIHJvdw0KICAgICAqIFRETkdISUEgOC8xMC8yMDIxDQogICAgICovDQogICAgZ3Jvd1RvSGVpZ2h0OiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEPhu50gY2hvIHBow6lwIGhp4buDbiB0aOG7iyBkw7JuZyBk4buvIGxp4buHdSB0cuG7kW5nDQogICAgICogTk1UVUFOMiAyMy4wOS4yMDIxDQogICAgICovDQogICAgaXNTaG93RW1wdHlUZXh0OiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogTuG7mWkgZHVuZyB0deG7syBjaOG7jW4gY2hvIGTDsm5nIGThu68gbGnhu4d1IHRy4buRbmcNCiAgICAgKiBOTVRVQU4yIDIzLjA5LjIwMjENCiAgICAgKi8NCiAgICBlbXB0eVRleHQ6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEN1c3RvbSBncmlkIGVtcHR5DQogICAgICogTlRCQU8gMDUuMTAuMjAyMQ0KICAgICAqLw0KICAgIGN1c3RvbUdyaWRFbXB0eVRlbXBsYXRlOiB7DQogICAgICBkZWZhdWx0OiBudWxsLA0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBNw6MgY29kZSDEkeG7gyBt4bufIG3DoG4gZGV0YWlsIHBo4bulYyB24bulIHRow6ptLyBz4butYSBk4buvIGxp4buHdSBncmlkDQogICAgICogTk1UVUFOMiAyMy4wOS4yMDIxDQogICAgICovDQogICAgc3ViU3lzdGVtQ29kZTogew0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogZ3JpZCBjw7MgY2hvIGNvbmZpZyBjb2x1bW5zIGtow7RuZw0KICAgICAqIFRETkdISUEgMS8xMC8yMDIxDQogICAgICovDQogICAgaXNTaG93Q29uZmlnQ29sdW1uOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEtob+G6o25nIGPDoWNoIHThu6sgY29udGV4dCBtZW51IMSR4bq/biBtw6lwIHRyw6puIGPhu6dhIHJvdw0KICAgICAqIE5NVFVBTjMgMjYvMTAvMjAyMQ0KICAgICAqLw0KICAgIGhlaWdodE9mZnNldDogew0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgICAgZGVmYXVsdDogLTIsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEhp4buDbiB0aOG7iyBpY29uIHRyb25nIGNvbnRleHQgbWVudQ0KICAgICAqIE5NVFVBTjMgMjYvMTAvMjAyMQ0KICAgICAqLw0KICAgIGhhc0ljb246IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiB0cnVlLA0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiB0cnVlOiBidWlsZCBj4bqjIGdyb3VwIGPDsyAxIHBo4bqnbiB04butDQogICAgICogZmFsc2U6IGtow7RuZyBidWlsZCBncm91cCBjw7MgMSBwaOG6p24gdOG7rQ0KICAgICAqIE5NVFVBTjMgMTcvMTEvMjAyMQ0KICAgICAqLw0KICAgIGlzQWx3YXlzR3JvdXA6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogSMOgbSBjdXN0b20gZMOybmcgxJHGsOG7o2MgZm9jdXMgxJHhuqd1IHRpw6puDQogICAgICovDQogICAgZ2V0Um93QXV0b0ZvY3VzOiB7DQogICAgICB0eXBlOiBbRnVuY3Rpb24sIE9iamVjdF0sDQogICAgICBkZWZhdWx0OiBudWxsLA0KICAgIH0sDQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIC8vRGF0YSB0cm9uZyBncmlkIGTDuW5nIMSR4buDIHJlbmRlcg0KICAgICAgZGF0YXg6IG51bGwsDQogICAgICAvL0NvbHVtbnMgdHJvbmcgZ3JpZCBkw7luZyDEkeG7gyByZW5kZXINCiAgICAgIGNvbHVtbng6IFtdLA0KICAgICAgLy9Nb2RlIGNobyBwaMOpcCBjb3B5IGThu68gbGnhu4d1IGhheSBraMO0bmcgdGjhu7FjIGhp4buHbiB24bubaSBjw6FjIGV2ZW50IGvDqW8gdGjhuqMgY+G7mXQsxJHhu5kgcuG7mW5nLC4uLg0KICAgICAgc2VsZWN0ZWRUZXh0TW9kZTogZmFsc2UsDQogICAgICAvL1RyYW5nIGhp4buHbiB04bqhaQ0KICAgICAgY3VycmVudFBhZ2U6IDEsDQoNCiAgICAgIC8vRMOybmcgxJFhbmcgxJHGsOG7o2MgY2jhu41uDQogICAgICByb3dTZWxlY3RlZDoge30sDQogICAgICAvL0tp4buDbSB0cmEgZGF0YSDEkcOjIMSRxrDhu6NjIGxvYWQgaGF5IGNoxrBhDQogICAgICBkYXRhTG9hZGVkOiBmYWxzZSwNCiAgICAgIGhhc1Njcm9sbDogZmFsc2UsDQogICAgICAvKioNCiAgICAgICAqIFbhu4sgdHLDrSBoaeG7g24gdGjhu4sgY+G7p2EgYm94IGVtcHR5DQogICAgICAgKi8NCiAgICAgIGVtcHR5U3R5bGU6IHsNCiAgICAgICAgdG9wOiAwLA0KICAgICAgICBsZWZ0OiAwLA0KICAgICAgICBkaXNwbGF5OiAibm9uZSIsDQogICAgICB9LA0KICAgICAgcGFnZVRvdGFsQ2FwdGlvbkRhdGE6DQogICAgICAgIHRoaXMucGFnZVRvdGFsQ2FwdGlvbiB8fCB0aGlzLiR0KCJpMThuQ29tcG9uZW50LlBhZ2luZy5Ub3RhbCIpLA0KICAgICAgLyoqDQogICAgICAgKiBGaWx0ZXIgdHLDqm4gdGnDqnUgxJHhu4EgY+G7mXQNCiAgICAgICAqLw0KICAgICAgZmlsdGVySGVhZGVyOiBbXSwNCiAgICAgIC8qKg0KICAgICAgICogw7Qgc2VhcmNoIHRleHQgdOG7qyBmb3JtIGLDqm4gbmdvw6BpDQogICAgICAgKi8NCiAgICAgIHBhcmVudFNlYXJjaFRleHQ6ICIiLA0KICAgICAgLyoqDQogICAgICAgKiBoZWFkZXIgcmVuZGVyDQogICAgICAgKi8NCiAgICAgIGhlYWRlcnM6IFtdLA0KDQogICAgICAvKg0KICAgICAgQ2hvIHNob3cgdOG6pXQgY+G6oyBpY29uIGZpbHRlciBoZWFkZXIgbMOqbg0KICAgICAgQ3JlYXRlOiAyMC8wNS8yMDIwDQogICAgICBBdXRob3I6IE5OTEFNICAgIA0KICAgICAgKi8NCiAgICAgIHNob3dBbGxJY29uRmlsdGVyOiBmYWxzZSwNCg0KICAgICAgLyoqDQogICAgICAgKiBmb290ZXIgcmVuZGVyDQogICAgICAgKi8NCiAgICAgIGZvb3RlcnM6IFtdLA0KDQogICAgICAvKioNCiAgICAgICAqIGhlYWRlciByZW5kZXINCiAgICAgICAqLw0KICAgICAgZmlyc3RMb2FkOiB0cnVlLA0KDQogICAgICAvL3Thu5VuZyBz4buRIGLhuqNuIGdoaSAoIHRyxrDhu51uZyBo4bujcCBxdWVyeSBsb2NhbCkNCiAgICAgIHBhZ2VUb3RhbEZuOiBudWxsLA0KICAgICAgLyoqDQogICAgICAgKiBnacOhIHRy4buLIHN0eWxlIGxlZnQgY+G7p2EgY+G7mXQgc2VyaWFsDQogICAgICAgKi8NCiAgICAgIHNlcmlhbE9mZnNldExlZnQ6ICIwIiwNCiAgICAgIC8qKg0KICAgICAgICogQ8OzIGPhu5l0IGxvY2sNCiAgICAgICAqLw0KICAgICAgaGFzTG9ja0NvbHVtbjogZmFsc2UsDQogICAgICAvKioNCiAgICAgICAqIEPDsyDEkWFuZyBz4butIGThu6VuZyBwaMOtbSB04bqvdCDEkeG7gyBjaOG7jW4gbmhhbmggY8OhYyBi4bqjbiBnaGkgaGF5IGtow7RuZw0KICAgICAgICovDQogICAgICBzaG9ydEtleUZvclF1aWNrU2VsZWN0OiBmYWxzZSwNCiAgICAgIC8qKg0KICAgICAgICogTmjhu69uZyBi4bqjbiBnaGkgZGMgY2jhu41uIG5oYW5oIHThu6sgc2hvcnRrZXkNCiAgICAgICAqLw0KICAgICAgc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YTogW10sDQoNCiAgICAgIC8qKg0KICAgICAgICogxJDDoW5oIGThuqV1IGhp4buDbiB0aOG7iyBjb25maWcgY29sdW1uIGJveA0KICAgICAgICogVEROR0hJQSAxLzEwLzIwMjENCiAgICAgICAqLw0KICAgICAgc2hvd2luZ0NvbmZpZ0NvbHVtbkJveDogZmFsc2UsDQoNCiAgICAgIC8qKg0KICAgICAgICogQ2FjaGUgY29uZmlnIGNvbHVtbiBiYW4gxJHhuqd1IGNobyBncmlkDQogICAgICAgKiBURE5HSElBIDEwLzQvMjAyMQ0KICAgICAgICovDQogICAgICBjb25maWdDb2x1bW5PcmlnaW5hbDogW10sDQoNCiAgICAgIC8qKg0KICAgICAgICogxJDDoW5oIGThuqV1IGNoZWNrYm94YWxsIHRyw6puIGhlYWRlciDEkWFuZyB0cuG6oW5nIHRow6FpIHRydW5nIGdpYW4NCiAgICAgICAqIFRETkdISUEgOC8xMC8yMDIxDQogICAgICAgKi8NCiAgICAgIGlzVGVtcFN0YXRlOiBmYWxzZSwNCg0KICAgICAgLyoqDQogICAgICAgKiBnacOhIHRy4buLIHN0eWxlIGxlZnQgY+G7p2EgY+G7mXQgY2hlY2tib3gNCiAgICAgICAqIE5NVFVBTjIgMjIuMDMuMjAyMg0KICAgICAgICovDQogICAgICBtdWx0aXBsZU9mZnNldExlZnQ6ICIwIiwNCiAgICB9Ow0KICB9LA0KICBjb21wdXRlZDogew0KICAgIC8qKg0KICAgICAqIFPhu5EgbMaw4bujbmcgY+G7mXQgc2hpbW1lcg0KICAgICAqLw0KICAgIHNoaW1tZXJDb2x1bW4oKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsZXQgcmVzID0gW107DQoNCiAgICAgIGlmIChtZS5tdWx0aXBsZSkgew0KICAgICAgICByZXMucHVzaCh7DQogICAgICAgICAgb2Zmc2V0OiAwLA0KICAgICAgICAgIGxvY2s6IG1lLmhhc0xvY2tDb2x1bW4sDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBpZiAobWUuc2VyaWFsKSB7DQogICAgICAgIHJlcy5wdXNoKHsNCiAgICAgICAgICBvZmZzZXQ6IG1lLm11bHRpcGxlID8gNjAgOiAwLA0KICAgICAgICAgIGxvY2s6IG1lLmhhc0xvY2tDb2x1bW4sDQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICBpZiAoQXJyYXkuaXNBcnJheShtZS5jb2x1bW54KSkgew0KICAgICAgICBtZS5jb2x1bW54LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICByZXMucHVzaCh7DQogICAgICAgICAgICBvZmZzZXQ6IGl0ZW0uc3RpY2t5T2Zmc2V0LA0KICAgICAgICAgICAgbG9jazogaXRlbS5sb2NrLA0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHJlczsNCiAgICB9LA0KICAgIC8vS2nhu4NtIHRyYSBjw7MgbOG6r25nIG5naGUgeOG7rSBsw70gc+G7sSBraeG7h24gZGJsaWNrIGhheSBraMO0bmc/IG7hur91IGPDsyB0aMOsIMSR4buVaSBpY29uIHRow6BuaCBwb2ludGVyDQogICAgY2hlY2tMaXN0ZW5lckRiQ2xpY2soKSB7DQogICAgICBpZiAodGhpcy5fZXZlbnRzLmRibGNsaWNrICYmIHRoaXMuX2V2ZW50cy5kYmxjbGljay5sZW5ndGggPiAwKSB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0sDQogICAgLy9Iw6BtIGtp4buDbSB0cmEgeGVtIGPDsyBzY3JvbGwgaGF5IGtow7RuZz8NCiAgICBzY3JvbGxWaXNpYWJsZSgpIHsNCiAgICAgIGlmICh0aGlzLmhhc1Njcm9sbCkgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBmYWxzZTsNCiAgICB9LA0KICAgIC8vU+G7sSBraeG7h24gdOG7qyAxIGTDsm5nIGThu68gbGnhu4d1IGVtaXQgcmEgbmdvw6BpDQogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE4LjA2LjIwMjApDQogICAgbGlzdGVuZXJzKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgY2xpY2s6IChkYXRhUm93LCBldmVudCkgPT4gew0KICAgICAgICAgIGlmIChtZS5yb3dTZWxlY3RlZCAmJiBtZS5yb3dTZWxlY3RlZC5kYXRhICE9IGRhdGFSb3cpIHsNCiAgICAgICAgICAgIGxldCBpbmRleFJvdyA9IG1lLmRhdGF4LmZpbmRJbmRleCgoaXRlbSkgPT4gaXRlbSA9PSBkYXRhUm93KTsNCiAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkID0gew0KICAgICAgICAgICAgICBkYXRhOiBkYXRhUm93LA0KICAgICAgICAgICAgICBpbmRleDogaW5kZXhSb3csDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaWYgKGV2ZW50ICYmICFtZS5zaG9ydEtleUZvclF1aWNrU2VsZWN0KSB7DQogICAgICAgICAgICAgIG1lLm9sZEluZGV4T2ZSb3dGb2N1c2VkID0gbWUuaW5kZXhPZlJvd0ZvY3VzZWQ7DQogICAgICAgICAgICAgIG1lLmluZGV4T2ZSb3dGb2N1c2VkID0gbWUuZGF0YXguZmluZEluZGV4KA0KICAgICAgICAgICAgICAgIChpdGVtKSA9PiBpdGVtID09IGRhdGFSb3cNCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmZvY3VzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoIW1lLm11bHRpcGxlKSB7DQogICAgICAgICAgICAgIG1lLnNlbGVjdGVkID0gZGF0YVJvdzsNCiAgICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQuZGF0YSA9IGRhdGFSb3c7DQogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gbWUuZGF0YXguZmluZEluZGV4KA0KICAgICAgICAgICAgICAgIChpdGVtKSA9PiBpdGVtID09IGRhdGFSb3cNCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgbWUuJGVtaXQoImNsaWNrIiwgZGF0YVJvdyk7DQogICAgICAgIH0sDQogICAgICAgIGRyaWxsZG93bkNsaWNrOiAobWV0YURhdGEsIGV2ZW50KSA9PiB7DQogICAgICAgICAgaWYgKGV2ZW50KSB7DQogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy4kZW1pdCgiZHJpbGxkb3duQ2xpY2siLCBtZXRhRGF0YSk7DQogICAgICAgIH0sDQoNCiAgICAgICAgLy9UVkxPSSAyMi4wNS4yMDIxIEV2ZW50IENsaWNrIHbDoG8gY+G7mXTEkeG6oWkgZGnhu4duIGNobyBuaGnhu4F1IGTDsm5nIGNoaSB0aeG6v3QNCiAgICAgICAgdmlld01vcmVEZXRhaWxzOiAobWV0YURhdGEsIGV2ZW50KSA9PiB7DQogICAgICAgICAgaWYgKGV2ZW50KSB7DQogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgdGhpcy4kZW1pdCgidmlld01vcmVEZXRhaWxzIiwgbWV0YURhdGEpOw0KICAgICAgICB9LA0KDQogICAgICAgIGZvY3VzOiAoZGF0YVJvdywgZXZlbnQpID0+IHsNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICBtZS5yb3dTZWxlY3RlZCAmJg0KICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQuZGF0YSAhPSBkYXRhUm93ICYmDQogICAgICAgICAgICAhbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdA0KICAgICAgICAgICkgew0KICAgICAgICAgICAgbGV0IGluZGV4Um93ID0gbWUuZGF0YXguZmluZEluZGV4KChpdGVtKSA9PiBpdGVtID09IGRhdGFSb3cpOw0KICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQgPSB7DQogICAgICAgICAgICAgIGRhdGE6IGRhdGFSb3csDQogICAgICAgICAgICAgIGluZGV4OiBpbmRleFJvdywNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgbWUuJGVtaXQoImZvY3VzIiwgZGF0YVJvdyk7DQogICAgICAgIH0sDQogICAgICAgIG1vdXNlb3ZlcjogKGRhdGFSb3csIGV2ZW50KSA9PiB7DQogICAgICAgICAgbWUuJGVtaXQoInJvd21vdXNlb3ZlciIsIGRhdGFSb3csIGV2ZW50KTsNCiAgICAgICAgfSwNCiAgICAgICAgcm93YWN0aW9uY2xpY2s6IChjb21tYW5kLCBkYXRhUm93LCBldmVudCkgPT4gew0KICAgICAgICAgIC8vIE5NVFVBTjIgMjMuMDkuMjAyMTogYuG7lSBzdW5nIMSR4buDIHBo4bulYyB24bulIHRydXnhu4FuIGvDqG0gMSBz4buRIHRow7RuZyB0aW4gdHXhu7MgY2jhu4luaA0KICAgICAgICAgIGxldCBvcHRpb25zID0gew0KICAgICAgICAgICAgU3ViU3lzdGVtQ29kZTogbWUuc3ViU3lzdGVtQ29kZSwNCiAgICAgICAgICB9Ow0KDQogICAgICAgICAgbWUuJGVtaXQoInJvd2FjdGlvbmNsaWNrIiwgY29tbWFuZCwgZGF0YVJvdywgZXZlbnQsIG9wdGlvbnMpOw0KICAgICAgICB9LA0KICAgICAgICBkYmxjbGljazogKGRhdGFSb3csIGV2ZW50KSA9PiB7DQogICAgICAgICAgbWUuJGVtaXQoImRibGNsaWNrIiwgZGF0YVJvdywgZXZlbnQpOw0KICAgICAgICB9LA0KICAgICAgICBrZXlkb3duOiAoZGF0YVJvdywgZXZlbnQpID0+IHsNCiAgICAgICAgICBtZS5yb3dfa2V5ZG93bihkYXRhUm93LCBldmVudCk7DQogICAgICAgICAgbWUuJGVtaXQoImtleWRvd24iLCBkYXRhUm93LCBldmVudCk7DQogICAgICAgIH0sDQogICAgICAgIHdpZGdldEV2ZW50OiAoZGF0YSwgZXZlbnQpID0+IHsNCiAgICAgICAgICBtZS4kZW1pdCgid2lkZ2V0RXZlbnQiLCBkYXRhLCBldmVudCk7DQogICAgICAgIH0sDQogICAgICAgIGNsaWNrTXVsdGlwbGU6IChkYXRhUm93LCBjaGVja2VkKSA9PiB7DQogICAgICAgICAgbWUuY2xpY2tNdWx0aXBsZShkYXRhUm93LCBjaGVja2VkKTsNCiAgICAgICAgfSwNCiAgICAgIH07DQogICAgfSwNCiAgICAvLyAvL1NldCBzdHlsZSBjaG8gZ3JpZCDEkeG7mSBy4buZbmcsLi4uDQogICAgZ3JpZFZpZXdTdHlsZSgpIHsNCiAgICAgIGlmICh0aGlzLm1heEhlaWdodCkgew0KICAgICAgICByZXR1cm4geyAibWF4LWhlaWdodCI6IHRoaXMubWF4SGVpZ2h0IH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgIH0NCiAgICB9LA0KICAgIGRhdGFFbXB0eSgpIHsNCiAgICAgIC8vIHJldHVybiBmYWxzZTsNCiAgICAgIGlmICh0aGlzLmRhdGF4ICYmIHRoaXMuZGF0YXgubGVuZ3RoID4gMCkgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9IGVsc2UgcmV0dXJuIHRydWU7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgeGVtIHThuqV0IGPhuqMgZOG7ryBsaeG7h3UgY8OzIMSRYW5nIMSRxrDhu6NjIGNoZWNrIGhheSBraMO0bmcNCiAgICAgKiBH4buNaSDEkeG6v24gbeG7l2kga2hpIHRpY2sgY2jhu41uIGNoZWNrYm94DQogICAgICogVEROR0hJQSA4LzEwLzIwMjE6IFRow6ptIGx14buTbmcgY2hlY2sgbuG6v3UgbcOgIGNoxrBhIHRpY2sgxJHhu6cgdGjDrCBz4bq9IGFkZCBjbGFzcyB0ZW1wDQogICAgICogdHLhuqFuZyB0aMOhaSBjaGVja2JveCBoaeG7h24gdOG6oWkgc+G6vSBsw6AgdHJ1bmcgZ2lhbiBz4butIGThu6VuZyDEkeG7gyBi4buPIGNo4buNbg0KICAgICAqLw0KICAgIGlzQ2hlY2tlZE11bHRpcGxlKCkgew0KICAgICAgaWYgKHRoaXMudmFsdWUpIHsNCiAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmRhdGF4LmZpbHRlcigoaSkgPT4gIWkuaXNEaXNhYmxlZENoZWNrQm94KTsgLy90w6xtIHThuqV0IGPhuqMgYuG6o24gZ2hpIHRyw6puIHBhZ2UgbcOgIMO0IGNoZWNrYm94IGsgYuG7iyBkaXNhYmxlZA0KICAgICAgICAvL8SQVlRoaSAxOS8wMS8yMDIxOiBz4butYSBs4buXaSBUQSBraGkgbWUuZGF0YXggbnVsbCB0aMOsIMSRb+G6oW4gY29kZSBuw6B5IHbEg25nIGzhu5dpIFRBDQogICAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoICE9IDApIHsNCiAgICAgICAgICAvL1RyxrDhu51uZyBo4bujcCBjaOG7jW4gaOG6v3QgdGjDrCB0aWNrIHbDoG8gY2hlY2tib3hhbGwNCiAgICAgICAgICBpZiAoDQogICAgICAgICAgICB0aGlzLnZhbHVlLmxlbmd0aCA+PSBkYXRhLmxlbmd0aCAmJg0KICAgICAgICAgICAgZGF0YS5ldmVyeSgoaXRlbSwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUuaW5jbHVkZXMoaXRlbSk7DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICkgew0KICAgICAgICAgICAgdGhpcy5pc1RlbXBTdGF0ZSA9IGZhbHNlOyAvL3Thuq90IHRy4bqhbmcgdGjDoWkgdHJ1bmcgZ2lhbiDEkWkNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvL07hur91IGNoxrBhIGNo4buNbiBo4bq/dCB0aMOsIGNoZWNrIHhlbSBjw7MgxJFhbmcgdGljayBkw7JuZyBuw6BvIGtow7RuZw0KICAgICAgICAgICAgLy9O4bq/dSBjw7MgdGljayB0aMOsIHRy4bqhbmcgdGjDoWkgbMOgIHRydW5nIGdpYW4NCiAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA8IGRhdGEubGVuZ3RoICYmIHRoaXMudmFsdWUubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICB0aGlzLmlzVGVtcFN0YXRlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgdGhpcy5pc1RlbXBTdGF0ZSA9IGZhbHNlOw0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBsb2NrQ291bnQoKSB7DQogICAgICAvLyBsZXQgY291bnQgPSB0aGlzLm11bHRpcGxlID8gMSA6IDA7DQogICAgICBsZXQgY291bnQgPSAwOw0KICAgICAgaWYgKHRoaXMuY29sdW1ueCkgew0KICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29sdW1ueC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGxldCBjb2wgPSB0aGlzLmNvbHVtbnhbaV07DQogICAgICAgICAgaWYgKCFjb2wubG9jaykgew0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICAgIGNvdW50Kys7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBjb3VudDsNCiAgICB9LA0KICAgIHN0aWNrZXlDb3VudENsYXNzKCkgew0KICAgICAgbGV0IGNvdW50ID0gdGhpcy5sb2NrQ291bnQ7DQogICAgICBpZiAoY291bnQgPiAwKSB7DQogICAgICAgIGlmICh0aGlzLnNlcmlhbCkgew0KICAgICAgICAgIGNvdW50Kys7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gWyJzdGlja3kiLCBjb3VudF0uam9pbigiLSIpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIG51bGw7DQogICAgfSwNCiAgICAvL1N0eWxlIHTDrW5oIGzhuqFpIHThu41hIMSR4buZIGNobyBmb290ZXIga2hpIGPDsyBwYWdpbmF0aW9uDQogICAgYm90dG9tRm9vdGVyKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgaWYgKG1lLnBhZ2luYXRpb24gJiYgbWUuZm9vdGVyKSB7DQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgYm90dG9tOiAiNDZweCIsDQogICAgICAgIH07DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgIGJvdHRvbTogIjBweCIsDQogICAgICAgIH07DQogICAgICB9DQogICAgfSwNCiAgfSwNCiAgLyoqDQogICAqDQogICAqLw0KICB3YXRjaDogew0KICAgIGRhdGE6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsNCiAgICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgICAgdGhpcy5jaGVja0hhc1Njcm9sbCgpOw0KICAgICAgICBpZiAobWUuZGF0YXggIT0gbWUuZGF0YSkgew0KICAgICAgICAgIG1lLmluaXREYXRhKG5ld1ZhbCk7DQogICAgICAgICAgaWYgKG1lLmZpcnN0TG9hZCAmJiBuZXdWYWwubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgbWUuZmlyc3RMb2FkID0gZmFsc2U7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChtZS5ncm91cEZpZWxkKSB7DQogICAgICAgICAgICBtZS4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgICAgICBtZS5kZWZhdWx0RXhwYW5kKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICB9DQogICAgICAgICAgLy8gY2hlY2sgc2VsZWN0ZWQgY8OhYyBi4bqjbiBnaGkga2hpIG3DoCBsb2FkIGzhuqFpIHRyYW5nIGhv4bq3YyBzZWFyY2ggbMOgbSB0aGF5IMSR4buVaSBkYXRhIGdyaWQNCiAgICAgICAgICBpZiAobWUudmFsdWUpIHsNCiAgICAgICAgICAgIG1lLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgICAgIGxldCBWTW9kZWwgPSBbLi4ubWUudmFsdWVdOw0KICAgICAgICAgICAgICBWTW9kZWwuZm9yRWFjaCgoZGF0YVJvdykgPT4gew0KICAgICAgICAgICAgICAgIGxldCBtYXAgPSBtZS5kYXRheC5maW5kKA0KICAgICAgICAgICAgICAgICAgKGRhdGEpID0+IGRhdGFbbWUuaWRGaWVsZF0gPT0gZGF0YVJvd1ttZS5pZEZpZWxkXQ0KICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgaWYgKG1hcCkgew0KICAgICAgICAgICAgICAgICAgbWUudmFsdWUucmVtb3ZlKGRhdGFSb3cpOw0KICAgICAgICAgICAgICAgICAgbWUudmFsdWUucHVzaChtYXApOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLnZhbHVlKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vbuG6v3Uga2jDtG5nIGPDsyBk4buvIGxp4buHdSB0w61uaCB0b8OhbiB24buLIHRyw60gaGnhu4NuIHRo4buLIGPhu6dhIGJveCBlbXB0eQ0KICAgICAgICAvL2NvbnRyb2wgY2jGsGEgcmVuZGVyIHRow6wgY8WpbmcgayB44butIGzDvQ0KICAgICAgICBpZiAoKCFuZXdWYWwgfHwgbmV3VmFsLmxlbmd0aCA9PT0gMCkgJiYgbWUuJGVsKSB7DQogICAgICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICAgIGxldCBzY3JvbGwgPSBtZS4kcmVmcy5jb250ZW50Ow0KICAgICAgICAgICAgaWYgKHNjcm9sbCkgew0KICAgICAgICAgICAgICBsZXQgc2Nyb2xsUG9zID0gc2Nyb2xsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgICAgICAgICBtZS5lbXB0eVN0eWxlID0gew0KICAgICAgICAgICAgICAgIHRvcDogW3Njcm9sbFBvcy50b3AgKyBzY3JvbGxQb3MuaGVpZ2h0IC8gMiAtIDk1LCAicHgiXS5qb2luKCIiKSwNCiAgICAgICAgICAgICAgICBsZWZ0OiBbc2Nyb2xsUG9zLmxlZnQgKyBzY3JvbGxQb3Mud2lkdGggLyAyIC0gMTI1LCAicHgiXS5qb2luKA0KICAgICAgICAgICAgICAgICAgIiINCiAgICAgICAgICAgICAgICApLA0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9LA0KICAgIH0sDQogICAgbG9hZGluZyhpc0xvYWRpbmcpIHsNCiAgICAgIGlmICghaXNMb2FkaW5nKSB7DQogICAgICAgIHRoaXMuYXV0b1NlbGVjdGVkRmlyc3RSb3coZmFsc2UpOw0KICAgICAgfQ0KICAgIH0sDQogICAgcGFnZVNpemU6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsNCiAgICAgICAgdGhpcy4kZW1pdCgicGFnZVNpemUiLCBuZXdWYWwpOw0KICAgICAgfSwNCiAgICB9LA0KDQogICAgcm93U2VsZWN0ZWQ6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHt9LA0KICAgIH0sDQogIH0sDQogIC8vTuG6v3UgZOG7ryBsaeG7h3UgdGhheSDEkeG7lWkgdGjDrCBjaGVjayBzY3JvbGwNCiAgdXBkYXRlZCgpIHsNCiAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgbWUudXBkYXRlU2l6ZSgpOw0KICB9LA0KICAvKioNCiAgICogSMOgbSBraOG7n2kgdOG6oW8gZ3JpZCBraOG7n2kgdOG6oW8gY29sdW1uIHbDoG8gZGF0YQ0KICAgKiBDcmVhdGVkIGJ5IExUREFUIDE2LjA2LjIwMjANCiAgICovDQogIGNyZWF0ZWQoKSB7DQogICAgY29uc3QgbWUgPSB0aGlzOw0KICAgIG1lLmluaXRDb2x1bW5zKCk7DQogICAgbWUuaW5pdERhdGEoKTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrT3V0R3JpZCk7DQogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInJlc2l6ZSIsIG1lLnVwZGF0ZVNpemUpOw0KICB9LA0KICBtb3VudGVkKCkge30sDQogIGJlZm9yZURlc3Ryb3koKSB7DQogICAgY29uc3QgbWUgPSB0aGlzOw0KICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbWUuY2xpY2tPdXRHcmlkKTsNCiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgbWUudXBkYXRlU2l6ZSk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvKioNCiAgICAgKiBDaHV54buDbiB24buBIHRyYW5nIGNo4buJIMSR4buLbmgNCiAgICAgKi8NCiAgICBzZXRQYWdlKHBhZ2UpIHsNCiAgICAgIHRoaXMuY3VycmVudFBhZ2UgPSBwYWdlOw0KICAgIH0sDQogICAgLyoqDQogICAgICogSGnhu4NuIHRo4buLIHRleHQgdMOtbmggdOG7lW5nIHRoZW8gxJHhu4tuaCBk4bqhbmcgZm9ybWF0DQogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbCBj4bqldSBow6xuaCBj4buZdA0KICAgICAqIEBhdXRob3IgTlZMQU0gMTAuMTIuMjAyMA0KICAgICAqLw0KICAgIGdldFN1bW1hcnlEaXNwbGF5KGNvbCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbGV0IGRhdGFSZW5kZXIgPSAiIjsNCiAgICAgIGlmIChtZS5zdW1tYXJ5RGF0YSkgew0KICAgICAgICBkYXRhUmVuZGVyID0gbWUuc3VtbWFyeURhdGFbY29sLmRhdGFGaWVsZF07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkYXRhUmVuZGVyID0gY29sLmZvb3RlckNvbW1hbmQNCiAgICAgICAgICA/IG1lLmRvRnVuY3Rpb24oY29sLmZvb3RlckNvbW1hbmQsIGNvbC5kYXRhRmllbGQsIGNvbC5kYXRhRm9ybWF0KQ0KICAgICAgICAgIDogY29sLmZvb3RlclRleHQ7DQogICAgICB9DQogICAgICBsZXQgdmFsdWUgPSBtZS4kb3B0aW9ucy5maWx0ZXJzLmZvcm1hdERhdGEoZGF0YVJlbmRlciwgew0KICAgICAgICBmb3JtYXRUeXBlOiBjb2wuZGF0YUZvcm1hdCB8fCBjb2wuZm9ybWF0VHlwZSwNCiAgICAgICAgaXNSZXBvcnQ6IG1lLmlzUmVwb3J0Vmlld2VyLA0KICAgICAgICBvcHRpb25Gb3JtYXQ6IGNvbC5vcHRpb25Gb3JtYXQsDQogICAgICB9KTsNCiAgICAgIHJldHVybiB2YWx1ZSA9PSAiLS0iIHx8IHZhbHVlID09ICItIiA/IG51bGwgOiB2YWx1ZTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24gdGhlbyBjw7RuZyB0aOG7qWMgxJHGsOG7o2MgY+G6pXUgaMOsbmggdOG6oWkgY+G6pXUgaMOsbmggY+G7mXQNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY29tbWFuZDogY8O0bmcgdGjhu6ljDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGZpZWxkOiBj4buZdA0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhRm9ybWF0OiBraeG7g3UgZOG7ryBsaeG7h3UgY+G7p2EgY+G7mXQNCiAgICAgKiBAYXV0aG9yIE5WTEFNIDI0LjA5LjIwMjANCiAgICAgKi8NCiAgICBkb0Z1bmN0aW9uKGNvbW1hbmQsIGZpZWxkLCBkYXRhRm9ybWF0KSB7DQogICAgICBsZXQgbWUgPSB0aGlzLA0KICAgICAgICByZXN1bHQ7DQogICAgICBzd2l0Y2ggKGNvbW1hbmQpIHsNCiAgICAgICAgY2FzZSBNU0VudW0uRm9vdGVyQ29tbWFuZC5TdW06DQogICAgICAgICAgcmVzdWx0ID0gbWUuc3VtRmllbGQoZmllbGQsIGRhdGFGb3JtYXQpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIE1TRW51bS5Gb290ZXJDb21tYW5kLlN1bUFsbDoNCiAgICAgICAgICByZXN1bHQgPSBtZS5zdW1BbGxGaWVsZChmaWVsZCwgZGF0YUZvcm1hdCk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0sDQogICAgLy8gVGluaHMgdG9uZyB0cmVuIGZpZWxkDQogICAgc3VtRmllbGQoZmllbGQsIGRhdGFGb3JtYXQpIHsNCiAgICAgIGxldCBtZSA9IHRoaXMsDQogICAgICAgIHN1bSA9IDA7DQogICAgICBtZS5kYXRheC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgIGlmIChpdGVtW2ZpZWxkXSkgew0KICAgICAgICAgIHN1bSArPSBwYXJzZUZsb2F0KGl0ZW1bZmllbGRdKTsgLy8udG9GaXhlZChGb3JtYXRVdGlsLmdldERlY2ltYWxEaWdpdEJ5Rm9ybWF0VHlwZShkYXRhRm9ybWF0KSkNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgICByZXR1cm4gc3VtOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBUw61uaCB04buVbmcgdOG6pXQgY+G6oyBjw6FjIGThu68gbGnhu4d1IHRoZW8gZmllbGQNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQ6IGPhu5l0DQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGRhdGFGb3JtYXQ6IGtp4buDdSBk4buvIGxp4buHdSBj4bunYSBj4buZdA0KICAgICAqIEBhdXRob3IgTlZMQU0gMjQuMDkuMjAyMA0KICAgICAqLw0KICAgIHN1bUFsbEZpZWxkKGZpZWxkLCBkYXRhRm9ybWF0KSB7DQogICAgICBsZXQgc3VtID0gMCwNCiAgICAgICAgZGF0YSA9IG1lLmRhdGF4Ow0KICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7DQogICAgICAgIGRhdGEuZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgIGlmIChpdGVtW2ZpZWxkXSkgew0KICAgICAgICAgICAgc3VtICs9IHBhcnNlRmxvYXQoaXRlbVtmaWVsZF0pOyAvLy50b0ZpeGVkKEZvcm1hdFV0aWwuZ2V0RGVjaW1hbERpZ2l0QnlGb3JtYXRUeXBlKGRhdGFGb3JtYXQpKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiBzdW07DQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBIw6BtIGNo4buNbiBkw7JuZyDEkeG6p3UgdGnDqm4NCiAgICAgKiBpc2NoZWNrYm94OiBjw7MgdMOtY2ggY2jhu41uIHbDoG8gw7QgY2hlY2tib3gga2jDtG5nLCBt4bq3YyDEkeG7i25oIGzDoCBraMO0bmcgdsOgIGNo4buJIMSRxqFuIHRodeG6p24gbMOgIGNsaWNrIHbDoG8gZMOybmcgxJHhuqd1IHRpw6puDQogICAgICogY3JlYXRlZCBieSBubmxhbSAwNi4wMy4yMDIxDQogICAgICogVEROR0hJQSAyLzEyLzIwMjE6IGlzQ2hlY2tib3ggxJFhbmcgdHJ1eeG7gW4gZXZlbnQgdsOgbyBuw6puIGzDumMgbsOgbyBjxaluZyBjaOG7jW4gZGMga2jDtG5nIHLDtSBsw70gZG8gPT4gaXNDaGVja2JveCAgPSBmYWxzZQ0KICAgICAqLw0KICAgIGF1dG9TZWxlY3RlZEZpcnN0Um93KGlzY2hlY2tib3gpIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBtZS4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICBpZiAobWUuZGF0YXgubGVuZ3RoID4gMCkgew0KICAgICAgICAgIGlmIChpc2NoZWNrYm94KSB7DQogICAgICAgICAgICAvL1RETkdISUEgMi8xMi8yMDIxOiBraMO0bmcgYmFvIGdp4budIHbDoG8gxJHDonkgbuG7r2ENCiAgICAgICAgICAgIG1lLmluZGV4T2ZSb3dGb2N1c2VkID0gMDsNCiAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkID0geyBkYXRhOiBtZS5kYXRheFswXSwgaW5kZXg6IDAgfTsNCiAgICAgICAgICB9DQogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgICBsZXQgdHJGaXJzdCA9IG1lLiRlbC5xdWVyeVNlbGVjdG9yKCIubXMtdGJvZHkuZGF0YSB0ciIpOw0KICAgICAgICAgICAgLy9OVEJBTzogMjYuMTEuMjAyMSBU4bqhbyB0aMOqbSBow6BtIGzhuqV5IGTDsm5nIHNlbGV0ZWN0IMSR4bqndSB0acOqbiB04buxIGNo4buNbg0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtZS5nZXRSb3dBdXRvRm9jdXMgPT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgICAgICB0ckZpcnN0ID0gbWUuZ2V0Um93QXV0b0ZvY3VzKCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHJGaXJzdCkgew0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgdHlwZW9mIHRyRmlyc3QuZ2V0VnVlSW5zdGFuY2UgPT0gImZ1bmN0aW9uIiAmJg0KICAgICAgICAgICAgICAgIHRyRmlyc3QuZ2V0VnVlSW5zdGFuY2UoKQ0KICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICB0ckZpcnN0LmdldFZ1ZUluc3RhbmNlKCkuX2V2ZW50cy5jbGljazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBtZS4kZW1pdCgiZm9jdXMiLCBtZS5kYXRheFswXSk7DQogICAgICAgICAgICAgIGlmIChtZS5pc0F1dG9Gb2N1c0ZpcnN0Um93KSB7DQogICAgICAgICAgICAgICAgdHJGaXJzdC5mb2N1cygpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBtZS4kZW1pdCgiZmlyc3RMb2FkIiwgbWUuZGF0YXhbMF0pOw0KICAgICAgICAgIH0sIDIwMCk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBIw6BtIEPhuq1wIG5o4bqtdCBs4bqhaSBnaWFvIGRp4buHbiBraGkgY8OzIHNjcm9sbCBoYXkga2hpIMSR4buZIHLhu5luZyBj4bunYSBkYXRhIGTDoGkgaMahbiDEkeG7mSBy4buZbmcgbeG6t2MgxJHhu4tuaCBj4bunYSBj4buZdA0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQNCiAgICAgKi8NCiAgICB1cGRhdGVTaXplKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgLy8gbWUuY2hlY2tIYXNTY3JvbGwoKTsNCiAgICAgICAgaWYgKG1lLiRyZWZzLnRyICYmIG1lLiRyZWZzLnRyLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBtZS5jb2x1bW54LmZvckVhY2goKGNvbCwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgIGxldCBjaGFuZ2VNaW5XaWR0aCA9IGZhbHNlOw0KICAgICAgICAgICAgbWUuJHJlZnMudHIuZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgaXRlbS4kcmVmc1tgdGV4dC0ke2NvbC5kYXRhRmllbGR9YF0gJiYNCiAgICAgICAgICAgICAgICBpdGVtLiRyZWZzW2B0ZXh0LSR7Y29sLmRhdGFGaWVsZH1gXS5sZW5ndGggPiAwDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIGxldCB0ZXh0U3BhbiA9DQogICAgICAgICAgICAgICAgICBpdGVtLiRyZWZzW2B0ZXh0LSR7Y29sLmRhdGFGaWVsZH1gXVswXS5vZmZzZXRXaWR0aDsNCiAgICAgICAgICAgICAgICBpZiAoY29sLl93aWR0aCA8IHRleHRTcGFuICsgMjApIHsNCiAgICAgICAgICAgICAgICAgIGNoYW5nZU1pbldpZHRoID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgICAgbWUuJHJlZnMudGhbaW5kZXhdLiRlbC5vZmZzZXRXaWR0aCAhPQ0KICAgICAgICAgICAgICAgICAgICBpdGVtLiRyZWZzW2B0ZC0ke2NvbC5kYXRhRmllbGR9YF1bMF0ub2Zmc2V0V2lkdGgNCiAgICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgICBtZS4kc2V0KA0KICAgICAgICAgICAgICAgICAgICAgIGNvbCwNCiAgICAgICAgICAgICAgICAgICAgICAiX21pbldpZHRoIiwNCiAgICAgICAgICAgICAgICAgICAgICBpdGVtLiRyZWZzW2B0ZC0ke2NvbC5kYXRhRmllbGR9YF1bMF0ub2Zmc2V0V2lkdGgNCiAgICAgICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgICAgICAgbWUuJHNldCgNCiAgICAgICAgICAgICAgICAgICAgICBjb2wsDQogICAgICAgICAgICAgICAgICAgICAgIl93aWR0aCIsDQogICAgICAgICAgICAgICAgICAgICAgaXRlbS4kcmVmc1tgdGQtJHtjb2wuZGF0YUZpZWxkfWBdWzBdLm9mZnNldFdpZHRoDQogICAgICAgICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmIChjaGFuZ2VNaW5XaWR0aCA9PSBmYWxzZSkgew0KICAgICAgICAgICAgICBtZS4kc2V0KGNvbCwgIl9taW5XaWR0aCIsIGNvbC5fd2lkdGgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIGlmIChtZS4kcmVmcy50ckdyb3VwKSB7DQogICAgICAgICAgICBtZS4kcmVmcy50ckdyb3VwLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgIGxldCB0ZEdyb3VwID0gaXRlbS5xdWVyeVNlbGVjdG9yKCIudGQtZ3JvdXAiKTsNCiAgICAgICAgICAgICAgaWYgKHRkR3JvdXApIHsNCiAgICAgICAgICAgICAgICBsZXQgY29sc3BhbiA9IHRkR3JvdXAuZ2V0QXR0cmlidXRlKCJjb2xzcGFuIik7DQogICAgICAgICAgICAgICAgbGV0IHRkR3JvdXBXaWR0aCA9IDA7DQogICAgICAgICAgICAgICAgaWYgKG1lLiRyZWZzLnRoICYmIGNvbHNwYW4pIHsNCiAgICAgICAgICAgICAgICAgIGxldCBpID0gbWUubXVsdGlwbGUgPyAwIDogMTsNCiAgICAgICAgICAgICAgICAgIGZvciAoaTsgaSA8PSBjb2xzcGFuOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHRoQ3VycmVudEVsZW1lbnQgPSBtZS4kcmVmcy50aFtpXTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoQ3VycmVudEVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICB0ZEdyb3VwV2lkdGggKz0gdGhDdXJyZW50RWxlbWVudC4kZWwub2Zmc2V0V2lkdGg7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGRHcm91cC5zdHlsZS53aWR0aCA9IHRkR3JvdXBXaWR0aCArICJweCI7DQogICAgICAgICAgICAgICAgdGRHcm91cC5zdHlsZS5tYXhXaWR0aCA9IHRkR3JvdXBXaWR0aCArICJweCI7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBIw6BtIHRyxrDhu5tjIHRo4buxYyBoaeG7h24gdHJhbnNpdGlvbiBi4bqvdCDEkeG6p3UgcmVuZGVyLg0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQNCiAgICAgKi8NCiAgICBiZWZvcmVSZW5kZXJDb250ZW50KCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUudXBkYXRlU2l6ZSgpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogVGjhu7FjIGhp4buHbiBraGkg4bqlbiB2w6BvIG5nb8OgaSBncmlkIGxv4bqhaSBi4buPIHJvdyDEkWFuZyBjaOG7jW4NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUDQogICAgICogICovDQoNCiAgICBjbGlja091dEdyaWQoZXZlbnQpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmIChldmVudC50YXJnZXQuY2xvc2VzdCgiLm1zLWdyaWQtdmlld2VyIikgIT0gbWUuJGVsKSB7DQogICAgICAgIC8vbWUucm93U2VsZWN0ZWQgPSB7fTsgIG5ubGFtIGLhu48gxJFpIHbDrCBraGkgY2xpY2sgcmEgbmdvw6BpIHRow6wgbmjhu69uZyBkw7JuZyDEkcaw4bujYyBjaOG7jW4gbW9uZyBtdeG7kW4gduG6q24gZ2nhu68gbmd1ecOqbiBmb2N1cw0KICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIHZp4buHYyBzb3J0IHRyw6puIGdyaWQNCiAgICAgKiBAcGFyYW1zIGNvbCBj4buZdCDEkcaw4bujYyB0aOG7sWMgaGnhu4duIHPhuq9wIHPhur9wDQogICAgICogQHBhcmFtcyBtb2RlIGfhu5NtIG51bGwsREVTQyxBU0MNCiAgICAgKiBjcmVhdGVkIGJ5IExUREFUDQogICAgICovDQoNCiAgICBzb3J0KGNvbCwgbW9kZSkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgaWYgKG1lLmRhdGF4ICYmIG1lLmRhdGF4Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgaWYgKG1lLnJlbW90ZVNvcnQgPT0gInJlbW90ZSIpIHsNCiAgICAgICAgICBsZXQgcGF5bG9hZCA9IHsNCiAgICAgICAgICAgIHNraXA6IChtZS5jdXJyZW50UGFnZSAtIDEpICogbWUucGFnZVNpemUsDQogICAgICAgICAgICB0YWtlOiBtZS5wYWdlU2l6ZSwNCiAgICAgICAgICB9Ow0KICAgICAgICAgIGlmIChtb2RlICE9IG1lLiRtcy5lbnVtLlNvcnRTdGF0dXMubm9uZSkgew0KICAgICAgICAgICAgcGF5bG9hZC5Tb3J0ID0gYCR7DQogICAgICAgICAgICAgIGNvbC5pc0V4dERhdGENCiAgICAgICAgICAgICAgICA/IGBKU09OX1VOUVVPVEUoSlNPTl9FWFRSQUNUKEV4dERhdGEsICckLiR7Y29sLmRhdGFGaWVsZH0nKSlgDQogICAgICAgICAgICAgICAgOiBjb2wuZGF0YUZpZWxkDQogICAgICAgICAgICB9ICR7bW9kZSA9PSBtZS4kbXMuZW51bS5Tb3J0U3RhdHVzLmRlc2MgPyAiREVTQyIgOiAiQVNDIn1gOw0KICAgICAgICAgIH0NCiAgICAgICAgICBtZS5saXN0ZW5lcnNMb2FkRGF0YShwYXlsb2FkKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBsZXQgZGF0YSA9IG51bGw7DQogICAgICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PSAibG9jYWwiICYmIHR5cGVvZiBtZS5maWx0ZXJGbiA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgICBkYXRhID0gbWUuZmlsdGVyRm4oKTsNCiAgICAgICAgICAgIG1lLnBhZ2VUb3RhbEZuID0gZGF0YSA/IGRhdGEubGVuZ3RoIDogMDsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZGF0YSA9IFsuLi5tZS5pbnRlcm5hbERhdGFTb3VyY2VdOw0KICAgICAgICAgIH0NCiAgICAgICAgICAvL2jDoG0gc29ydA0KICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikgew0KICAgICAgICAgICAgaWYgKGFbY29sLmRhdGFGaWVsZF0gPCBiW2NvbC5kYXRhRmllbGRdKQ0KICAgICAgICAgICAgICByZXR1cm4gbW9kZSA9PSBtZS4kbXMuZW51bS5Tb3J0U3RhdHVzLmRlc2MgPyAxIDogLTE7DQogICAgICAgICAgICBpZiAoYVtjb2wuZGF0YUZpZWxkXSA+IGJbY29sLmRhdGFGaWVsZF0pDQogICAgICAgICAgICAgIHJldHVybiBtb2RlID09IG1lLiRtcy5lbnVtLlNvcnRTdGF0dXMuYXNjID8gMSA6IC0xOw0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy90aOG7sWMgaGnhu4duIHNvcnQNCiAgICAgICAgICBpZiAobW9kZSAhPSBtZS4kbXMuZW51bS5Tb3J0U3RhdHVzLm5vbmUpIHsNCiAgICAgICAgICAgIGRhdGEgPSBkYXRhLnNvcnQoY29tcGFyZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy9u4bq/dSBjw7MgcGjDom4gdHJhbmcgdGjDrCBwaMOibiB0cmFuZw0KICAgICAgICAgIGlmIChtZS5wYWdpbmF0aW9uKSB7DQogICAgICAgICAgICBsZXQgcGFnZVNpemUgPSBtZS5wYWdlU2l6ZSA/IG1lLnBhZ2VTaXplIDogMjAsDQogICAgICAgICAgICAgIG1pbiA9IE1hdGguY2VpbCgobWUuY3VycmVudFBhZ2UgLSAxKSAqIHBhZ2VTaXplKSwNCiAgICAgICAgICAgICAgbWF4ID0gbWluICsgcGFnZVNpemU7DQogICAgICAgICAgICBtZS5kYXRheCA9IGRhdGEuZmlsdGVyKChpdGVtLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICByZXR1cm4gaW5kZXggPj0gbWluICYmIGluZGV4IDwgbWF4Ow0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG1lLmRhdGF4ID0gZGF0YTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIC8vS2nhu4NtIHRyYSB4ZW0gZ3JpZCBjw7Mgc2Nyb2xsIGhheSBraMO0bmcgxJHhu4MgY2jhu4luaCBs4bqhaSBzaXplIGPhu6dhIGdyaWQgY2hvIMSRw7puZw0KICAgIC8vQ3JlYXRlZCBieSBMVERBVCAoMjkuMDcuMjAyMCkNCiAgICBjaGVja0hhc1Njcm9sbCgpIHsNCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgaWYgKHRoaXMuJHJlZnMuY29udGVudCkgew0KICAgICAgICAgIGlmICgNCiAgICAgICAgICAgIHRoaXMuJHJlZnMuY29udGVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgKyAyIDwNCiAgICAgICAgICAgIHRoaXMuJHJlZnMuY29udGVudC5zY3JvbGxIZWlnaHQNCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIHRoaXMuaGFzU2Nyb2xsID0gdHJ1ZTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhpcy5oYXNTY3JvbGwgPSBmYWxzZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqDQogICAgICogSMOgbSBs4bqvbmcgbmdoZSBz4buxIGtp4bq/biB0aGF5IMSR4buVaSB0cmFuZyBu4bq/dSB0aGF5IMSR4buVaSB0aMOsIGVtaXQgc+G7sSBraeG7h24gbG9hZCBkYXRhIG3hu5tpIHJhIG5nb8OgaQ0KICAgICAqIEBwYXJhbSBwYXlsb2FkIGThu68gbGnhu4d1IHRow7RuZyB0aW4gdHJhbmcgZ+G7rWkgcmEgbmdvw6BpDQogICAgICogICovDQogICAgLy9DcmVhdGVkIGJ5IExUREFUKDI3LjA3LjIwMjApDQogICAgbGlzdGVuZXJzTG9hZERhdGEocGF5bG9hZCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgaWYgKG1lLnBhZ2luYXRpb24pIHsNCiAgICAgICAgbWUuY3VycmVudFBhZ2UgPSBwYXlsb2FkLnNraXAgLyBwYXlsb2FkLnRha2UgKyAxOw0KICAgICAgICAvL07hur91IHRo4buxYyBoaeG7h24gbOG6pXkgZGF0YSBkxrDhu5tpIGxvY2FsIHRow6wgdGjhu6ljIGhp4buHbiBsxrB1IGThu68gbGnhu4d1IHbDoG8gaW50ZXJuYWxEYXRhU291cmNlIHbDoCBwaMOibiB0cmFuZyBsb2NhbA0KICAgICAgICBpZiAobWUucXVlcnlNb2RlID09ICJsb2NhbCIgJiYgbWUucGFnaW5hdGlvbikgew0KICAgICAgICAgIC8vIGNvbW1vbkZuLmdlblZLZXlWYWx1ZShtZS5pbnRlcm5hbERhdGFTb3VyY2UpOw0KICAgICAgICAgIG1lLmRhdGF4ID0gbWUuZ2V0SXRlbVBhZ2luYXRpb24oKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgbWUuJHJlZnMuY29udGVudC5zY3JvbGxUb3AgPSAwOw0KICAgICAgbWUuJGVtaXQoImxvYWREYXRhIiwgcGF5bG9hZCk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBT4buxIGtp4buHbiBzY3JvbGwgdHLDqm4gZ3JpZA0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQoMjUuMDYuMjAyMCkNCiAgICAgKi8NCiAgICBvblNjcm9sbChlKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBtZS4kZW1pdCgic2Nyb2xsIiwgZSk7DQogICAgICAvL21lLiRyZWZzLmdyaWRDb250ZW50Lg0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIHhlbSBj4buZdCDEkcaw4bujYyBjaGVjayBoYXkga2jDtG5nID8NCiAgICAgKiBkdXnhu4d0IHRyb25nIGRhdGEgbuG6v3UgY8OzIGNoxrBhIGThu68gbGnhu4d1IGPhu6dhIGTDsm5nIHTGsMahbmcg4bupbmcgdGjDrCByZXR1cm4gdHJ1ZSBuZ8aw4bujYyBs4bqhaSBmYWxzZQ0KICAgICAqIEBwYXJhbSBkYXRhUm93IGThu68gbGnhu4d1IGPhu6dhIGTDsm5nIMSRxrDhu6NjIGNoZWNrDQogICAgICogQ3JlYXRlZCBieSBMVERBVCAyNC4wNi4yMDIwDQogICAgICogICovDQogICAgaXNTZWxlY3RlZChkYXRhUm93KSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBpZiAobWUudmFsdWUgJiYgbWUudmFsdWUubGVuZ3RoID4gMCkgew0KICAgICAgICByZXR1cm4gbWUudmFsdWUuaW5jbHVkZXMoZGF0YVJvdyk7DQogICAgICB9DQogICAgICByZXR1cm4gZmFsc2U7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIHhlbSByb3cgY8OzIGRpc2FibGUgY2hlY2tib3ggaw0KICAgICAqIEBwYXJhbSBkYXRhUm93IGThu68gbGnhu4d1IGPhu6dhIGTDsm5nIMSRxrDhu6NjIGNoZWNrDQogICAgICogQ3JlYXRlZCBieSBubmxhbSAyNC4wNi4yMDIwDQogICAgICogICovDQogICAgZnVuRGlzYWJsZWRDaGVja2VkTXVsdGlwbGVUYm9keShkYXRhUm93KSB7DQogICAgICBsZXQgbWUgPSB0aGlzOw0KICAgICAgaWYgKHR5cGVvZiBtZS5kaXNhYmxlZENoZWNrZWRNdWx0aXBsZVRib2R5ID09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgcmV0dXJuIG1lLmRpc2FibGVkQ2hlY2tlZE11bHRpcGxlVGJvZHkoZGF0YVJvdyk7DQogICAgICB9DQogICAgICByZXR1cm4gbWUuZGlzYWJsZWRDaGVja2VkTXVsdGlwbGVUYm9keTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEjDoG0geOG7rSBsw70gc+G7sSBraeG7h24ga2hpIGNsaWNrIHbDoG8gw7QgY2hlY2sgbXVsdGlwbGUNCiAgICAgKiBAcGFyYW0gZGF0YVJvdyBk4buvIGxp4buHdSBj4bunYSBkw7JuZyDEkcaw4bujYyBjaOG7jW4NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUICgzMC4wNS4yMDIwKQ0KICAgICAqLw0KICAgIGNsaWNrTXVsdGlwbGUoZGF0YVJvdywgY2hlY2tlZCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWUudmFsdWUpKSB7DQogICAgICAgIG1lLnZhbHVlID0gW107DQogICAgICB9DQoNCiAgICAgIGlmIChtZS52YWx1ZS5pbmNsdWRlcyhkYXRhUm93KSkgew0KICAgICAgICBtZS52YWx1ZS5yZW1vdmUoZGF0YVJvdyk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtZS52YWx1ZS5wdXNoKGRhdGFSb3cpOw0KICAgICAgfQ0KDQogICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS52YWx1ZSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBIw6BtIHjhu60gbMO9IHPhu7Ega2nhu4duIGtoaSBjbGljayB2w6BvIMO0IGNoZWNrIG11bHRpcGxlIGTDuW5nIHBow61tIHThuq90DQogICAgICogQHBhcmFtIGRhdGFSb3cgZOG7ryBsaeG7h3UgY+G7p2EgZMOybmcgxJHGsOG7o2MgY2jhu41uDQogICAgICogQ3JlYXRlZCBieSBOTkxBTSAoMzAuMDUuMjAyMCkNCiAgICAgKi8NCiAgICBjbGlja011bHRpcGxlQnlTaG9yS2V5KGxpc3QpIHt9LA0KDQogICAgLy9M4bqleSBk4buvIGxp4buHdSBj4bunYSAxIHRyYW5nIGtoaSBwaMOibiB0cmFuZyBsb2NhbA0KICAgIC8vQ3JlYXRlZCBieSBMVERBVCgxOC4wNi4yMDIwKQ0KICAgIGdldEl0ZW1QYWdpbmF0aW9uKCkgew0KICAgICAgbGV0IG1lID0gdGhpcywNCiAgICAgICAgcGFnZVNpemUgPSBtZS5wYWdlU2l6ZSA/IG1lLnBhZ2VTaXplIDogMjAsDQogICAgICAgIG1pbiA9IE1hdGguY2VpbCgobWUuY3VycmVudFBhZ2UgLSAxKSAqIHBhZ2VTaXplKSwNCiAgICAgICAgbWF4ID0gbWluICsgcGFnZVNpemU7DQogICAgICBsZXQgZGF0YUZpbHRlciA9IG51bGw7DQogICAgICBpZiAobWUucXVlcnlNb2RlID09ICJsb2NhbCIgJiYgdHlwZW9mIG1lLmZpbHRlckZuID09ICJmdW5jdGlvbiIpIHsNCiAgICAgICAgZGF0YUZpbHRlciA9IG1lLmZpbHRlckZuKCk7DQogICAgICAgIG1lLnBhZ2VUb3RhbEZuID0gZGF0YUZpbHRlciA/IGRhdGFGaWx0ZXIubGVuZ3RoIDogMDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGRhdGFGaWx0ZXIgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2U7DQogICAgICB9DQogICAgICBkYXRhRmlsdGVyID0gZGF0YUZpbHRlciA/IGRhdGFGaWx0ZXIgOiBbXTsNCg0KICAgICAgLy8gTk1UVUFOMyAyMS8xMi8yMDIxOiBDYXNlIG7hur91IGNo4buJIGhp4buDbiB0aOG7iyB04buVbmcgc+G7kSB0cmFuZyB0aMOsIHRy4bqjIHbhu4EgbHXDtG4NCiAgICAgIGlmIChtZS5pc09ubHlTaG93UGFnZVRvdGFsKSB7DQogICAgICAgIHJldHVybiBtZS5kYXRhOw0KICAgICAgfQ0KDQogICAgICBsZXQgZGF0YVBhZ2luYXRpb24gPSBkYXRhRmlsdGVyLmZpbHRlcigoaXRlbSwgaW5kZXgpID0+IHsNCiAgICAgICAgcmV0dXJuIGluZGV4ID49IG1pbiAmJiBpbmRleCA8IG1heDsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gZGF0YVBhZ2luYXRpb247DQogICAgfSwNCiAgICAvL1jhu60gbMO9IHPhu7Ega2nhu4duIHJlc2l6ZSBjb2wgdHLDqm4gZ3JpZA0KICAgIC8vY3JlYXRlZCBieSBMVERBVCgyOS4wNS4yMDIwKQ0KICAgIC8vY210IGJ5OiBubmxhbSAyNC8wMi8yMDIxOiBi4buPIMSRaSB2w6wgdGjhu6thIGfDonkgeOG6pXUga2hpIG3DoCBjbGljayB2w6BvIHJlc2l6ZSB0aMOsIGzDoG0gY2hhbmdlIHdpZHRoIHRvw6BuIGLhu5kgY29sdW1uIGx1w7RuDQogICAgcmVzaXplQWN0aXZlKCkgew0KICAgICAgLy9LaMO0bmcgY2hvIHBow6lwIGLDtGkgxJFlbiB0ZXh0DQogICAgICAvLyB0aGlzLnNlbGVjdGVkVGV4dE1vZGUgPSB0cnVlOw0KICAgICAgLy8gaWYgKHRoaXMuJHJlZnMudGgpIHsNCiAgICAgIC8vICAgbGV0IGxpc3RUaCA9IHRoaXMuJHJlZnMudGg7DQogICAgICAvLyAgIGlmIChsaXN0VGggJiYgbGlzdFRoLmxlbmd0aCA+IDApIHsNCiAgICAgIC8vICAgICBsaXN0VGguZm9yRWFjaChpdGVtID0+IHsNCiAgICAgIC8vICAgICAgIGlmIChpdGVtID09IGxpc3RUaFtsaXN0VGgubGVuZ3RoIC0gdGhpcy5pbmRleEZsZXhSaWdodF0pIHsNCiAgICAgIC8vICAgICAgICAgaXRlbS51cGRhdGVDb2xXaWR0aCh0cnVlKTsNCiAgICAgIC8vICAgICAgIH0gZWxzZSB7DQogICAgICAvLyAgICAgICAgIGl0ZW0udXBkYXRlQ29sV2lkdGgoZmFsc2UpOw0KICAgICAgLy8gICAgICAgfQ0KICAgICAgLy8gICAgIH0pOw0KICAgICAgLy8gICB9DQogICAgICAvLyB9DQogICAgfSwNCiAgICAvL8SQw7NuZyBz4buxIGtp4buHbiByZXNpemUgY+G7mXQgdHLDqm4gZ3JpZA0KICAgIC8vY3JlYXRlZCBieSBMVERBVCgyOS4wNS4yMDIwKQ0KDQogICAgcmVzaXplQ2xvc2UoY29sKSB7DQogICAgICAvL0NobyBwaMOpcCBiw7RpIMSRw6puIHRleHQNCiAgICAgIHRoaXMuc2VsZWN0ZWRUZXh0TW9kZSA9IGZhbHNlOw0KICAgICAgY29sLm5ld1dpZHRoID0gY29sLl93aWR0aDsNCiAgICAgIHRoaXMuJGVtaXQoInJlc2l6ZUNvbCIsIGNvbCk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBTZXQgZ2nDoSB0cuG7iyBkZWZhdWx0IGNobyBj4bqldSBow6xuaCBj4buZdA0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQoMTcuMDcuMjAyMCkNCiAgICAgKi8NCiAgICBzZXREZWZhdWx0RmllbGRDb2x1bW4oY29sdW1ucykgew0KICAgICAgLy9O4bq/dSBraMO0bmcgY+G6pXUgaMOsbmggZmllbGQgaGnhu4duIHRo4buLIHRow6wgbeG6t2MgxJHhu4tuaCBsw6AgdHJ1ZQ0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgY29sdW1ucy5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgIGlmIChpdGVtLnZpc2libGUgIT0gZmFsc2UpIHsNCiAgICAgICAgICBpdGVtLnZpc2libGUgPSB0cnVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLy9zZXQgY29sdW1uVHlwZQ0KICAgICAgICBpZiAodHlwZW9mIGl0ZW0uY29sdW1uVHlwZSAhPT0gIm51bWJlciIpIHsNCiAgICAgICAgICBtZS5zZXREZWZhdWx0Q29sdW1uVHlwZShpdGVtKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vbuG6v3Uga2jDtG5nIGNo4buJbmggxJHhu4tuaCB0aMOsIMSR4buDIGFsaWduIG3hurdjIGThu4tuaCB0aGVvIGZvcm1hdCB0eXBlDQogICAgICAgIGlmICghaXRlbS5hbGlnbikgew0KICAgICAgICAgIHN3aXRjaCAoaXRlbS5jb2x1bW5UeXBlKSB7DQogICAgICAgICAgICBjYXNlICJDb2x1bW5OdW1iZXIiOg0KICAgICAgICAgICAgICBpdGVtLmFsaWduID0gInJpZ2h0IjsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlICJDb2x1bW5Cb29sZWFuIjoNCiAgICAgICAgICAgICAgaXRlbS5hbGlnbiA9ICJjZW50ZXIiOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICBtZS4kc2V0KGl0ZW0sICJfd2lkdGgiLCBpdGVtLndpZHRoKTsNCg0KICAgICAgICAvL2RlZmF1bHQgZmlsdGVyDQogICAgICAgIGlmICghaXRlbS5maWx0ZXIpIHsNCiAgICAgICAgICBtZS5zZXREZWZhdWx0RmlsdGVyKGl0ZW0pOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIC8qKiBM4bqleSByYSBjw6FjIGNvbHVtbiBjw7MgdGh14buZYyB0w61uaCB2aXNpYmxlID0gdHJ1ZQ0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQgMTcuMDcuMjAyMA0KICAgICAqICovDQogICAgZ2V0VmlzaWJsZUNvbHVtbihjb2x1bW5zKSB7DQogICAgICByZXR1cm4gY29sdW1ucy5maWx0ZXIoKGl0ZW0pID0+IHsNCiAgICAgICAgcmV0dXJuIGl0ZW0udmlzaWJsZSA9PSB0cnVlOw0KICAgICAgfSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBLaOG7n2kgdOG6oW8gZOG7ryBsaeG7h3UgYmFuIMSR4bqndSBjaG8gZ3JpZA0KICAgICAqIGNvbHVtbnMgdHJ1eeG7gW4gdsOgbyBt4bq3YyDEkeG7i25oIGzDoCBjb2x1bW5zIHRyb25nIHByb3BzIGPDsyB0aOG7gyB0cnV54buBbiBj4bqldSBow6xuaCBraMOhYyB04burIG5nb8OgaSB2w6BvDQogICAgICovDQogICAgaW5pdENvbHVtbnMoY29sdW1ucykgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUuY29sdW1ueCA9IFtdOw0KICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgbWUuY29sdW1ueCA9IGNvbHVtbnMgfHwgbWUuY29sdW1ucyB8fCBbXTsNCg0KICAgICAgICAvL0fDoW4gY29sdW1ucyBjaG8gY29uZmlnLWJveA0KICAgICAgICBpZiAoDQogICAgICAgICAgbWUuJHJlZnMuY29uZmlnQm94ICYmDQogICAgICAgICAgdHlwZW9mIG1lLiRyZWZzLmNvbmZpZ0JveC51cGRhdGVEYXRhID09ICJmdW5jdGlvbiINCiAgICAgICAgKSB7DQogICAgICAgICAgbWUuJHJlZnMuY29uZmlnQm94LnVwZGF0ZURhdGEobWUuY29sdW1ueCk7DQogICAgICAgIH0NCg0KICAgICAgICBtZS5zZXREZWZhdWx0RmllbGRDb2x1bW4obWUuY29sdW1ueCk7DQogICAgICAgIG1lLmNvbHVtbnggPSBtZS5nZXRWaXNpYmxlQ29sdW1uKG1lLmNvbHVtbngpOw0KICAgICAgICBpZiAoIW1lLmNvbHVtbngpIHsNCiAgICAgICAgICBtZS5jb2x1bW54ID0gW107DQogICAgICAgIH0NCiAgICAgICAgbGV0IGhhc0ZsZXggPSBtZS5jb2x1bW54LnNvbWUoKGl0ZW0pID0+IHsNCiAgICAgICAgICByZXR1cm4gaXRlbS5hdXRvUmVzaXplOw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKA0KICAgICAgICAgIGhhc0ZsZXggPT0gZmFsc2UgJiYNCiAgICAgICAgICBtZS5jb2x1bW54W21lLmNvbHVtbngubGVuZ3RoIC0gbWUuaW5kZXhGbGV4UmlnaHRdDQogICAgICAgICkgew0KICAgICAgICAgIC8vIG1lLnJlc2l6ZUFjdGl2ZSgpOw0KICAgICAgICAgIG1lLiRzZXQoDQogICAgICAgICAgICBtZS5jb2x1bW54W21lLmNvbHVtbngubGVuZ3RoIC0gbWUuaW5kZXhGbGV4UmlnaHRdLA0KICAgICAgICAgICAgImF1dG9SZXNpemUiLA0KICAgICAgICAgICAgdHJ1ZQ0KICAgICAgICAgICk7DQogICAgICAgIH0gZWxzZSBpZiAoaGFzRmxleCA9PSBmYWxzZSAmJiBtZS5jb2x1bW54Lmxlbmd0aCA9PSAxKSB7DQogICAgICAgICAgbWUuJHNldChtZS5jb2x1bW54WzBdLCAiYXV0b1Jlc2l6ZSIsIHRydWUpOw0KICAgICAgICB9DQogICAgICAgIC8vIG1lLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIC8vICAgbGV0IGhlYWRlciA9IG1lLiRyZWZzLmhlYWRlcjsNCiAgICAgICAgLy8gICB7DQogICAgICAgIC8vICAgICBpZiAoaGVhZGVyKSB7DQogICAgICAgIC8vICAgICAgIGhlYWRlci5zdHlsZS5taW5IZWlnaHQgPQ0KICAgICAgICAvLyAgICAgICAgIGhlYWRlci5maXJzdEVsZW1lbnRDaGlsZC5vZmZzZXRIZWlnaHQgKyAxICsgInB4IjsNCiAgICAgICAgLy8gICAgIH0NCiAgICAgICAgLy8gICB9DQogICAgICAgIC8vIH0pOw0KDQogICAgICAgIC8veOG7rSBsw70gZ3JvdXAgaGVhZGVyDQogICAgICAgIG1lLmluaXRIZWFkZXIobWUuY29sdW1ueCk7DQoNCiAgICAgICAgLy9u4bq/dSBjw7MgZm9vdGVyIHRow6wgc+G7rSBsw70NCiAgICAgICAgaWYgKG1lLmZvb3Rlcikgew0KICAgICAgICAgIG1lLmluaXRGb290ZXIobWUuY29sdW1ueCk7DQogICAgICAgIH0NCg0KICAgICAgICAvL2fDoW4gc3RpY2t0eSBsZWZ0IGNobyBjw6FjIGPhu5l0IHN0aWNreQ0KICAgICAgICBtZS4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgIG1lLnVwZGF0ZVN0aWNreU9mZnNldCgpOw0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqDQogICAgICogWOG7rSBsw70gdGnDqnUgxJHhu4EgY+G7mXQNCiAgICAgKi8NCiAgICBpbml0SGVhZGVyKGNvbHVtbnMpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpcywNCiAgICAgICAgaGVhZGVycyA9IFtdLA0KICAgICAgICBzdWIgPSBbXTsNCiAgICAgIGxldCBncm91cDsNCiAgICAgIGNvbHVtbnMuZm9yRWFjaCgoaXRlbSwgaSkgPT4gew0KICAgICAgICBpZiAoaXRlbS5ncm91cCkgew0KICAgICAgICAgIGlmICghZ3JvdXAgfHwgZ3JvdXAuY2FwdGlvbiAhPT0gaXRlbS5ncm91cCkgew0KICAgICAgICAgICAgZ3JvdXAgPSB7DQogICAgICAgICAgICAgIGlzR3JvdXA6IHRydWUsDQogICAgICAgICAgICAgIGNvbHNwYW46IDEsDQogICAgICAgICAgICAgIGNhcHRpb246IGl0ZW0uZ3JvdXAsDQogICAgICAgICAgICAgIGNoaWxkczogW10sDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaGVhZGVycy5wdXNoKGdyb3VwKTsNCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgZ3JvdXAuY29sc3BhbisrOw0KICAgICAgICAgIH0NCiAgICAgICAgICBncm91cC5jaGlsZHMucHVzaChpdGVtKTsNCiAgICAgICAgICBzdWIucHVzaChpdGVtKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBoZWFkZXJzLnB1c2goaXRlbSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICAvKioNCiAgICAgICAqIGNhc2UgxJHhu4MgY2hlY2sgbHXDtG4gYnVpbGQgZ3JvdXANCiAgICAgICAqIE5NVFVBTjMgMTcvMTEvMjAyMQ0KICAgICAgICovDQogICAgICBpZiAoIW1lLmlzQWx3YXlzR3JvdXApIHsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWFkZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgbGV0IGNvbCA9IGhlYWRlcnNbaV07DQogICAgICAgICAgaWYgKGNvbC5jaGlsZHMpIHsNCiAgICAgICAgICAgIGlmIChjb2wuY2hpbGRzLmxlbmd0aCA9PT0gMSkgew0KICAgICAgICAgICAgICBsZXQgY2hpbGQgPSBjb2wuY2hpbGRzWzBdOw0KICAgICAgICAgICAgICBoZWFkZXJzW2ldID0gY2hpbGQ7DQogICAgICAgICAgICAgIHN1Yi5yZW1vdmUoY2hpbGQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZGVsZXRlIGNvbC5jaGlsZHM7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmIChzdWIubGVuZ3RoID4gMCkgew0KICAgICAgICBtZS5oZWFkZXJzID0gW2hlYWRlcnMsIHN1Yl07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtZS5oZWFkZXJzID0gW2hlYWRlcnNdOw0KICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogWOG7rSBsw70gdGnDqnUgxJHhu4EgY+G7mXQNCiAgICAgKi8NCiAgICBpbml0Rm9vdGVyKGNvbHVtbnMpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpcywNCiAgICAgICAgZm9vdGVycyA9IFtdLA0KICAgICAgICBzdWIgPSBbXTsNCg0KICAgICAgbGV0IGdyb3VwOw0KICAgICAgbGV0IGNvbHVteCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoY29sdW1ucykpOw0KICAgICAgLy8gTlRCQU86IFThuqFtIHRo4budaSBi4buPIMSRaSB0csOhbmggYnVpbGQgcmEgZMOybmcgZm9vdGVyIGtoaSBjw7MgY+G7mXQgY2hlY2sgY2jhu41uIG5oaeG7gXUNCiAgICAgIC8vIGlmIChtZS5tdWx0aXBsZSkgew0KICAgICAgLy8gICBjb2x1bXgudW5zaGlmdCh7fSk7DQogICAgICAvLyB9DQogICAgICBjb2x1bXguZm9yRWFjaCgoY29sLCBpKSA9PiB7DQogICAgICAgIGxldCBpdGVtID0gew0KICAgICAgICAgIGRhdGFGaWVsZDogY29sLmRhdGFGaWVsZCwNCiAgICAgICAgICBhbGlnbjogY29sLmFsaWduLA0KICAgICAgICAgIGZvcm1hdFR5cGU6IGNvbC5mb3JtYXRUeXBlLA0KICAgICAgICAgIGZvb3RlclRleHQ6IGNvbC5mb290ZXJUZXh0LA0KICAgICAgICAgIGxvY2s6IGNvbC5sb2NrID8gY29sLmxvY2sgOiBmYWxzZSwNCiAgICAgICAgfTsNCg0KICAgICAgICBpZiAoaXRlbS5ncm91cEZvb3RlciB8fCBpIDwgbWUubG9ja0NvdW50KSB7DQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgIWdyb3VwIHx8DQogICAgICAgICAgICBncm91cC5jYXB0aW9uICE9PSBpdGVtLmdyb3VwRm9vdGVyIHx8DQogICAgICAgICAgICBpID09PSBtZS5sb2NrQ291bnQNCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIGdyb3VwID0gew0KICAgICAgICAgICAgICBpc0dyb3VwOiB0cnVlLA0KICAgICAgICAgICAgICBjb2xzcGFuOiAxLA0KICAgICAgICAgICAgICBjYXB0aW9uOiBpdGVtLmdyb3VwRm9vdGVyLA0KICAgICAgICAgICAgICBjaGlsZHM6IFtdLA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGZvb3RlcnMucHVzaChncm91cCk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGdyb3VwLmNvbHNwYW4rKzsNCiAgICAgICAgICB9DQogICAgICAgICAgZ3JvdXAuY2hpbGRzLnB1c2goaXRlbSk7DQogICAgICAgICAgLy9zdWIucHVzaChpdGVtKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBmb290ZXJzLnB1c2goaXRlbSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KDQogICAgICAvL2R1eeG7h3QgeOG7rSBsw70gY8OhYyBuaMOzbSBj4buZdCBjaOG7iSBjw7MgMSBwaOG6p24gdOG7qyAtPiBi4buPIG5ow7NtIMSRaQ0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmb290ZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBjb2wgPSBmb290ZXJzW2ldOw0KICAgICAgICBpZiAoY29sLmNoaWxkcykgew0KICAgICAgICAgIGxldCBjaGlsZCA9IGNvbC5jaGlsZHNbMF07DQogICAgICAgICAgY2hpbGRbImNvbHNwYW4iXSA9IGNoaWxkWyJjb2xzcGFuIl0gPyBjaGlsZFsiY29sc3BhbiJdIDogY29sLmNvbHNwYW47DQogICAgICAgICAgZm9vdGVyc1tpXSA9IGNoaWxkOw0KICAgICAgICAgIHN1Yi5yZW1vdmUoY2hpbGQpOw0KICAgICAgICAgIGRlbGV0ZSBjb2wuY2hpbGRzOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmIChmb290ZXJzWzBdKSB7DQogICAgICAgIGxldCBmaXJzdCA9IGZvb3RlcnNbMF07DQoNCiAgICAgICAgaWYgKG1lLnNlcmlhbCkgew0KICAgICAgICAgIGZpcnN0LmNvbHNwYW4gPSAoZmlyc3QuY29sc3BhbiB8fCAxKSArIDE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKG1lLm11bHRpcGxlKSB7DQogICAgICAgICAgZmlyc3QuY29sc3BhbiA9IChmaXJzdC5jb2xzcGFuIHx8IDEpICsgMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodHlwZW9mIGZpcnN0LmNhcHRpb24gPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgZmlyc3QuY2FwdGlvbiA9IG1lLiR0KCJpMThuQ29tcG9uZW50LkZvb3Rlci5TdW1tYXJ5Iik7DQogICAgICAgIH0NCiAgICAgICAgaWYgKHR5cGVvZiBmaXJzdC5mb290ZXJUZXh0ID09PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgIGZpcnN0LmZvb3RlclRleHQgPSBtZS4kdCgiaTE4bkNvbXBvbmVudC5Gb290ZXIuU3VtbWFyeSIpOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGlmIChzdWIubGVuZ3RoID4gMCkgew0KICAgICAgICBtZS5mb290ZXJzID0gW2Zvb3RlcnMsIHN1Yl07DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtZS5mb290ZXJzID0gW2Zvb3RlcnNdOw0KICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogQ+G6rXAgbmjhuq10IGxlZnQgY2hvIGPDoWMgY+G7mXQgc3RpY2tleQ0KICAgICAqLw0KICAgIHVwZGF0ZVN0aWNreU9mZnNldCgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpcywNCiAgICAgICAgdGhzID0gbWUuJGVsLnF1ZXJ5U2VsZWN0b3JBbGwoIi5tcy10aCIpLA0KICAgICAgICBjb2x1bW5zID0gbWUuY29sdW1ueDsNCiAgICAgIGxldCB1c2luZ0NvbHVtblNldHRpbmcgPSBmYWxzZTsNCg0KICAgICAgbGV0IG9mZnNldCA9IDA7DQogICAgICBsZXQgZiA9IDA7DQogICAgICBsZXQgd2lkdGggPSAwOw0KDQogICAgICBpZiAobWUuaXNTaG93Q29uZmlnQ29sdW1uKSB7DQogICAgICAgIHdpZHRoID0gdGhzW2ZdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIHx8IDA7DQogICAgICAgIG9mZnNldCArPSB3aWR0aDsNCiAgICAgICAgZisrOw0KICAgICAgfQ0KDQogICAgICBpZiAobWUubXVsdGlwbGUpIHsNCiAgICAgICAgbWUubXVsdGlwbGVPZmZzZXRMZWZ0ID0gb2Zmc2V0ICsgInB4IjsNCg0KICAgICAgICB3aWR0aCA9IHRoc1tmXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCB8fCAwOw0KICAgICAgICAvLyB0csaw4budbmcgaOG7o3AgZ3JpZCBi4buLIOG6qW4gxJFpIC0+IG9mZnNldCBj4bunYSDDtCBjaGVja2JveCBi4buLID0gMDsgKGzGsHUgw70gdHLDqm4gZm9ybSBjw7MgMiBncmlkIHRyw6puIDIgbXMtdGFwLWl0ZW0ga2jDoWMgbmhhdSB0aMOsIGdyaWQg4bufIHRhYiBraMO0bmcgYWN0aWNlIHPhur0gYuG7iyBs4buXaSBsZWZ0IHN0aWNreSkNCiAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7DQogICAgICAgICAgdXNpbmdDb2x1bW5TZXR0aW5nID0gdHJ1ZTsNCiAgICAgICAgICB3aWR0aCA9IG1lLiRtcy5lbnVtLlN0eWxlQ2hlY2tCb3hNdWx0aS5XaWR0aDsNCiAgICAgICAgfQ0KICAgICAgICBvZmZzZXQgKz0gd2lkdGg7DQogICAgICAgIGYrKzsNCiAgICAgIH0NCg0KICAgICAgaWYgKG1lLnNlcmlhbCkgew0KICAgICAgICBtZS5zZXJpYWxPZmZzZXRMZWZ0ID0gb2Zmc2V0ICsgInB4IjsNCg0KICAgICAgICB3aWR0aCA9IHRoc1tmXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCB8fCAwOw0KICAgICAgICAvLyB0csaw4budbmcgaOG7o3AgZ3JpZCBi4buLIOG6qW4gxJFpIC0+IG9mZnNldCBj4bunYSDDtCBjaGVja2JveCBi4buLID0gMDsgKGzGsHUgw70gdHLDqm4gZm9ybSBjw7MgMiBncmlkIHRyw6puIDIgbXMtdGFwLWl0ZW0ga2jDoWMgbmhhdSB0aMOsIGdyaWQg4bufIHRhYiBraMO0bmcgYWN0aWNlIHPhur0gYuG7iyBs4buXaSBsZWZ0IHN0aWNreSkNCiAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7DQogICAgICAgICAgd2lkdGggPSA2MDsNCiAgICAgICAgfQ0KICAgICAgICB1c2luZ0NvbHVtblNldHRpbmcgPSB0cnVlOw0KICAgICAgICBvZmZzZXQgKz0gd2lkdGg7DQogICAgICAgIGYrKzsNCiAgICAgIH0NCg0KICAgICAgbWUuaGFzTG9ja0NvbHVtbiA9IGZhbHNlOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZS5jb2x1bW54Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBjb2wgPSBtZS5jb2x1bW54W2ldOw0KICAgICAgICBpZiAoIWNvbC5sb2NrKSB7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCg0KICAgICAgICBtZS5oYXNMb2NrQ29sdW1uID0gdHJ1ZTsNCiAgICAgICAgbWUuJHNldChjb2wsICJzdGlja3lPZmZzZXQiLCBvZmZzZXQpOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBHw6FuIHRow6ptIG9mZnNldCBjaG8gZm9vdGVyIMSR4buDIGxvY2sgY+G7mXQNCiAgICAgICAgICogTlRCQU8gMTguMDEuMjAyMg0KICAgICAgICAgKi8NCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtZS5mb290ZXJzLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgY29uc3QgZm9vdGVySXRlbSA9IG1lLmZvb3RlcnNbal07DQoNCiAgICAgICAgICBsZXQgaXRlbSA9IGZvb3Rlckl0ZW0uZmluZChmdW5jdGlvbiAoeCkgew0KICAgICAgICAgICAgcmV0dXJuIHguZGF0YUZpZWxkID09IGNvbC5kYXRhRmllbGQ7DQogICAgICAgICAgfSk7DQogICAgICAgICAgaWYgKGl0ZW0pIHsNCiAgICAgICAgICAgIG1lLiRzZXQoaXRlbSwgInN0aWNreU9mZnNldCIsIG9mZnNldCk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy8gVMOtbmggb2Zmc2V0IHRp4bq/cCB0aGVvDQogICAgICAgIGxldCBwb3MgPSAwOw0KICAgICAgICBpZiAoIXVzaW5nQ29sdW1uU2V0dGluZykgew0KICAgICAgICAgIHBvcyA9IHRoc1tpICsgZl0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgcG9zID0geyB3aWR0aDogY29sdW1uc1tpICsgZiAtIDFdLndpZHRoIH07DQogICAgICAgIH0NCg0KICAgICAgICBvZmZzZXQgKz0gcG9zLndpZHRoOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvL1jDs2EgMSBwaOG6p24gdOG7rSB0cm9uZyBkYXRhIGdyaWQNCiAgICByZW1vdmVJdGVtKGl0ZW0pIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLmRhdGF4ID0gXy5yZW1vdmUobWUuZGF0YXgsIChlKSA9PiB7DQogICAgICAgIHJldHVybiBlICE9PSBpdGVtOw0KICAgICAgfSk7DQogICAgfSwNCiAgICAvL0fDoW4gZ2nDoSB0cuG7iyDEkeG7gyByZW5kZXIgZGF0YSBjw7MgdGjhu4MgdHJ1eeG7gW4gdOG7qyBuZ2/DoGkgdsOgbw0KICAgIGluaXREYXRhKGRhdGEgPSB0aGlzLmRhdGEpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpcywNCiAgICAgICAgdXBkYXRlU2Nyb2xsID0NCiAgICAgICAgICAhZGF0YSAhPSAhbWUuZGF0YXggfHwNCiAgICAgICAgICAoZGF0YSAmJiBtZS5kYXRheCAmJiBkYXRhLmxlbmd0aCAhPSBtZS5kYXRheC5sZW5ndGgpOw0KDQogICAgICBpZiAobWUuJHBhcmVudC5zZWFyY2hUZXh0ICYmIG1lLiRwYXJlbnQuc2VhcmNoVGV4dC5sZW5ndGggPiAwKSB7DQogICAgICAgIG1lLnBhcmVudFNlYXJjaFRleHQgPSBtZS4kcGFyZW50LnNlYXJjaFRleHQ7DQogICAgICB9DQoNCiAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZSA9IG51bGw7DQogICAgICBpZiAoZGF0YSkgew0KICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBbLi4uZGF0YV07DQogICAgICB9DQogICAgICAvL07hur91IHRo4buxYyBoaeG7h24gbOG6pXkgZGF0YSBkxrDhu5tpIGxvY2FsIHRow6wgdGjhu6ljIGhp4buHbiBsxrB1IGThu68gbGnhu4d1IHbDoG8gaW50ZXJuYWxEYXRhU291cmNlIHbDoCBwaMOibiB0cmFuZyBsb2NhbA0KICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PSAibG9jYWwiICYmIG1lLnBhZ2luYXRpb24pIHsNCiAgICAgICAgLy8gY29tbW9uRm4uZ2VuVktleVZhbHVlKG1lLmludGVybmFsRGF0YVNvdXJjZSk7DQogICAgICAgIG1lLmRhdGF4ID0gbWUuZ2V0SXRlbVBhZ2luYXRpb24oKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vTOG6pXkgZOG7ryBsaeG7h3UgdOG7qyBzZXJ2ZXINCiAgICAgICAgLy9U4bqhbSBnw6FuID0gcHJvcHMgZGF0YSBzYXUgZ8OhbiA9IGfDrCBraMOhYyB0w61uaCBzYXUNCiAgICAgICAgLy/EkFZUaGkgMTkvMDEvMjAyMTogc+G7rWEgbOG7l2kgVEEga2hpIG1lLmRhdGF4IG51bGwgdGjDrCDEkW/huqFuIGNvZGUgbsOgeSB2xINuZyBs4buXaSBUQQ0KICAgICAgICBpZiAobWUuaW50ZXJuYWxEYXRhU291cmNlKSB7DQogICAgICAgICAgbWUuZGF0YXggPSBbLi4ubWUuaW50ZXJuYWxEYXRhU291cmNlXTsNCiAgICAgICAgfQ0KICAgICAgICAvLyBjb21tb25Gbi5nZW5WS2V5VmFsdWUobWUuZGF0YXgpOw0KICAgICAgfQ0KICAgICAgaWYgKG1lLmlzTWFzdGVyRGV0YWlsKSB7DQogICAgICAgIG1lLmRhdGF4ID0gbWUuJG1zLmNvbW1vbkZuLmdldEJvZHlEYXRhKA0KICAgICAgICAgIG1lLmRhdGF4LA0KICAgICAgICAgIHRydWUsDQogICAgICAgICAgMSwNCiAgICAgICAgICBtZS5kZXRhaWxGaWVsZA0KICAgICAgICApOw0KICAgICAgfQ0KDQogICAgICBpZiAodXBkYXRlU2Nyb2xsKSB7DQogICAgICAgIG1lLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgdGhpcy5jaGVja0hhc1Njcm9sbCgpOw0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vTOG6pXkgZOG7ryBsaeG7h3UgY+G7p2EgZMOybmcgxJHGsOG7o2MgY2jhu41uDQogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE2LjA2LjIwMjApDQogICAgZ2V0Um93U2VsZWN0ZWQoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICByZXR1cm4gbWUucm93U2VsZWN0ZWQ7DQogICAgfSwNCiAgICAvL1jhu60gbMO9IHPhu7Ega2nhu4duIOG6pW4gcGjDrW0gdHLDqm4gcm93DQogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE1LjA2LjIwMjApDQogICAgcm93X2tleWRvd24oZGF0YVJvdywgZSkgew0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIGxldCBjdXJyZW50SW5kZXggPSBtZS5yb3dTZWxlY3RlZC5pbmRleDsNCiAgICAgIGxldCB0ciA9IG51bGw7DQogICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7DQogICAgICBpZiAoZS5jdHJsS2V5IHx8IGUuc2hpZnRLZXkpIHsNCiAgICAgICAgc3dpdGNoIChlLndoaWNoKSB7DQogICAgICAgICAgY2FzZSA0MDogLy9kb3duDQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4IDwgbWUuZGF0YXgubGVuZ3RoIC0gMSAmJiAhZS5hbHRLZXkpIHsNCiAgICAgICAgICAgICAgbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCA9IHRydWU7DQogICAgICAgICAgICAgIHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigNCiAgICAgICAgICAgICAgICBgLm1zLXRib2R5LmRhdGEgdHJbaW5kZXhSb3c9JyR7Y3VycmVudEluZGV4fSddYA0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAvLyBpZighbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFttZS5yb3dTZWxlY3RlZC5pbmRleF0pICYmIHRyLmNsYXNzTGlzdCAmJiB0ci5jbGFzc0xpc3QuY29udGFpbnMoJ3Jvdy1zZWxlY3RlZCcpICYmICF0ci5jbGFzc0xpc3QuY29udGFpbnMoJ211bHRpLXJvdy1zZWxlY3RlZCcpKXsNCiAgICAgICAgICAgICAgLy8gICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnB1c2gobWUuZGF0YXhbbWUucm93U2VsZWN0ZWQuaW5kZXhdKTsNCiAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgICBjdXJyZW50SW5kZXgrKzsNCiAgICAgICAgICAgICAgbWUuaW5kZXhPZlJvd0ZvY3VzZWQgPSBjdXJyZW50SW5kZXg7DQogICAgICAgICAgICAgIC8vZXZlbnQudGFyZ2V0LmZvY3VzKCk7DQogICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAhbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFtjdXJyZW50SW5kZXhdKQ0KICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnB1c2gobWUuZGF0YXhbY3VycmVudEluZGV4XSk7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5yZW1vdmUobWUuZGF0YXhbY3VycmVudEluZGV4XSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQuZGF0YSA9IG1lLmRhdGF4W2N1cnJlbnRJbmRleF07DQogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gY3VycmVudEluZGV4Ow0KICAgICAgICAgICAgICBtZS5hZGp1c3RTY3JvbGwoY3VycmVudEluZGV4LCB0ciwgZmFsc2UpOw0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIDM4OiAvL3VwDQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID4gMCAmJiAhZS5hbHRLZXkpIHsNCiAgICAgICAgICAgICAgbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCA9IHRydWU7DQogICAgICAgICAgICAgIHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigNCiAgICAgICAgICAgICAgICBgLm1zLXRib2R5LmRhdGEgdHJbaW5kZXhSb3c9JyR7Y3VycmVudEluZGV4fSddYA0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICAvLyBpZighbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFttZS5yb3dTZWxlY3RlZC5pbmRleF0pICYmIHRyLmNsYXNzTGlzdCAmJiB0ci5jbGFzc0xpc3QuY29udGFpbnMoJ3Jvdy1zZWxlY3RlZCcpICYmICF0ci5jbGFzc0xpc3QuY29udGFpbnMoJ211bHRpLXJvdy1zZWxlY3RlZCcpKXsNCiAgICAgICAgICAgICAgLy8gICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnB1c2gobWUuZGF0YXhbbWUucm93U2VsZWN0ZWQuaW5kZXhdKTsNCiAgICAgICAgICAgICAgLy8gfQ0KICAgICAgICAgICAgICBjdXJyZW50SW5kZXgtLTsNCiAgICAgICAgICAgICAgbWUuaW5kZXhPZlJvd0ZvY3VzZWQgPSBjdXJyZW50SW5kZXg7DQogICAgICAgICAgICAgIC8vZXZlbnQudGFyZ2V0LmZvY3VzKCk7DQoNCiAgICAgICAgICAgICAgaWYgKA0KICAgICAgICAgICAgICAgICFtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmluY2x1ZGVzKG1lLmRhdGF4W2N1cnJlbnRJbmRleF0pDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEucHVzaChtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnJlbW92ZShtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmRhdGEgPSBtZS5kYXRheFtjdXJyZW50SW5kZXhdOw0KICAgICAgICAgICAgICBtZS5yb3dTZWxlY3RlZC5pbmRleCA9IGN1cnJlbnRJbmRleDsNCiAgICAgICAgICAgICAgbWUuYWRqdXN0U2Nyb2xsKGN1cnJlbnRJbmRleCwgdHIsIHRydWUpOw0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIDMyOiAvL3NwYWNlDQogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSAmJg0KICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmxlbmd0aCA+IDANCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICBtZS5jbGlja011bHRpcGxlKGl0ZW0pOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIG1lLmNsaWNrTXVsdGlwbGUobWUuZGF0YXhbY3VycmVudEluZGV4XSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc3dpdGNoIChlLndoaWNoKSB7DQogICAgICAgICAgY2FzZSA0MDogLy9kb3duDQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4IDwgbWUuZGF0YXgubGVuZ3RoIC0gMSAmJiAhZS5hbHRLZXkpIHsNCiAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSA9IFtdOw0KICAgICAgICAgICAgICB0ciA9IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoDQogICAgICAgICAgICAgICAgYC5tcy10Ym9keS5kYXRhIHRyW2luZGV4Um93PScke2N1cnJlbnRJbmRleH0nXWANCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgdHIubmV4dEVsZW1lbnRTaWJsaW5nLnF1ZXJ5U2VsZWN0b3IoInRkIikuY2xpY2soKTsNCiAgICAgICAgICAgICAgY3VycmVudEluZGV4Kys7DQogICAgICAgICAgICAgIG1lLmluZGV4T2ZSb3dGb2N1c2VkID0gY3VycmVudEluZGV4Ow0KICAgICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQuZGF0YSA9IG1lLmRhdGF4W2N1cnJlbnRJbmRleF07DQogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gY3VycmVudEluZGV4Ow0KICAgICAgICAgICAgICBtZS5hZGp1c3RTY3JvbGwoY3VycmVudEluZGV4LCB0ciwgZmFsc2UpOw0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIDM4OiAvL3VwDQogICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID4gMCAmJiAhZS5hbHRLZXkpIHsNCiAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSA9IFtdOw0KICAgICAgICAgICAgICB0ciA9IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoDQogICAgICAgICAgICAgICAgYC5tcy10Ym9keS5kYXRhIHRyW2luZGV4Um93PScke2N1cnJlbnRJbmRleH0nXWANCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgdHIucHJldmlvdXNFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCJ0ZCIpLmNsaWNrKCk7DQogICAgICAgICAgICAgIGN1cnJlbnRJbmRleC0tOw0KICAgICAgICAgICAgICBtZS5pbmRleE9mUm93Rm9jdXNlZCA9IGN1cnJlbnRJbmRleDsNCiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmZvY3VzKCk7DQogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmRhdGEgPSBtZS5kYXRheFtjdXJyZW50SW5kZXhdOw0KICAgICAgICAgICAgICBtZS5yb3dTZWxlY3RlZC5pbmRleCA9IGN1cnJlbnRJbmRleDsNCiAgICAgICAgICAgICAgbWUuYWRqdXN0U2Nyb2xsKGN1cnJlbnRJbmRleCwgdHIsIHRydWUpOw0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIDMyOiAvL3NwYWNlDQogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsNCiAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSAmJg0KICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmxlbmd0aCA+IDANCiAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICBsZXQgY2hlY2tib3ggPSBtZS4kZWwucXVlcnlTZWxlY3RvckFsbCgNCiAgICAgICAgICAgICAgICAnLm1zLXRyLm11bHRpLXJvdy1zZWxlY3RlZCAubXVsdGlwbGUtY2VsbCBpbnB1dFt0eXBlPSJjaGVja2JveCJdJw0KICAgICAgICAgICAgICApOw0KICAgICAgICAgICAgICBsZXQgY2hlY2tlZCA9IG1lLiRlbC5xdWVyeVNlbGVjdG9yQWxsKA0KICAgICAgICAgICAgICAgICcubXMtdHIubXVsdGktcm93LXNlbGVjdGVkIC5tdWx0aXBsZS1jZWxsIGlucHV0W3R5cGU9ImNoZWNrYm94Il06Y2hlY2tlZCcNCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgaWYgKGNoZWNrZWQubGVuZ3RoID09IDAgfHwgY2hlY2tlZC5sZW5ndGggPT0gY2hlY2tib3gubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgY2hlY2tib3guZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgICAgICAgaXRlbS5jbGljaygpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGNoZWNrYm94LmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICAgICAgICAgIGlmICghaXRlbS5jaGVja2VkKSB7DQogICAgICAgICAgICAgICAgICAgIGl0ZW0uY2xpY2soKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgbWUuY2xpY2tNdWx0aXBsZShtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBxdWlja1NlbGVjdGVkKGUpIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBsZXQgb2xkSW5kZXggPSBtZS5vbGRJbmRleE9mUm93Rm9jdXNlZCB8fCAwOw0KICAgICAgaWYgKGUuc2hpZnRLZXkpIHsNCiAgICAgICAgbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCA9IHRydWU7DQogICAgICAgIGxldCB0ckV2ZW50ID0gZS50YXJnZXQuY2xvc2VzdCgiLm1zLXRyIik7DQogICAgICAgIGxldCBuZXdJbmRleCA9IHRyRXZlbnQuZ2V0QXR0cmlidXRlKCJpbmRleHJvdyIpOw0KICAgICAgICBsZXQgc3RhcnQgPSBvbGRJbmRleCA+PSBuZXdJbmRleCA/IG5ld0luZGV4IDogb2xkSW5kZXg7DQogICAgICAgIGxldCBlbmQgPSBvbGRJbmRleCA+PSBuZXdJbmRleCA/IG9sZEluZGV4IDogbmV3SW5kZXg7DQogICAgICAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEgPSBbXTsNCiAgICAgICAgZm9yIChzdGFydDsgc3RhcnQgPD0gZW5kOyBzdGFydCsrKSB7DQogICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5wdXNoKG1lLmRhdGF4W3N0YXJ0XSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChlLmN0cmxLZXkpIHsNCiAgICAgICAgbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCA9IHRydWU7DQogICAgICAgIGxldCB0ckV2ZW50ID0gZS50YXJnZXQuY2xvc2VzdCgiLm1zLXRyIik7DQogICAgICAgIGxldCBuZXdJbmRleCA9IHRyRXZlbnQuZ2V0QXR0cmlidXRlKCJpbmRleHJvdyIpOw0KICAgICAgICBpZiAoIW1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEuaW5jbHVkZXMobWUuZGF0YXhbb2xkSW5kZXhdKSkgew0KICAgICAgICAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEucHVzaChtZS5kYXRheFtvbGRJbmRleF0pOw0KICAgICAgICB9DQogICAgICAgIGlmIChtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmluY2x1ZGVzKG1lLmRhdGF4W25ld0luZGV4XSkpIHsNCiAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnJlbW92ZShtZS5kYXRheFtuZXdJbmRleF0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEucHVzaChtZS5kYXRheFtuZXdJbmRleF0pOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgbWUuJGVsLmNsYXNzTGlzdC5hZGQoInVzZXItc2VsZWN0ZWQtbm9uZSIpOw0KICAgICAgfTsNCiAgICAgIGRvY3VtZW50Lm9ua2V5dXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIG1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QgPSBmYWxzZTsNCiAgICAgICAgbWUuJGVsLmNsYXNzTGlzdC5yZW1vdmUoInVzZXItc2VsZWN0ZWQtbm9uZSIpOw0KICAgICAgfTsNCiAgICAgIGRvY3VtZW50Lm9ubW91c2V1cCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKCFtZS5zaG9ydEtleUZvclF1aWNrU2VsZWN0KSB7DQogICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSA9IFtdOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgIH0sDQogICAgZGVzdHJveVF1aWNrU2VsZWN0ZWQoZSkgew0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIGlmIChtZS5zaG9ydEtleUZvclF1aWNrU2VsZWN0KSB7DQogICAgICAgIG1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLy9T4buxIGtp4buHbiDhuqVuIHbDoG8gbsO6dCBjaOG7jW4gdOG6pXQgY+G6oyBiw6puIHRyw6puIGhlYWRlcg0KICAgIC8vVEROR0hJQSA4LzEwLzIwMjEgY2xpY2sgdsOgbyBtdWx0aSBib3gNCiAgICAvL07hur91IMSRYW5nIGzDoCB0ZW1wIHRow6wgYuG7jyB0aWNrIGjhur90LCBu4bq/dSDEkWFuZyBsw6AgdGljayB0aMOsIGPFqW5nIGLhu48gdGljayBo4bq/dCwgbuG6v3UgxJFhbmcgdHLhu5FuZyB0aMOsIHRpY2sgaOG6v3QNCiAgICBjaGFuZ2VDaGVja2VkTXVsdGlwbGUoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQoNCiAgICAgIGxldCBWTW9kZWwgPSBtZS52YWx1ZSA9PSBudWxsID8gW10gOiBbLi4ubWUudmFsdWVdOw0KICAgICAgLy9O4bq/dSDEkWFuZyBjaGVjayB0aMOsIGLhu48gdGljayBo4bq/dA0KICAgICAgaWYgKG1lLmlzQ2hlY2tlZE11bHRpcGxlIHx8IG1lLmlzVGVtcFN0YXRlKSB7DQogICAgICAgIGxldCBkYXRhID0gbWUuZGF0YXguZmlsdGVyKChpKSA9PiAhaS5pc0Rpc2FibGVkQ2hlY2tCb3gpOw0KICAgICAgICBkYXRhLmZvckVhY2goKGRhdGFSb3cpID0+IHsNCiAgICAgICAgICBpZiAoVk1vZGVsLmluY2x1ZGVzKGRhdGFSb3cpKSB7DQogICAgICAgICAgICBWTW9kZWwucmVtb3ZlKGRhdGFSb3cpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICAvL07hur91IMSRYW5nIHLhu5duZyB0aMOsIMSRxrDhu6NjIHRpY2sgaOG6v3QNCiAgICAgICAgbGV0IGRhdGEgPSBtZS5kYXRheC5maWx0ZXIoKGkpID0+ICFpLmlzRGlzYWJsZWRDaGVja0JveCk7DQogICAgICAgIGRhdGEuZm9yRWFjaCgoZGF0YVJvdykgPT4gew0KICAgICAgICAgIGlmICghVk1vZGVsLmluY2x1ZGVzKGRhdGFSb3cpKSB7DQogICAgICAgICAgICBWTW9kZWwucHVzaChkYXRhUm93KTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KDQogICAgICAvL0jDoG0gbsOgeSBsw6AgYuG6r24gcmEgYmFzZWxpc3Rwb3B1cCDEkeG7gyDhuqluIGhp4buHbiB0aWNrIGNo4buNbiwuLi4oc2VsZWN0aW9uQ2hhbmdlKQ0KICAgICAgbWUuJGVtaXQoImlucHV0IiwgVk1vZGVsKTsNCg0KICAgICAgLy9O4bq/dSDEkWFuZyBsw6AgdHLhuqFuZyB0aMOhaSB0cnVuZyBnaWFuIHRow6wgcHJldmVudCDEkeG7gyBraMO0bmcgYuG7iyB0aWNrIHbDoG8gaW5wdXQNCiAgICAgIGlmIChtZS5pc1RlbXBTdGF0ZSkgew0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBjaGFuZ2VQYWdlU2l6ZSh2YWx1ZSkgew0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIC8vTuG6v3UgdGjhu7FjIGhp4buHbiBs4bqleSBkYXRhIGTGsOG7m2kgbG9jYWwgdGjDrCB0aOG7qWMgaGnhu4duIGzGsHUgZOG7ryBsaeG7h3UgdsOgbyBpbnRlcm5hbERhdGFTb3VyY2UgdsOgIHBow6JuIHRyYW5nIGxvY2FsDQogICAgICBpZiAobWUucXVlcnlNb2RlID09ICJsb2NhbCIgJiYgbWUucGFnaW5hdGlvbikgew0KICAgICAgICAvLyBjb21tb25Gbi5nZW5WS2V5VmFsdWUobWUuaW50ZXJuYWxEYXRhU291cmNlKTsNCiAgICAgICAgbWUucGFnZVNpemUgPSB2YWx1ZTsNCiAgICAgICAgbWUuZGF0YXggPSBtZS5nZXRJdGVtUGFnaW5hdGlvbigpOw0KICAgICAgfQ0KICAgICAgdGhpcy4kZW1pdCgiY2hhbmdlcGFnZXNpemUiLCB2YWx1ZSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBHw6FuIGZpbHRlciBt4bq3YyDEkeG7i25oIGNobyB04bqldCBj4bqjIGPDoWMgY+G7mXQgY29sdW1uDQogICAgICovDQogICAgc2V0RGVmYXVsdEZpbHRlckFsbENvbHVtbigpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGxldCBjb2x1bW5zID0gbWUuY29sdW1ueDsNCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICBtZS5zZXREZWZhdWx0RmlsdGVyKGNvbHVtbnNbaV0pOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBHw6FuIGZpbHRlciBt4bq3YyDEkeG7i25oIGNobyBjb2x1bW4NCiAgICAgKi8NCiAgICBzZXREZWZhdWx0RmlsdGVyKGNvbHVtbikgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICBjb2x1bW4uZmlsdGVyID0gew0KICAgICAgICB2YWx1ZTogbnVsbCwNCiAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5FcXVhbHMsDQogICAgICB9Ow0KDQogICAgICBzd2l0Y2ggKGNvbHVtbi5jb2x1bW5UeXBlKSB7DQogICAgICAgIGNhc2UgIkNvbHVtblRleHQiOg0KICAgICAgICBjYXNlICJDb2x1bW5EcmlsbGRvd24iOg0KICAgICAgICAgIGlmICghY29sdW1uLmVudW1OYW1lIHx8IGNvbHVtbi5lbnVtKSB7DQogICAgICAgICAgICBjb2x1bW4uZmlsdGVyLm9wZXJhdG9yID0gbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkNvbnRhaW5zOw0KICAgICAgICAgIH0NCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEfDoW4gZ2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oIGNobyBjb2x1bW5UeXBlIGPhu6dhIGPhuqV1IGjDrG5oIGPhu5l0DQogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbDogY+G6pXUgaMOsbmggY+G7mXQNCiAgICAgKiBAYXV0aG9yIE5WTEFNIDE4LjEyLjIwMjANCiAgICAgKi8NCiAgICBzZXREZWZhdWx0Q29sdW1uVHlwZShjb2wpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpcywNCiAgICAgICAgRm9ybWF0VHlwZSA9IG1lLiRtcy5lbnVtLkZvcm1hdFR5cGU7DQogICAgICBzd2l0Y2ggKGNvbC5mb3JtYXRUeXBlKSB7DQogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5MaXN0Og0KICAgICAgICAgIGNvbC5jb2x1bW5UeXBlID0gIkNvbHVtbkRyb3Bkb3duIjsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBGb3JtYXRUeXBlLkNoZWNrYm94Og0KICAgICAgICAgIGNvbC5jb2x1bW5UeXBlID0gIkNvbHVtbkJvb2xlYW4iOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIEZvcm1hdFR5cGUuVGV4dDoNCiAgICAgICAgICBpZiAoY29sLmNvbHVtblR5cGUgIT0gIkNvbHVtbkRyb3Bkb3duIikgew0KICAgICAgICAgICAgY29sLmNvbHVtblR5cGUgPSAiQ29sdW1uVGV4dCI7DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIEZvcm1hdFR5cGUuUHJvZ3Jlc3M6DQogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5OdW1iZXI6DQogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5RdWFudGl0eToNCiAgICAgICAgY2FzZSBGb3JtYXRUeXBlLlJhdGU6DQogICAgICAgICAgY29sLmNvbHVtblR5cGUgPSAiQ29sdW1uTnVtYmVyIjsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSBGb3JtYXRUeXBlLkRhdGU6DQogICAgICAgICAgY29sLmNvbHVtblR5cGUgPSAiQ29sdW1uRGF0ZVRpbWUiOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIEZvcm1hdFR5cGUuRGF0ZVRpbWU6DQogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5UaW1lOg0KICAgICAgICAgIGNvbC5jb2x1bW5UeXBlID0gIkNvbHVtbkRhdGVUaW1lIjsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICBjb2wuY29sdW1uVHlwZSA9ICJDb2x1bW5UZXh0IjsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIMSQ4buNYyDEkWnhu4F1IGtp4buHbiBmaWx0ZXIgaGVhZGVyDQogICAgICovDQogICAgZ2V0RmlsdGVySGVhZGVyKGhhc0NvbHVtbikgew0KICAgICAgbGV0IG1lID0gdGhpcywNCiAgICAgICAgcmVzdWx0ID0gW10sDQogICAgICAgIGVudW1GaWx0ZXJIZWFkZXIgPSBtZS4kbXMuZW51bS5GaWx0ZXJIZWFkZXIsDQogICAgICAgIGNvbHVtbnMgPSBtZS5maWx0ZXJIZWFkZXI7IC8vbWUuY29sdW1ueDsNCg0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2x1bW5zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBjb2x1bW4gPSBjb2x1bW5zW2ldOw0KICAgICAgICBpZiAoY29sdW1uLmZpbHRlciAmJiBjb2x1bW4uZmlsdGVyLnZhbHVlICE9PSBjb2x1bW4uZmlsdGVySWdub3JlVmFsdWUpIHsNCiAgICAgICAgICBsZXQgaXRlbSA9IG51bGwsDQogICAgICAgICAgICBmaWx0ZXJWYWx1ZSA9IGNvbHVtbi5maWx0ZXIudmFsdWUsDQogICAgICAgICAgICBvcGVyYXRvciA9IGNvbHVtbi5maWx0ZXIub3BlcmF0b3I7DQogICAgICAgICAgc3dpdGNoIChvcGVyYXRvcikgew0KICAgICAgICAgICAgY2FzZSBlbnVtRmlsdGVySGVhZGVyLkJldHdlZW46DQogICAgICAgICAgICAgIGl0ZW0gPSB7DQogICAgICAgICAgICAgICAgcHJvcGVydHk6IGNvbHVtbi5pc0V4dERhdGENCiAgICAgICAgICAgICAgICAgID8gYEpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuJHtjb2x1bW4uZGF0YUZpZWxkfScpKWANCiAgICAgICAgICAgICAgICAgIDogY29sdW1uLmRhdGFGaWVsZCwNCiAgICAgICAgICAgICAgICBvcGVyYXRvcjogbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkdyZWF0ZXJUaGFuRXF1YWxzLA0KICAgICAgICAgICAgICAgIHZhbHVlOiBjb2x1bW4uZmlsdGVyLmZyb20sDQogICAgICAgICAgICAgICAgb3BlcmFuZDogImFuZCIsDQogICAgICAgICAgICAgICAgY2hpbGRyZW5zOiBbDQogICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhDQogICAgICAgICAgICAgICAgICAgICAgPyBgSlNPTl9VTlFVT1RFKEpTT05fRVhUUkFDVChFeHREYXRhLCAnJC4ke2NvbHVtbi5kYXRhRmllbGR9JykpYA0KICAgICAgICAgICAgICAgICAgICAgIDogY29sdW1uLmRhdGFGaWVsZCwNCiAgICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5MZXNzVGhhbkVxdWFscywNCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGNvbHVtbi5maWx0ZXIudG8sDQogICAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiLA0KICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBdLA0KICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgZW51bUZpbHRlckhlYWRlci5OdWxsOg0KICAgICAgICAgICAgY2FzZSBlbnVtRmlsdGVySGVhZGVyLk5vdE51bGw6DQogICAgICAgICAgICAgIGl0ZW0gPSB7DQogICAgICAgICAgICAgICAgcHJvcGVydHk6IGNvbHVtbi5pc0V4dERhdGENCiAgICAgICAgICAgICAgICAgID8gYEpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuJHtjb2x1bW4uZGF0YUZpZWxkfScpKWANCiAgICAgICAgICAgICAgICAgIDogY29sdW1uLmRhdGFGaWVsZCwNCiAgICAgICAgICAgICAgICBvcGVyYXRvcjogb3BlcmF0b3IsDQogICAgICAgICAgICAgICAgb3BlcmFuZDogImFuZCIsDQogICAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgICAgLy924bubaSBj4buZdCB0ZXh0IHPhur0gZml4IGdpw6EgdHLhu4sgxJHhu4MgbMOqbiBzZXJ2ZXIgc+G6vSB44butIGzDvSB0aMOqbSBraeG7g20gdHJhIHbhu5tpIGdpw6EgdHLhu4sgdHLhu5FuZyAnJw0KICAgICAgICAgICAgICBzd2l0Y2ggKGNvbHVtbi5jb2x1bW5UeXBlKSB7DQogICAgICAgICAgICAgICAgY2FzZSAiQ29sdW1uVGV4dCI6DQogICAgICAgICAgICAgICAgY2FzZSAiQ29sdW1uRHJpbGxkb3duIjoNCiAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSAidGV4dCI7DQogICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgZW51bUZpbHRlckhlYWRlci5Db250YWluczoNCiAgICAgICAgICAgIGNhc2UgZW51bUZpbHRlckhlYWRlci5Ob3Rjb250YWluczoNCiAgICAgICAgICAgIGNhc2UgZW51bUZpbHRlckhlYWRlci5TdGFydHNXaXRoOg0KICAgICAgICAgICAgY2FzZSBlbnVtRmlsdGVySGVhZGVyLkVuZHNXaXRoOg0KICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgdHlwZW9mIGZpbHRlclZhbHVlICE9PSAidW5kZWZpbmVkIiAmJg0KICAgICAgICAgICAgICAgIGZpbHRlclZhbHVlICE9PSBudWxsICYmDQogICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgIT09ICIiDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIC8vIGxldCB3b3JkcyA9IG1lLiRtcy5jb21tb25Gbi5zcGxpdEtleVdvcmQoZmlsdGVyVmFsdWUpOw0KICAgICAgICAgICAgICAgIC8vIHZhciBhZGRDb2x1bW5GaWx0ZXIgPSBmdW5jdGlvbihmaWx0ZXIpIHsNCiAgICAgICAgICAgICAgICAvLyAgIGlmICghaXRlbSkgew0KICAgICAgICAgICAgICAgIC8vICAgICBpdGVtID0gZmlsdGVyOw0KICAgICAgICAgICAgICAgIC8vICAgICBpdGVtLmNoaWxkcmVucyA9IFtdOw0KICAgICAgICAgICAgICAgIC8vICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKA0KICAgICAgICAgICAgICAgIC8vICAgICAgIG9wZXJhdG9yID09PSBlbnVtRmlsdGVySGVhZGVyLlN0YXJ0c1dpdGggfHwNCiAgICAgICAgICAgICAgICAvLyAgICAgICBvcGVyYXRvciA9PT0gZW51bUZpbHRlckhlYWRlci5FbmRzV2l0aA0KICAgICAgICAgICAgICAgIC8vICAgICApIHsNCiAgICAgICAgICAgICAgICAvLyAgICAgICBpdGVtLm9wZXJhbmQgPSAib3IiOw0KICAgICAgICAgICAgICAgIC8vICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vICAgICAgIGl0ZW0ub3BlcmFuZCA9ICJhbmQiOw0KICAgICAgICAgICAgICAgIC8vICAgICB9DQogICAgICAgICAgICAgICAgLy8gICAgIGl0ZW0uY2hpbGRyZW5zLnB1c2goZmlsdGVyKTsNCiAgICAgICAgICAgICAgICAvLyAgIH0NCiAgICAgICAgICAgICAgICAvLyB9Ow0KICAgICAgICAgICAgICAgIC8vIGlmICh3b3Jkcy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRzLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICAgICAgLy8gICAgIGxldCBmaWx0ZXJJdGVtID0gew0KICAgICAgICAgICAgICAgIC8vICAgICAgIHByb3BlcnR5OiBjb2x1bW4uZGF0YUZpZWxkLA0KICAgICAgICAgICAgICAgIC8vICAgICAgIHZhbHVlOiB3b3Jkc1tpXSwNCiAgICAgICAgICAgICAgICAvLyAgICAgICBvcGVyYXRvcjogb3BlcmF0b3IsDQogICAgICAgICAgICAgICAgLy8gICAgICAgb3BlcmFuZDoNCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIG9wZXJhdG9yID09PSBlbnVtRmlsdGVySGVhZGVyLlN0YXJ0c1dpdGggfHwNCiAgICAgICAgICAgICAgICAvLyAgICAgICAgIG9wZXJhdG9yID09PSBlbnVtRmlsdGVySGVhZGVyLkVuZHNXaXRoDQogICAgICAgICAgICAgICAgLy8gICAgICAgICAgID8gIm9yIg0KICAgICAgICAgICAgICAgIC8vICAgICAgICAgICA6ICJhbmQiDQogICAgICAgICAgICAgICAgLy8gICAgIH07DQogICAgICAgICAgICAgICAgLy8gICAgIGFkZENvbHVtbkZpbHRlcihmaWx0ZXJJdGVtKTsNCiAgICAgICAgICAgICAgICAvLyAgIH0NCiAgICAgICAgICAgICAgICAvLyB9DQogICAgICAgICAgICAgICAgaXRlbSA9IHsNCiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhDQogICAgICAgICAgICAgICAgICAgID8gYEpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuJHtjb2x1bW4uZGF0YUZpZWxkfScpKWANCiAgICAgICAgICAgICAgICAgICAgOiBjb2x1bW4uZGF0YUZpZWxkLA0KICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yLA0KICAgICAgICAgICAgICAgICAgdmFsdWU6IGZpbHRlclZhbHVlLA0KICAgICAgICAgICAgICAgICAgb3BlcmFuZDogImFuZCIsDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgIHN3aXRjaCAoY29sdW1uLmNvbHVtblR5cGUpIHsNCiAgICAgICAgICAgICAgICBjYXNlICJDb2x1bW5EYXRlVGltZSI6DQogICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyVmFsdWUpIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogY29sdW1uLmlzRXh0RGF0YQ0KICAgICAgICAgICAgICAgICAgICAgICAgPyBgSlNPTl9VTlFVT1RFKEpTT05fRVhUUkFDVChFeHREYXRhLCAnJC4ke2NvbHVtbi5kYXRhRmllbGR9JykpYA0KICAgICAgICAgICAgICAgICAgICAgICAgOiBjb2x1bW4uZGF0YUZpZWxkLA0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmaWx0ZXJWYWx1ZSwgLy9tb21lbnQoZmlsdGVyVmFsdWUpLmZvcm1hdCgnWVlZWS1NTS1ERCcpLA0KICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvciwNCiAgICAgICAgICAgICAgICAgICAgICBvcGVyYW5kOiAiYW5kIiwNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgIHR5cGVvZiBmaWx0ZXJWYWx1ZSAhPT0gInVuZGVmaW5lZCIgJiYNCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgIT09IG51bGwgJiYNCiAgICAgICAgICAgICAgICAgICAgZmlsdGVyVmFsdWUgIT09ICIiDQogICAgICAgICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHsNCiAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eTogY29sdW1uLmlzRXh0RGF0YQ0KICAgICAgICAgICAgICAgICAgICAgICAgPyBgSlNPTl9VTlFVT1RFKEpTT05fRVhUUkFDVChFeHREYXRhLCAnJC4ke2NvbHVtbi5kYXRhRmllbGR9JykpYA0KICAgICAgICAgICAgICAgICAgICAgICAgOiBjb2x1bW4uZGF0YUZpZWxkLA0KICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmaWx0ZXJWYWx1ZSwNCiAgICAgICAgICAgICAgICAgICAgICBvcGVyYXRvcjogb3BlcmF0b3IsDQogICAgICAgICAgICAgICAgICAgICAgb3BlcmFuZDogImFuZCIsDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvL3jhu60gbMO9IHTDrG5oIGh14buRbmcgZW51bSBj4bunYSBj4buZdCBraMO0bmcgY2jhu6lhIGdpw6EgdHLhu4sgdGjDrCBraOG7j2kgZmlsdGVyDQogICAgICAgICAgaWYgKGl0ZW0gJiYgKGNvbHVtbi5lbnVtTmFtZSB8fCBjb2x1bW4uZW51bSkpIHsNCiAgICAgICAgICAgIGxldCBlbnVtT2JqID0gbWUuJG1zLmVudW1bY29sdW1uLmVudW1OYW1lIHx8IGNvbHVtbi5lbnVtXSwNCiAgICAgICAgICAgICAgaGFzVmFsdWUgPSBmYWxzZTsNCiAgICAgICAgICAgIGZvciAobGV0IGkgaW4gZW51bU9iaikgew0KICAgICAgICAgICAgICBpZiAoZW51bU9ialtpXSA9PT0gaXRlbS52YWx1ZSkgew0KICAgICAgICAgICAgICAgIGhhc1ZhbHVlID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoIWhhc1ZhbHVlKSB7DQogICAgICAgICAgICAgIGl0ZW0gPSBudWxsOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChpdGVtKSB7DQogICAgICAgICAgICBpZiAoaGFzQ29sdW1uKSB7DQogICAgICAgICAgICAgIGl0ZW0uY29sdW1uID0gY29sdW1uOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKGNvbHVtbi5udWxsVG9GYWlsKSB7DQogICAgICAgICAgICAgIGl0ZW0ubnVsbFRvRmFpbCA9IGNvbHVtbi5udWxsVG9GYWlsOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIGzGsHUgdOG6pXQgY+G6oyBjw6FjIGPhu5l0IMSRw6MgxJHDoW5oIGThuqV1IGzDoCDEkWFuZyBmaWx0ZXINCiAgICAgKi8NCiAgICBidWlsZEZpbHRlckhlYWRlcihjb2wpIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBsZXQgY2hlY2sgPSBtZS5maWx0ZXJIZWFkZXIuZmlsdGVyKChpKSA9PiBpLmRhdGFGaWVsZCA9PSBjb2wuZGF0YUZpZWxkKTsNCiAgICAgIGlmIChjaGVjay5sZW5ndGggPT0gMCkgew0KICAgICAgICBtZS5maWx0ZXJIZWFkZXIucHVzaChjb2wpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWUuZmlsdGVySGVhZGVyLmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgICBpZiAoaXRlbS5kYXRhRmllbGQgPT0gY29sLmRhdGFGaWVsZCkgew0KICAgICAgICAgICAgaXRlbSA9IGNvbDsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgICAgbGV0IHRoID0gbWUuJHJlZnMudGguZmlsdGVyKCh4KSA9PiB4LmNvbC5kYXRhRmllbGQgPT0gY29sLmRhdGFGaWVsZCk7DQogICAgICBpZiAodGggJiYgdGgubGVuZ3RoID4gMCkgew0KICAgICAgICB0aFswXS5jaGVja0hpZGVNZW51SGVhZGVyKCk7DQogICAgICB9DQogICAgfSwNCg0KICAgIHN0eWxlQ29sdW1uKGNvbCwgZGF0YVJvdywgc3R5bGVPYmplY3QpIHsNCiAgICAgIHRoaXMuJGVtaXQoInN0eWxlQ29sdW1uIiwgY29sLCBkYXRhUm93LCBzdHlsZU9iamVjdCk7DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIGjDoG0gY29udmVyIHRvw6FuIHThu60gdGjDoG5oIHRleHQ6IHbDrSBk4bulICJDb250YW50cyIgLT4gIkNo4bupYSINCiAgICAgKi8NCiAgICBidWlsZE9wZXJhdG9yVGV4dChvcGVyYXRvcikgew0KICAgICAgbGV0IG9wZXJhdG9yVGV4dCA9IHRoaXMuJG1zLmNvbW1vbkZuLmdldEVudW1SZXNvdXJjZSgNCiAgICAgICAgb3BlcmF0b3IsDQogICAgICAgICJGaWx0ZXJIZWFkZXIiDQogICAgICApOw0KICAgICAgaWYgKG9wZXJhdG9yVGV4dCkgew0KICAgICAgICBvcGVyYXRvclRleHQgPSBvcGVyYXRvclRleHQudG9Mb2NhbGVMb3dlckNhc2UoKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBvcGVyYXRvclRleHQ7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBow6BtIGJ1aWxkIHZhbHVlIGZpbHRlcg0KICAgICAqLw0KICAgIGJ1aWxkVmFsdWUoaXRlbSkgew0KICAgICAgaWYgKA0KICAgICAgICBpdGVtLmZpbHRlciAmJg0KICAgICAgICAoaXRlbS5maWx0ZXIub3BlcmF0b3IgPT0gdGhpcy4kbXMuZW51bS5GaWx0ZXJIZWFkZXIuTnVsbCB8fA0KICAgICAgICAgIGl0ZW0uZmlsdGVyLm9wZXJhdG9yID09IHRoaXMuJG1zLmVudW0uRmlsdGVySGVhZGVyLk5vdE51bGwpDQogICAgICApIHsNCiAgICAgICAgcmV0dXJuICIiOw0KICAgICAgfQ0KICAgICAgaWYgKA0KICAgICAgICBpdGVtLmZpbHRlci52YWx1ZSA9PSAwICYmDQogICAgICAgIGl0ZW0uZm9ybWF0VHlwZSAhPSB0aGlzLiRtcy5lbnVtLkZvcm1hdFR5cGUuRW51bSAmJg0KICAgICAgICBpdGVtLmZvcm1hdFR5cGUgIT0gdGhpcy4kbXMuZW51bS5Gb3JtYXRUeXBlLkZpbHRlclN0YXRlR3JpZCAvL1RETkdISUEgY2FzZSB0aMOqbSB0csaw4budbmcgaOG7o3AgbsOgeSDEkeG7gyB24bq9IGZpbHRlciB0cuG6oW5nIHRow6FpIGdyaWQNCiAgICAgICkgew0KICAgICAgICByZXR1cm4gIjAiOw0KICAgICAgfQ0KICAgICAgaWYgKGl0ZW0uZmlsdGVyLm9wZXJhdG9yID09IHRoaXMuJG1zLmVudW0uRmlsdGVySGVhZGVyLkJldHdlZW4pIHsNCiAgICAgICAgbGV0IHZhbHVlRnJvbSA9IHRoaXMuJG9wdGlvbnMuZmlsdGVycy5mb3JtYXREYXRhKGl0ZW0uZmlsdGVyLmZyb20sIHsNCiAgICAgICAgICBmb3JtYXRUeXBlOiBpdGVtLmZvcm1hdFR5cGUsDQogICAgICAgICAgZW51bU5hbWU6IGl0ZW0uZW51bSwNCiAgICAgICAgICBkYXRhUm93OiB7fSwNCiAgICAgICAgfSk7DQogICAgICAgIGxldCB2YWx1ZVRvID0gdGhpcy4kb3B0aW9ucy5maWx0ZXJzLmZvcm1hdERhdGEoaXRlbS5maWx0ZXIudG8sIHsNCiAgICAgICAgICBmb3JtYXRUeXBlOiBpdGVtLmZvcm1hdFR5cGUsDQogICAgICAgICAgZW51bU5hbWU6IGl0ZW0uZW51bSwNCiAgICAgICAgICBkYXRhUm93OiB7fSwNCiAgICAgICAgfSk7DQogICAgICAgIHJldHVybiB0aGlzLiR0KCJpMThuQmFzZUZvcm0uRmlsdGVyLk9wZXJhdG9yQmV0d2VlbiIpLmZvcm1hdCgNCiAgICAgICAgICB2YWx1ZUZyb20sDQogICAgICAgICAgdmFsdWVUbw0KICAgICAgICApOw0KICAgICAgfQ0KICAgICAgbGV0IHZhbHVlID0gdGhpcy4kb3B0aW9ucy5maWx0ZXJzLmZvcm1hdERhdGEoaXRlbS5maWx0ZXIudmFsdWUsIHsNCiAgICAgICAgZm9ybWF0VHlwZTogaXRlbS5mb3JtYXRUeXBlLA0KICAgICAgICBlbnVtTmFtZTogaXRlbS5lbnVtLA0KICAgICAgICBkYXRhUm93OiB7fSwNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuICI6ICIgKyB2YWx1ZTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogaMOgbSB4w7NhIDEgaXRlbSBmaWx0ZXINCiAgICAgKi8NCiAgICByZW1vdmVGaWx0ZXJJdGVtKGl0ZW0pIHsNCiAgICAgIGxldCBtZSA9IHRoaXM7DQogICAgICBtZS5maWx0ZXJIZWFkZXIucmVtb3ZlKGl0ZW0pOw0KICAgICAgaWYgKA0KICAgICAgICAhaXRlbS5mb3JtYXRUeXBlIHx8DQogICAgICAgIGl0ZW0uZm9ybWF0VHlwZSA9PSBtZS4kbXMuZW51bS5Gb3JtYXRUeXBlLlRleHQgfHwNCiAgICAgICAgaXRlbS5mb3JtYXRUeXBlID09IG1lLiRtcy5lbnVtLkZvcm1hdFR5cGUuTm9uZQ0KICAgICAgKSB7DQogICAgICAgIGl0ZW0uZmlsdGVyLm9wZXJhdG9yID0gbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkNvbnRhaW5zOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgaXRlbS5maWx0ZXIub3BlcmF0b3IgPSBtZS4kbXMuZW51bS5GaWx0ZXJIZWFkZXIuRXF1YWxzOw0KICAgICAgfQ0KICAgICAgaXRlbS5maWx0ZXIudmFsdWUgPSBudWxsOw0KICAgICAgaXRlbS5oYXNBY3Rpb25GaWx0ZXIgPSBmYWxzZTsNCiAgICAgIGxldCB0aCA9IG1lLiRyZWZzLnRoLmZpbHRlcigoeCkgPT4geC5jb2wuZGF0YUZpZWxkID09IGl0ZW0uZGF0YUZpZWxkKTsNCiAgICAgIGlmICh0aCAmJiB0aC5sZW5ndGggPiAwKSB7DQogICAgICAgIHRoWzBdLmNoZWNrSGlkZU1lbnVIZWFkZXIoKTsNCiAgICAgIH0NCiAgICAgIG1lLiRlbWl0KCJmaWx0ZXIiLCBpdGVtKTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIGjDoG0gYuG7jyBs4buNYw0KICAgICAqLw0KICAgIGNsZWFyQWxsRmlsdGVyKCkgew0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIC8vbWUuZmlsdGVySGVhZGVyLnJlbW92ZUFsbCgpOw0KICAgICAgbWUuZmlsdGVySGVhZGVyLmZvckVhY2goKGl0ZW0pID0+IHsNCiAgICAgICAgaWYgKA0KICAgICAgICAgICFpdGVtLmZvcm1hdFR5cGUgfHwNCiAgICAgICAgICBpdGVtLmZvcm1hdFR5cGUgPT0gbWUuJG1zLmVudW0uRm9ybWF0VHlwZS5UZXh0IHx8DQogICAgICAgICAgaXRlbS5mb3JtYXRUeXBlID09IG1lLiRtcy5lbnVtLkZvcm1hdFR5cGUuTm9uZQ0KICAgICAgICApIHsNCiAgICAgICAgICBpdGVtLmZpbHRlci5vcGVyYXRvciA9IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5Db250YWluczsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpdGVtLmZpbHRlci5vcGVyYXRvciA9IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5FcXVhbHM7DQogICAgICAgIH0NCiAgICAgICAgaXRlbS5maWx0ZXIudmFsdWUgPSBudWxsOw0KICAgICAgICBpdGVtLmhhc0FjdGlvbkZpbHRlciA9IGZhbHNlOw0KICAgICAgICBsZXQgdGggPSBtZS4kcmVmcy50aC5maWx0ZXIoKHgpID0+IHguY29sLmRhdGFGaWVsZCA9PSBpdGVtLmRhdGFGaWVsZCk7DQogICAgICAgIGlmICh0aCAmJiB0aC5sZW5ndGggPiAwKSB7DQogICAgICAgICAgdGhbMF0uY2hlY2tIaWRlTWVudUhlYWRlcigpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICAgIG1lLiRlbWl0KCJmaWx0ZXIiLCB7fSk7DQogICAgICBtZS5maWx0ZXJIZWFkZXIgPSBbXTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFNob3cgaOG6v3QgaWNvbiBmaWx0ZXIgbMOqbg0KICAgICAqLw0KICAgIGZ1blNob3dBbGxJY29uRmlsdGVyKHZhbHVlKSB7DQogICAgICBsZXQgbWUgPSB0aGlzOw0KICAgICAgbWUuY29sdW1ueC5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgIGxldCB0aCA9IG1lLiRyZWZzLnRoLmZpbHRlcigoeCkgPT4geC5jb2wuZGF0YUZpZWxkID09IGl0ZW0uZGF0YUZpZWxkKTsNCiAgICAgICAgaWYgKHRoICYmIHRoLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICB0aFswXS5zaG93QWxsSWNvbkZpbHRlciA9IHZhbHVlOw0KICAgICAgICAgIC8vdGhbMF0uY2hlY2tIaWRlTWVudUhlYWRlcigpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogdGjDqm0gaMOgbSB0aGnhur90IGzhuq1wIGPhu5l0IOG6qW4gaGnhu4duIGPhu5l0IHRyw6puIGdyaWQgxJHhu4MgY8OzIHRo4buDIGfhu41pIHThu6sgY29tcG9uZW50IHPhu60gZOG7pW5nICBncmlkDQogICAgICogcHZkdXkgMDIvMDQvMjAyMQ0KICAgICAqLw0KICAgIHNldENvbHVtblZpc2libGUoZmllbGQsIHZpc2libGUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGxldCBjb2x1bW4gPSBudWxsOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZS5jb2x1bW5zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGxldCBjb2wgPSBtZS5jb2x1bW5zW2ldOw0KICAgICAgICBpZiAoY29sLmRhdGFGaWVsZCA9PT0gZmllbGQpIHsNCiAgICAgICAgICBjb2x1bW4gPSBjb2w7DQogICAgICAgICAgY29sdW1uLnZpc2libGUgPSB2aXNpYmxlOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBtZS5pbml0Q29sdW1ucyhtZS5jb2x1bW5zKTsNCiAgICB9LA0KICAgIC8vTOG6pXkgZWxlbWVudCBzY3JvbGwNCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApDQogICAgZ2V0U2Nyb2xsZXIoKSB7DQogICAgICBpZiAodGhpcyAmJiB0aGlzLiRlbCAmJiB0eXBlb2YgdGhpcy4kZWwucXVlcnlTZWxlY3RvciA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICByZXR1cm4gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLnNjcm9sbGVyIik7DQogICAgICB9DQogICAgICByZXR1cm4gbnVsbDsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIHNjcm9sbCB0aGVvIHBow61tIHVwIC9kb3duDQogICAgICogQHBhcmFtIHtC4bqjbiBnaGkgxJFhbmcgc2VsZWN0ZWR9IHR5cGVBaGVhZFBvaW50ZXINCiAgICAgKiBAcGFyYW0ge2TDsm5nIGZvY3VzIHRyxrDhu5tjIMSRw7N9IHRyT2xkDQogICAgICogQHBhcmFtIHtTY3JvbGwgTMOqbiBoYXkgeHXhu5FuZ30gc2Nyb2xsVXANCiAgICAgKiBDcmVhdGVkQnkgTk5MQU0gMTYuMDYuMjAyMA0KICAgICAqLw0KICAgIGFkanVzdFNjcm9sbCh0eXBlQWhlYWRQb2ludGVyID0gdGhpcy50eXBlQWhlYWRQb2ludGVyLCB0ck9sZCwgc2Nyb2xsVXApIHsNCiAgICAgIGxldCBzY3JvbGxlciA9IHRoaXMuZ2V0U2Nyb2xsZXIoKTsNCiAgICAgIGxldCB0ZEhlaWdodCA9IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoInRkIikub2Zmc2V0SGVpZ2h0Ow0KICAgICAgbGV0IHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigNCiAgICAgICAgYC5tcy10Ym9keS5kYXRhIHRyW2luZGV4Um93PScke3R5cGVBaGVhZFBvaW50ZXJ9J11gDQogICAgICApOw0KICAgICAgbGV0IHRoID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLm1zLXRoZWFkIHRoIik7DQogICAgICBpZiAoc2Nyb2xsZXIgJiYgdHIgJiYgdGgpIHsNCiAgICAgICAgaWYgKCFzY3JvbGxVcCkgew0KICAgICAgICAgIGlmICgNCiAgICAgICAgICAgIHRyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCAtIHRoLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCA+PQ0KICAgICAgICAgICAgc2Nyb2xsZXIub2Zmc2V0SGVpZ2h0IC0gdGgub2Zmc2V0SGVpZ2h0DQogICAgICAgICAgKSB7DQogICAgICAgICAgICBzY3JvbGxlci5zY3JvbGxUb3AgKz0gdHIub2Zmc2V0VG9wIC0gdHJPbGQub2Zmc2V0VG9wOw0KICAgICAgICAgIH0NCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAodHIub2Zmc2V0VG9wIDw9IHRoLm9mZnNldFRvcCArIHRkSGVpZ2h0IC8gMikgew0KICAgICAgICAgICAgc2Nyb2xsZXIuc2Nyb2xsVG9wIC09IHRyT2xkLm9mZnNldFRvcCAtIHRyLm9mZnNldFRvcDsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIHjhu60gbMO9IGJpbmRpbmcgZOG7ryBsaeG7h3UgY2hvIGPDoWMgZ3JpZCBjw7MgY2hlY2tib3ggY2hvIHBow6lwIGNo4buNbiByb3cgKHYtbW9kZWwpDQogICAgICogQHBhcmFtIHtbT2JqZWN0L1N0cmluZ119IGxpc3RJdGVtcyBEYW5oIHPDoWNoIGPDoWMgaXRlbSDEkWFuZyBu4bqxbSB0csOqbiBncmlkIGhv4bq3YyBkYW5oIHPDoWNoIElEIGPhu6dhIGPDoWMgSXRlbSBj4bqnbiBjaGVjaw0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBpZEZpZWxkIFByaW1hcnkga2V5IGPhu6dhIG1vZGVsL29iamVjdCB0cm9uZyBzdG9yZQ0KICAgICAqLw0KICAgIHNldE1vZGVsQnlJZChsaXN0SXRlbXMsIGlkRmllbGQgPSBudWxsKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsaXN0SXRlbXMgPSBsaXN0SXRlbXMgfHwgW107DQogICAgICAvL1Ryb25nIHRyxrDhu51uZyBo4bujcCBraMO0bmcgcGjhuqNpIGdyaWQgYWxsb3cgY2hlY2sgdGjDrCBraMO0bmcgY+G6p24gbMOgbSBnw6wNCiAgICAgIGlmICghbWUubXVsdGlwbGUpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICBsZXQgaWRQcm9wZXJ0eSA9IG51bGw7DQogICAgICBpZiAoaWRGaWVsZCkgew0KICAgICAgICBpZFByb3BlcnR5ID0gaWRGaWVsZDsNCiAgICAgIH0gZWxzZSBpZiAobWUuaWRQcm9wZXJ0eSkgew0KICAgICAgICBpZFByb3BlcnR5ID0gbWUuaWRQcm9wZXJ0eTsNCiAgICAgIH0NCg0KICAgICAgaWYgKGlkUHJvcGVydHkpIHsNCiAgICAgICAgbGV0IGFyck1vZGVsID0gW107DQoNCiAgICAgICAgbGlzdEl0ZW1zLmZvckVhY2goKGlkKSA9PiB7DQogICAgICAgICAgbWUuZGF0YXguZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBpZCA9PSAib2JqZWN0Iikgew0KICAgICAgICAgICAgICBpZiAoaXRlbVtpZFByb3BlcnR5XSA9PSBpZFtpZFByb3BlcnR5XSkgew0KICAgICAgICAgICAgICAgIGFyck1vZGVsLnB1c2goaXRlbSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGlmIChpdGVtW2lkUHJvcGVydHldID09IGlkKSB7DQogICAgICAgICAgICAgICAgYXJyTW9kZWwucHVzaChpdGVtKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCg0KICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBhcnJNb2RlbCk7DQogICAgICB9DQogICAgfSwNCg0KICAgIC8qDQogICAgICogSMOgbSBt4bufIHBvcHVwIGNvbmZpZ2NvbHVtbg0KICAgICAqIFRETkdISUEgMS8xMC8yMDIxDQogICAgICovDQogICAgb3BlbkNvbmZpZ0NvbHVtQm94KCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICBtZS5zaG93aW5nQ29uZmlnQ29sdW1uQm94ID0gIW1lLnNob3dpbmdDb25maWdDb2x1bW5Cb3g7DQogICAgfSwNCg0KICAgIC8qKioNCiAgICAgKiBJbml0IGzhuqFpIGNvbHVtbiBncmlkDQogICAgICogVEROR0hJQSAxMC8zLzIwMjENCiAgICAgKi8NCiAgICBsYXlvdXRPbkNoYW5nZShuZXdMYXlvdXQpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCg0KICAgICAgbWUuaW5pdENvbHVtbnMobmV3TGF5b3V0KTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogxJDDs25nIGNvbmZpZ2JveCAoYuG6r3Qgc+G7sSBraeG7h24gdOG7qyBtcy1jb25maWctY29sdW1uKQ0KICAgICAqIFRETkdISUEgMTAvMy8yMDIxDQogICAgICovDQogICAgY2xvc2VDb25maWdCb3goKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQoNCiAgICAgIG1lLnNob3dpbmdDb25maWdDb2x1bW5Cb3ggPSBmYWxzZTsNCiAgICB9LA0KDQogICAgZ2V0Q29uZmlnRGVmYXVsdCgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCg0KICAgICAgbWUuJGVtaXQoImdldENvbmZpZ0RlZmF1bHQiKTsNCiAgICB9LA0KICB9LA0KfTsNCg=="},null]}
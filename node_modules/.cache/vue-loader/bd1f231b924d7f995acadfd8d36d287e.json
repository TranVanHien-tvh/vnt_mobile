{"remainingRequest":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\VNT_vue\\src\\components\\mscombobox\\msCombobox.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\VNT_vue\\src\\components\\mscombobox\\msCombobox.vue","mtime":1665805263002},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgTXNDb21ib0JveERyb3Bkb3duIGZyb20gIi4vTXNDb21ib0JveERyb3Bkb3duLnZ1ZSI7DQppbXBvcnQgTXNDb21ib0JveEl0ZW0gZnJvbSAiLi9Nc0NvbWJvQm94SXRlbS52dWUiOw0KaW1wb3J0IGNvbW1vbkZuIGZyb20gIkAvY29tbW9ucy9jb21tb25GdW5jdGlvbi5qcyI7DQppbXBvcnQgbXNCYXNlQ29tcG9uZW50IGZyb20gIkAvY29tcG9uZW50cy9tc2Jhc2UvbXNCYXNlQ29tcG9uZW50LnZ1ZSI7DQppbXBvcnQgRXZlbnRCdXNHbG9iYWwsIHsgR2xvYmFsRXZlbnROYW1lIH0gZnJvbSAiQC9jb21tb25zL2V2ZW50QnVzR2xvYmFsIjsNCmltcG9ydCBwb3B1cFV0aWwgZnJvbSAiQC9jb21tb25zL3BvcHVwVXRpbCI7DQppbXBvcnQgaTE4biBmcm9tICJAL2kxOG5zL2kxOG4iOw0KaW1wb3J0IG1lc3NhZ2VCb3ggZnJvbSAiQC9jb21tb25zL21lc3NhZ2VCb3giOw0KaW1wb3J0IF8gZnJvbSAibG9kYXNoIjsNCmltcG9ydCB7IGZpbHRlciB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9maWx0ZXIiOw0KaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7DQppbXBvcnQgeyB2YWxpZGF0ZUNvbWJvYm94IH0gZnJvbSAiQC9taXhpbnMvY29tcG9uZW50L3ZhbGlkYXRlQ29tYm9ib3giOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJNc0NvbWJvYm94IiwNCiAgY29tcG9uZW50czogew0KICAgIE1zQ29tYm9Cb3hEcm9wZG93biwNCiAgICBNc0NvbWJvQm94SXRlbSwNCiAgfSwNCiAgZXh0ZW5kczogbXNCYXNlQ29tcG9uZW50LA0KICBtaXhpbnM6IFtmaWx0ZXIsIHZhbGlkYXRlQ29tYm9ib3hdLA0KICBpbmhlcml0QXR0cnM6IGZhbHNlLA0KICBwcm9wczogew0KICAgIHZhbHVlOiB7fSwNCiAgICBjdXN0b21Ub29sdGlwOiB7DQogICAgICBkZWZhdWx0OiBudWxsLA0KICAgICAgdHlwZTogW09iamVjdF0sDQogICAgfSwNCiAgICBwbGFjZWhvbGRlcjogew0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sDQogICAgfSwNCiAgICBtYXhJdGVtc0Rpc3BsYXk6IHsNCiAgICAgIGRlZmF1bHQ6IDUsDQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgfSwNCiAgICBjb2x1bW5zOiB7DQogICAgICB0eXBlOiBBcnJheSwNCiAgICAgIGRlZmF1bHQ6ICgpID0+IFtdLA0KICAgIH0sDQogICAgLyoqDQogICAgICogVHLGsOG7nW5nIGzDoG0gdmFsdWUNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTUuMDYuMjAyMA0KICAgICAqLw0KICAgIHZhbHVlRmllbGQ6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBUcsaw4budbmcgbMOgbSB0ZXh0IGRpc3BsYXkNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTUuMDYuMjAyMA0KICAgICAqLw0KICAgIGRpc3BsYXlGaWVsZDogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIC8vROG7ryBsaeG7h3UgY+G7p2EgY29tYm9ib3gNCiAgICBkYXRhOiB7DQogICAgICBkZWZhdWx0OiAoKSA9PiBbXSwNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgIH0sDQogICAgLy/EkOG7mSBy4buZbmcgY+G7p2EgMSBpdGVtDQogICAgaXRlbVNpemU6IHsNCiAgICAgIGRlZmF1bHQ6IDM2LA0KICAgICAgdHlwZTogTnVtYmVyLA0KICAgIH0sDQogICAgLy9DaOG7iSBuaOG6rW4gZ2nDoSB0cuG7iyBjw7MgdHJvbmcgZGFuaCBzw6FjaA0KICAgIGZvcmNlU2VsZWN0aW9uOiB7DQogICAgICBkZWZhdWx0OiB0cnVlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIC8vTMOgIGNvbWJvdHJlZSBoYXkga2jDtG5nDQogICAgaXNUcmVlOiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICAvL1BhcmVudCBGaWVsZA0KICAgIGlkUHJvcGVydHk6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICAvL0ZpZWxkIGNo4bupYSBwYXJlbnRJRA0KICAgIHBhcmVudElkUHJvcGVydHk6IHsNCiAgICAgIGRlZmF1bHQ6ICJQYXJlbnRJRCIsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICAvL0tow7RuZyBjaG8gcGjDqXAgY2jhu41uIHRyxrDhu51uZyBsw6AgY2hhDQogICAgbm90U2VsZWN0aW9uUGFyZW50OiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCiAgICAvL8SQ4buZIHLDtG5nIGPhu6dhIGRyb3Bkb3duIHTDrW5oIGLhurFuZyBweA0KICAgIGRyb3Bkb3duV2lkdGg6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLA0KICAgIH0sDQogICAgLy9Nb2RlIHF1ZXJ5IGzhuqV5IGThu68gbGnhu4d1IHThu6sgc2VydmVyIGhheSBjbGllbnQNCiAgICBxdWVyeU1vZGU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6ICJsb2NhbCIsDQogICAgfSwNCiAgICByZW1vdGVGaWx0ZXI6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICB9LA0KICAgIC8vR8OhbiBnacOhIHRy4buLIHRleHQgbMO6YyBiYW4gxJHhuqd1DQogICAgaW5pdFRleHQ6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddLA0KICAgIH0sDQogICAgLy8gLy9Db21ibyBt4bq3YyDEkeG7i25oIGNo4buNbiBi4bqjbiBnaGkgdGhlbyBpbmRleA0KICAgIC8vIGluaXRJbmRleDogew0KICAgIC8vICAgZGVmYXVsdDogMCwNCiAgICAvLyAgIHR5cGU6IE51bWJlcg0KICAgIC8vIH0sDQogICAgZGlzYWJsZWQ6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIHJlYWRPbmx5OiB7DQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgfSwNCg0KICAgIC8vY2jhu4kgY2hvIHBow6lwIGNo4buNbiBraMO0bmcgY2hvIHBow6lwIG5o4bqtcCB0ZXh0DQogICAgc2VsZWN0T25seTogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAgYXV0b0xvYWQ6IHsNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICB9LA0KICAgIGRpc3BsYXk6IHt9LA0KICAgIG1hcHBpbmdGaWVsZDogew0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIGZpcnN0RXhwYW5kTG9hZDogew0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgIH0sDQogICAga2V5RmllbGQ6IHsNCiAgICAgIC8vIGRlZmF1bHQ6ICdfX3ZLZXlWYWx1ZScsDQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICBtYXhMZW5ndGg6IHsNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgfSwNCiAgICBsZWZ0SWNvbjogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgIH0sDQogICAgLyoqDQogICAgICogQ8OidSBow6xuaCBxdWlja3NlYXJjaA0KICAgICAqLw0KICAgIHF1aWNrU2VhcmNoOiB7DQogICAgICB0eXBlOiBTdHJpbmcsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBE4buvIGxp4buHdSB0cnV54buBbiBrw6htIHF1aWNrc2VhcmNoDQogICAgICovDQogICAgcXVpY2tTZWFyY2hQYXJhbTogew0KICAgICAgdHlwZTogT2JqZWN0LA0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEPDonUgaMOsbmggYWRkDQogICAgICovDQogICAgcXVpY2tBZGQ6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICBpc1Nob3dUZXh0OiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIGNoZWNrIHF1eeG7gW4gduG7m2kgcXVpY2thZGQNCiAgICAgKi8NCiAgICBpc1Blcm1pc3Npb246IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiB0cnVlLA0KICAgIH0sDQogICAgLy9wdmR1eSAxNy8wMy8yMDIxOiB0aMOqbSBwcm9wIHJ1bGUgxJHhu4MgY8OzIHRo4buDIGN1c3RvbSDhu58gbmdvw6BpIGZvcm0NCiAgICBydWxlczogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogIiIsDQogICAgfSwNCiAgICAvKg0KICAgICAqIEjDoG0gc2hvdyByYSBjw6J1IHRow7RuZyBiw6FvIHJpw6puZyB0aGVvIHThu6tuZyB0csaw4budbmcgaOG7o3ANCiAgICAgKiB2w60gZOG7pTogY3VzdG9tV2FycmluZyB7cnVsZXM6J3JlcXVpcmVkJywgbWVzOiAnVMOgaSBz4bqjbiBuw6B5IGzDoCBj4bunYSBwdmR1eSd9DQogICAgICovDQogICAgY3VzdG9tV2FycmluZzogew0KICAgICAgdHlwZTogT2JqZWN0LA0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIERhbmggc8OhY2ggY8OhYyB0csaw4budbmcgZOG7ryBsaeG7h3UgbOG6pXkgduG7gQ0KICAgICAqLw0KICAgIHJlcXVlc3RGaWVsZDogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogbnVsbCwNCiAgICB9LA0KICAgIHNob3dUaXRsZTogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQogICAgLyoqDQogICAgICogRGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyBk4buvIGxp4buHdSBs4bqleSB24buBDQogICAgICovDQogICAgdGl0bGU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBjdXN0b20gbOG6oWkgdGhhbSBz4buRIGZpbHRlcg0KICAgICAqLw0KICAgIGJ1aWxkRmlsdGVyOiB7DQogICAgICB0eXBlOiBGdW5jdGlvbiwNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCg0KICAgIGlzUmVsb2FkOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBzaXplIHBhZ2luZw0KICAgICAqLw0KICAgIHBhZ2VTaXplOiB7DQogICAgICB0eXBlOiBOdW1iZXIsDQogICAgICBkZWZhdWx0OiAxMCwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEdpw6EgdHLhu4sgYuG6o24gZ2hpIHThuqV0IGPhuqMNCiAgICAgKi8NCiAgICBzZWxlY3RBbGxWYWx1ZTogew0KICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSwNCiAgICAgIGRlZmF1bHQ6IC0xLA0KICAgIH0sDQogICAgLyoqDQogICAgICogVGV4dCBoaeG7g24gdGjhu4sgdOG6pXQgY+G6ow0KICAgICAqLw0KICAgIHNlbGVjdEFsbFRleHQ6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBDw7MgaGnhu4NuIHRo4buLIGLhuqNuIGdoaSB04bqldCBj4bqjIGtow7RuZw0KICAgICAqLw0KICAgIHNob3dTZWxlY3RBbGw6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogTuG6v3UgZm9jdXMgdGjDrCBt4bubaSB2YWxpZGF0ZQ0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTguMDguMjAyMQ0KICAgICAqLw0KICAgIHZhbGlkYXRlT25Gb2N1czogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBWYWxpZGF0ZSBraGkgYmx1cg0KICAgICAqIEBhdXRob3IgTkRIVVkgMDYuMDEuMjAyMQ0KICAgICAqLw0KICAgIHZhbGlkYXRlT25CbHVyOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogdHJ1ZSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIEdpw6EgdHLhu4sgdmFsdWUgY2hvIGPhu6dhIGdpw6EgdHLhu4sgIlThuqV0IGPhuqMiDQogICAgICovDQogICAgdmFsdWVBbGxTZWxlY3RlZDogew0KICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSwNCiAgICAgIGRlZmF1bHQ6IC0xLA0KICAgIH0sDQogICAgLyoqDQogICAgICogVMOqbiBlbnVtIGPhu6dhIGNvbWJvYm94DQogICAgICovDQogICAgbmFtZUVudW06IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6IG51bGwsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIGPhu50g4bqpbiBoaeG7h24gbsO6dCB0aMOqbSBuaGFuaCBiw6puIG5nb8OgaSBjb21ibw0KICAgICAqIE5NVFVBTjIgMDMuMTEuMjAyMQ0KICAgICAqLw0KICAgIGlzSGFzQ29tYm9BZGQ6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogY+G7nSDEkeG6vyBu4bq/dSBnacOhIHRy4buLIG5o4bqtcCB2w6BvIGzDoCB0cuG7kW5nIHRow6wgc+G6vSBi4buPIGNo4buNbg0KICAgICAqIE5NVFVBTjIgMzAuMTIuMjAyMQ0KICAgICAqLw0KICAgIGFsbG93RGVzZWxlY3RJdGVtOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIGPhu50gY2hvIHBow6lwIGx1w7RuIGdp4buvIGzhuqFpIGdpw6EgdHLhu4sgbmjhuq1wDQogICAgICogTk1UVUFOMiAwNC4wMS4yMDIyDQogICAgICovDQogICAgYWxsb3dGcmVlVGV4dDogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IGZhbHNlLA0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiB0cnVlOiBi4buPIHF1YSBjaOG7ryBob2EvIHRoxrDhu51uZw0KICAgICAqIE5NVFVBTjIgMDQuMDEuMjAyMg0KICAgICAqLw0KICAgIGlnbm9yZUNhc2U6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogc2V0IHR5cGVBaGVhZFBvaW50ZXIgduG7gSAtMQ0KICAgICAqIE5UVEhBTkgxDQogICAgICovDQogICAgcmVzZXRUeXBlQWhlYWRQb2ludGVyOiB7DQogICAgICB0eXBlOiBCb29sZWFuLA0KICAgICAgZGVmYXVsdDogZmFsc2UsDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBjw7MgbXXhu5FuIHNob3cgY2hlY2sgYm94IGhheSBraMO0bmcNCiAgICAgKi8NCiAgICBpc1Nob3dDaGVja0JveDogew0KICAgICAgdHlwZTogQm9vbGVhbiwNCiAgICAgIGRlZmF1bHQ6IHRydWUsDQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIGPDsyBtdeG7kW4gZHJvcGRvd24gY8OzIMSR4buZIGTDoGkgZml0IHbhu5tpIGNvbWJvIHRow6wgY2hvIGLhurFuZyB0cnVlDQogICAgICogVEROR0hJQSAzLzMvMjAyMQ0KICAgICAqLw0KICAgIGZvcmNlTWF4V2lkdGg6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZSwNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogQ29tYm8gdHJvbmcgYuG7mSBs4buNYyB0aMOsIHBo4bqjaSBjw7MgdHLGsOG7nW5nIG7DoHkNCiAgICAgKiBOTVRVQU4zIDE0LzQvMjAyMg0KICAgICAqLw0KICAgIGZpbHRlck5hbWU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICB9LA0KICB9LA0KICBkYXRhKCkgew0KICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICBtZS5pbml0U3RhdGljRGF0YSgpOw0KDQogICAgcmV0dXJuIHsNCiAgICAgIGludGVybmFsRGF0YVNvdXJjZTogW10sDQogICAgICBpbnRlcm5hbFRleHQ6IG51bGwsDQogICAgICBleHBhbmRlZDogZmFsc2UsDQogICAgICBkcm9wZG93blRvcHg6IDAsDQogICAgICBkcm9wZG93bkxlZnR4OiAwLA0KICAgICAgaW50ZXJuYWxTZWxlY3RlZEl0ZW06IG51bGwsDQogICAgICB0eXBlQWhlYWRQb2ludGVyOiAtMSwNCiAgICAgIGZvY3VzZWQ6IGZhbHNlLA0KICAgICAgLy/EkFZUaGkgIDAzLzAzLzIwMjENCiAgICAgIC8va8OtY2ggdGjGsOG7m2MgbeG6t2MgxJHhu4tuaCBj4bunYSBpdGVtU2l6ZSBj4bunYSBjb21ib3gga2hpIMSRxrDhu6NjIGTDuW5nIHRyw6puIGzGsOG7m2kgRWRpdG9yDQogICAgICBncmlkSXRlbVNpemU6IDQ4LA0KICAgICAgdG9vbHRpcExlZnQ6IDAsDQogICAgICBkcm9wZG93blNjcm9sbFRvcDogMCwNCiAgICAgIC8qKg0KICAgICAgICogxJBhbmcgbG9hZCBk4buvIGxp4buHdQ0KICAgICAgICovDQogICAgICBsb2FkaW5nOiBmYWxzZSwNCiAgICAgIC8qKg0KICAgICAgICogVGhhbSBz4buRIGxvYWQgZOG7ryBsaeG7h3UgbOG6p24gZ+G6p24gbmjhuqV0DQogICAgICAgKi8NCiAgICAgIGxhc3RSZXF1ZXN0UGFyYW06IG51bGwsDQogICAgfTsNCiAgfSwNCiAgY29tcHV0ZWQ6IHsNCiAgICAvKioNCiAgICAgKiBkYXRhIHNvdXJjZSBjaG8gdG9vbHRpcA0KICAgICAqIGNyZWF0ZWQgYnkgbnRwaG9uZyAyOS81LzIwMjENCiAgICAgKi8NCiAgICB0b29sdGlwRGF0YVNvdXJjZSgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGxldCBkYXRhU291cmNlID0gbWUuaW50ZXJuYWxEYXRhU291cmNlOw0KICAgICAgaWYgKG1lLl9hbGxEYXRhICYmIG1lLl9hbGxEYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZGF0YVNvdXJjZSA9IG1lLl9hbGxEYXRhOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGRhdGFTb3VyY2U7DQogICAgfSwNCiAgICBsaXN0ZW5lcnMoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICByZXR1cm4gew0KICAgICAgICBpbnB1dDogKGV2ZW50KSA9PiBtZS5vbklucHV0KGV2ZW50KSwNCiAgICAgICAgZm9jdXM6IChldmVudCkgPT4gbWUub25Gb2N1cyhldmVudCksDQogICAgICAgIGNoYW5nZTogKGV2ZW50KSA9PiBtZS5vbkNoYW5nZShldmVudCksDQogICAgICAgIGJsdXI6IChldmVudCkgPT4gbWUub25CbHVyKGV2ZW50KSwNCiAgICAgICAga2V5ZG93bjogKGV2ZW50KSA9PiBtZS5vbktleWRvd24oZXZlbnQpLA0KICAgICAgICBjbGljazogKGV2ZW50KSA9PiBtZS5vbkNsaWNrKGV2ZW50KSwNCiAgICAgIH07DQogICAgfSwNCiAgICAvL1TDrW5oIMSR4buZIHLhu5luZyBj4bunYSBkcm9wZG93biBjb21ib2JveCDEkeG7gyBzY3JvbGwNCiAgICBzdHlsZVNjcm9sbGVyKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgcmV0dXJuIHsgIm1heC1oZWlnaHQiOiBtZS5tYXhJdGVtc0Rpc3BsYXkgKiBtZS5pdGVtU2l6ZSArICJweCIgfTsNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIMSQVlRoaSAwMy8wMy8yMDIxIHTDuXkgYmnhur9uIGzhuqFpIMSR4buZIHLhu5luZyBj4bunYSBpdGVtIFNpemUga2hpIGTDuW5nIGNvbWJveCB0csOqbiBsxrDhu5tpIEVkaXRvciA9NDhweA0KICAgICAqLw0KICAgIGl0ZW1TaXplQ29tcHV0ZSgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmIChtZS4kZWRpdG9yQ2xhc3MpIHsNCiAgICAgICAgcmV0dXJuIG1lLmdyaWRJdGVtU2l6ZTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiBtZS5pdGVtU2l6ZTsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIMSQVlRoaSAwMy8wMy8yMDIxIG7hur91IGNvbWJveCBtw6AgxJHGsOG7o2MgZMO5bmcgdHLDqm4gbMaw4bubaSBFZGl0b3IgdGjDrCBhcHBseSB0aMOqbSBjbGFzcyDEkeG7gyB0w7l5IGJp4bq/biDEkeG7mSBy4buZbmcNCiAgICAgKi8NCiAgICBkcm9wZG93bkNsYXNzKCkgew0KICAgICAgaWYgKHRoaXMuJGVkaXRvckNsYXNzKSB7DQogICAgICAgIHJldHVybiB0aGlzLiRlZGl0b3JDbGFzczsNCiAgICAgIH0NCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0sDQogICAgLyoqDQogICAgICogQ8OzIGhp4buDbiB0aOG7iyBxdWlja2FkZCBraMO0bmcNCiAgICAgKi8NCiAgICBoYXNTaG93UXVpY2tBZGQoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsZXQgcmVzID0gZmFsc2U7DQoNCiAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAwICYmIG1lLnF1aWNrQWRkKSB7DQogICAgICAgIGlmIChtZS5fYWxsRGF0YSkgew0KICAgICAgICAgIHJlcyA9IHRydWU7DQogICAgICAgIH0gZWxzZSBpZiAobWUubGFzdFJlcXVlc3RQYXJhbSkgew0KICAgICAgICAgIHJlcyA9IHRydWU7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIHJlczsNCiAgICB9LA0KICB9LA0KICB3YXRjaDogew0KICAgIHJ1bGVzOiB7DQogICAgICBoYW5kbGVyKG5ld1ZhbCwgb2xkVmFsKSB7DQogICAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgICAgbWUudmFsaWRhdGUobWUpOw0KICAgICAgfSwNCiAgICB9LA0KICAgIGRhdGE6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsNCiAgICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICAgIGlmIChtZS5sb2FkaW5nKSB7DQogICAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOw0KDQogICAgICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICAgIG1lLmRvSGlnaHRsaWdodEl0ZW0oKTsNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChuZXdWYWwgPT0gbnVsbCkgew0KICAgICAgICAgIC8vdMOsbmggaHXhu5FuZyBjw7MgdGjDqm0vc+G7rWEveMOzYSBk4buvIGxp4buHdSBn4buRYyAtPiByZXNldCDEkeG7gyBraGkgZXhwYW5kIHPhur0gbG9hZCBs4bqhaSBk4buvIGxp4buHdQ0KICAgICAgICAgIG1lLmxhc3RRdWVyeVN0cmluZyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KICAgICAgICAgIG1lLl9hbGxEYXRhID0gbnVsbDsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBpZiAobWUucXVlcnlNb2RlICE9PSAicmVtb3RlIikgew0KICAgICAgICAgICAgbWUuX2FsbERhdGEgPSBuZXdWYWw7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlICE9IG5ld1ZhbCAmJg0KICAgICAgICAgICAgIShtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAwICYmIG5ld1ZhbC5sZW5ndGggPT09IDApDQogICAgICAgICAgKSB7DQogICAgICAgICAgICBtZS5pbml0RGF0YSgpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSwNCiAgICB9LA0KICAgIC8qKg0KICAgICAqIFNldCBs4bqhaSBnacOhIHRy4buLIGhp4buDbiB0aOG7iyBraGkgZ2nDoSB0cuG7iyBj4bunYSBiaeG6v24gaW5pdFRleHQgdGhheSDEkeG7lWkNCiAgICAgKi8NCiAgICBpbml0VGV4dDogew0KICAgICAgaW1tZWRpYXRlOiB0cnVlLA0KICAgICAgaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgew0KICAgICAgICBsZXQgbWUgPSB0aGlzOw0KICAgICAgICBpZiAobmV3VmFsIHx8IG9sZFZhbCkgew0KICAgICAgICAgIGxldCB2YWwgPSBuZXdWYWwgPyBuZXdWYWwgOiBvbGRWYWw7DQogICAgICAgICAgLy8gTk1UVUFOMiAwNC4wMS4yMDIxOiBjaG8gcGjDqXAgbOG6pXkgZ2nDoSB0cuG7iyBt4bubaSBuaOG6pXQNCiAgICAgICAgICBpZiAobWUuYWxsb3dGcmVlVGV4dCkgew0KICAgICAgICAgICAgdmFsID0gbmV3VmFsID8gbmV3VmFsIDogIiI7DQogICAgICAgICAgfQ0KICAgICAgICAgIG1lLnNldEluaXRUZXh0KHZhbCk7DQogICAgICAgIH0NCiAgICAgIH0sDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIG7hur91IHRleHQgaGnhu4duIHRo4buLIHRoYXkgxJHhu5VpIHRoaSB2YWxpZGF0ZQ0KICAgICAqIE1vZGlmeSBieSDEkFZUaGkgMDUvMDIvMjAyMCB0cnV54buBbiB0aMOqbSBtZSB2w6BvIHZhbGlkYXRlIChtZSkgxJHhu4Mga2hpIG5nxrDhu51pIGTDuW5nIGNo4buNbiBnacOhIHRy4buLIGNoxrBhIGPDsyB0cm9uZyBkYW5oIG3hu6VjDQogICAgICAgIHRoaSBiw6FvIGzhu5dpDQogICAgICovDQogICAgaW50ZXJuYWxUZXh0OiB7DQogICAgICBoYW5kbGVyKG5ld1ZhbCwgb2xkVmFsKSB7DQogICAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgICAgbmV3VmFsID0gbmV3VmFsID8gbmV3VmFsIDogIiI7DQogICAgICAgIG9sZFZhbCA9IG9sZFZhbCA/IG9sZFZhbCA6ICIiOw0KICAgICAgICAvLyB2dmtpZXQgLSAxOC4wOC4yMDIxOiBUaMOqbSDEkWnhu4F1IGtp4buHbiBwaOG7pWMgduG7pSBjaG8gVEggbuG6v3UgZm9jdXMgdsOgbyBjb250cm9sIHRow6wgbeG7m2kgdmFsaWRhdGUNCiAgICAgICAgLy8gVsOtIGThu6U6IFRIIEzGsHUgdsOgIFRow6ptIG3hu5tpLCBzYXUga2hpIGzGsHUgeG9uZyB0aMOsIHThu7EgxJHhu5luZyBiw6FvIGzhu5dpIGNvbnRyb2wga2jDtG5nIMSRxrDhu6NjIMSR4buDIHRy4buRbmcNCiAgICAgICAgaWYgKG5ld1ZhbCAhPSBvbGRWYWwgJiYgKCFtZS52YWxpZGF0ZU9uRm9jdXMgfHwgbWUuZm9jdXNlZCkpIHsNCiAgICAgICAgICAvL0FkZCBtZSBieSDEkFZUaGkgMDUvMDIvMjAyMSBwaOG7pWMgduG7pSB2YWxpZGF0ZSBnacOhIHRy4buLIG5nxrDhu51pIGTDuW5nIG5o4bqtcCBzYWkgZm9yY2VTZWxlY3Rpb24NCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsNCiAgICAgICAgICAgIG1lLnZhbGlkYXRlKG1lKTsNCiAgICAgICAgICB9LCA1MDApOw0KICAgICAgICB9DQogICAgICAgIC8vIG1lLiRlbWl0KCdpbnB1dCcsbmV3VmFsKTsNCiAgICAgIH0sDQogICAgfSwNCiAgICAvL0toaSB0aGF5IMSR4buVaSBz4buRIHBo4bqnbiB04butIGPhu6dhIGNvbWJveCB0aMOsIHRoaeG6v3QgbOG6rXAgbOG6oWkgduG7iyB0csOtIGPhu6dhIGRyb3Bkb3cNCiAgICBpbnRlcm5hbERhdGFTb3VyY2U6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsNCiAgICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgICAvL8SQVlRoaSBz4butYSBs4buXaSA5MDQ5MSBraMO0bmcgdGhheSDEkeG7lWkgduG7iyB0csOtIGtoaSBnw7UgdGV4dCDEkeG7gyBzZWFyY2ggdHLDqm4gY29tYm94DQogICAgICAgIG1lLmNoYW5nZURyb3Bkb3duUG9zaXRpb24oKTsNCiAgICAgIH0sDQogICAgfSwNCiAgICAvKioNCiAgICAgKiBO4bq/dSBnacOhIHRy4buLIFZNb2RlbCBj4bunYSBjb21ibyB0aGF5IMSR4buVaSB0aMOsIGfDoW4gbOG6oWkgZ2nDoSB0cuG7iyBt4bubaSB2w6Agc2VsZWN0IHbDoG8gaXRlbSB0xrDGoW5nIOG7qW5nIGPDsyB0cm9uZyBkYXRhDQogICAgICovDQogICAgdmFsdWU6IHsNCiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwNCiAgICAgIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsNCiAgICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgICBpZiAobmV3VmFsICE9IG9sZFZhbCkgew0KICAgICAgICAgIGlmIChuZXdWYWwgIT0gbnVsbCAmJiBuZXdWYWwgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbmV3VmFsOw0KDQogICAgICAgICAgICAvL3jhu60gbMO9IGdpw6EgdHLhu4sgdOG6pXQgY+G6ow0KICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PT0gbWUuc2VsZWN0QWxsVmFsdWUgJiYgIW1lLmluaXRUZXh0KSB7DQogICAgICAgICAgICAgIG1lLmludGVybmFsVGV4dCA9IG1lLl9zZWxlY3RBbGxUZXh0Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICFtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSB8fA0KICAgICAgICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbVttZS52YWx1ZUZpZWxkXSAhPT0gbmV3VmFsDQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZSAhPSBtZS5kYXRhKSB7DQogICAgICAgICAgICAgICAgbWUuaW5pdERhdGEoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKCk7DQogICAgICAgICAgICAgIGlmIChtZS5yZXNldFR5cGVBaGVhZFBvaW50ZXIpIHsNCiAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gLTE7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPj0gMCkgew0KICAgICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbSgNCiAgICAgICAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSwNCiAgICAgICAgICAgICAgICAgIGZhbHNlDQogICAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoIW1lLmZvcmNlU2VsZWN0aW9uICYmIG1lLnZhbHVlRmllbGQgPT0gbWUuZGlzcGxheUZpZWxkKSB7DQogICAgICAgICAgICAgICAgICBtZS5zZXRJbnRlcm5hbFRleHQobWUuaW50ZXJuYWxWYWx1ZSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIG7hur91IGLhuq90IGJ14buZYyBwaOG6o2kgY2jhu41uIGdpw6EgdHLhu4sgdGjDrCBt4bubaSByZXNldA0KICAgICAgICAgICAgaWYgKG1lLmZvcmNlU2VsZWN0aW9uKSB7DQogICAgICAgICAgICAgIG1lLnJlc2V0KCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9LA0KICAgIH0sDQogIH0sDQogIC8vSMOgbSBraOG7n2kgdOG6oW8gZOG7ryBsaeG7h3UgaG9vayBmdW5jDQogIGNyZWF0ZWQoKSB7DQogICAgY29uc3QgbWUgPSB0aGlzOw0KICAgIC8vIG1lLmluaXRJbmRleCA9IDA7DQogICAgbWUuaW5pdENvbWJvKCk7DQogICAgLy8gbWUuc2V0SW5pdEluZGV4KCk7DQogICAgbWUuaW5pdERhdGEoKTsNCiAgICBpZiAobWUuYXV0b0xvYWQpIHsNCiAgICAgIG1lLmRvUXVlcnlJbnRlcm5hbChudWxsLCBmYWxzZSk7DQogICAgfQ0KICAgIEV2ZW50QnVzR2xvYmFsLiRvbihHbG9iYWxFdmVudE5hbWUuc2Nyb2xsRXZlbnQsIG1lLnNjcm9sbEV2ZW50KTsNCiAgICBpZiAobWUubWFwcGluZ0ZpZWxkKSB7DQogICAgICBmb3IgKGxldCBrZXkgaW4gbWUubWFwcGluZ0ZpZWxkKSB7DQogICAgICAgIG1lLiRvcHRpb25zLnByb3BzRGF0YVtrZXldID0gbnVsbDsNCiAgICAgIH0NCiAgICB9DQogICAgLy8gbWUuaW5pdERhdGEoKTsNCiAgICAvLyBtZS5zZXRJbml0VGV4dCgpOw0KICB9LA0KICBtb3VudGVkKCkgew0KICAgIGxldCBtZSA9IHRoaXM7DQogICAgLy9EZWJvdW5jZSBxdWVyeSDEkeG7gyBkZWxheSBsb2FkDQogICAgaWYgKG1lLnF1ZXJ5TW9kZSAhPSAicmVtb3RlIikgew0KICAgICAgbWUuaW50ZXJuYWxRdWVyeURlbGF5ID0gMjA7DQogICAgfQ0KICAgIG1lLmRvUXVlcnkgPSBfLmRlYm91bmNlKG1lLmRvUXVlcnlJbnRlcm5hbCwgbWUuaW50ZXJuYWxRdWVyeURlbGF5KTsNCiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrX291dCk7DQogICAgLy9pbml0IGFsbHRleHQNCiAgICBtZS5fc2VsZWN0QWxsVGV4dCA9DQogICAgICBtZS5zZWxlY3RBbGxUZXh0IHx8IGkxOG4udCgiaTE4bkNvbXBvbmVudC5Db21ib2JveC5TZWxlY3RBbGxJdGVtVGV4dCIpOw0KICB9LA0KICBiZWZvcmVEZXN0cm95KCkgew0KICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICBtZS5jb2xsYXBzZSgpOw0KICAgIGlmIChtZS4kcmVmcy5kcm9wZG93blBhbmVsKSB7DQogICAgICBtZS4kcmVmcy5kcm9wZG93blBhbmVsLiRlbC5yZW1vdmUoKTsNCiAgICB9DQogICAgRXZlbnRCdXNHbG9iYWwuJG9mZihHbG9iYWxFdmVudE5hbWUuc2Nyb2xsRXZlbnQsIG1lLnNjcm9sbEV2ZW50KTsNCiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrX291dCk7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICBnZXRUb29sdGlwQ2xhc3MoKSB7DQogICAgICBsZXQgbWUgPSB0aGlzOw0KICAgICAgaWYgKG1lLiRlbCkgew0KICAgICAgICBtZS50b29sdGlwTGVmdCA9IC1tZS4kZWwub2Zmc2V0V2lkdGggLyAyOw0KICAgICAgfQ0KICAgICAgaWYgKG1lLmN1c3RvbVRvb2x0aXApIHsNCiAgICAgICAgcmV0dXJuICJ0b29sdGlwLSIgKyBtZS5jdXN0b21Ub29sdGlwLnR5cGUudG9Mb3dlckNhc2UoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAiIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIGtp4buDbSB0cmEgeGVtIGThu68gbGnhu4d1IHRyw6puIGNvbWJvYm94IGPDsyB0cuG7kW5nIGhheSBraMO0bmcNCiAgICAgKiBAYXV0aG9yIHRtY2hpIDE2LjA0LjIwMjENCiAgICAgKi8NCiAgICBpc051bGxPckVtcHR5dmFsdWUoKSB7DQogICAgICBpZiAodGhpcy52YWx1ZSA9PSBudWxsIHx8IHRoaXMudmFsdWUgPT0ge30pIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBC4bqvdCBz4buxIGtp4buHbiBraGkgc2Nyb2xsIHRyw6puIGNoxrDGoW5nIHRyw6xuaCB0aMOsIMSRw7NuZyBjb21ib2JveCBs4bqhaQ0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQNCiAgICAgKi8NCiAgICBzY3JvbGxFdmVudChlKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBpZiAobWUuZXhwYW5kZWQpIHsNCiAgICAgICAgbWUuY29sbGFwc2UoKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIE3hurdjIMSR4buLbmggY2jhu41uIGdpw6EgdHLhu4sgdGhlbyBpbmRleCBiYW4gxJHhuqd1DQogICAgICogQ3JlYXRlZCBieSBMVERBVA0KICAgICAqLw0KICAgIHNldEluaXRJbmRleCgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmICgNCiAgICAgICAgbWUuaW5pdEluZGV4ID49IDAgJiYNCiAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlICYmDQogICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGggPiAwICYmDQogICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPCAwDQogICAgICApIHsNCiAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IG1lLmluaXRJbmRleDsNCiAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSwgZmFsc2UpOw0KICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogU2V0IGdpw6EgdHLhu4sgaGnhu4duIHRo4buLIGJhbiDEkeG6p3UgY2hvIGNvbWJvYm94IGtoaSBjb21ibyBjaMawYSBjw7MgZOG7ryBsaeG7h3UNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDI1LjA2LjIwMjApDQogICAgICovDQogICAgc2V0SW5pdFRleHQodmFsKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBtZS5pbnRlcm5hbFRleHQgPSAodHlwZW9mIHZhbCA9PSAic3RyaW5nIiA/IHZhbCA6IG1lLmluaXRUZXh0KSB8fCAiIjsNCg0KICAgICAgLy9URE5HSElBIHThuqFvIHRow6ptIGjDoG0ga2nhu4NtIHRyYSBu4bq/dSB0ZXh0IGto4bubcCB24bubaSBkYXRhIHNvdXJjZSB0aMOsIGfDoW4gZ2nDoSB0cuG7iyBjb21ibyBi4bqxbmcgbHXDtG4NCiAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID4gMCkgew0KICAgICAgICB2YXIgc2VsZWN0ZWQgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UuZmluZChmdW5jdGlvbiAoaXRlbSkgew0KICAgICAgICAgIGlmIChtZS5pZ25vcmVDYXNlKSB7DQogICAgICAgICAgICByZXR1cm4gKA0KICAgICAgICAgICAgICBpdGVtW21lLmRpc3BsYXlGaWVsZF0udG9Mb3dlckNhc2UoKS50cmltKCkgPT0NCiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxUZXh0LnRvTG93ZXJDYXNlKCkudHJpbSgpDQogICAgICAgICAgICApOw0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gaXRlbVttZS5kaXNwbGF5RmllbGRdID09IG1lLmludGVybmFsVGV4dDsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKG1lLmFsbG93RnJlZVRleHQpIHsNCiAgICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSA9IG51bGw7DQogICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoc2VsZWN0ZWQgIT0gbnVsbCkgew0KICAgICAgICAgIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtID0gc2VsZWN0ZWQ7DQogICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IHNlbGVjdGVkW21lLnZhbHVlRmllbGRdOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBUaOG7sWMgaGnhu4duIHF1ZXJ5IGThu68gbGnhu4d1LCBjw7MgdGjhu4MgdOG7qyBsb2NhbCBob+G6t2MgcmVtb3RlIHTDuXkgdGhlbyBj4bqldSBow6xuaA0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAxMS8xMi8yMDE5DQogICAgICovDQogICAgZG9RdWVyeUludGVybmFsKHNlYXJjaFN0cmluZywgZXhwYW5kKSB7DQogICAgICBsZXQgbWUgPSB0aGlzLA0KICAgICAgICBldmVudCA9IHsgcHJldmVudERlZmF1bHQ6IGZhbHNlLCBzZW5kZXI6IG1lIH0sDQogICAgICAgIHF1ZXJ5U3RyaW5nID0gc2VhcmNoU3RyaW5nOw0KICAgICAgbWUuJGVtaXQoImJlZm9yZVF1ZXJ5IiwgZXZlbnQpOw0KICAgICAgaWYgKGV2ZW50LnByZXZlbnREZWZhdWx0KSB7DQogICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGlmIChtZS5sYXN0UXVlcnlTdHJpbmcgPT09IHF1ZXJ5U3RyaW5nICYmICFtZS5pc1JlbG9hZCkgew0KICAgICAgICBpZiAoZXhwYW5kKSB7DQogICAgICAgICAgbWUuZXhwYW5kKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG1lLmRyb3Bkb3duU2Nyb2xsVG9wID0gMDsNCiAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlID0gW107DQogICAgICAgIG1lLmxhc3RRdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nOw0KICAgICAgICBtZS5xdWVyeWluZyA9IHRydWU7DQogICAgICAgIC8vIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSAtMTsNCg0KICAgICAgICBpZiAobWUucXVlcnlNb2RlID09PSAicmVtb3RlIiAmJiAhbWUuX2FsbERhdGEpIHsNCiAgICAgICAgICBpZiAobWUuaXNUcmVlKSB7DQogICAgICAgICAgICBxdWVyeVN0cmluZyA9IG51bGw7DQogICAgICAgICAgfQ0KICAgICAgICAgIG1lLmRvUmVtb3RlUXVlcnkocXVlcnlTdHJpbmcpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgICBtZS5kb0xvY2FsUXVlcnkocXVlcnlTdHJpbmcpOw0KICAgICAgICAgICAgaWYgKGV4cGFuZCAmJiAhbWUuZXhwYW5kZWQpIHsNCiAgICAgICAgICAgICAgbWUuZXhwYW5kKCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIC8vIG1lLiRwcm9wcy5pc1JlbG9hZCA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBzYXUga2hpIHF1ZXJ5IHhvbmcgZOG7ryBsaeG7h3UNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMjQuMDYuMjAyMA0KICAgICAqLw0KICAgIGFmdGVyUXVlcnkoZXhwYW5kKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBpZiAoZXhwYW5kKSB7DQogICAgICAgIG1lLmV4cGFuZCgpOw0KICAgICAgfQ0KICAgIH0sDQogICAgLyoqDQogICAgICogUXVlcnkgZOG7ryBsaeG7h3UgYXBpDQogICAgICogQ3JlYXRlZEJ5IExUREFUIDI0LjA2LjIwMjANCiAgICAgKi8NCiAgICBkb1JlbW90ZVF1ZXJ5KHF1ZXJ5U3RyaW5nLCBleHBhbmQpIHsNCiAgICAgIC8vQnVpbGQgZmlsdGVyLA0KICAgICAgbGV0IG1lID0gdGhpcywNCiAgICAgICAgZmlsdGVycyA9IFtdLA0KICAgICAgICBmaWx0ZXJGaWVsZHMgPSBtZS5maWx0ZXJGaWVsZHM7DQogICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICBpZiAocXVlcnlTdHJpbmcpIHsNCiAgICAgICAgICBsZXQgZmlsdGVyID0gbnVsbDsNCiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBmaWx0ZXJGaWVsZHMpIHsNCiAgICAgICAgICAgIGlmIChmaWx0ZXJGaWVsZHMuaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgICBjb25zdCBmID0gZmlsdGVyRmllbGRzW2tleV07DQoNCiAgICAgICAgICAgICAgaWYgKGZpbHRlcikgew0KICAgICAgICAgICAgICAgIGZpbHRlci5jaGlsZHJlbnMucHVzaCh7DQogICAgICAgICAgICAgICAgICBwcm9wZXJ0eToga2V5LA0KICAgICAgICAgICAgICAgICAgdmFsdWU6IHF1ZXJ5U3RyaW5nLA0KICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IGYsDQogICAgICAgICAgICAgICAgICBvcGVyYW5kOiAib3IiLA0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGZpbHRlciA9IHsNCiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBrZXksDQogICAgICAgICAgICAgICAgICB2YWx1ZTogcXVlcnlTdHJpbmcsDQogICAgICAgICAgICAgICAgICBvcGVyYXRvcjogZiwNCiAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiLA0KICAgICAgICAgICAgICAgICAgY2hpbGRyZW5zOiBbXSwNCiAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgaWYgKGZpbHRlcikgew0KICAgICAgICAgICAgZmlsdGVycy5wdXNoKGZpbHRlcik7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGxldCBwYXlsb2FkID0ge307DQogICAgICAgIHBheWxvYWQuc2tpcCA9IDA7DQogICAgICAgIHBheWxvYWQudGFrZSA9IG1lLnBhZ2VTaXplOw0KICAgICAgICBwYXlsb2FkLnBhZ2VBcHBlbmQgPSBmYWxzZTsNCiAgICAgICAgaWYgKGZpbHRlcnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIHBheWxvYWQuZmlsdGVyID0gZmlsdGVyczsNCiAgICAgICAgfQ0KDQogICAgICAgIGxldCBjb2x1bW5zID0gW21lLmRpc3BsYXlGaWVsZCwgbWUudmFsdWVGaWVsZF07DQogICAgICAgIGlmIChtZS5jb2x1bW5zICYmIG1lLmNvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgIG1lLmNvbHVtbnMuZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YUZpZWxkICYmIGNvbHVtbnMuaW5kZXhPZihpdGVtLmRhdGFGaWVsZCkpIHsNCiAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKGl0ZW0uZGF0YUZpZWxkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobWUucmVxdWVzdEZpZWxkKSB7DQogICAgICAgICAgbWUucmVxdWVzdEZpZWxkLnNwbGl0KCIsIikuZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICAgICAgaWYgKGl0ZW0gJiYgY29sdW1ucy5pbmRleE9mKGl0ZW0pKSB7DQogICAgICAgICAgICAgIGNvbHVtbnMucHVzaChpdGVtKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgICBwYXlsb2FkLmNvbHVtbnMgPSBjb2x1bW5zLmpvaW4oIiwiKTsNCg0KICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtID0gcGF5bG9hZDsNCiAgICAgICAgaWYgKHR5cGVvZiBtZS5idWlsZEZpbHRlciA9PSAiZnVuY3Rpb24iKSB7DQogICAgICAgICAgbWUuYnVpbGRGaWx0ZXIocGF5bG9hZCk7DQogICAgICAgIH0NCiAgICAgICAgbWUubG9hZGluZyA9IHRydWU7DQogICAgICAgIG1lLiRlbWl0KCJsb2FkRGF0YSIsIHBheWxvYWQpOw0KICAgICAgICAvL1RWTG9pIDI4LjA4LjIwMjEgQ2hvIHThuq90IGx1w7RuIGPhu50g4bufIMSRw6J5IG7hu69hLCBQaMOybmcgdHLGsOG7nW5nIGjhu6NwIHjhu5UgY29tYm8gbmjGsG5nIGtvIGfhu41pIEFQSSB0aMOsIGtvIHThuq90IMSRxrDhu6NjIGPhu50gbG9hZGluZy4NCiAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOw0KICAgICAgfSk7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBRdWVyeSBk4buvIGxp4buHdSBsb2NhbA0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAyNC4wNi4yMDIwDQogICAgICovDQogICAgZG9Mb2NhbFF1ZXJ5KHF1ZXJ5U3RyaW5nKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsZXQgZmlsdGVyRGF0YSA9IG1lLmZpbHRlckRhdGEocXVlcnlTdHJpbmcpOw0KICAgICAgaWYgKHF1ZXJ5U3RyaW5nICYmIG1lLmNvbWJvVHlwZSA9PT0gMykgew0KICAgICAgICBsZXQgZmlyc3RJdGVtID0gZmlsdGVyRGF0YVswXTsNCg0KICAgICAgICAvL3Row6ptIGNoYSB2w6BvIMSR4buDIGJ1aWxkIGPDonkNCiAgICAgICAgbGV0IHJvb3RzID0gW107DQogICAgICAgIGxldCBpID0gMDsNCiAgICAgICAgd2hpbGUgKGkgPCBmaWx0ZXJEYXRhLmxlbmd0aCkgew0KICAgICAgICAgIGxldCBpdGVtID0gZmlsdGVyRGF0YVtpXSwNCiAgICAgICAgICAgIHBhcmVudCA9IGl0ZW0ucGFyZW50Tm9kZTsNCg0KICAgICAgICAgIGlmICghcGFyZW50IHx8IEFycmF5LmlzQXJyYXkocGFyZW50KSkgew0KICAgICAgICAgICAgcm9vdHMucHVzaChpdGVtKTsNCiAgICAgICAgICB9IGVsc2UgaWYgKGZpbHRlckRhdGEuaW5kZXhPZihwYXJlbnQpID09PSAtMSkgew0KICAgICAgICAgICAgZmlsdGVyRGF0YS5wdXNoKHBhcmVudCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGkrKzsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vc+G6r3AgeOG6v3Agcm9vdCB0aGVvIMSRw7puZyB0aOG7qSB04buxDQogICAgICAgIGlmIChyb290cy5sZW5ndGggPiAxKSB7DQogICAgICAgICAgbGV0IHJzID0gW107DQogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtZS5fYWxsRGF0YS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgbGV0IGl0ZW0gPSBtZS5fYWxsRGF0YVtpXTsNCiAgICAgICAgICAgIGlmIChyb290cy5pbmRleE9mKGl0ZW0pID4gLTEpIHsNCiAgICAgICAgICAgICAgcnMucHVzaChpdGVtKTsNCg0KICAgICAgICAgICAgICBpZiAocnMubGVuZ3RoID09PSByb290cy5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICByb290cyA9IHJzOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLy9idWlsZCBjw6J5DQogICAgICAgIGxldCBycyA9IFtdOw0KICAgICAgICBsZXQgZm5QdXNoID0gZnVuY3Rpb24gKGl0ZW0pIHsNCiAgICAgICAgICBycy5wdXNoKGl0ZW0pOw0KICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0uY2hpbGROb2RlcykpIHsNCiAgICAgICAgICAgIGl0ZW0uY2hpbGROb2Rlcy5mb3JFYWNoKChjaGlsZCkgPT4gew0KICAgICAgICAgICAgICBpZiAoZmlsdGVyRGF0YS5pbmRleE9mKGNoaWxkKSA+IC0xKSB7DQogICAgICAgICAgICAgICAgZm5QdXNoKGNoaWxkKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICByb290cy5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgZm5QdXNoKGl0ZW0pOw0KICAgICAgICB9KTsNCg0KICAgICAgICAvL3Phuq9wIHjhur9wIHRoZW8gbWlzYUNvZGUNCiAgICAgICAgZmlsdGVyRGF0YSA9IHJzOw0KICAgICAgfQ0KDQogICAgICBtZS5fZmlsdGVyRGF0YSA9IGZpbHRlckRhdGE7DQogICAgICBsZXQgY291bnQgPSBNYXRoLm1pbihtZS5fZmlsdGVyRGF0YS5sZW5ndGgsIG1lLnBhZ2VTaXplKTsNCiAgICAgIGxldCBkcyA9IFtdOw0KICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7DQogICAgICAgIGRzLnB1c2gobWUuX2ZpbHRlckRhdGFbaV0pOw0KICAgICAgfQ0KICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlID0gZHM7DQogICAgfSwNCiAgICBmaWx0ZXJEYXRhKHF1ZXJ5U3RyaW5nKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsZXQgbWF0Y2hJdGVtID0gW107DQoNCiAgICAgIGlmIChxdWVyeVN0cmluZykgew0KICAgICAgICBtZS5fYWxsRGF0YS5mb3JFYWNoKChpdGVtKSA9PiB7DQogICAgICAgICAgbGV0IHZhbGlkID0gZmFsc2U7DQogICAgICAgICAgZm9yIChsZXQgZiBpbiBtZS5maWx0ZXJGaWVsZHMpIHsNCiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGl0ZW1bZl07DQogICAgICAgICAgICBsZXQgdGVzdCA9IG1lLnRlc3RGaWx0ZXIobWUuZmlsdGVyRmllbGRzW2ZdLCB2YWx1ZSwgcXVlcnlTdHJpbmcpOw0KICAgICAgICAgICAgaWYgKHRlc3QpIHsNCiAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCiAgICAgICAgICBpZiAodmFsaWQpIHsNCiAgICAgICAgICAgIG1hdGNoSXRlbS5wdXNoKGl0ZW0pOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtYXRjaEl0ZW0gPSBtZS5fYWxsRGF0YTsNCiAgICAgIH0NCg0KICAgICAgcmV0dXJuIG1hdGNoSXRlbTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogTOG6pXkgY2h14buXaSBj4bqnbiBxdWVyeSwgdHLGsOG7nW5nIGjhu6NwIG51bWJlciB0aMOsIGzhuqV5IHZhbHVlIGLhu48gcXVhIGvDvSB04buxIHBow6JuIGPDoWNoDQogICAgICogQ3JlYXRlZEJ5IExUREFUIDExLzEyLzIwMTkNCiAgICAgKi8NCiAgICBnZXRRdWVyeVN0cmluZygpIHsNCiAgICAgIHJldHVybiAodGhpcy5pbnRlcm5hbFRleHQgfHwgIiIpLnRyaW0oKTsNCiAgICB9LA0KICAgIC8vQ2xpY2sgcmEgbmdvw6BpIGNvbWJvIMSRw7NuZyBjb21ibyBs4bqhaQ0KICAgIC8vQ3JlYXRlZCBieSBMVERBVCAxOC4wNi4yMDIwDQogICAgY2xpY2tfb3V0KGUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmICgNCiAgICAgICAgIWNvbW1vbkZuLmhhc1BhcmVudChlLnRhcmdldCwgbWUuJGVsKSAmJg0KICAgICAgICBtZS4kcmVmcy5kcm9wZG93blBhbmVsICYmDQogICAgICAgIG1lLiRyZWZzLmRyb3Bkb3duUGFuZWwuJGVsICYmDQogICAgICAgICFjb21tb25Gbi5oYXNQYXJlbnQoZS50YXJnZXQsIG1lLiRyZWZzLmRyb3Bkb3duUGFuZWwuJGVsKQ0KICAgICAgKSB7DQogICAgICAgIG1lLmNvbGxhcHNlKCk7DQogICAgICB9DQogICAgfSwNCiAgICAvL1Jlc2V0IGzhuqFpIGPDoWMgZ2nDoSB0cuG7iyB0cm9uZyBjb21ib2JveA0KICAgIHJlc2V0KCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUuaW50ZXJuYWxUZXh0ID0gIiI7DQogICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSA9IG51bGw7DQogICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gLTE7DQogICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsNCiAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogU2V0IGdpw6EgdHLhu4sgaGnhu4NuIHRo4buLDQogICAgICogQHByYW0gdmFsdWUgZ2nDoSB0cuG7iyBoaeG7g24gdGjhu4sNCiAgICAgKi8NCiAgICBzZXRJbnRlcm5hbFRleHQodmFsdWUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLmludGVybmFsVGV4dCA9IHZhbHVlOw0KICAgIH0sDQogICAgLyoqDQogICAgICogU2V0IHZhbHVlIGNobyBjb21ibw0KICAgICAqLw0KICAgIHNldFZhbHVlKHZhbHVlLCB1c2VyQWN0aW9uID0gZmFsc2UpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLmludGVybmFsVmFsdWUgPSB2YWx1ZTsNCiAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgICAgbWUuZG9IaWdodGxpZ2h0SXRlbSgpOw0KICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPj0gMCkgew0KICAgICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0oDQogICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlW21lLnR5cGVBaGVhZFBvaW50ZXJdLA0KICAgICAgICAgIHVzZXJBY3Rpb24NCiAgICAgICAgKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIC8vU+G7sSBraeG7h24gbmjhuq1wIGxp4buHdSB0csOqbiBpbnB1dA0KICAgIC8vQ3JlYXRlZCBieSBMVERBVCAoMTYuMDYuMjAyMCkNCiAgICBvbklucHV0KGUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLl90eXBpbmcgPSB0cnVlOw0KICAgICAgaWYgKCFtZS5leHBhbmRlZCkgew0KICAgICAgICBtZS5leHBhbmQoKTsNCiAgICAgICAgLy8gbWUuZG9RdWVyeUludGVybmFsKG1lLmdldFF1ZXJ5U3RyaW5nKCksIHRydWUpOw0KICAgICAgfQ0KICAgICAgaWYgKCFtZS5pbnRlcm5hbFRleHQpIHsNCiAgICAgICAgLy8gaWYgKG1lLmludGVybmFsVmFsdWUpIHsNCiAgICAgICAgLy8gICBsZXQgbWV0YURhdGEgPSB7DQogICAgICAgIC8vICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwNCiAgICAgICAgLy8gICAgIG5ld0RhdGE6IG51bGwsDQogICAgICAgIC8vICAgfTsNCiAgICAgICAgLy8gICBtZS4kZW1pdCgic2VsZWN0ZWQiLCBtZXRhRGF0YSk7DQogICAgICAgIC8vIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogcmVzZXQgbOG6oWkgY29tYm8ga2hpIGludGVybmFsVGV4dCBy4buXbmcNCiAgICAgICAgICogTk1UVUFOMyAxNi8xMS8yMDIxDQogICAgICAgICAqLw0KICAgICAgICBtZS5yZXNldCgpOw0KDQogICAgICAgIGlmICghbWUuZm9yY2VTZWxlY3Rpb24pIHsNCiAgICAgICAgICBtZS5yZXNldCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBtZS5kb1F1ZXJ5KG1lLmludGVybmFsVGV4dCwgdHJ1ZSk7DQogICAgICBtZS5fdHlwaW5nID0gZmFsc2U7DQogICAgICBpZiAoIW1lLmZvcmNlU2VsZWN0aW9uICYmIG1lLnZhbHVlRmllbGQgPT0gbWUuZGlzcGxheUZpZWxkKSB7DQogICAgICAgIG1lLmludGVybmFsVmFsdWUgPSBtZS5pbnRlcm5hbFRleHQ7DQogICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgICAgfSBlbHNlIGlmICgNCiAgICAgICAgbWUuZm9yY2VTZWxlY3Rpb24gJiYNCiAgICAgICAgbWUuYWxsb3dEZXNlbGVjdEl0ZW0gJiYNCiAgICAgICAgbWUuaW50ZXJuYWxUZXh0ID09ICIiDQogICAgICApIHsNCiAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG1lLmludGVybmFsVGV4dDsNCg0KICAgICAgICBsZXQgZGF0YUVtcHR5ID0ge307DQogICAgICAgIGRhdGFFbXB0eVttZS52YWx1ZUZpZWxkXSA9IG51bGw7DQogICAgICAgIGRhdGFFbXB0eVttZS5kaXNwbGF5RmllbGRdID0gbWUuaW50ZXJuYWxUZXh0Ow0KICAgICAgICBsZXQgbWV0YURhdGEgPSB7DQogICAgICAgICAgb2xkRGF0YTogbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0sDQogICAgICAgICAgbmV3RGF0YTogZGF0YUVtcHR5LA0KICAgICAgICB9Ow0KDQogICAgICAgIG1lLiRlbWl0KCJzZWxlY3RlZCIsIG1ldGFEYXRhKTsNCiAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7DQogICAgICB9IGVsc2UgaWYgKG1lLmFsbG93RnJlZVRleHQpIHsNCiAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7DQogICAgICAgIG1lLnNldEluaXRUZXh0KG1lLmludGVybmFsVGV4dCk7DQoNCiAgICAgICAgbGV0IGRhdGFFbXB0eSA9IHt9Ow0KICAgICAgICBkYXRhRW1wdHlbbWUudmFsdWVGaWVsZF0gPSBtZS5pbnRlcm5hbFZhbHVlOw0KICAgICAgICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsNCiAgICAgICAgbGV0IG1ldGFEYXRhID0gew0KICAgICAgICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLA0KICAgICAgICAgIG5ld0RhdGE6IGRhdGFFbXB0eSwNCiAgICAgICAgfTsNCg0KICAgICAgICBtZS4kZW1pdCgic2VsZWN0ZWQiLCBtZXRhRGF0YSk7DQogICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgICAgfQ0KDQogICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKHRydWUpOw0KICAgICAgbWUuYWRqdXN0U2Nyb2xsKCk7DQogICAgfSwNCiAgICAvL1Phu7Ega2nhu4duIGNsaWNrIHbDoG8gaW5wdXQNCiAgICAvL0NyZWF0ZWQgYnkgTk5MQU0gKDE5LzA0LzIwMjEpDQogICAgb25DbGljayhlKSB7DQogICAgICB0aGlzLiRlbWl0KCJjbGljayIsIGUpOw0KICAgIH0sDQogICAgLy9T4buxIGtp4buHbiBmb2N1cyB2w6BvIGlucHV0DQogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQ0KICAgIG9uRm9jdXMoZSkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUuZm9jdXNlZCA9IHRydWU7DQogICAgICBtZS4kZW1pdCgiZm9jdXMiLCBlKTsNCiAgICB9LA0KICAgIC8vU+G7sSBraeG7h24gY2hhbmdlIGlucHV0DQogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQ0KICAgIG9uQ2hhbmdlKGUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmIChtZS5mb2N1c2VkKSB7DQogICAgICAgIGlmIChtZS5mb3JjZVNlbGVjdGlvbikgew0KICAgICAgICAgIGlmIChtZS50eXBlQWhlYWRQb2ludGVyIDwgMCkgew0KICAgICAgICAgICAgLy9tZS5yZXNldCgpOw0KICAgICAgICAgICAgLy8gbGV0IGRhdGFFbXB0eSA9IHt9Ow0KICAgICAgICAgICAgLy8gICBkYXRhRW1wdHlbbWUudmFsdWVGaWVsZF0gPSBudWxsOw0KICAgICAgICAgICAgLy8gICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsNCiAgICAgICAgICAgIC8vICAgbGV0IG1ldGFEYXRhID0gew0KICAgICAgICAgICAgLy8gICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLA0KICAgICAgICAgICAgLy8gICAgIG5ld0RhdGE6IGRhdGFFbXB0eSwNCiAgICAgICAgICAgIC8vICAgICB1c2VyQWN0aW9uOiBmYWxzZQ0KICAgICAgICAgICAgLy8gICB9Ow0KICAgICAgICAgICAgLy9UT0RPIGJuZHVjIDkuNy4yMDIxOiBC4buPIHJhaXNlIHNlbGVjdGQgZXZlbnQgxJFpIHbDrCBjw6FjIGZvcm0gxJFhbmcgaGFuZGxlIMSR4buDIGfDoW4gbOG6oWkgaW5pdFRleHQgLT4gbOG7l2kgdmFsaWRhdGUgZm9yY2VTZWxlY3Rpb24NCiAgICAgICAgICAgIC8vIG1lLiRlbWl0KCJzZWxlY3RlZCIsIG1ldGFEYXRhKTsNCiAgICAgICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgICAgICAgIH0gZWxzZSBpZiAobWUuYWxsb3dEZXNlbGVjdEl0ZW0gJiYgbWUuaW50ZXJuYWxUZXh0ID09ICIiKSB7DQogICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gLTE7DQogICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsNCiAgICAgICAgICAgIGxldCBkYXRhRW1wdHkgPSB7fTsNCiAgICAgICAgICAgIGRhdGFFbXB0eVttZS52YWx1ZUZpZWxkXSA9IG51bGw7DQogICAgICAgICAgICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsNCiAgICAgICAgICAgIGxldCBtZXRhRGF0YSA9IHsNCiAgICAgICAgICAgICAgb2xkRGF0YTogbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0sDQogICAgICAgICAgICAgIG5ld0RhdGE6IGRhdGFFbXB0eSwNCiAgICAgICAgICAgICAgdXNlckFjdGlvbjogZmFsc2UsDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOw0KICAgICAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSBtZS5maWx0ZXJJbmRleEl0ZW1CeVRleHQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKG1lLnZhbHVlRmllbGQgPT0gbWUuZGlzcGxheUZpZWxkKSB7DQogICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbWUuaW50ZXJuYWxUZXh0Ow0KICAgICAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSBtZS5maWx0ZXJJbmRleEl0ZW1CeVRleHQoKTsNCiAgICAgICAgICAgIGlmIChtZS50eXBlQWhlYWRQb2ludGVyIDwgMCkgew0KICAgICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsNCiAgICAgICAgICAgICAgbGV0IGRhdGFFbXB0eSA9IHt9Ow0KICAgICAgICAgICAgICBkYXRhRW1wdHlbbWUudmFsdWVGaWVsZF0gPSBudWxsOw0KICAgICAgICAgICAgICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsNCiAgICAgICAgICAgICAgbGV0IG1ldGFEYXRhID0gew0KICAgICAgICAgICAgICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLA0KICAgICAgICAgICAgICAgIG5ld0RhdGE6IGRhdGFFbXB0eSwNCiAgICAgICAgICAgICAgICB1c2VyQWN0aW9uOiBmYWxzZSwNCiAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOw0KICAgICAgICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vVE9ETyBibmR1YyA1LjUuMjAyMSBjaOG7lyBuw6B5IGfhu41pIGNoYW5nZSBsw6BtIGfDrCBuaOG7iQ0KICAgICAgLy8gbWUuJGVtaXQoImNoYW5nZSIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgIH0sDQogICAgLy9T4buxIGtp4buHbiBibHVyIGlucHV0DQogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQ0KICAgIC8vIHB2ZHV5IDA3LzA1LzIwMjE6IHPhu61hIGzhuqFpIGNvbWJvYm94ICjEkcOjIHRyYW8gxJHhu5VpIHbhu5tpIFNBIGFuaCBCTkR1YykNCiAgICBvbkJsdXIoZSkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUuZm9jdXNlZCA9IGZhbHNlOw0KDQogICAgICAvL27hur91IGtow7RuZyBjw7MgdmFsdWUgbcOgIHNvdXJjZSBjaOG7iSBjw7MgMSBi4bqjbiBnaGkgKyB0ZXh0IGhp4buDbiB0aOG7iyDEkWFuZyBtYXAgLT4gc2VsZWN0IGl0ZW0gbsOgeQ0KICAgICAgaWYgKA0KICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAxICYmDQogICAgICAgIG1lLmludGVybmFsVGV4dCAmJg0KICAgICAgICAhbWUuaW50ZXJuYWxWYWx1ZQ0KICAgICAgKSB7DQogICAgICAgIGxldCBmaXJzdEl0ZW0gPSBtZS5pbnRlcm5hbERhdGFTb3VyY2VbMF07DQogICAgICAgIG1lLnNldEludGVybmFsSXRlbShmaXJzdEl0ZW0pOw0KICAgICAgfQ0KDQogICAgICAvL21lLnZhbGlkYXRlKG1lKTsNCiAgICAgIGlmIChtZS5pbnRlcm5hbFRleHQgIT0gIiIpIHsNCiAgICAgICAgaWYgKG1lLnZhbGlkYXRlT25CbHVyKSB7DQogICAgICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICAgIG1lLnZhbGlkYXRlQmx1cigpOw0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vVEROR0hJQSAxNi85LzIwMjEgbuG6v3UgZm9yY2Ugc2VsZWN0aW9uIHRow6wgb3V0IGZvY3VzIHJhIG3DoCB4w7NhIGjhur90IHRleHQgdGjDrCBzZXQgbOG6oWkgZ2nDoSB0cuG7iyBjxakgY2hvIGNvbWJvDQogICAgICAvLyBOTVRVQU4yIDEzLjA0LjIwMjI6IG7hur91IGtow7RuZyBjaG8gYuG7jyBjaOG7jW4gdGjDrCBt4bubaSBzZXQgbOG6oWkgZ2nDoSB0cuG7iyBjxakNCiAgICAgIGlmICgNCiAgICAgICAgbWUuZm9yY2VTZWxlY3Rpb24gJiYNCiAgICAgICAgIW1lLmFsbG93RGVzZWxlY3RJdGVtICYmDQogICAgICAgIG1lLmludGVybmFsVGV4dCA9PSAiIiAmJg0KICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbQ0KICAgICAgKSB7DQogICAgICAgIG1lLmludGVybmFsVGV4dCA9IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtW21lLmRpc3BsYXlGaWVsZF07DQogICAgICB9DQoNCiAgICAgIC8vVEROR0hJQSAxNC8xMS8yMDIxOiBoaeG7h24gdOG6oWkgbuG6v3UgeMOzYSBo4bq/dCB0ZXh0IMSRaSBjb21ibyB04buxIGNo4buNbiBs4bqhaSBnacOhIHRy4buLID0+IGNhc2UgbuG6v3UgeMOzYSBo4bq/dCB0aMOsIHJlc2V0IGx1w7RuDQogICAgICBpZiAobWUuaW50ZXJuYWxUZXh0ID09ICIiICYmICFtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSkgew0KICAgICAgICBtZS5yZXNldCgpOw0KICAgICAgfQ0KDQogICAgICBtZS4kZW1pdCgiYmx1ciIsIGUpOw0KICAgIH0sDQogICAgLy9T4buxIGtp4buHbiBrZXlkb3duIGlucHV0DQogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQ0KICAgIG9uS2V5ZG93bihlKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQoNCiAgICAgIHN3aXRjaCAoZS53aGljaCkgew0KICAgICAgICBjYXNlIDQwOg0KICAgICAgICAgIHsNCiAgICAgICAgICAgIGlmICghbWUuZXhwYW5kZWQpIHsNCiAgICAgICAgICAgICAgbWUuZG9RdWVyeUludGVybmFsKG51bGwsIHRydWUpOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChtZS50eXBlQWhlYWRQb2ludGVyIDwgbWUuZ2V0VG90YWxEYXRhKCkgLSAxKSB7DQogICAgICAgICAgICAgIGlmIChtZS5ub3RTZWxlY3Rpb25QYXJlbnQpIHsNCiAgICAgICAgICAgICAgICBsZXQgdHlwZUFoZWFkUG9pbnRlck5leHQgPSBtZS50eXBlQWhlYWRQb2ludGVyICsgMTsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gdHlwZUFoZWFkUG9pbnRlck5leHQ7IGkgPCBtZS5nZXRUb3RhbERhdGEoKTsgaSsrKSB7DQogICAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyKys7DQogICAgICAgICAgICAgICAgICBtZS5hZGp1c3RTY3JvbGwodHlwZUFoZWFkUG9pbnRlck5leHQpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFtZS5pbnRlcm5hbERhdGFTb3VyY2VbaV0uaXNQYXJlbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIrKzsNCiAgICAgICAgICAgICAgICBtZS5hZGp1c3RTY3JvbGwoKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAzODoNCiAgICAgICAgICB7DQogICAgICAgICAgICBpZiAobWUuZXhwYW5kZWQpIHsNCiAgICAgICAgICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPiAwKSB7DQogICAgICAgICAgICAgICAgaWYgKG1lLm5vdFNlbGVjdGlvblBhcmVudCkgew0KICAgICAgICAgICAgICAgICAgbGV0IHR5cGVBaGVhZFBvaW50ZXJQcmUgPSBtZS50eXBlQWhlYWRQb2ludGVyIC0gMTsNCiAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSB0eXBlQWhlYWRQb2ludGVyUHJlOyBpID4gMDsgaS0tKSB7DQogICAgICAgICAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXItLTsNCiAgICAgICAgICAgICAgICAgICAgbWUuYWRqdXN0U2Nyb2xsKG1lLnR5cGVBaGVhZFBvaW50ZXIpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoIW1lLmludGVybmFsRGF0YVNvdXJjZVtpXS5pc1BhcmVudCkgew0KICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXItLTsNCiAgICAgICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAxMzoNCiAgICAgICAgICB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA+PSAwKSB7DQogICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShtZS5pbnRlcm5hbERhdGFTb3VyY2VbbWUudHlwZUFoZWFkUG9pbnRlcl0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbWUuY29sbGFwc2UoKTsNCiAgICAgICAgICB9DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgOToNCiAgICAgICAgICB7DQogICAgICAgICAgICBpZiAobWUuZXhwYW5kZWQpIHsNCiAgICAgICAgICAgICAgLy8gTk1UVUFOMyAxNi8xMS8yMDIxIFRow6ptIMSRaeG7gXUga2nhu4duIGtp4buDbSB0cmEgaW50ZXJuYWxUZXh0IGPDsyBy4buXbmcgaGF5IGtow7RuZw0KICAgICAgICAgICAgICAvL1RETkdISUEgY29tbWVudCBs4bqhaTogxJFv4bqhbiBuw6B5IGzDoCDEkeG7gyBu4bq/dSDhuqVuIHRhYiBtw6AgdHLDqm4gY29tYm8gY8OzIG1hcCDEkcaw4bujYyBnacOhIHRy4buLIG7DoG8gcuG7k2kgdGjDrCBz4bq9IHThu7EgY2jhu41uIGdpw6EgdHLhu4sgxJHhuqV5DQogICAgICAgICAgICAgIGlmIChtZS50eXBlQWhlYWRQb2ludGVyID49IDAgJiYgbWUuaW50ZXJuYWxUZXh0KSB7DQogICAgICAgICAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSk7DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBtZS5jb2xsYXBzZSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCiAgICAgIG1lLiRlbWl0KCJrZXlkb3duIiwgZSk7DQogICAgfSwNCiAgICAvL0zhuqV5IHThu5VuZyBz4buRIGzGsOG7o25nIGThu68gbGnhu4d1IHRyb25nIGRhdGENCiAgICBnZXRUb3RhbERhdGEoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICByZXR1cm4gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsNCiAgICB9LA0KICAgIC8vQsO0aSBtw6B1IGhpZ2h0bGlnaHQgY2hvIGl0ZW0NCiAgICBkb0hpZ2h0bGlnaHRJdGVtKGlnbm9yZVZhbHVlKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsZXQgaW5kZXggPSAtMTsNCg0KICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZSAmJiBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID4gMCkgew0KICAgICAgICBpbmRleCA9IC0xOw0KDQogICAgICAgIGlmICgNCiAgICAgICAgICAhaWdub3JlVmFsdWUgJiYNCiAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlICE9IG51bGwgJiYNCiAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlICE9IHVuZGVmaW5lZA0KICAgICAgICApIHsNCiAgICAgICAgICBsZXQgc291cmNlcyA9IG1lLl9hbGxEYXRhIHx8IG1lLmludGVybmFsRGF0YVNvdXJjZTsNCg0KICAgICAgICAgIC8vVHLGsOG7m2Mga2hpIGxvYWQgdMOtbmggdG/DoW4gbOG6oWkgdHlwZUFoZWFkUG9pbnRlciBu4bq/dSBj4bqnbiB0aGnhur90IMSR4buDIHNjcm9sbCBkaSBjaHV54buDbiB24buBIGTDum5nIHbhu4sgdHLDrSBraGkgc2hvdyBzY3JvbGxlciBsw6puDQogICAgICAgICAgLy9Uw6xtIHbhu4sgdHLDrSBzZWxlY3RlZEl0ZW0gdHJvbmcgc291cmNlLCBraMO0bmcgbOG6pXkgc2VsZWN0ZWRJbmRleCB2w6wgY8OzIHRo4buDIGtow7RuZyBjaMOtbmggeMOhYyBraGkgc291cmNlIHRoYXkgxJHhu5VpDQogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VyY2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBsZXQgaXRlbSA9IHNvdXJjZXNbaV07DQogICAgICAgICAgICBpZiAoaXRlbVttZS52YWx1ZUZpZWxkXSA9PT0gbWUuaW50ZXJuYWxWYWx1ZSkgew0KICAgICAgICAgICAgICBpbmRleCA9IGk7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIGlmIChpbmRleCA+PSBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoKSB7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsgaSA8PSBpbmRleDsgaSsrKSB7DQogICAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5wdXNoKHNvdXJjZXNbaV0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpbmRleCA9PT0gLTEgJiYgbWUuaW50ZXJuYWxUZXh0KSB7DQogICAgICAgICAgbGV0IGxvd2VyVGV4dCA9IG1lLmludGVybmFsVGV4dC50b0xvd2VyQ2FzZSgpOw0KDQogICAgICAgICAgaWYgKG1lLmNvbHVtbnMgJiYgbWUuY29sdW1ucy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICBsZXQgaXRlbSA9IG1lLmludGVybmFsRGF0YVNvdXJjZVtpXTsNCiAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBtZS5jb2x1bW5zLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgICAgbGV0IGZpZWxkID0gbWUuY29sdW1uc1tqXS5kYXRhRmllbGQ7DQogICAgICAgICAgICAgICAgbGV0IGl0ZW1WYWx1ZSA9IGl0ZW1bZmllbGRdOw0KICAgICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICAgIHR5cGVvZiBpdGVtVmFsdWUgPT09ICJzdHJpbmciICYmDQogICAgICAgICAgICAgICAgICBpdGVtVmFsdWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGxvd2VyVGV4dCkgPiAtMQ0KICAgICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgICAgaW5kZXggPSBpOw0KICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICBsZXQgaXRlbVZhbHVlID0gbWUuaW50ZXJuYWxEYXRhU291cmNlW2ldW21lLmRpc3BsYXlGaWVsZF07DQogICAgICAgICAgICAgIGlmICgNCiAgICAgICAgICAgICAgICB0eXBlb2YgaXRlbVZhbHVlID09PSAic3RyaW5nIiAmJg0KICAgICAgICAgICAgICAgIGl0ZW1WYWx1ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YobG93ZXJUZXh0KSA+IC0xDQogICAgICAgICAgICAgICkgew0KICAgICAgICAgICAgICAgIGluZGV4ID0gaTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHsNCiAgICAgICAgICBpbmRleCA9IDA7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IGluZGV4Ow0KICAgIH0sDQogICAgLy9Uw6xtIGtp4bq/bSBpdGVtIHRyb25nIGxpc3QNCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTYuMDYuMjAyMCkNCiAgICBmaWx0ZXJJbmRleEl0ZW1CeVRleHQocXVlcnlUZXh0KSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBsZXQgZmlsdGVycyA9IG1lLmZpbHRlckZpZWxkcywNCiAgICAgICAgdmFsdWUgPSBxdWVyeVRleHQgfHwgbWUuaW50ZXJuYWxUZXh0LA0KICAgICAgICBpbmRleCA9IC0xOw0KICAgICAgaWYgKGZpbHRlcnMgJiYgdmFsdWUpIHsNCiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOw0KICAgICAgICBpbmRleCA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5maW5kSW5kZXgoKGl0ZW0sIF9pbmRleCkgPT4gew0KICAgICAgICAgIGxldCByZXQgPSBmYWxzZTsNCiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBmaWx0ZXJzKSB7DQogICAgICAgICAgICBpZiAoZmlsdGVycy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICAgICAgICAgIGNvbnN0IHMgPSBmaWx0ZXJzW2tleV07DQogICAgICAgICAgICAgIGlmIChzID09ICJjb250YWlucyIpIHsNCiAgICAgICAgICAgICAgICByZXQgPQ0KICAgICAgICAgICAgICAgICAgaXRlbVtrZXldICYmDQogICAgICAgICAgICAgICAgICBpdGVtW2tleV0udG9TdHJpbmcoKSAmJg0KICAgICAgICAgICAgICAgICAgaXRlbVtrZXldDQogICAgICAgICAgICAgICAgICAgIC50b1N0cmluZygpDQogICAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpDQogICAgICAgICAgICAgICAgICAgIC5jb250YWlucyh2YWx1ZS50b0xvd2VyQ2FzZSgpKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXQgPQ0KICAgICAgICAgICAgICAgICAgaXRlbVtrZXldICYmDQogICAgICAgICAgICAgICAgICBpdGVtW2tleV0udG9TdHJpbmcoKSAmJg0KICAgICAgICAgICAgICAgICAgaXRlbVtrZXldDQogICAgICAgICAgICAgICAgICAgIC50b1N0cmluZygpDQogICAgICAgICAgICAgICAgICAgIC50b0xvd2VyQ2FzZSgpDQogICAgICAgICAgICAgICAgICAgIC5zdGFydHNXaXRoKHZhbHVlLnRvTG93ZXJDYXNlKCkpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGlmIChyZXQpIHsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICByZXR1cm4gcmV0Ow0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBpbmRleDsNCiAgICB9LA0KICAgIC8vTOG6pXkgY+G7mXQgZmlsdGVyIMSR4buDIHTDrG0ga2nhur9tIGxvY2FsDQogICAgLy9DcmVhdGVkIGJ5IExUREFUIDE2LjA2LjIwMjANCiAgICBnZXRGaWx0ZXJGaWVsZHMoKSB7DQogICAgICBsZXQgZmlsdGVyID0ge307DQoNCiAgICAgIGlmICh0aGlzLmNvbHVtbnMgJiYgdGhpcy5jb2x1bW5zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmNvbHVtbnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICBjb25zdCBjb2wgPSB0aGlzLmNvbHVtbnNbaV07DQogICAgICAgICAgaWYgKCFjb2wuZmlsdGVyT3BlcmF0b3IpIHsNCiAgICAgICAgICAgIGNvbC5maWx0ZXJPcGVyYXRvciA9ICJjb250YWlucyI7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChjb2wuZGF0YUZpZWxkICYmIGNvbC5maWx0ZXJPcGVyYXRvcikgew0KICAgICAgICAgICAgaWYgKHRoaXMuZmlsdGVyQ29sdW1ucyAmJiB0aGlzLmZpbHRlckNvbHVtbnMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICB0aGlzLmZpbHRlckNvbHVtbnMuZm9yRWFjaCgoZSkgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZmlsdGVyLmhhc093blByb3BlcnR5KGUpKSB7DQogICAgICAgICAgICAgICAgICBmaWx0ZXJbZV0gPSBjb2wuZmlsdGVyT3BlcmF0b3I7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIGZpbHRlcltjb2wuZGF0YUZpZWxkXSA9IGNvbC5maWx0ZXJPcGVyYXRvcjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIGZpbHRlclt0aGlzLmRpc3BsYXlGaWVsZF0gPSAiY29udGFpbnMiOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIGZpbHRlcjsNCiAgICB9LA0KICAgIC8vTOG6pXkgZWxlbWVudCBzY3JvbGwNCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApDQogICAgZ2V0U2Nyb2xsZXIoKSB7DQogICAgICBpZiAodGhpcy5leHBhbmRlZCkgew0KICAgICAgICAvLyByZXR1cm4gdGhpcy4kcmVmc1sic2Nyb2xsZXIiXTsNCiAgICAgICAgbGV0IGRkID0gdGhpcy4kcmVmc1siZHJvcGRvd25QYW5lbCJdOw0KICAgICAgICBpZiAoZGQgJiYgZGQuJGVsICYmIHR5cGVvZiBkZC4kZWwucXVlcnlTZWxlY3RvciA9PT0gImZ1bmN0aW9uIikgew0KICAgICAgICAgIHJldHVybiBkZC4kZWwucXVlcnlTZWxlY3RvcigiLnNjcm9sbGVyIik7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0sDQogICAgLyoqDQogICAgICogRGkgY2h1eeG7g24gdmlldyDEkeG6v24gYuG6o24gZ2hpIG7hur91IGPhuqduDQogICAgICogQHBhcmFtIHtC4bqjbiBnaGkgY+G6p24gdmlld30gaW5kZXgNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTYuMDYuMjAyMA0KICAgICAqLw0KICAgIGFkanVzdFNjcm9sbCh0eXBlQWhlYWRQb2ludGVyID0gdGhpcy50eXBlQWhlYWRQb2ludGVyKSB7DQogICAgICBsZXQgc2Nyb2xsZXIgPSB0aGlzLmdldFNjcm9sbGVyKCk7DQogICAgICBpZiAoc2Nyb2xsZXIpIHsNCiAgICAgICAgLy8gc2Nyb2xsZXIuc2Nyb2xsVG9JdGVtKHR5cGVBaGVhZFBvaW50ZXIsIHRydWUpOw0KICAgICAgICBzY3JvbGxlci5zY3JvbGxUb3AgPSAzNSAqIHR5cGVBaGVhZFBvaW50ZXI7DQogICAgICB9DQogICAgfSwNCiAgICBvblNjcm9sbGVyVmlzaWJsZSgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLmFkanVzdFNjcm9sbCgpOw0KICAgIH0sDQogICAgLy9Iw6BtIHjhu60gbMO9IGtoaSBjaOG7jW4gaXRlbSB0csOqbiBkcm9wZG93bg0KICAgIC8vQ3JlYXRlZCBieSBMVERBVCgxNi4wNi4yMDIwKQ0KICAgIG9uSXRlbUNsaWNrKGl0ZW0sIGV2ZW50KSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKGl0ZW0pOw0KICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsNCiAgICB9LA0KICAgIC8vU2V0IGdpw6EgdHLhu4sgxJHGsOG7o2MgY2jhu41uDQogICAgc2V0SW50ZXJuYWxJdGVtKGl0ZW0sIHVzZXJBY3Rpb24gPSB0cnVlKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICBpZiAoaXRlbSkgew0KICAgICAgICBpZiAobWUubm90U2VsZWN0aW9uUGFyZW50ICYmIGl0ZW0uaXNQYXJlbnQpIHsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgbGV0IG1ldGFEYXRhID0gew0KICAgICAgICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLA0KICAgICAgICAgIG5ld0RhdGE6IGl0ZW0sDQogICAgICAgIH07DQogICAgICAgIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtID0gaXRlbTsNCiAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IGl0ZW1bbWUudmFsdWVGaWVsZF07DQogICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOw0KICAgICAgICBtZS5pbnRlcm5hbFRleHQgPSBpdGVtW21lLmRpc3BsYXlGaWVsZF07DQogICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSBtZS5maW5kSW5kZXhJdGVtKGl0ZW0pOw0KICAgICAgICBtZS5jb2xsYXBzZSgpOw0KICAgICAgICBtZS4kZW1pdCgidXBkYXRlOmRpc3BsYXkiLCBtZS5pbnRlcm5hbFRleHQpOw0KICAgICAgICBpZiAobWUubWFwcGluZ0ZpZWxkKSB7DQogICAgICAgICAgZm9yIChsZXQga2V5IGluIG1lLm1hcHBpbmdGaWVsZCkgew0KICAgICAgICAgICAgbGV0IGVtaXRTdHJVcGRhdGUgPSAidXBkYXRlOiIgKyBrZXk7DQogICAgICAgICAgICBtZS4kZW1pdCgNCiAgICAgICAgICAgICAgZW1pdFN0clVwZGF0ZSwNCiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW1bbWUubWFwcGluZ0ZpZWxkW2tleV1dDQogICAgICAgICAgICApOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAodXNlckFjdGlvbiA9PSB0cnVlKSB7DQogICAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOw0KDQogICAgICAgICAgaWYgKG1ldGFEYXRhLm9sZERhdGEgIT09IG1ldGFEYXRhLm5ld0RhdGEpIHsNCiAgICAgICAgICAgIG1lLiRlbWl0KA0KICAgICAgICAgICAgICAiY2hhbmdlIiwNCiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSwNCiAgICAgICAgICAgICAgbWV0YURhdGEubmV3RGF0YSwNCiAgICAgICAgICAgICAgbWV0YURhdGEub2xkRGF0YQ0KICAgICAgICAgICAgKTsNCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgbWUuJGVtaXQoImF1dG9TZWxlY3RlZCIsIG1ldGFEYXRhKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0sDQogICAgLy9Uw6xtIHbhu4sgdHLhu4sgY+G7p2EgaXRlbSB0cm9uZyBkYXRhDQogICAgZmluZEluZGV4SXRlbShpdGVtKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICByZXR1cm4gbWUuaW50ZXJuYWxEYXRhU291cmNlLmZpbmRJbmRleCgoX2l0ZW0pID0+IHsNCiAgICAgICAgcmV0dXJuIF9pdGVtID09IGl0ZW07DQogICAgICB9KTsNCiAgICB9LA0KICAgIC8vS2jhu59pIHThuqFvIGThu68gbGnhu4d1IHTEqW5oIG3hurdjIMSR4buLbmgNCiAgICBpbml0U3RhdGljRGF0YSgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLmNvbWJvVHlwZSA9IDE7DQoNCiAgICAgIG1lLmludGVybmFsUXVlcnlEZWxheSA9IDIwMDsNCiAgICAgIG1lLmZpbHRlckZpZWxkcyA9IG1lLmdldEZpbHRlckZpZWxkcygpOw0KICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7DQogICAgICBtZS5maXJzdEV4cGFuZCA9IHRydWU7DQogICAgfSwNCiAgICAvKioNCiAgICAgKiB0aMOqbSBi4bqjbiBnaGkgY2jhu41uIHThuqV0IGPhuqMgdsOgbyBzb3VyY2UNCiAgICAgKi8NCiAgICBhcHBlbmRTZWxlY3RBbGxJdGVtKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgaWYgKCFtZS5zaG93U2VsZWN0QWxsKSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIGxldCBmaXJzdEl0ZW0gPSBtZS5pbnRlcm5hbERhdGFTb3VyY2VbMF07DQogICAgICBpZiAoZmlyc3RJdGVtICYmIGZpcnN0SXRlbVttZS52YWx1ZUZpZWxkXSAhPT0gbWUuc2VsZWN0QWxsVmFsdWUpIHsNCiAgICAgICAgbGV0IGFsbEl0ZW0gPSB7fTsNCiAgICAgICAgYWxsSXRlbVttZS52YWx1ZUZpZWxkXSA9IG1lLnNlbGVjdEFsbFZhbHVlOw0KICAgICAgICBhbGxJdGVtW21lLmRpc3BsYXlGaWVsZF0gPSBtZS5fc2VsZWN0QWxsVGV4dDsNCg0KICAgICAgICAvLyB2dmtpZXQgLSAyNC4wNi4yMDIxOiBC4buVIHN1bmcgdGV4dCBU4bqldCBj4bqjIGNobyB04bqldCBj4bqjIGPDoWMgY+G7mXQNCiAgICAgICAgbWUuY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHsNCiAgICAgICAgICBhbGxJdGVtW2NvbHVtbi5kYXRhRmllbGRdID0gbWUuX3NlbGVjdEFsbFRleHQ7DQogICAgICAgIH0pOw0KDQogICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS51bnNoaWZ0KGFsbEl0ZW0pOw0KICAgICAgfQ0KICAgIH0sDQogICAgLy9LaOG7n2kgdOG6oW8gZOG7ryBsaeG7h3UNCiAgICBpbml0RGF0YSgpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmICgNCiAgICAgICAgbWUubGFzdFJlcXVlc3RQYXJhbSAmJg0KICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtLnBhZ2VBcHBlbmQgJiYNCiAgICAgICAgbWUuc2Nyb2xsRG9pbmcNCiAgICAgICkgew0KICAgICAgICAvLyBpZihtZS5pbnRlcm5hbERhdGFTb3VyY2UuZmlsdGVyKGk9Pmk9PSkpDQogICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5hcHBlbmQobWUuZGF0YSk7DQogICAgICAgIG1lLnNjcm9sbERvaW5nID0gZmFsc2U7DQogICAgICAgIC8vbuG6v3UgZOG7ryBsaeG7h3UgdHLhuqMgduG7gSDDrXQgaMahbiBtb25nIMSR4bujaSAtPiDEkcOhbmggZOG6pXUga+G6v3QgdGjDumMgxJHhu4Mga2hpIHNjcm9sbCB4deG7kW5nIGsgbG9hZCB0aMOqbSBu4buvYQ0KICAgICAgICBpZiAobWUuZGF0YS5sZW5ndGggPCBtZS5wYWdlU2l6ZSkgew0KICAgICAgICAgIG1lLmxhc3RSZXF1ZXN0UGFyYW0uZW5kID0gdHJ1ZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtLmVuZCA9IGZhbHNlOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBbLi4ubWUuZGF0YV07DQoNCiAgICAgICAgbWUuYXBwZW5kU2VsZWN0QWxsSXRlbSgpOw0KICAgICAgfQ0KDQogICAgICBpZiAobWUua2V5RmllbGQgJiYgbWUua2V5RmllbGQgIT09IG1lLnZhbHVlRmllbGQpIHsNCiAgICAgICAgY29tbW9uRm4uZ2VuVktleVZhbHVlKG1lLmludGVybmFsRGF0YVNvdXJjZSwgbWUua2V5RmllbGQpOw0KICAgICAgfQ0KICAgICAgLy9O4bq/dSBsw6AgY29tYm8gZOG6oW5nIHRyZWUNCiAgICAgIGlmIChtZS5jb21ib1R5cGUgPT0gMykgew0KICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobWUuaW50ZXJuYWxEYXRhU291cmNlKSk7DQogICAgICAgIGxldCBkYXRhVHJlZSA9IGNvbW1vbkZuLm5vbWFsaXplRGF0YVRyZWUoDQogICAgICAgICAgZGF0YSwNCiAgICAgICAgICBtZS5pZFByb3BlcnR5IHx8IG1lLnZhbHVlRmllbGQsDQogICAgICAgICAgbWUucGFyZW50SWRQcm9wZXJ0eQ0KICAgICAgICApOw0KICAgICAgICBsZXQgdHJlZURhdGEgPSBjb21tb25Gbi5nZXRCb2R5RGF0YShkYXRhVHJlZSwgdHJ1ZSk7DQoNCiAgICAgICAgaWYgKHRyZWVEYXRhLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBtZS5fYWxsRGF0YSA9IHRyZWVEYXRhOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZSA9IFtdOw0KICAgICAgICAgIG1lLl9hbGxEYXRhID0gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICBpZiAobWUuX2FsbERhdGEpIHsNCiAgICAgICAgbWUuZG9Mb2NhbFF1ZXJ5KG1lLmxhc3RRdWVyeVN0cmluZyk7DQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBLaOG7n2kgdOG6oW8gY29tYm8NCiAgICAgKg0KICAgICAqIEBhdXRob3IgaG5naWFwIC0gMDEuMDkuMjAxOQ0KICAgICAqIDEgbMOgIGNvbWJvIGtow7RuZyBjw7MgY29sdW1ucyAoQ29tYm9FZGl0b3IpDQogICAgICogMiBsw6AgY29tYm8gY8OzIGNvbHVtbnMNCiAgICAgKiAzIGzDoCBjb21ibyB0cmVlDQogICAgICovDQogICAgaW5pdENvbWJvKCkgew0KICAgICAgbGV0IG1lID0gdGhpczsNCiAgICAgIGlmIChtZS5pc1RyZWUpIHsNCiAgICAgICAgbWUuY29tYm9UeXBlID0gMzsNCiAgICAgIH0gZWxzZSBpZiAobWUuY29sdW1ucyAmJiBtZS5jb2x1bW5zLmxlbmd0aCAhPT0gMCkgew0KICAgICAgICBtZS5jb21ib1R5cGUgPSAyOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbWUuY29tYm9UeXBlID0gMTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICogY2xpY2sgdsOgbyBpY29uIGRyb3Bkb3duDQogICAgICovDQogICAgdHJpZ2dlckNsaWNrKGUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpcywNCiAgICAgICAgZXhwYW5kZWQgPSBtZS5leHBhbmRlZDsNCg0KICAgICAgLy9kaXNhYmxlIHRow6wga2jDtG5nIGzDoG0gZ8OsDQogICAgICBpZiAobWUuZGlzYWJsZWQpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICBpZiAoIWV4cGFuZGVkKSB7DQogICAgICAgIC8vIGlmIChtZS5wYWdpbmF0aW9uKSB7DQogICAgICAgIG1lLmRvUXVlcnlJbnRlcm5hbChudWxsLCB0cnVlKTsNCiAgICAgICAgLy8gfSBlbHNlIGlmIChtZS5maXJzdEV4cGFuZCkgew0KICAgICAgICAvLyAgIG1lLmZpcnN0RXhwYW5kID0gZmFsc2U7DQoNCiAgICAgICAgLy8gICBtZS5kb1F1ZXJ5SW50ZXJuYWwobnVsbCwgdHJ1ZSk7DQogICAgICAgIC8vIH0NCg0KICAgICAgICBtZS4kZW1pdCgiYmVmb3JlRXhwYW5kIik7DQogICAgICAgIC8vIHZ2a2VpdCAtIDA2LjA0LjIwMjE6IDg5ODIzIC0gTOG7l2kgY2h1bmc6IEzhu5dpIHRyw6puIGZvcm0gxJFp4buBdSBjaHV54buDbiBow6BuZyBsb+G6oXQgZMaw4bubaSBi4bqjbmcgY2hpIHRp4bq/dCBraGkgxJHDoyBjaOG7jW4gdMOgaSBz4bqjbiB0aMOsIMSRYW5nIGtow7RuZyB44buVIGNvbWJvIMSR4buDIGNo4buNbiB0aeG6v3ANCiAgICAgICAgLy8gbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsNCiAgICAgICAgbWUuY2hhbmdlRHJvcGRvd25Qb3NpdGlvbigpOw0KICAgICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKCk7DQogICAgICB9DQoNCiAgICAgIC8vxJHhurd0IG5leHRpY2sgxJHhu4MgdHLDoW5oIGzhu5dpIHJlbmRlciBkb20gY+G7p2EgY29tYm9ib3ggdHJlZSBraGkgY2jhu41uIGl0ZW0gdOG7qyBkcm9wZG93bg0KICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgbWUuZXhwYW5kZWQgPSAhZXhwYW5kZWQ7DQogICAgICB9KTsNCg0KICAgICAgLy9mb2N1cyBpbnB1dA0KICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsNCiAgICB9LA0KDQogICAgLyoqDQogICAgICogaGnhu4NuIHRo4buLIGRyb3Bkb3duDQogICAgICovDQogICAgZXhwYW5kKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICBtZS4kZW1pdCgiYmVmb3JlRXhwYW5kIik7DQogICAgICAvLyB2dmtlaXQgLSAwNi4wNC4yMDIxOiA4OTgyMyAtIEzhu5dpIGNodW5nOiBM4buXaSB0csOqbiBmb3JtIMSRaeG7gXUgY2h1eeG7g24gaMOgbmcgbG/huqF0IGTGsOG7m2kgYuG6o25nIGNoaSB0aeG6v3Qga2hpIMSRw6MgY2jhu41uIHTDoGkgc+G6o24gdGjDrCDEkWFuZyBraMO0bmcgeOG7lSBjb21ibyDEkeG7gyBjaOG7jW4gdGnhur9wDQogICAgICAvLyBtZS4kcmVmcy5pbnB1dC5mb2N1cygpOw0KICAgICAgbWUuY2hhbmdlRHJvcGRvd25Qb3NpdGlvbigpOw0KICAgICAgbWUuZG9IaWdodGxpZ2h0SXRlbSgpOw0KDQogICAgICAvL8SR4bq3dCBuZXh0aWNrIMSR4buDIHRyw6FuaCBs4buXaSByZW5kZXIgZG9tIGPhu6dhIGNvbWJvYm94IHRyZWUga2hpIGNo4buNbiBpdGVtIHThu6sgZHJvcGRvd24NCiAgICAgIG1lLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIG1lLmV4cGFuZGVkID0gdHJ1ZTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqDQogICAgICog4bqpbiBkcm9wZG93bg0KICAgICAqLw0KICAgIGNvbGxhcHNlKCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgbWUuZXhwYW5kZWQgPSBmYWxzZTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgLyoqDQogICAgICogSMOgbSBzZXQgduG7iyB0csOtIGNobyBkcm9wZG93biBtZW51IGtoaSBleHBhbmQNCiAgICAgKiBUT0RPOiBDaMawYSB44butIGzDvSBraGkgY8OzIHNjcm9sbA0KICAgICAqLw0KICAgIGNoYW5nZURyb3Bkb3duUG9zaXRpb24oKSB7DQogICAgICBsZXQgbWUgPSB0aGlzLA0KICAgICAgICBjb21ib0VsID0gbWUuJGVsOw0KICAgICAgaWYgKGNvbWJvRWwpIHsNCiAgICAgICAgY29tYm9FbCA9IGNvbWJvRWwuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiY29tYm8tYm94LWlucHV0IilbMF07DQogICAgICB9DQoNCiAgICAgIGlmIChjb21ib0VsKSB7DQogICAgICAgIGxldCBjb21ib0VsUmVjdCA9IGNvbWJvRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksDQogICAgICAgICAgY29tYm9NZW51RWwgPSBtZS4kZWw7DQoNCiAgICAgICAgbGV0IHdpbmRvd1dpZHRoID0NCiAgICAgICAgICB3aW5kb3cuaW5uZXJXaWR0aCB8fA0KICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fA0KICAgICAgICAgIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGg7DQogICAgICAgIGxldCB3aW5kb3dIZWlnaHQgPQ0KICAgICAgICAgIHdpbmRvdy5pbm5lckhlaWdodCB8fA0KICAgICAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwNCiAgICAgICAgICBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDsNCg0KICAgICAgICBtZS5kcm9wZG93bkxlZnR4ID0gY29tYm9FbFJlY3QubGVmdDsNCiAgICAgICAgbWUuZHJvcGRvd25Ub3B4ID0gY29tYm9FbFJlY3QudG9wICsgY29tYm9FbFJlY3QuaGVpZ2h0ICsgMjsNCiAgICAgICAgbWUuZHJvcGRvd25NYXhXaWR0aHggPSBtZS5kcm9wZG93bk1pbldpZHRoeCA9IG1lLmRyb3Bkb3duV2lkdGgNCiAgICAgICAgICA/IG1lLmRyb3Bkb3duV2lkdGgNCiAgICAgICAgICA6IGNvbWJvRWxSZWN0LndpZHRoOw0KDQogICAgICAgIC8vIE7hur91IGNo4bqhbSBwaOG6o2kgdGjDrCBhbGlnbiBzYW5nIHRyw6FpDQogICAgICAgIGlmIChjb21ib0VsUmVjdC5sZWZ0ICsgY29tYm9NZW51RWwub2Zmc2V0V2lkdGggPiB3aW5kb3dXaWR0aCkgew0KICAgICAgICAgIG1lLmRyb3Bkb3duTGVmdHggPSBjb21ib0VsUmVjdC5yaWdodCAtIGNvbWJvTWVudUVsLm9mZnNldFdpZHRoOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gTuG6v3UgY2jhuqFtIGJvdHRvbSB0aMOsIGFsaWduIHRvcA0KICAgICAgICBsZXQgbWF4SXRlbXNEaXNwbGF5ID0gbWUubWF4SXRlbXNEaXNwbGF5Ow0KICAgICAgICBpZiAobWUuY29sdW1ucyAmJiBtZS5jb2x1bW5zLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICBtYXhJdGVtc0Rpc3BsYXkgKz0gMTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoDQogICAgICAgICAgY29tYm9FbFJlY3QuYm90dG9tICsgbWUuaXRlbVNpemUgKiBtYXhJdGVtc0Rpc3BsYXkgKyAyID4NCiAgICAgICAgICB3aW5kb3dIZWlnaHQNCiAgICAgICAgKSB7DQogICAgICAgICAgbWUuZHJvcGRvd25Ub3B4ID0NCiAgICAgICAgICAgIGNvbWJvRWxSZWN0LnRvcCAtDQogICAgICAgICAgICAobWUuaXRlbVNpemUgKg0KICAgICAgICAgICAgICBNYXRoLm1pbihtYXhJdGVtc0Rpc3BsYXksIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGgpICsNCiAgICAgICAgICAgICAgNCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIC8qKg0KICAgICAqIENsaWNrIHbDoG8gaWNvbiBxdWlja3NlYXJjaA0KICAgICAqLw0KICAgIHF1aWNrU2VhcmNoQ2xpY2soZSkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgaWYgKG1lLnF1aWNrU2VhcmNoKSB7DQogICAgICAgIGlmIChtZS5kaXNhYmxlZCkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBtZS5leHBhbmRlZCA9IGZhbHNlOw0KICAgICAgICBsZXQgcGFyYW0gPSB7IC4uLihtZS5xdWlja1NlYXJjaFBhcmFtIHx8IHt9KSB9Ow0KICAgICAgICBwb3B1cFV0aWwuc2hvdyhtZSwgbWUucXVpY2tTZWFyY2gsIHBhcmFtLCB7DQogICAgICAgICAgLyoqDQogICAgICAgICAgICogU+G7sSBraeG7h24gY2FsbGJhY2sga2hpIGNo4buNbiBpdGVtIHThu6sgZm9ybSB0w6xtIG5oYW5oDQogICAgICAgICAgICovDQogICAgICAgICAgc2VhcmNoU3VibWl0OiBmdW5jdGlvbiAocmVjb3JkKSB7DQogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZWNvcmQpKSB7DQogICAgICAgICAgICAgIC8vIGNo4buNbiB04burIGZvcm0gY2jhu41uIG5oYW5oIHh14buRbmcgY29tYm8gZG8gcnVsZSBj4bunYSBk4buxIMOhbiBsw6AgxJFrIGzhu41jIHRyw6puIGZvcm0gY2jhu41uIG5oYW5oIHbDoCBjb21ibyBuaMawIG5oYXUgbsOqbiBjw7MgdGjhu4MgYuG7jyBxdWEgdmFsaWRhdGUgayBjw7MgdHJvbmcgZG5haCBt4bulYw0KICAgICAgICAgICAgICAvL3bDoCBi4buPIHF1YSB2YWxpZGF0ZSBrIGPDsyB0cm9uZyBkYW5oIG3hu6VjIGLhurFuZyBjw6FjaCBraeG7g20gdHJhIHNvdXJjZSBkxrDhu5tpIGNvbWJvIGPDsyBpdGVtIGRjIGNo4buNbiB04burIGZvcm0gY2jhu41uIG5oYW5oIGssIG7hur91IGsgY8OzIHRow6wgYWRkIHbDoG8NCiAgICAgICAgICAgICAgbGV0IGNoZWNrID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmZpbHRlcigNCiAgICAgICAgICAgICAgICAoaSkgPT4gaVttZS52YWx1ZUZpZWxkXSA9PSByZWNvcmRbMF1bbWUudmFsdWVGaWVsZF0NCiAgICAgICAgICAgICAgKTsNCiAgICAgICAgICAgICAgaWYgKCFjaGVjayB8fCBjaGVjay5sZW5ndGggPT0gMCkgew0KICAgICAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5wdXNoKHJlY29yZFswXSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKHJlY29yZFswXSk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAvLyBjaOG7jW4gdOG7qyBmb3JtIGNo4buNbiBuaGFuaCB4deG7kW5nIGNvbWJvIGRvIHJ1bGUgY+G7p2EgZOG7sSDDoW4gbMOgIMSRayBs4buNYyB0csOqbiBmb3JtIGNo4buNbiBuaGFuaCB2w6AgY29tYm8gbmjGsCBuaGF1IG7Dqm4gY8OzIHRo4buDIGLhu48gcXVhIHZhbGlkYXRlIGsgY8OzIHRyb25nIGRuYWggbeG7pWMNCiAgICAgICAgICAgICAgLy92w6AgYuG7jyBxdWEgdmFsaWRhdGUgayBjw7MgdHJvbmcgZGFuaCBt4bulYyBi4bqxbmcgY8OhY2gga2nhu4NtIHRyYSBzb3VyY2UgZMaw4bubaSBjb21ibyBjw7MgaXRlbSBkYyBjaOG7jW4gdOG7qyBmb3JtIGNo4buNbiBuaGFuaCBrLCBu4bq/dSBrIGPDsyB0aMOsIGFkZCB2w6BvDQogICAgICAgICAgICAgIGxldCBjaGVjayA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5maWx0ZXIoDQogICAgICAgICAgICAgICAgKGkpID0+IGlbbWUudmFsdWVGaWVsZF0gPT0gcmVjb3JkW21lLnZhbHVlRmllbGRdDQogICAgICAgICAgICAgICk7DQogICAgICAgICAgICAgIGlmICghY2hlY2sgfHwgY2hlY2subGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UucHVzaChyZWNvcmQpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShyZWNvcmQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbWUuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICAgICAgbWUudmFsaWRhdGUobWUpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBtZS4kcmVmcy5pbnB1dC5mb2N1cygpOw0KICAgICAgICAgIH0sDQogICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7DQogICAgICAgICAgfSwNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiBWYWxpZGF0ZSBraGkgYmx1cg0KICAgICAqIG50bmdoaWEgLSAxMS8wMy8yMDIxDQogICAgICogYm5kdWMgMjEuNi4yMDIxOiDEkOG7lWkgbOG6oWkgdGjDoG5oIGfhu41pIGjDoG0gdmFsaWRhdGUgY+G7p2EgY29udHJvbCB0aGF5IHbDrCB2aeG6v3Qgc2N1c3RvbSBuaMawIG7DoHkNCiAgICAgKi8NCiAgICB2YWxpZGF0ZUJsdXIoKSB7DQogICAgICB0aGlzLnZhbGlkYXRlKHRoaXMpOw0KICAgIH0sDQogICAgLyoqDQogICAgICogc2Nyb2xsIHh14buRbmcgY3Xhu5FpIGRyb3duZG93biAtPiBsb2FkIHRow6ptIGThu68gbGnhu4d1DQogICAgICovDQogICAgZHJvcGRvd25TY3JvbGxFbmQoKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQogICAgICAvLyBpZiAobWUucGFnaW5hdGlvbikgew0KICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PT0gInJlbW90ZSIgJiYgIW1lLl9hbGxEYXRhKSB7DQogICAgICAgIG1lLnNjcm9sbERvaW5nID0gdHJ1ZTsNCiAgICAgICAgLy9yZW1vdGUNCiAgICAgICAgaWYgKG1lLmxhc3RSZXF1ZXN0UGFyYW0gJiYgIW1lLmxhc3RSZXF1ZXN0UGFyYW0uZW5kKSB7DQogICAgICAgICAgLy9UT0RPIGJuZHVjIDIxLjYuMjAyMTogZ2hpIG5o4bqtbiB0w61uaCBodeG7kW5nIGfhu41pIHbDoG8gxJHDonkgMiBs4bqnbiB0csOqbiBtw6F5IHFjIC0+IHRow6ptIGtp4buDbSB0cmEgbsOgeSDEkeG7gyBrIGzhu5dpDQogICAgICAgICAgaWYgKA0KICAgICAgICAgICAgbWUubGFzdFJlcXVlc3RQYXJhbS5za2lwICYmDQogICAgICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtLnNraXAgPT09IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGgNCiAgICAgICAgICApIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICBsZXQgcGF5bG9hZCA9IG1lLmxhc3RSZXF1ZXN0UGFyYW07DQogICAgICAgICAgcGF5bG9hZC5za2lwID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsNCiAgICAgICAgICBwYXlsb2FkLnBhZ2VBcHBlbmQgPSB0cnVlOw0KDQogICAgICAgICAgbWUuJGVtaXQoImxvYWREYXRhIiwgcGF5bG9hZCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vbG9jYWwNCiAgICAgICAgbGV0IGRhdGEgPSBtZS5fZmlsdGVyRGF0YSB8fCBtZS5fYWxsRGF0YTsNCiAgICAgICAgaWYgKGRhdGEpIHsNCiAgICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UgfHwgW107DQogICAgICAgICAgbGV0IHN0YXJ0ID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsNCiAgICAgICAgICBsZXQgY291bnQgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCwgbWUucGFnZVNpemUgKyBzdGFydCk7DQogICAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlLnB1c2goZGF0YVtpXSk7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyB9DQogICAgfSwNCiAgICAvKioNCiAgICAgKiB44butIGzDvSBwaMOtbSBlc2MNCiAgICAgKi8NCiAgICBvbkVzYyhlKSB7DQogICAgICBjb25zdCBtZSA9IHRoaXM7DQoNCiAgICAgIC8v4bqpbiBkcm9wZG93biB2w6Agc3RvcCBldmVudCBu4bq/dSDEkWFuZyBleHBhbmQNCiAgICAgIGlmIChtZS5leHBhbmRlZCkgew0KICAgICAgICBtZS5jb2xsYXBzZSgpOw0KICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGUuY2FuY2VsID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICogeOG7rSBsw70gcGjDrW0gZW50ZXINCiAgICAgKi8NCiAgICBvbkVudGVyKGUpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCg0KICAgICAgaWYgKG1lLmV4cGFuZGVkICYmICFtZS5sb2FkaW5nICYmIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgICBtZS5zaG93UXVpY2tBZGQodHJ1ZSk7DQogICAgICB9DQogICAgfSwNCg0KICAgIC8qKg0KICAgICAqIE3hu58gZm9ybSB0aMOqbSBuaGFuaA0KICAgICAqLw0KICAgIHNob3dRdWlja0FkZChpc2Zyb21FbnRlciwgaXNmcm9tU2hvcnRLZXkpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIGlmICgNCiAgICAgICAgKG1lLmV4cGFuZGVkICYmICFtZS5sb2FkaW5nICYmIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGggPT09IDApIHx8DQogICAgICAgIGlzZnJvbVNob3J0S2V5DQogICAgICApIHsNCiAgICAgICAgaWYgKCFtZS5xdWlja0FkZCkgew0KICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW1lLmlzUGVybWlzc2lvbikgew0KICAgICAgICAgIGlmICghaXNmcm9tRW50ZXIpIHsNCiAgICAgICAgICAgIG1lLmNvbGxhcHNlKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIG1lc3NhZ2VCb3guc2hvd0Vycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuTm90UGVybWlzc2lvbiIpKTsNCiAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCg0KICAgICAgICBtZS5leHBhbmRlZCA9IGZhbHNlOw0KICAgICAgICBsZXQgcGFyYW0gPSB7IC4uLihtZS5xdWlja1NlYXJjaFBhcmFtIHx8IHt9KSB9Ow0KICAgICAgICBpZiAobWUuaW50ZXJuYWxUZXh0KSB7DQogICAgICAgICAgcGFyYW0ucXVpY2tBZGRUZXh0ID0gbWUuaW50ZXJuYWxUZXh0Ow0KICAgICAgICB9DQogICAgICAgIHBvcHVwVXRpbC5zaG93KG1lLCBtZS5xdWlja0FkZCwgcGFyYW0sIHsNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBT4buxIGtp4buHbiBjYWxsYmFjayBraGkgc3VibWl0IHThu6sgZm9ybSB0aMOqbSBuaGFuaA0KICAgICAgICAgICAqLw0KICAgICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgew0KICAgICAgICAgICAgLy90b2RvDQogICAgICAgICAgICBsZXQgcmVjb3JkID0gcmVzdWx0LkRhdGE7DQogICAgICAgICAgICBpZiAocmVjb3JkKSB7DQogICAgICAgICAgICAgIGlmIChtZS5xdWVyeU1vZGUgPT09ICJyZW1vdGUiKSB7DQogICAgICAgICAgICAgICAgLy9sb2FkIGzhuqFpIHJhIMSR4buDIHB1c2ggdGjDqm0gaWNvbiB2w6BvIChidWcgMTE1ODg1ICkNCiAgICAgICAgICAgICAgICBtZS5kb1F1ZXJ5SW50ZXJuYWwobnVsbCwgZmFsc2UpOw0KICAgICAgICAgICAgICAgIC8vYXBwZW5kIGRhdGEgdG8gc291cmNlDQogICAgICAgICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlLnB1c2gocmVjb3JkKTsNCg0KICAgICAgICAgICAgICAgIC8vbnRwaG9uZyAyOS81LzIwMjEgLSB0aMOqbSBi4bqjbiBnaGkgbeG7m2kgdsOgbyBzb3VyY2UobuG6v3UgbMOgIGtp4buDdSB0cmVlIHRow6wgdGjDqm0gxJHDum5nIHbhu4sgdHLDrSBjaGEgY29uKQ0KICAgICAgICAgICAgICAgIC8vbm5sYW0gMDcvMDcvMjAyMTogYSBwaG9uZyBhIGsgY2hlY2sgeGVtIGNvbWJvIGPDsyBsw6AgZOG6oW5nIHRyZWUgaGF5IGsgbcOgIGEgxJHDoyBsw6BtIHRo4bq/IG7DoHkgciDDoA0KICAgICAgICAgICAgICAgIGlmIChtZS5pc1RyZWUpIHsNCiAgICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghbWUuX2FsbERhdGEpIHsNCiAgICAgICAgICAgICAgICAgICAgICBtZS5fYWxsRGF0YSA9IFtdOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGxldCBpc0V4aXN0SXRlbSA9IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEl0ZW0sDQogICAgICAgICAgICAgICAgICAgICAgaXRlbUluZGV4ID0gbWUuX2FsbERhdGEubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1lLl9hbGxEYXRhLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBtZS5fYWxsRGF0YVtpXTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW1bbWUudmFsdWVGaWVsZF0gPT0gcmVjb3JkW21lLnZhbHVlRmllbGRdKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlzRXhpc3RJdGVtID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoDQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZFttZS5wYXJlbnRJZFByb3BlcnR5XSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtW21lLnZhbHVlRmllbGRdID09IHJlY29yZFttZS5wYXJlbnRJZFByb3BlcnR5XQ0KICAgICAgICAgICAgICAgICAgICAgICAgKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEl0ZW0gPSBpdGVtOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtSW5kZXggPSBpICsgMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0V4aXN0SXRlbSkgew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmRbbWUucGFyZW50SWRQcm9wZXJ0eV0gJiYgcGFyZW50SXRlbSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SXRlbS5Jc1BhcmVudCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWUuaXNUcmVlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJdGVtLmxldmVsKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkLmxldmVsID0gcGFyZW50SXRlbS5sZXZlbCArIDE7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkLnBhcmVudE5vZGUgPSBwYXJlbnRJdGVtOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJdGVtLmNoaWxkTm9kZXMgPSBbcmVjb3JkXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgbWUuX2FsbERhdGEuc3BsaWNlKGl0ZW1JbmRleCwgMCwgcmVjb3JkKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXgpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyBtZS5fYWxsRGF0YS5wdXNoKHJlY29yZCk7DQogICAgICAgICAgICAgICAgbWUuZG9Mb2NhbFF1ZXJ5KG51bGwpOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy91cGRhdGUgdmFsdWUgYW5kIGRpc3BsYXkNCiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0gPSBudWxsOw0KICAgICAgICAgICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0ocmVjb3JkKTsNCg0KICAgICAgICAgICAgICBtZS4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgICAgICAgIG1lLnZhbGlkYXRlKG1lKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7DQogICAgICAgICAgfSwNCiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsNCiAgICAgICAgICB9LA0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICogQG92ZXJyaWRlDQogICAgICovDQogICAgY3VzdG9tUnVsZVZhbGlkYXRlUnVsZXMocnVsZXMpIHsNCiAgICAgIGNvbnN0IG1lID0gdGhpczsNCiAgICAgIG1lLnN1cGVyKCJjdXN0b21SdWxlVmFsaWRhdGVSdWxlcyIsIHJ1bGVzKTsNCg0KICAgICAgaWYgKG1lLmZvcmNlU2VsZWN0aW9uICYmIHJ1bGVzLmluZGV4T2YoImZvcmNlU2VsZWN0aW9uIikpIHsNCiAgICAgICAgcnVsZXMucHVzaCgiZm9yY2VTZWxlY3Rpb24iKTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLyoqDQogICAgICogWOG7rSBsw70ga2hpIGNsaWNrIG7DunQgcXVpY2thZGQgbmdvw6BpIGNvbWJvDQogICAgICogTk1UVUFOMiAwMy4xMS4yMDIxDQogICAgICovDQogICAgY29tYm9RdWlja0FkZChldmVudCkgew0KICAgICAgY29uc3QgbWUgPSB0aGlzOw0KDQogICAgICBtZS4kZW1pdCgiY29tYm9RdWlja0FkZCIpOw0KICAgIH0sDQogIH0sDQp9Ow0K"},null]}
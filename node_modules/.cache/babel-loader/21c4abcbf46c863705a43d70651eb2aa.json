{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT_vue\\src\\views\\base\\BaseDetail.js","dependencies":[{"path":"D:\\VNT_vue\\src\\views\\base\\BaseDetail.js","mtime":1656127264074},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfdHlwZW9mIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3R5cGVvZiI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLWluZGV4LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyBwZXJtaXNzaW9uIH0gZnJvbSAiQC9taXhpbnMvY29tbW9uL3Blcm1pc3Npb24iOwppbXBvcnQgeyBtaXhpblN1cGVyIH0gZnJvbSAiQC9taXhpbnMvY29tbW9uL21peGluU3VwZXIiOwppbXBvcnQgeyBtYXBTdGF0ZSwgbWFwQWN0aW9ucywgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgeyBNb2R1bGVDb250ZXh0IH0gZnJvbSAiQC9zdG9yZXMvbW9kdWxlLWNvbnN0IjsKaW1wb3J0IG1zVmFsaWRhdGUgZnJvbSAiQC9jb21wb25lbnRzL21zVmFsaWRhdGUvbXNWYWxpZGF0ZS52dWUiOwppbXBvcnQgY29tbW9uRm4gZnJvbSAiQC9jb21tb25zL2NvbW1vbkZ1bmN0aW9uIjsKaW1wb3J0IE1TSnNvbiBmcm9tICJAL2NvbW1vbnMvanNvbiI7CmltcG9ydCB7IGNvbWJvYm94Q29sdW1ucyB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9jb21ib2JveENvbHVtbnMiOwppbXBvcnQgQXVkaXRpbmdMb2dBUEkgZnJvbSAiQC9hcGlzL3N5c3RlbS9hdWRpdGluZ0xvZ0FQSSI7CmltcG9ydCB7IGZpbHRlciB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9maWx0ZXIiOwppbXBvcnQgeyBzaG9ydGtleVN0YXR1c2JhciB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9zaG9ydGtleVN0YXR1c2JhciI7CmltcG9ydCBtb21lbnQgZnJvbSAibW9tZW50IjsKaW1wb3J0IEZpcmViYXNlIGZyb20gIkAvZmlyZWJhc2UvZmlyZWJhc2UiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkJhc2VEZXRhaWwiLAogIG1peGluczogW2ZpbHRlciwgbWl4aW5TdXBlciwgcGVybWlzc2lvbiwgY29tYm9ib3hDb2x1bW5zLCBzaG9ydGtleVN0YXR1c2Jhcl0sCiAgY29tcG9uZW50czogewogICAgbXNWYWxpZGF0ZTogbXNWYWxpZGF0ZQogIH0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHdpbmRvdy5feHggPSB0aGlzOwogICAgcmV0dXJuIHsKICAgICAgLy9tb2R1bGUgY2jDrW5oIGPhu6dhIGZvcm0KICAgICAgbW9kdWxlOiBudWxsLAogICAgICAvL23hu58gZm9ybSDhu58gbW9kZSBuw6BvOiB0aMOqbSwgc+G7rWEsIG5ow6JuIGLhuqNuCiAgICAgIGVkaXRNb2RlOiB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5BZGQsCiAgICAgIC8vdGnDqnUgxJHhu4EgY+G7p2EgZm9ybQogICAgICB0aXRsZTogbnVsbCwKICAgICAgLy9k4buvIGxp4buHdSBiaW5kaW5nCiAgICAgIGN1cnJlbnRJdGVtOiB7fSwKCiAgICAgIC8qKg0KICAgICAgICogVE9ETyB4ZW0geMOpdCBjw7MgZMO5bmcgbcOzbiBuw6B5IGtow7RuZw0KICAgICAgICovCiAgICAgIHN0b3JlRGV0YWlsOiBudWxsLAoKICAgICAgLyoqDQogICAgICAgKiBEYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIGThu68gbGnhu4d1IGfhu5FjIGPhu6dhIGThu68gbGnhu4d1DQogICAgICAgKi8KICAgICAgb3JpZ2luRmllbGRzOiBbXSwKCiAgICAgIC8qKg0KICAgICAgICogYmnhur9uIGPDsyBjaG8gbeG6t2MgxJHhu4tuaCBmb2N1cyBrbw0KICAgICAgICovCiAgICAgIGlzQXV0b0ZvY3VzOiB0cnVlLAoKICAgICAgLyoqDQogICAgICAgKiDEkGFuZyB44butIGzDvSB24bubaSBzZXJ2ZXINCiAgICAgICAqLwogICAgICBsb2FkaW5nOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogZOG7ryBsaeG7h3UgY8WpDQogICAgICAgKi8KICAgICAgb2xkRGF0YUl0ZW06IHt9LAoKICAgICAgLyoqDQogICAgICAgKiBtw7QgdOG6oyBuaOG6rXQga8O9DQogICAgICAgKi8KICAgICAgZGVzY3JpcHRpb25BdWRpdGluZ0xvZzogewogICAgICAgIG1hc3Rlcjoge30sCiAgICAgICAgZGV0YWlsOiBbXQogICAgICB9LAoKICAgICAgLyoqDQogICAgICAgKiBow6BuaCDEkeG7mW5nIHRoYW8gdMOhYyBj4bunYSBuaOG6rXQga8O9DQogICAgICAgKi8KICAgICAgYWN0aW9uQXVkaXRpbmdMb2c6IG51bGwsCgogICAgICAvKioNCiAgICAgICAqIGRhbmggc8OhY2ggY8OhYyBmaWVsZCBjw7Mgbmhp4buBdSBjYXB0aW9uICh0aXRsZSkgdsOgIHRoYXkgxJHhu5VpIHRoZW8gxJFp4buBdSBraeG7h24gbsOgbyDEkcOzDQogICAgICAgKiB2w60gZOG7pTogYWNjb3VudE9iamVjdENvZGU6IG3DoyBuaMOgIGN1bmcgY+G6pXAgKC1u4bq/dSBsw6AgbmjDoCBjYyksIG3DoyBraMOhY2ggaMOgbmcgKC1u4bq/dSBsw6Aga2jDoWNoIGjDoG5nKS4uLi4NCiAgICAgICAqIHR1eSBuaGnDqm4gdGjDrCB04bqhaSAxIHRo4budaSDEkWnhu4NtIGPDoWMgZmllbGQgbsOgeSBjaOG7iSBjw7MgMSB0aXRsZSBkdXkgbmjhuqV0IHbDoCBj4bqnbiBsxrB1IHRpdGxlIGPhu6dhIG7DsyB2w6BvIGxpc3QgbsOgeSDEkeG7gyBzYXUgY8OzIHRo4buDIHNob3cgbcO0IHThuqMgY2jDrW5oIHjDoWMNCiAgICAgICAqIERlbW86IHttYXN0ZXI6e2FjY291bnRPYmplY3RDb2RlOiAxfX07IGtoaSBnZW4gbG9nIHPhur0gbWFwaW5nIGzDoCA6IGkxOG5BdWRpdGluZ2xvZy5hc3NldC5tYXN0ZXIuYWNjb3VudE9iamVjdENvZGVfMSBob+G6t2MgaTE4bkF1ZGl0aW5nbG9nLmFzc2V0LmRldGFpbC5hY2NvdW50T2JqZWN0Q29kZV8xDQogICAgICAgKi8KICAgICAgc3dpdGNoQ2FwdGlvbjogewogICAgICAgIG1hc3Rlcjoge30sCiAgICAgICAgZGV0YWlsOiB7fQogICAgICB9LAogICAgICBlbnRpdHlTdGF0ZTogbnVsbCwKCiAgICAgIC8qKg0KICAgICAgICogR2nhu68gdOG6oW0gdGjhu51pIGPDoWMgZmlsZSBkYyB0aMO0bmcgcXVhIGtoaSB1cGxvYWQNCiAgICAgICAqLwogICAgICBmaWxlVGVtcHM6IFtdLAoKICAgICAgLyoqDQogICAgICAgKiBDw7MgZMO5bmcgc2hvcnRrZXkga2jDtG5nDQogICAgICAgKi8KICAgICAgaGFzU2hvcnRLZXk6IHRydWUsCgogICAgICAvKioNCiAgICAgICAqIFBhcmFtDQogICAgICAgKi8KICAgICAgcGFyYW06IG51bGwKICAgIH07CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICBtZS5hZGRIYW5kbGVyKCk7IC8vaW5pdCBjaGEgY+G7p2EgZm9ybSBz4bq9IMSDbiBwaMOtbSB04bqvdAoKICAgIGlmIChtZS5oYXNTaG9ydEtleSkgewogICAgICB0aGlzLiRtcy5jb21tb25Gbi5zaG9ydGtleVB1c2hWaWV3KHRoaXMuJGVsKTsKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBjb250ZXh0OiBmdW5jdGlvbiBjb250ZXh0KCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGVbTW9kdWxlQ29udGV4dF07CiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvKioNCiAgICAgKiBY4butIGzDvSB0aMOqbSBt4bubaQ0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICovCiAgICBhZGQ6IGZ1bmN0aW9uIGFkZChwYXJhbSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgbWUsIGRhdGE7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczsgLy9Hw6FuIGZvcm0gbW9kZQoKICAgICAgICAgICAgICAgIG1lLnNldEZvcm1Nb2RlKG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5BZGQpOwogICAgICAgICAgICAgICAgbWUuZW50aXR5U3RhdGUgPSBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkluc2VydDsgLy9s4bqleSBk4buvIGxp4buHdQoKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmxvYWREYXRhKCJOZXciLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIGRhdGEgPSBfY29udGV4dC5zZW50OwogICAgICAgICAgICAgICAgLy9D4bqtcCBuaOG6rXQgZOG7ryBsaeG7h3UgdsOgbyBjdXJyZW50SXRlbQogICAgICAgICAgICAgICAgbWUuYmluZERhdGEoZGF0YSk7IC8vcmVzZXQgdmFsaWRhdGUKCiAgICAgICAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAobWUuaXNBdXRvRm9jdXMpIHsKICAgICAgICAgICAgICAgICAgICAvL2ZvY3VzIGZpcnN0IGNvbnRyb2wKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIG1lLiRtcy5jb21tb25Gbi5mb2N1c0ZpcnN0Q29udHJvbElucHV0KG1lLiRlbCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgbWUucmVzZXRWYWxpZGF0ZSgpOyAvL0Phuq1wIG5o4bqtdCBPbGREYXRhIMSR4buDIHRyYWNrIGNoYW5nZQoKICAgICAgICAgICAgICAgICAgbWUuc2V0T2xkRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEfDoW4gc3RhdGUgY2hvIGZvcm0NCiAgICAgKi8KICAgIHNldEZvcm1Nb2RlOiBmdW5jdGlvbiBzZXRGb3JtTW9kZShtb2RlKSB7CiAgICAgIHRoaXMuZWRpdE1vZGUgPSBtb2RlOyAvL2Phuq1wIG5o4bqtdCB0acOqdSDEkeG7gSBjaG8gZm9ybQoKICAgICAgdGhpcy50aXRsZSA9IHRoaXMuZ2V0Rm9ybVRpdGxlKG1vZGUpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0acOqdSDEkeG7gSBmb3JtDQogICAgICovCiAgICBnZXRGb3JtVGl0bGU6IGZ1bmN0aW9uIGdldEZvcm1UaXRsZShtb2RlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciB0aXRsZSA9IFtdOwogICAgICB0aXRsZS5wdXNoKG1lLiRtcy5jb21tb25Gbi5nZXRFbnVtUmVzb3VyY2UobW9kZSwgIkZvcm1TdGF0ZSIpKTsKICAgICAgdGl0bGUucHVzaCgobWUuZ2V0TW9kdWxlTmFtZSgpIHx8ICIiKS50b0xvd2VyQ2FzZSgpKTsKICAgICAgcmV0dXJuIHRpdGxlLmpvaW4oIiAiKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdMOqbiDEkeG7kWkgdMaw4bujbmcgY+G7p2EgZm9ybQ0KICAgICAqIE5NVFVBTjMgMi8xMS8yMDIxDQogICAgICovCiAgICBnZXRNb2R1bGVOYW1lOiBmdW5jdGlvbiBnZXRNb2R1bGVOYW1lKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuJHQoImkxOG5Db21tb24ubW9kdWxlLiIgKyAobWUubW9kdWxlIHx8ICIiKS50b0xvd2VyQ2FzZSgpKTsKICAgIH0sCgogICAgLyoqDQogICAgICogQmluZCBk4buvIGxp4buHdSBjaG8gZm9ybQ0KICAgICAqLwogICAgYmluZERhdGE6IGZ1bmN0aW9uIGJpbmREYXRhKGRhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9kZXRhaWxzCgogICAgICBpZiAobWUuc3RvcmVEZXRhaWwpIHsKICAgICAgICAvLyBM4bqleSBzdGF0ZSBjaG8gY8OhYyBSb3cgdHLDqm4gZ3JpZAogICAgICAgIC8vIEJWSEFVIDE5LjA1LjIwMjA6IOG7niBtb2RlIFRow6ptIHRow6wgbeG6t2MgxJHhu4tuaCBk4buvIGxp4buHdSDEkWFuZyBraOG7n2kgdOG6oW8gY2jhu4kgbMOgIGTDsm5nIHThuqFtKGlzVGVtcCkKICAgICAgICB2YXIgb2JqZWN0U3RhdGUgPSB7CiAgICAgICAgICBhcHBlbmQ6IGZhbHNlLAogICAgICAgICAgaXNUZW1wOiB0cnVlCiAgICAgICAgfTsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIG1lLnN0b3JlRGV0YWlsKSB7CiAgICAgICAgICB2YXIgc3RvcmUgPSBtZS5zdG9yZURldGFpbFtrZXldLAogICAgICAgICAgICAgIGRldGFpbERhdGEgPSBkYXRhW2tleV07CiAgICAgICAgICBkZWxldGUgZGF0YVtrZXldOwoKICAgICAgICAgIGlmIChkZXRhaWxEYXRhICYmIEFycmF5LmlzQXJyYXkoZGV0YWlsRGF0YSkgJiYgZGV0YWlsRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHN0b3JlLmxvYWREYXRhKGRldGFpbERhdGEsIG9iamVjdFN0YXRlLmFwcGVuZCwgb2JqZWN0U3RhdGUuaXNUZW1wKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0b3JlLm93bmVyLmFkZE5ldyh7fSwgb2JqZWN0U3RhdGUuaXNUZW1wKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy9tYXN0ZXIKCgogICAgICBtZS5jdXJyZW50SXRlbSA9IGRhdGE7CiAgICAgIG1lLmJlZm9yZUJpbmREYXRhKCk7CiAgICB9LAogICAgYmVmb3JlQmluZERhdGE6IGZ1bmN0aW9uIGJlZm9yZUJpbmREYXRhKCkgewogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHPhu61hDQogICAgICogQHBhcmFtIGRhdGENCiAgICAgKi8KICAgIGVkaXQ6IGZ1bmN0aW9uIGVkaXQocGFyYW0pIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICB2YXIgbWUsIGRhdGE7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXMyOwogICAgICAgICAgICAgICAgbWUuZW50aXR5U3RhdGUgPSBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLlVwZGF0ZTsgLy9u4bq/dSBz4butYSBjw7MgdHJ1eeG7gW4gZOG7ryBsaeG7h3UgLT4gYmluZGluZyBk4buvIGxp4buHdSB0cnV54buBbiBsw6puIHRyxrDhu5tjIHRyb25nIGtoaSDEkWFuZyBjaOG7nSBsb2FkIGThu68gbGnhu4d1IHThu6sgc2VydmVyCgogICAgICAgICAgICAgICAgaWYgKF90eXBlb2YocGFyYW0uZGF0YSkgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgIG1lLmN1cnJlbnRJdGVtID0gX29iamVjdFNwcmVhZCh7fSwgcGFyYW0uZGF0YSk7CiAgICAgICAgICAgICAgICB9IC8vR8OhbiBmb3JtIG1vZGUKCgogICAgICAgICAgICAgICAgbWUuc2V0Rm9ybU1vZGUobWUuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQpOyAvL2zhuqV5IGThu68gbGnhu4d1CgogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA2OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmxvYWREYXRhKCJFZGl0IiwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICAvL0Phuq1wIG5o4bqtdCBk4buvIGxp4buHdSB2w6BvIGN1cnJlbnRJdGVtCiAgICAgICAgICAgICAgICBtZS5iaW5kRGF0YShkYXRhKTsgLy9yZXNldCB2YWxpZGF0ZQoKICAgICAgICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtZS5pc0F1dG9Gb2N1cykgewogICAgICAgICAgICAgICAgICAgIC8vZm9jdXMgZmlyc3QgY29udHJvbAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLmZvY3VzRmlyc3RDb250cm9sSW5wdXQobWUuJGVsKTsKICAgICAgICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBtZS5yZXNldFZhbGlkYXRlKCk7IC8vQ+G6rXAgbmjhuq10IE9sZERhdGEgxJHhu4MgdHJhY2sgY2hhbmdlCgogICAgICAgICAgICAgICAgICBtZS5zZXRPbGREYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMyk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSB2aWV3DQogICAgICogcHZkdXkgMjcvMDIvMjAyMQ0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICovCiAgICB2aWV3OiBmdW5jdGlvbiB2aWV3KHBhcmFtKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoKSB7CiAgICAgICAgdmFyIG1lLCBkYXRhOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzMzsgLy9u4bq/dSBz4butYSBjw7MgdHJ1eeG7gW4gZOG7ryBsaeG7h3UgLT4gYmluZGluZyBk4buvIGxp4buHdSB0cnV54buBbiBsw6puIHRyxrDhu5tjIHRyb25nIGtoaSDEkWFuZyBjaOG7nSBsb2FkIGThu68gbGnhu4d1IHThu6sgc2VydmVyCgogICAgICAgICAgICAgICAgaWYgKF90eXBlb2YocGFyYW0uZGF0YSkgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICAgICAgICAgIG1lLmN1cnJlbnRJdGVtID0gX29iamVjdFNwcmVhZCh7fSwgcGFyYW0uZGF0YSk7CiAgICAgICAgICAgICAgICB9IC8vbOG6pXkgZOG7ryBsaeG7h3UKCgogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmxvYWREYXRhKCJFZGl0IiwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICAvL0Phuq1wIG5o4bqtdCBk4buvIGxp4buHdSB2w6BvIGN1cnJlbnRJdGVtCiAgICAgICAgICAgICAgICBtZS5iaW5kRGF0YShkYXRhKTsgLy9Hw6FuIGZvcm0gbW9kZQoKICAgICAgICAgICAgICAgIG1lLnNldEZvcm1Nb2RlKG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5WaWV3KTsgLy9yZXNldCB2YWxpZGF0ZQoKICAgICAgICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtZS5pc0F1dG9Gb2N1cykgewogICAgICAgICAgICAgICAgICAgIC8vZm9jdXMgZmlyc3QgY29udHJvbAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLmZvY3VzRmlyc3RDb250cm9sSW5wdXQobWUuJGVsKTsKICAgICAgICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBtZS5yZXNldFZhbGlkYXRlKCk7IC8vQ+G6rXAgbmjhuq10IE9sZERhdGEgxJHhu4MgdHJhY2sgY2hhbmdlCgogICAgICAgICAgICAgICAgICBtZS5zZXRPbGREYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBOaMOibiBi4bqjbg0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICovCiAgICBkdXBsaWNhdGU6IGZ1bmN0aW9uIGR1cGxpY2F0ZShwYXJhbSkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgIHZhciBtZSwgZGF0YTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczQ7IC8vbuG6v3Ugc+G7rWEgY8OzIHRydXnhu4FuIGThu68gbGnhu4d1IC0+IGJpbmRpbmcgZOG7ryBsaeG7h3UgdHJ1eeG7gW4gbMOqbiB0csaw4bubYyB0cm9uZyBraGkgxJFhbmcgY2jhu50gbG9hZCBk4buvIGxp4buHdSB04burIHNlcnZlcgoKICAgICAgICAgICAgICAgIGlmIChfdHlwZW9mKHBhcmFtLmRhdGEpID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICBtZS5jdXJyZW50SXRlbSA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmFtLmRhdGEpOwogICAgICAgICAgICAgICAgfSAvL0fDoW4gZm9ybSBtb2RlCgoKICAgICAgICAgICAgICAgIG1lLnNldEZvcm1Nb2RlKG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5EdXBsaWNhdGUpOyAvL2zhuqV5IGThu68gbGnhu4d1CgogICAgICAgICAgICAgICAgX2NvbnRleHQ1Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmxvYWREYXRhKCJEdXBsaWNhdGUiLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIGRhdGEgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIC8vQ+G6rXAgbmjhuq10IGThu68gbGnhu4d1IHbDoG8gY3VycmVudEl0ZW0KICAgICAgICAgICAgICAgIG1lLmJpbmREYXRhKGRhdGEpOyAvL3Jlc2V0IHZhbGlkYXRlCgogICAgICAgICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgaWYgKG1lLmlzQXV0b0ZvY3VzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9mb2N1cyBmaXJzdCBjb250cm9sCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4uZm9jdXNGaXJzdENvbnRyb2xJbnB1dChtZS4kZWwpOwogICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG1lLnJlc2V0VmFsaWRhdGUoKTsgLy9D4bqtcCBuaOG6rXQgT2xkRGF0YSDEkeG7gyB0cmFjayBjaGFuZ2UKCiAgICAgICAgICAgICAgICAgIG1lLnNldE9sZERhdGFJdGVtKCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEfhu41pIGFwaSBsb2FkIGThu68gbGnhu4d1DQogICAgICovCiAgICBsb2FkRGF0YTogZnVuY3Rpb24gbG9hZERhdGEoYWN0aW9uLCBwYXJhbSkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICAgIHZhciBtZSwgcmVzdWx0LCBkZWZhdWx0RGF0YSwgcGFyYW1SZXF1ZXN0LCBsb2FkUGFyYW07CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM1OwogICAgICAgICAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAgICAgICAgICAgICAgIG1lLmxvYWRpbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAzOwogICAgICAgICAgICAgICAgLy944butIGzDvSBk4buvIGxp4buHdSB0cnV54buBbiBsw6puIMSR4buDIGtow7RuZyB0cnV54buBbiBn4buNaSBsw6puIHNlcnZlcgogICAgICAgICAgICAgICAgZGVmYXVsdERhdGEgPSBwYXJhbS5kYXRhIHx8IHt9OwogICAgICAgICAgICAgICAgcGFyYW1SZXF1ZXN0ID0gT2JqZWN0LmFzc2lnbih7fSwgcGFyYW0pOwogICAgICAgICAgICAgICAgZGVsZXRlIHBhcmFtUmVxdWVzdC5kYXRhOwoKICAgICAgICAgICAgICAgIGlmIChtZS5pc0xvY2FsTG9hZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb2FkUGFyYW0gPSBtZS5nZXRMb2FkRGF0YVBhcmFtZXRlcihhY3Rpb24sIHBhcmFtUmVxdWVzdCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQobWUubW9kdWxlLCAiL2dldCIpLCBsb2FkUGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQ2LnNlbnQ7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdCkgewogICAgICAgICAgICAgICAgICByZXN1bHQgPSBfb2JqZWN0U3ByZWFkKHt9LCBkZWZhdWx0RGF0YSk7CiAgICAgICAgICAgICAgICB9IC8veOG7rSBsw70gdHLGsOG7m2Mga2hpIHJlbmRlcgoKCiAgICAgICAgICAgICAgICBtZS5wcm9jZXNzTG9hZERhdGEocmVzdWx0LCBhY3Rpb24sIHBhcmFtKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMTk7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMTY7CiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSBfY29udGV4dDZbImNhdGNoIl0oMyk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKF9jb250ZXh0Ni50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDE5OwogICAgICAgICAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5maW5pc2goMTkpOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7CgogICAgICAgICAgICAgIGNhc2UgMjM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTYsIG51bGwsIFtbMywgMTYsIDE5LCAyMl1dKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZ2V0QXV0b0lEOiBmdW5jdGlvbiBnZXRBdXRvSUQoKSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoKSB7CiAgICAgICAgdmFyIHJlc3VsdCwgbWU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJlc3VsdCA9ICIiLCBtZSA9IF90aGlzNjsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5wcmV2ID0gMTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KG1lLm1vZHVsZSwgIi9nZXRBdXRvSUQiKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0Ny5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBfY29udGV4dDcucHJldiA9IDc7CiAgICAgICAgICAgICAgICBfY29udGV4dDcudDAgPSBfY29udGV4dDdbImNhdGNoIl0oMSk7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKF9jb250ZXh0Ny50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgcmVzdWx0KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNywgbnVsbCwgW1sxLCA3XV0pOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gZOG7ryBsaeG7h3UgY2xpZW50IHNhdSBraGkgbG9hZCB04burIHNlcnZlciB24buBIHRyxrDhu5tjIGtoaSBiaW5kaW5nDQogICAgICovCiAgICBwcm9jZXNzTG9hZERhdGE6IGZ1bmN0aW9uIHByb2Nlc3NMb2FkRGF0YShkYXRhLCBhY3Rpb24sIHBhcmFtKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7IC8veOG7rSBsw70gZOG7ryBsaeG7h3UgbeG7nyBy4buZbmcKCiAgICAgIG1lLm9yaWdpbkZpZWxkcyA9IFtdOwoKICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoIkV4dERhdGEiKSkgewogICAgICAgIC8vRGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyBk4buvIGxp4buHdSBn4buRYyBj4bunYSBk4buvIGxp4buHdQogICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkgewogICAgICAgICAgbWUub3JpZ2luRmllbGRzLnB1c2goaSk7CiAgICAgICAgfSAvL21hcCBk4buvIGxp4buHdSBt4bufIHLhu5luZwoKCiAgICAgICAgaWYgKGRhdGEuRXh0RGF0YSAmJiB0eXBlb2YgZGF0YS5FeHREYXRhID09PSAic3RyaW5nIikgewogICAgICAgICAgdmFyIGV4dERhdGEgPSBKU09OLnBhcnNlKGRhdGEuRXh0RGF0YSk7CgogICAgICAgICAgaWYgKGV4dERhdGEpIHsKICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLnByb2Nlc3NTZXJ2ZXJSZXNwb25zZURhdGEoZXh0RGF0YSk7CgogICAgICAgICAgICBmb3IgKHZhciBtIGluIGV4dERhdGEpIHsKICAgICAgICAgICAgICAvL2No4buJIG1hcCBjw6FjIHRyxrDhu51uZyBraMO0bmcgY8OzIHRyb25nIGThu68gbGnhu4d1IGfhu5FjCiAgICAgICAgICAgICAgaWYgKG1lLm9yaWdpbkZpZWxkcy5pbmRleE9mKG0pID09PSAtMSkgewogICAgICAgICAgICAgICAgZGF0YVttXSA9IGV4dERhdGFbbV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8veOG7rSBsw70gbeG6t2MgxJHhu4tuaCBxdWlja0FkZFRleHQgdsOgbyB0csaw4budbmcgdGV4dAoKCiAgICAgIGlmIChwYXJhbSAmJiBwYXJhbS5xdWlja0FkZFRleHQpIHsKICAgICAgICB2YXIgZmNmID0gbWUuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0uX2NvbmZpZy5maWVsZDsKCiAgICAgICAgaWYgKGZjZi5uYW1lICYmICFkYXRhW2ZjZi5uYW1lXSkgewogICAgICAgICAgZGF0YVtmY2YubmFtZV0gPSBwYXJhbS5xdWlja0FkZFRleHQ7CiAgICAgICAgfQogICAgICB9IC8vIE5ESFVZIDEzLjA5LjIwMjEgQ+G6rXAgbmjhuq10IGVudGl0eSBzdGF0ZSBjaG8gZW50aXR5CgoKICAgICAgZGF0YS5FbnRpdHlTdGF0ZSA9IG1lLmVudGl0eVN0YXRlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0aGFtIHPhu5EgbG9hZCBk4buvIGxp4buHdSBjaG8gZm9ybQ0KICAgICAqLwogICAgZ2V0TG9hZERhdGFQYXJhbWV0ZXI6IGZ1bmN0aW9uIGdldExvYWREYXRhUGFyYW1ldGVyKGFjdGlvbiwgcGFyYW0pIHsKICAgICAgdmFyIHJlc3VsdCA9IHsKICAgICAgICBhY3Rpb246IGFjdGlvbgogICAgICB9OwoKICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICBjYXNlICJFZGl0IjoKICAgICAgICBjYXNlICJWaWV3IjoKICAgICAgICBjYXNlICJEdXBsaWNhdGUiOgogICAgICAgICAgcmVzdWx0LmlkID0gcGFyYW0uaWQ7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBs4bqleSBnacOhIHRy4buLIGPhu6dhIGN1cnJlbnRJdGVtDQogICAgICogICovCiAgICBnZXRDdXJyZW50SXRlbTogZnVuY3Rpb24gZ2V0Q3VycmVudEl0ZW0oKSB7CiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRJdGVtOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGzhuqV5IGdpw6EgdHLhu4sgY8WpIGPhu6dhIGZvcm0NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDIyLjA2LjIyMDIwKQ0KICAgICAqLwogICAgZ2V0T2xkRGF0YUl0ZW06IGZ1bmN0aW9uIGdldE9sZERhdGFJdGVtKCkgewogICAgICByZXR1cm4gdGhpcy5vbGREYXRhSXRlbTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIHNldCBnacOhIHRy4buLIGNobyBvbGREYXRhIG3hurdjIMSR4buLbmggbMOgIGdpw6EgdHLhu4sgYmFuIMSR4bqndSBraGkgbeG7nyBmb3JtDQogICAgICogSMOgbSBuw6B5IMSRxrDhu6NjIGfhu41pIHRyb25nIGjDoG0gbeG7nyBmb3JtIHNob3dQb3B1cCgpDQogICAgICovCiAgICBzZXRPbGREYXRhSXRlbTogZnVuY3Rpb24gc2V0T2xkRGF0YUl0ZW0oKSB7CiAgICAgIHZhciBjdXJyZW50SXRlbSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdGhpcy5jdXJyZW50SXRlbTsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUub2xkRGF0YUl0ZW0gPSBfLmNsb25lRGVlcChjdXJyZW50SXRlbSk7CiAgICB9LAoKICAgIC8qDQogICAgICogSMOgbSByZXNldCBs4bqhaSBnacOhIHRy4buLDQogICAgICogcHZkdXkgMDIvMDcvMjAyMTogcGjhu6VjIHbhu6UgbeG7pWMgxJHDrWNoIGtoaSB0w61jaCBjaOG7qWMgbsSDbmcgeCB0csOqbiBjb250cm9sIG1zY29udHJvbCBmaWVsZA0KICAgICAqLwogICAgcmVzZXREYXRhOiBmdW5jdGlvbiByZXNldERhdGEoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBmb3IgKHZhciBmaWVsZCBpbiBtZS5jdXJyZW50SXRlbSkgewogICAgICAgIGlmIChtZS5jdXJyZW50SXRlbS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHsKICAgICAgICAgIG1lLmN1cnJlbnRJdGVtW2ZpZWxkXSA9IG1lLm9sZERhdGFJdGVtW2ZpZWxkXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gbWUuY3VycmVudEl0ZW07CgogICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eSgiRXh0RGF0YSIpKSB7CiAgICAgICAgLy9EYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIGThu68gbGnhu4d1IGfhu5FjIGPhu6dhIGThu68gbGnhu4d1CiAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgICBtZS5vcmlnaW5GaWVsZHMucHVzaChpKTsKICAgICAgICB9IC8vbWFwIGThu68gbGnhu4d1IG3hu58gcuG7mW5nCgoKICAgICAgICBpZiAoZGF0YS5FeHREYXRhICYmIHR5cGVvZiBkYXRhLkV4dERhdGEgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICB2YXIgZXh0RGF0YSA9IEpTT04ucGFyc2UoZGF0YS5FeHREYXRhKTsKCiAgICAgICAgICBpZiAoZXh0RGF0YSkgewogICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4ucHJvY2Vzc1NlcnZlclJlc3BvbnNlRGF0YShleHREYXRhKTsKCiAgICAgICAgICAgIGZvciAodmFyIG0gaW4gZXh0RGF0YSkgewogICAgICAgICAgICAgIC8vY2jhu4kgbWFwIGPDoWMgdHLGsOG7nW5nIGtow7RuZyBjw7MgdHJvbmcgZOG7ryBsaeG7h3UgZ+G7kWMKICAgICAgICAgICAgICBpZiAobWUub3JpZ2luRmllbGRzLmluZGV4T2YobSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBkYXRhW21dID0gZXh0RGF0YVttXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB44butIGzDvSBjw6FjIHPhu7Ega2nhu4duIGPhu6dhIGZvcm0NCiAgICAgKiBAY29tbWFuZCA6IGdpw6EgdHLhu4sgdMawxqFuZyDhu6luZyB24bubaSB04burbmcgYWN0aW9uIG5oxrAgOlNhdmUsQ2xvc2UsU2F2ZUFuZEFkZCwuLi4NCiAgICAgKi8KICAgIHRvb2xiYXJBY3Rpb246IGZ1bmN0aW9uIHRvb2xiYXJBY3Rpb24oY29tbWFuZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAiU2F2ZSI6CiAgICAgICAgICBtZS5zYXZlKHRoaXMuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiU2F2ZUFuZEFkZCI6CiAgICAgICAgICBtZS5zYXZlKHRoaXMuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZU5ldyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiQ2xvc2UiOgogICAgICAgICAgewogICAgICAgICAgICBtZS5jbG9zZSgpOwogICAgICAgICAgfQogICAgICB9IC8vbWUubG9nRGF0YUZpcmVCYXNlKCk7CgogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0aMO0bmcgdGluIGxvZyBmaXJlYmFzZQ0KICAgICAqIE5UVEhBTkgxDQogICAgICovCiAgICAvLyBsb2dEYXRhRmlyZUJhc2UoKSB7CiAgICAvLyAgICAgY29uc3QgbWUgPSB0aGlzOwogICAgLy8gICB0cnkgewogICAgLy8gICAgIGxldCBtZW51TmFtZUN1cnJlbnQgPSBudWxsOwogICAgLy8gICAgIGxldCBwYXJlbnQgPSBtZS4kcGFyZW50OwogICAgLy8gICAgIGlmKG1lLiRyb3V0ZXIgfHwgbWUuJCRyb3V0ZXIpIHsKICAgIC8vICAgICAgIG1lbnVOYW1lQ3VycmVudCA9IG1lLiRyb3V0ZT9tZS4kcm91dGUubmFtZTptZS4kJHJvdXRlLm5hbWU7CiAgICAvLyAgICAgfQogICAgLy8gICAgIGVsc2UgewogICAgLy8gICAgICAgaWYocGFyZW50ICYmIChwYXJlbnQuJHJvdXRlciB8fCBwYXJlbnQuJCRyb3V0ZXIpKSB7CiAgICAvLyAgICAgICAgIG1lbnVOYW1lQ3VycmVudCA9IHBhcmVudC4kcm91dGVyP3BhcmVudC4kcm91dGUubmFtZTpwYXJlbnQuJCRyb3V0ZS5uYW1lOwogICAgLy8gICAgICAgfQogICAgLy8gICAgIH0KICAgIC8vICAgICBpZihtZW51TmFtZUN1cnJlbnQpIHsKICAgIC8vICAgICAgIGNvbW1vbkZuLmxvZ0RhdGFGaXJlQmFzZVVwZGF0ZShtZW51TmFtZUN1cnJlbnQsIG1lLmNvbnRleHQpOwogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gICBjYXRjaChleCkgewogICAgLy8gICAgIGNvbnNvbGUubG9nKGV4KTsKICAgIC8vICAgfQogICAgLy8gfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBwaMOtbSB04bqvdA0KICAgICAqLwogICAgLy8gc2hvcnRrZXlBY3Rpb24oZSkgewogICAgLy8gICBsZXQgbWUgPSB0aGlzOwogICAgLy8gCXN3aXRjaCAoZS5zcmNLZXkpIHsKICAgIC8vIAkJY2FzZSAnU2F2ZSc6CiAgICAvLyAJCQltZS5zYXZlKHRoaXMuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZSk7CiAgICAvLyAgICAgICBicmVhazsKICAgIC8vICAgICBjYXNlICdTYXZlQW5kQWRkJzoKICAgIC8vICAgICAgIG1lLnNhdmUodGhpcy4kbXMuZW51bS5TYXZlTW9kZS5TYXZlTmV3KTsKICAgIC8vICAgICAgIGJyZWFrOwogICAgLy8gICAgIGNhc2UgJ1ByaW50JzoKICAgIC8vICAgICAgIG1lLnByaW50KCk7CiAgICAvLyAgICAgICBicmVhazsKICAgIC8vICAgICBkZWZhdWx0OgogICAgLy8gICAgICAgYnJlYWs7CiAgICAvLyAJfQogICAgLy8gfSwKICAgIC8vaW4KICAgIHByaW50OiBmdW5jdGlvbiBwcmludCgpIHt9LAoKICAgIC8qKg0KICAgICAqIHNldCBk4buvIGxp4buHdSBjaG8gY3VycmVudEl0ZW0NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDI1LjA2LjIwMjApDQogICAgICovCiAgICBzZXRDdXJyZW50SXRlbTogZnVuY3Rpb24gc2V0Q3VycmVudEl0ZW0oZGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5jdXJyZW50SXRlbSA9IGRhdGE7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gdmFsaWRhdGUNCiAgICAgKiBDaOG6oXkgcXVhIGjDoG0gdmFsaWRhdGUgY2hvIGNvbnRyb2wgdsOgIHZhbGlkYXRlIGNobyBuZ2hp4buHcCB24bulDQogICAgICogQHJldHVybiB0cuG6oyB24buBIHRydWUvZmFsc2UNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUICgyMi4wNi4yMDIwKQ0KICAgICAqLwogICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUudmFsaWRhdGVDb21wb25lbnRzKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHZhbGlkYXRlIEZpbGUNCiAgICAgKi8KICAgIHZhbGlkYXRlRmlsZTogZnVuY3Rpb24gdmFsaWRhdGVGaWxlKGZpbGVzKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgIG1lLmZpbGVUZW1wcyA9IFtdOwogICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgdmFyIGRhdGEgPSBmaWxlLm5hbWUuc3BsaXQoIi4iKTsgLy9O4bq/dSBraMO0bmcgY8OzIGV4dGVuc2lvbiAtPiBmYWlsCgogICAgICAgIGlmIChkYXRhLmxlbmd0aCA8IDIpIHsKICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dFcnJvcihtZS4kdCgiaTE4bkNvbXBvbmVudC5BdHRhY2htZW50LkZpbGVOYW1lSW52YWxpZCIpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBleHQgPSBkYXRhLmxhc3QoKS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAod2luZG93Ll9maWxlQ29uZmlnICYmICF3aW5kb3cuX2ZpbGVDb25maWcuVXBsb2FkQWxsb3dFeHRlbnNpb24uY29udGFpbnMoZXh0KSkgewogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0Vycm9yKG1lLiR0KCJpMThuQ29tcG9uZW50LkF0dGFjaG1lbnQuRmlsZUV4dGVuc2lvbkludmFsaWQiKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAod2luZG93Ll9maWxlQ29uZmlnICYmIGZpbGUuc2l6ZSA+IHdpbmRvdy5fZmlsZUNvbmZpZy5VcGxvYWRNYXhTaXplTUIgKiAxMDI0ICogMTAyNCkgewogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0Vycm9yKG1lLiR0KCJpMThuQ29tcG9uZW50LkF0dGFjaG1lbnQuRmlsZUxhcmdlcjVNQiIpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgbWUuZmlsZVRlbXBzLnB1c2goZmlsZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHZhbGlkOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIHZhbGlkYXRlIGPDoWMgY29udHJvbCBpbnB1dA0KICAgICAqIEjDoG0gbsOgeSBz4butIGThu6VuZyBjb21wb25lbnQgbXMtdmFsaWRhdGUNCiAgICAgKiDEkeG7gyBiYW8gbmdvw6BpIHbDuW5nIMSRxrDhu6NjIHZhbGlkYXRlDQogICAgICogQENow7ogw706cmVmIGPhu6dhIG1zLXZhbGlkYXRlIHBo4bqjaSBsw6AgdmFsaWRhdGVPYnNlcnZlcg0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQoMTguMDYuMjAyMCkNCiAgICAgKi8KICAgIHZhbGlkYXRlQ29tcG9uZW50czogZnVuY3Rpb24gdmFsaWRhdGVDb21wb25lbnRzKCkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL3JlZnMgY+G7p2EgbXMtdmFsaWRhdGUKCiAgICAgIGlmIChtZS4kcmVmcy52YWxpZGF0ZU9ic2VydmVyKSB7CiAgICAgICAgcmV0dXJuIG1lLiRyZWZzLnZhbGlkYXRlT2JzZXJ2ZXIudmFsaWRhdGUoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gZMO5bmcgxJHhu4MgZm9jdXMgdsOgbyDDtCBs4buXaSDEkeG6p3UgdGnDqm4NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDIyLjA2LjIwMjApDQogICAgICogTW9kaWZ5IGJ5IMSQVlRoaSAxOC8wMy8yMDIxOiBLaMO0bmcgdMOsbSDEkcaw4bujYyBjb250cm9sIGzhu5dpIHRow6wga2jDtG5nIGLhuq9uIGzhu5dpIFRBDQogICAgICogKi8KICAgIGZvY3VzRmlyc3RFcnJvcjogZnVuY3Rpb24gZm9jdXNGaXJzdEVycm9yKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLiRyZWZzLnZhbGlkYXRlT2JzZXJ2ZXIpIHsKICAgICAgICB2YXIgbGlzdEVycm9yID0gbWUuJHJlZnMudmFsaWRhdGVPYnNlcnZlci5nZXRMaXN0RXJyb3IoKTsKCiAgICAgICAgaWYgKGxpc3RFcnJvciAmJiBsaXN0RXJyb3IubGVuZ3RoID4gMCAmJiBsaXN0RXJyb3JbMF0uZWxlbWVudCkgewogICAgICAgICAgaWYgKHR5cGVvZiBsaXN0RXJyb3JbMF0uZWxlbWVudC5mb2N1c0VkaXRvciA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGxpc3RFcnJvclswXS5lbGVtZW50LmNlbGxTZWxlY3RlZCgpOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbGlzdEVycm9yWzBdLmVsZW1lbnQuZm9jdXMgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBsaXN0RXJyb3JbMF0uZWxlbWVudC5mb2N1cygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBD4bqtcCBuaOG6rXQgbOG6oWkgdHLhuqFuZyB0aMOhaSB2YWxpZGF0ZSB24buBIGJhbiDEkeG6p3UNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDIzLjA2LjIwMjApDQogICAgICovCiAgICByZXNldFZhbGlkYXRlOiBmdW5jdGlvbiByZXNldFZhbGlkYXRlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLiRyZWZzLnZhbGlkYXRlT2JzZXJ2ZXIpIHsKICAgICAgICBtZS4kcmVmcy52YWxpZGF0ZU9ic2VydmVyLnJlc2V0KCk7CiAgICAgIH0KICAgIH0sCiAgICAvL0jDoG0geOG7rSBsw70gc+G7sSBraeG7h24gbMawdSBmb3JtCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTguMDYuMjAyMCkKICAgIC8vUFZEVVkgMjcvMDIvMjAyMSA6IGzhuqV5IGThu68gbGnhu4d1IHRow6ptIGNobyBtb2RlIHZpZXcKICAgIHNhdmU6IGZ1bmN0aW9uIHNhdmUobW9kZSkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICAgIHZhciBtZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczc7CiAgICAgICAgICAgICAgICBtZS5sb2FkaW5nID0gdHJ1ZTsgLy8gdnZraWV0IC0gMTIuMDQuMjAyMTogVGjhu7FjIGhp4buHbiBjw6FjIGPDtG5nIHZp4buHYyB0csaw4bubYyBraGkgc2F2ZQoKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5iZWZvcmVTYXZlKCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmIChtZS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZU1vZGUgPSB0eXBlb2YgbW9kZSA9PT0gIm51bWJlciIgPyBtb2RlIDogbWUuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZTsgLy9O4bq/dSBlZGl0IGzDoCB1cGRhdGUsIG7hur91IGFkZCBob+G6t2MgZHVwbGljYXRlIGzDoCBpbnNlcnQKCiAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gbWUuZWRpdE1vZGUgPT09IG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0IHx8IG1lLmVkaXRNb2RlID09PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuVmlldyA/ICJ1cGRhdGUiIDogImluc2VydCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5ID0gbWUuZ2V0U2F2ZURhdGEoc2F2ZU1vZGUsIG1lLmVudGl0eVN0YXRlIHx8IG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuSW5zZXJ0KTsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlUGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGU6IHNhdmVNb2RlLAogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHk6IGVudGl0eSwKICAgICAgICAgICAgICAgICAgICAgICAgQnlQYXNzVmFsaWRhdGU6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9OyAvL3ZhbGlkYXRlIGFuZCBzdWJtaXQKCiAgICAgICAgICAgICAgICAgICAgICBtZS5zdWJtaXRBY3Rpb24oc2F2ZVBhcmFtLCBhY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBtZS5mb2N1c0ZpcnN0RXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICAgIG1lLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgICAgICBtZS5sb2FkaW5nID0gZmFsc2U7IC8vIH0gZmluYWxseXsKICAgICAgICAgICAgICAgICAgICAvLyAgVE9ETyBibmR1YzogYuG7jyBjaOG7lyBuw6B5IMSRaSB2w6wgbuG6v3UgZXhjZXB0aW9uIHRow6wgxJHDoyBn4buNaSB04bqvdCBjw7JuIHN1Y2Nlc3MgdGjDrCB0cm9uZyBow6BtIHN1Ym1pdEFjdGlvbiBz4bq9IHThuq90IGPhu50gbG9hZGluZwogICAgICAgICAgICAgICAgICAgIC8vICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB3aW5kb3cuX2FwcENvbmZpZy5zYXZlVGltZW91dCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBH4buNaSB2YWxpZGF0ZSBjbGllbnQgdsOgIHN1Ym1pdCBk4buvIGxp4buHdSBsw6puIHNlcnZlcg0KICAgICAqIMSQVlRoaSArQk7EkOG7qWM6IDAzLzA2LzIwMjEgdMOhY2ggcmEgcGjhu6VjIHbhu6UgZ+G7jWkgbOG6oWkgY2hvIGx14buTbmcgaOG7j2kgbmfGsOG7nWkgZMO5bmcga2hpIG5o4bqlbiBzYXZlDQogICAgICovCiAgICBzdWJtaXRBY3Rpb246IGZ1bmN0aW9uIHN1Ym1pdEFjdGlvbihzYXZlUGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgdmFsaWRhdGVSZXN1bHQgPSBtZS52YWxpZGF0ZUJ1c2luZXNzKHNhdmVQYXJhbSwgYWN0aW9uKTsKCiAgICAgIGlmICh2YWxpZGF0ZVJlc3VsdCkgewogICAgICAgIGlmIChtZS5jaGVja0VkaXRQYXJhbSgpKSB7CiAgICAgICAgICAvLyBH4buNaSDEkeG6v24gdXBkYXRlIHRyxrDhu51uZyBj4bunYSBi4bqjbmcgVXNhZ2VIaXN0b3J5CiAgICAgICAgICBtZS5zdWJtaXRFZGl0Rm9ybShzYXZlUGFyYW0sIGFjdGlvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vc3VibWl0IHNlcnZlcgogICAgICAgICAgbWUuc3VibWl0KHNhdmVQYXJhbSwgYWN0aW9uKTsKICAgICAgICB9IC8vTG9nIGZpcmViYXNlCiAgICAgICAgLy8gbWUubG9nRGF0YUZpcmVCYXNlKCk7CgogICAgICB9IGVsc2UgewogICAgICAgIG1lLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBD4bqldCBrIHZhbGlkYXRlDQogICAgICogTk5MQU0NCiAgICAgKi8KICAgIHNhdmVOb3RWYWxpZGF0ZTogZnVuY3Rpb24gc2F2ZU5vdFZhbGlkYXRlKG1vZGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHNhdmVNb2RlID0gdHlwZW9mIG1vZGUgPT09ICJudW1iZXIiID8gbW9kZSA6IG1lLiRtcy5lbnVtLlNhdmVNb2RlLlNhdmU7IC8vTuG6v3UgZWRpdCBsw6AgdXBkYXRlLCBu4bq/dSBhZGQgaG/hurdjIGR1cGxpY2F0ZSBsw6AgaW5zZXJ0CgogICAgICB2YXIgYWN0aW9uID0gbWUuZWRpdE1vZGUgPT09IG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0IHx8IG1lLmVkaXRNb2RlID09PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuVmlldyA/ICJ1cGRhdGUiIDogImluc2VydCIsCiAgICAgICAgICBlbnRpdHkgPSBtZS5nZXRTYXZlRGF0YShzYXZlTW9kZSwgbWUuZW50aXR5U3RhdGUgfHwgbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5JbnNlcnQpOwogICAgICB2YXIgc2F2ZVBhcmFtID0gewogICAgICAgIE1vZGU6IHNhdmVNb2RlLAogICAgICAgIEVudGl0eTogZW50aXR5LAogICAgICAgIEJ5UGFzc1ZhbGlkYXRlOiBbXQogICAgICB9OwoKICAgICAgaWYgKG1lLmNoZWNrRWRpdFBhcmFtKCkpIHsKICAgICAgICAvLyBH4buNaSDEkeG6v24gdXBkYXRlIHRyxrDhu51uZyBj4bunYSBi4bqjbmcgVXNhZ2VIaXN0b3J5CiAgICAgICAgbWUuc3VibWl0RWRpdEZvcm0oc2F2ZVBhcmFtLCBhY3Rpb24pOwogICAgICB9IGVsc2UgewogICAgICAgIG1lLnN1Ym1pdChzYXZlUGFyYW0sIGFjdGlvbik7CiAgICAgIH0KCiAgICAgIG1lLmhpZGUoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRlDQogICAgICovCiAgICBjaGVja0VkaXRQYXJhbTogZnVuY3Rpb24gY2hlY2tFZGl0UGFyYW0oKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBtZS5pc1VwZGF0ZU5vdGU7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGtoaSBj4bqldCBs4buXaQ0KICAgICAqICovCiAgICBwcm9jZXNzU3VibWl0RXJyb3I6IGZ1bmN0aW9uIHByb2Nlc3NTdWJtaXRFcnJvcihzYXZlUmVzdWx0LCBwYXJhbSwgYWN0aW9uKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBzd2l0Y2ggKHNhdmVSZXN1bHQuQ29kZSkgewogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uU2VydmljZVJlc3BvbnNlQ29kZS5JbnZhbGlkRGF0YToKICAgICAgICAgIHZhciBlcnJvcnMgPSBzYXZlUmVzdWx0LkRhdGEsCiAgICAgICAgICAgICAgYWxlcnQgPSBmYWxzZSwKICAgICAgICAgICAgICB1bmNvbmZpcm0gPSBmYWxzZSwKICAgICAgICAgICAgICBzaG93RXJyb3IgPSBmdW5jdGlvbiBzaG93RXJyb3IoaW5kZXgpIHsKICAgICAgICAgICAgaWYgKGluZGV4ID09PSBlcnJvcnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgaWYgKCFhbGVydCAmJiAhdW5jb25maXJtKSB7CiAgICAgICAgICAgICAgICAvL27hur91IG5nxrDhu51pIGTDuW5nIHjDoWMgbmjhuq1uIHRvw6BuIGLhu5kgY29uZmlybSB0aMOsIHPhur0gc3VibWl0IGzhuqFpCiAgICAgICAgICAgICAgICBtZS5zdWJtaXQocGFyYW0sIGFjdGlvbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBlciA9IGVycm9yc1tpbmRleF07CgogICAgICAgICAgICBpZiAoIWVyLk1lc3NhZ2UgJiYgZXIuQ29kZSkgewogICAgICAgICAgICAgIGVyLk1lc3NhZ2UgPSBtZS5nZXRWYWxpZGF0ZU1lc3NhZ2UoZXIuQ29kZSwgZXIuRGF0YSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN3aXRjaCAoZXIuVHlwZSkgewogICAgICAgICAgICAgIGNhc2UgbWUuJG1zLmVudW0uVmFsaWRhdGVSZXN1bHRUeXBlLkluZm86CiAgICAgICAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dJbmZvKGVyLk1lc3NhZ2UpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBzaG93RXJyb3IoaW5kZXggKyAxKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgbWUuJG1zLmVudW0uVmFsaWRhdGVSZXN1bHRUeXBlLldhcm5pbmc6CiAgICAgICAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dRdWVzdGlvbih7CiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGVyLk1lc3NhZ2UKICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICAgICAgICAgICAgICBpZiAoYW5zd2VyID09PSAiWWVzIikgewogICAgICAgICAgICAgICAgICAgIHBhcmFtLkJ5UGFzc1ZhbGlkYXRlID0gcGFyYW0uQnlQYXNzVmFsaWRhdGUgfHwgW107CiAgICAgICAgICAgICAgICAgICAgcGFyYW0uQnlQYXNzVmFsaWRhdGUucHVzaChlci5Db2RlKTsgLy8gdnZraWV0IC0gMjQuMDguMjAyMTogQuG7lSBzdW5nIGjDoG0gxJHhu4MgY3VzdG9tIGzhuqFpIHBhcmFtCgogICAgICAgICAgICAgICAgICAgIG1lLmN1c3RvbVBhcmFtQnlQYXNzVmFsaWRhdGUocGFyYW0sIGVyLkRhdGEpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yKGluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdW5jb25maXJtID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBhbGVydCA9IHRydWU7CiAgICAgICAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dFcnJvcihlci5NZXNzYWdlKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yKGluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9OyAvL1Phuq9wIHjhur9wIMSR4buDIGNvbmZpcm0gY3Xhu5FpIGPDuW5nCiAgICAgICAgICAvL8SQVlRoaSAwOS8wMy8yMDIxCiAgICAgICAgICAvL3Phu61hIGzhu5dpIFRBIGtow7RuZyBz4bqvcCB44bq/cCDEkcaw4bujYyBkbyB0cnV54buBbiBzYWkga2nhu4N1IGPhu6dhIHRoYW0gc+G7kSBjaG8gaMOgbSBz4bqvcCB44bq/cAogICAgICAgICAgLy8gZXJyb3JzID0gZXJyb3JzLnNvcnRPYmplY3QoWyJUeXBlIl0pOwogICAgICAgICAgLy9IaeG7g24gdGjhu4sgdGjDtG5nIGLDoW8KCgogICAgICAgICAgc2hvd0Vycm9yKDApOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uU2VydmljZVJlc3BvbnNlQ29kZS5FeGNlcHRpb246CiAgICAgICAgICBpZiAoc2F2ZVJlc3VsdC5TeXN0ZW1NZXNzYWdlKSB7CiAgICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0Vycm9yKHNhdmVSZXN1bHQuU3lzdGVtTWVzc2FnZSk7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy/EkFZUaGkgMTkvMDMvMjAyMTogVGjDtG5nIGLDoW8gbOG7l2kgdsaw4bujdCBxdcOhIHPhu5EgbMaw4bujbmcgdOG7k24KCiAgICAgICAgY2FzZSBtZS4kbXMuZW51bS5TZXJ2aWNlUmVzcG9uc2VDb2RlLk92ZXJRdWFudGl0eToKICAgICAgICAgIHZhciBzdHJFcnJvck92ZXJRdWFudGl0eSA9IG1lLmdldFZhbGlkYXRlTWVzc2FnZShzYXZlUmVzdWx0LlN5c3RlbU1lc3NhZ2UpOwogICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93RXJyb3Ioc3RyRXJyb3JPdmVyUXVhbnRpdHkpOwogICAgICAgICAgbWUucHJvY2Vzc01hcmtDb250cm9sRm9yT3ZlclF1YW50aXR5RXJyb3Ioc2F2ZVJlc3VsdC5TdWJDb2RlKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHNhdmVSZXN1bHQuTWVzc2FnZSkgewogICAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dFcnJvcihzYXZlUmVzdWx0Lk1lc3NhZ2UpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWUuc2hvd0N1c3RvbUVycm9yKHNhdmVSZXN1bHQpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIMSQVlRoaSAxOS8wMy8yMDIxDQogICAgICogU2F1IGtoaSB2xrDhu6N0IHF1YSBz4buRIGzGsOG7o25nIHThu5NuIHRow6wgY2hvIHBow6lwIGRldiB0w7l5IGJp4bq/biBmb2N1cyB2w6BvIGPDoWMgY+G7mXQgc+G7mSBsxrDhu6NuZyBi4buLIGzhu5dpDQogICAgICovCiAgICBwcm9jZXNzTWFya0NvbnRyb2xGb3JPdmVyUXVhbnRpdHlFcnJvcjogZnVuY3Rpb24gcHJvY2Vzc01hcmtDb250cm9sRm9yT3ZlclF1YW50aXR5RXJyb3IoZXJyb3JEZXRhaWwpIHt9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IG7hu5lpIGR1bmcgdGjDtG5nIGLDoW8gdGhlbyBtw6MgdmFsaWRhdGUNCiAgICAgKiBOTVRVQU4zIDI4LzEwLzIwMjENCiAgICAgKi8KICAgIGdldFZhbGlkYXRlTWVzc2FnZTogZnVuY3Rpb24gZ2V0VmFsaWRhdGVNZXNzYWdlKHZhbGlkYXRlQ29kZSwgZGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgbXNnID0gdmFsaWRhdGVDb2RlOwogICAgICB2YXIgdGl0bGVOYW1lID0gbWUuZ2V0Rm9ybVRpdGxlKG1lLmVkaXRNb2RlKTsKICAgICAgdmFyIGZpZWxkID0gbWUuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0uX2NvbmZpZy5maWVsZDsKCiAgICAgIHN3aXRjaCAodmFsaWRhdGVDb2RlKSB7CiAgICAgICAgY2FzZSAiRHVwbGljYXRlIjoKICAgICAgICAgIHZhciBjb2RlRHVwbGljYXRlID0gbWUuY3VycmVudEl0ZW1bZmllbGQudW5pcXVlXSB8fCBtZS5jdXJyZW50SXRlbVtmaWVsZC5jb2RlXSB8fCBtZS5jdXJyZW50SXRlbVtmaWVsZC5uYW1lXTsKICAgICAgICAgIHZhciBtb2R1bGVOYW1lID0gbWUuJHQoImkxOG5Db21tb24ubW9kdWxlLiIgKyBtZS5tb2R1bGUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICBtc2cgPSB0aGlzLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuIiArIHZhbGlkYXRlQ29kZSkuZm9ybWF0KG1vZHVsZU5hbWUudG9Mb3dlckNhc2UoKSwgY29kZUR1cGxpY2F0ZSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiT3ZlclF1YW50aXR5IjoKICAgICAgICAgIG1zZyA9IHRoaXMuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS4iICsgdmFsaWRhdGVDb2RlKS5mb3JtYXQodGl0bGVOYW1lKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vxJBWVGhpIDE5LzAzLzIwMjEgY2h1eeG7g24gduG7gSBkZWZhdWx0IMSR4buDIMSRxrDhu6NjIG5oaeG7gXUgdHLGsOG7nW5nIGjhu6NwIHbDrSBk4bulICBPdmVyUXVhbnRpdHkKCiAgICAgICAgY2FzZSAiUmVmTm9EdXBsaWNhdGUiOgogICAgICAgICAgbXNnID0gdGhpcy4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLlJlZk5vRHVwbGljYXRlIikuZm9ybWF0KG1lLmN1c3RvbVJlZk5vRHVwbGljYXRlKGRhdGEpIHx8IG1lLmN1cnJlbnRJdGVtLlByb2Nlc3NObyB8fCBtZS5jdXJyZW50SXRlbS5SZWZObyB8fCBtZS5jdXJyZW50SXRlbS5UcmFuc2Zlck5vKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgbXNnID0gdGhpcy4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLiIgKyB2YWxpZGF0ZUNvZGUpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHJldHVybiBtc2c7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IG5o4buvbmcgbOG7l2kga2jDoWMNCiAgICAgKi8KICAgIHNob3dDdXN0b21FcnJvcjogZnVuY3Rpb24gc2hvd0N1c3RvbUVycm9yKHJlc3VsdCkge30sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gY+G6pXQgdHLGsOG7nW5nIGThu68gbGnhu4d1DQogICAgICovCiAgICBzdWJtaXRFZGl0Rm9ybTogZnVuY3Rpb24gc3VibWl0RWRpdEZvcm0ocGFyYW0pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGFjdGlvbiA9ICJ1cGRhdGVGaWVsZCI7CiAgICAgIHZhciBtb2R1bGUgPSAidXNhZ2VIaXN0b3J5IjsKICAgICAgbWUucHJlcGFyZVN1Ym1pdFBhcmFtKHBhcmFtKTsgLy8gTuG6v3UgdOG7qyDEkWnhu4F1IGNodXnhu4NuIHbDoCDEkWnhu4F1IGNodXnhu4NuIG5oaeG7gXUgdGjDrCBn4buNaSBzYW5nIG1vZHVsZSBj4bunYSB0cmFuc2ZlciDEkeG7gyDEkcaw4bujYyBj4bqtcCBuaOG6rXQgaXRlbQoKICAgICAgaWYgKG1lLm1vZHVsZSA9PSAidHJhbnNmZXIiICYmIHBhcmFtLk9sZEVudGl0eSkgewogICAgICAgIG1vZHVsZSA9IG1lLm1vZHVsZTsKICAgICAgfSAvL3Nob3cgbWFzawoKCiAgICAgIG1lLmxvYWRpbmcgPSB0cnVlOwogICAgICBtZS4kc3RvcmUuZGlzcGF0Y2goW21vZHVsZSwgYWN0aW9uXS5qb2luKCIvIiksIHBhcmFtKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5TdWNjZXNzKSB7CiAgICAgICAgICAvL3jhu60gbMO9IHNhdSBraGkgY+G6pXQKICAgICAgICAgIG1lLmFmdGVyU3VibWl0KHJlc3VsdCwgcGFyYW0sIGFjdGlvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLnByb2Nlc3NTdWJtaXRFcnJvcihyZXN1bHQsIHBhcmFtLCBhY3Rpb24pOwogICAgICAgIH0KICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRhYmxlDQogICAgICovCiAgICBwcmVwYXJlU3VibWl0UGFyYW06IGZ1bmN0aW9uIHByZXBhcmVTdWJtaXRQYXJhbShwYXJhbSkge30sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gY+G6pXQgZOG7ryBsaeG7h3UNCiAgICAgKiBDcmVhdGVkQnk6IFBES0lFTiAyNy8wNy8yMDE5DQogICAgICovCiAgICBzdWJtaXQ6IGZ1bmN0aW9uIHN1Ym1pdChwYXJhbSwgYWN0aW9uKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7IC8vc2hvdyBtYXNrCgogICAgICBtZS5sb2FkaW5nID0gdHJ1ZTsKICAgICAgbWUuJHN0b3JlLmRpc3BhdGNoKFttZS5tb2R1bGUsIGFjdGlvbl0uam9pbigiLyIpLCBwYXJhbSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuU3VjY2VzcykgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWUuaW5zZXJ0QXVkaXRpbmdMb2cocmVzdWx0LCBwYXJhbSwgYWN0aW9uKTsKICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICAgIH0gLy944butIGzDvSBzYXUga2hpIGPhuqV0CgoKICAgICAgICAgIG1lLmFmdGVyU3VibWl0KHJlc3VsdCwgcGFyYW0sIGFjdGlvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLnByb2Nlc3NTdWJtaXRFcnJvcihyZXN1bHQsIHBhcmFtLCBhY3Rpb24pOwogICAgICAgIH0KICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogdGhhbSBjaGnhur91IG5o4bqtdCBrw70gKGzGsHUgZOG6oW5nIGpzb24gOiB7a2V5OiBrZXksIGNvZGU6IGNvZGUsIG5hbWU6IG5hbWV9KQ0KICAgICAqIGtleToga2jDs2EgY2jDrW5oIGPhu6dhIGLhuqNuZyBtb2R1bGUsIGTDuW5nIMSR4buDIGRyaWxkb3duIGtoaSBjbGljayB2w6BvDQogICAgICogY29kZSwgbmFtZTogbcOjLCB0w6puIMSR4buDIGhp4buDdSB0aOG7iyDhu58gY+G7mXQgdGhhbSBjaGnhur91IGtoaSB4ZW0gbG9nOiB2w60gZOG7pTogUXXhuqF0IMSRaeG7h24gKFFEMDAwMDEpDQogICAgICogQG92ZXJyaWRlDQogICAgICovCiAgICBidWlsZFJlZmVyZW5jZTogZnVuY3Rpb24gYnVpbGRSZWZlcmVuY2UoKSB7CiAgICAgIHZhciBfbWUkZ2V0RmllbGQ7CgogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZmllbGQgPSAoX21lJGdldEZpZWxkID0gbWUuZ2V0RmllbGQoKSkgIT09IG51bGwgJiYgX21lJGdldEZpZWxkICE9PSB2b2lkIDAgPyBfbWUkZ2V0RmllbGQgOiB0aGlzLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICBpZiAoZmllbGQpIHsKICAgICAgICByZXR1cm4gTVNKc29uLnNlcmlhbGl6ZSh7CiAgICAgICAgICBrZXk6IG1lLmN1cnJlbnRJdGVtW2ZpZWxkLmtleV0sCiAgICAgICAgICBjb2RlOiBtZS5jdXJyZW50SXRlbVtmaWVsZC5jb2RlXSwKICAgICAgICAgIG5hbWU6IG1lLmN1cnJlbnRJdGVtW2ZpZWxkLm5hbWVdCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogY3VzdG9tIFNpbmggbcO0IHThuqMgY+G7p2Egbmjhuq10IGvDvQ0KICAgICAqIENyZWF0ZWRCeTogbm5sYW0gMjQvMDMvMjAyMQ0KICAgICAqLwogICAgY3VzdG9tRGVzY3JpcHRpb25BdWRpdGluZ0xvZzogZnVuY3Rpb24gY3VzdG9tRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhlbnRpdHksIG9sZEVudGl0eSwgYWN0aW9uLCBpc0RldGFpbCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogU2luaCBtw7QgdOG6oyBj4bunYSBuaOG6rXQga8O9DQogICAgICogQ3JlYXRlZEJ5OiBubmxhbSAyNC8wMy8yMDIxDQogICAgICovCiAgICBnZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2c6IGZ1bmN0aW9uIGdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhlbnRpdHksIG9sZEVudGl0eSwgYWN0aW9uLCBpc0RldGFpbCkgewogICAgICB2YXIgX21lJGdldEZpZWxkMjsKCiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBvYmpEZXNjcmlwdGlvbiA9IHt9OwogICAgICB2YXIgZmllbGQgPSAoX21lJGdldEZpZWxkMiA9IG1lLmdldEZpZWxkKCkpICE9PSBudWxsICYmIF9tZSRnZXRGaWVsZDIgIT09IHZvaWQgMCA/IF9tZSRnZXRGaWVsZDIgOiB0aGlzLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICBpZiAoaXNEZXRhaWwpIHsKICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKGVudGl0eSk7IF9pIDwgX09iamVjdCRrZXlzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgdmFyIGkgPSBfT2JqZWN0JGtleXNbX2ldOwoKICAgICAgICAgIGlmIChlbnRpdHlbaV0gIT0gb2xkRW50aXR5W2ldKSB7CiAgICAgICAgICAgIHZhciBzd2l0Y2hDYXAgPSBtZS5zd2l0Y2hDYXB0aW9uLmRldGFpbFtpXTsKCiAgICAgICAgICAgIGlmIChzd2l0Y2hDYXApIHsKICAgICAgICAgICAgICBvYmpEZXNjcmlwdGlvbltpXSA9IHsKICAgICAgICAgICAgICAgIG9sZFZhbHVlOiBvbGRFbnRpdHlbaV0sCiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogZW50aXR5W2ldLAogICAgICAgICAgICAgICAgc3dpdGNoQ2FwdGlvbjogc3dpdGNoQ2FwCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBvYmpEZXNjcmlwdGlvbltpXSA9IHsKICAgICAgICAgICAgICAgIG9sZFZhbHVlOiBvbGRFbnRpdHlbaV0sCiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogZW50aXR5W2ldCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzd2l0Y2ggKGFjdGlvbikgewogICAgICAgICAgY2FzZSBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkluc2VydDoKICAgICAgICAgIGNhc2UgbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5EdXBsaWNhdGU6CiAgICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuRGVsZXRlOgogICAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5jb2RlXSA9IG1lLmN1cnJlbnRJdGVtW2ZpZWxkLmNvZGVdOyAvL3tuZXdWYWx1ZTptZS5jdXJyZW50SXRlbVtmaWVsZC5jb2RlXSwgc3dpdGNoQ2FwdGlvbjogbWUuc3dpdGNoQ2FwdGlvbi5tYXN0ZXJbZmllbGQuY29kZV19OwoKICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25bZmllbGQubmFtZV0gPSBtZS5jdXJyZW50SXRlbVtmaWVsZC5uYW1lXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLm5hbWVdfTsKCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5VcGRhdGU6CiAgICAgICAgICBjYXNlICJ1cGRhdGUiOgogICAgICAgICAgICBtZS5idWlsZERlc2NyaXB0aW9uTG9nKGVudGl0eSwgb2xkRW50aXR5LCBvYmpEZXNjcmlwdGlvbik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9iakRlc2NyaXB0aW9uOwogICAgfSwKICAgIGdldEZpZWxkOiBmdW5jdGlvbiBnZXRGaWVsZCgpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAogICAgYnVpbGREZXNjcmlwdGlvbkxvZzogZnVuY3Rpb24gYnVpbGREZXNjcmlwdGlvbkxvZyhuZXdFbnRpdHksIG9sZEVudGl0eSwgb2JqRGVzY3JpcHRpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgb2JqRGVzY3JpcHRpb24gPSBvYmpEZXNjcmlwdGlvbiA/IG9iakRlc2NyaXB0aW9uIDoge307CgogICAgICBmb3IgKHZhciBfaTIgPSAwLCBfT2JqZWN0JGtleXMyID0gT2JqZWN0LmtleXMobmV3RW50aXR5KTsgX2kyIDwgX09iamVjdCRrZXlzMi5sZW5ndGg7IF9pMisrKSB7CiAgICAgICAgdmFyIGogPSBfT2JqZWN0JGtleXMyW19pMl07CgogICAgICAgIGlmIChqICE9ICJFeHREYXRhIikgewogICAgICAgICAgdmFyIHZhbHVlT2xkRW50aXR5ID0gb2xkRW50aXR5W2pdLAogICAgICAgICAgICAgIHZhbHVlTmV3RW50aXR5ID0gbmV3RW50aXR5W2pdOyAvLyBO4bq/dSBsw6AgbmfDoHkgdGjDoW5nIHRow6wgZm9ybWF0IGzhuqFpCgogICAgICAgICAgdmFyIGZpZWxkRm9ybWF0RGF0ZUluZGV4ID0gbWUuZmllbGRGb3JtYXREYXRlKCkuZmluZEluZGV4KGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gZmllbGQgPT0gajsKICAgICAgICAgIH0pLAogICAgICAgICAgICAgIHJlbW92ZUF1ZGl0TG9nQnlGaWVsZEluZGV4ID0gbWUucmVtb3ZlQXVkaXRMb2dCeUZpZWxkKCkuZmluZEluZGV4KGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICByZXR1cm4gZmllbGQgPT0gajsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChqLmNvbnRhaW5zKCJEYXRlIikgfHwgZmllbGRGb3JtYXREYXRlSW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgdmFsdWVPbGRFbnRpdHkgPSBtb21lbnQodmFsdWVPbGRFbnRpdHkpLmZvcm1hdCgiREQvTU0vWVlZWSIpOwogICAgICAgICAgICB2YWx1ZU5ld0VudGl0eSA9IG1vbWVudCh2YWx1ZU5ld0VudGl0eSkuZm9ybWF0KCJERC9NTS9ZWVlZIik7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKCh2YWx1ZU9sZEVudGl0eSB8fCB2YWx1ZU5ld0VudGl0eSkgJiYgdmFsdWVPbGRFbnRpdHkgIT0gdmFsdWVOZXdFbnRpdHkgJiYgcmVtb3ZlQXVkaXRMb2dCeUZpZWxkSW5kZXggPT0gLTEpIHsKICAgICAgICAgICAgdmFyIHN3aXRjaENhcCA9IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2pdOwogICAgICAgICAgICB2YXIgZW51bU5hbWUgPSBtZS5lbnVtcyA/IG1lLmVudW1zLm1hc3RlcltqXSA6IG51bGw7CgogICAgICAgICAgICBpZiAoc3dpdGNoQ2FwKSB7CiAgICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25bal0gPSB7CiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogdmFsdWVPbGRFbnRpdHksCiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogdmFsdWVOZXdFbnRpdHksCiAgICAgICAgICAgICAgICBzd2l0Y2hDYXB0aW9uOiBzd2l0Y2hDYXAsCiAgICAgICAgICAgICAgICBlbnVtOiBlbnVtTmFtZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25bal0gPSB7CiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogdmFsdWVPbGRFbnRpdHksCiAgICAgICAgICAgICAgICBuZXdWYWx1ZTogdmFsdWVOZXdFbnRpdHksCiAgICAgICAgICAgICAgICBlbnVtOiBlbnVtTmFtZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGV4dE9iak5ldyA9IEpTT04ucGFyc2UobmV3RW50aXR5W2pdKTsKICAgICAgICAgIHZhciBleHRPYmpPbGQgPSBKU09OLnBhcnNlKG9sZEVudGl0eVtqXSk7CiAgICAgICAgICBtZS5idWlsZERlc2NyaXB0aW9uTG9nKGV4dE9iak5ldywgZXh0T2JqT2xkKTsKICAgICAgICB9CgogICAgICAgIG1lLmN1c3RvbUF1ZGl0aW5nTG9nQnlGaWVsZChuZXdFbnRpdHksIG9sZEVudGl0eSwgb2JqRGVzY3JpcHRpb24sIGopOwogICAgICB9CgogICAgICByZXR1cm4gb2JqRGVzY3JpcHRpb247CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMjUuMDYuMjAyMQ0KICAgICAqIFRow6ptIGjDoG0gY3VzdG9tIGxvZyB0aGVvIGZpZWxkDQogICAgICovCiAgICBjdXN0b21BdWRpdGluZ0xvZ0J5RmllbGQ6IGZ1bmN0aW9uIGN1c3RvbUF1ZGl0aW5nTG9nQnlGaWVsZChuZXdFbnRpdHksIG9sZEVudGl0eSwgb2JqRGVzY3JpcHRpb24sIGtleSkge30sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRlIEPDoWMgdHLGsOG7nW5nIHPhur0ga2jDtG5nIGdoaSBsb2cNCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgcmVtb3ZlQXVkaXRMb2dCeUZpZWxkOiBmdW5jdGlvbiByZW1vdmVBdWRpdExvZ0J5RmllbGQoKSB7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRlIEPDoWMgdHLGsOG7nW5nIHPhur0gZm9ybWF0IHRoZW8gbmfDoHkgdGjDoW5nDQogICAgICogQHJldHVybnMNCiAgICAgKi8KICAgIGZpZWxkRm9ybWF0RGF0ZTogZnVuY3Rpb24gZmllbGRGb3JtYXREYXRlKCkgewogICAgICByZXR1cm4gW107CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEdldCB0aMO0bmcgdGluIGV4dCAoIGPDoWMgdHLGsOG7nW5nIGLhu5Ugc3VuZykNCiAgICAgKiBDcmVhdGVkQnk6IG5ubGFtIDI0LzAzLzIwMjENCiAgICAgKi8KICAgIGdldEV4dERhdGFBdWRpdGluZ0xvZzogZnVuY3Rpb24gZ2V0RXh0RGF0YUF1ZGl0aW5nTG9nKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gbOG7l2kga2hpIGPhuqV0IGRhbmggbeG7pWMNCiAgICAgKiBDcmVhdGVkQnk6IFBES0lFTiAyNC8wNy8yMDE5DQogICAgICovCiAgICBoYW5kbGVTdWJtaXRFcnJvcjogZnVuY3Rpb24gaGFuZGxlU3VibWl0RXJyb3IoZXJyKSB7CiAgICAgIHZhciBtc2cgPSB0aGlzLmdldEVycm9yTWVzc2FnZShlcnIpOyAvLyB0aGlzLnNlcnZlckVycm9yTGlzdC5wdXNoKG1zZyk7CgogICAgICBpZiAobXNnKSB7CiAgICAgICAgdGhpcy4kbXMuY29tbW9uRm4udG9hc3QoewogICAgICAgICAgdHlwZTogImVycm9yIiwKICAgICAgICAgIHRleHQ6IG1zZywKICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IgogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLmFmdGVyU3VibWl0RXJyb3IoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogR2V0IGzhu5dpIGtoaSBj4bqldCBkYW5oIG3hu6VjDQogICAgICogQ3JlYXRlZEJ5OiBOQ1RoYW5oMSAyNC8wNy8yMDE5DQogICAgICogTW9kaWZpZWQgQnk6IHB2ZHVvbmcxIC0gMTIvMTEvMjAxOQ0KICAgICAqIE1vZGlmaWVkIERlc2NyaXRpb246IFRoYXkgxJHhu5VpIG7hu5lpIGR1bmcgbWVzYWdlIHRy4bqjIHbhu4ENCiAgICAgKi8KICAgIGdldEVycm9yTWVzc2FnZTogZnVuY3Rpb24gZ2V0RXJyb3JNZXNzYWdlKGVycikgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgbXNnID0gIiI7CgogICAgICBpZiAoT2JqZWN0LmlzT2JqZWN0KGVycikpIHsKICAgICAgICB2YXIgcGFyYW1Db2RlID0gdGhpcy5jdXJyZW50SXRlbS5nZXRDb2RlRmllbGQoKTsKCiAgICAgICAgc3dpdGNoIChlcnIuQ29kZSkgewogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgLy8JbXNnID0gYXBpUmVzcG9uc2VDb2RlLmdldE1lc3NhZ2UoZXJyLkNvZGUpOwogICAgICAgICAgICBpZiAodGhpcy5lZGl0TW9kZSA9PSB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0KSB7CiAgICAgICAgICAgICAgbXNnID0gdGhpcy50aXRsZSArICIgIiArIHRoaXMuY3VycmVudEl0ZW1bcGFyYW1Db2RlXSArICIgxJHDoyBjw7MgcGjDoXQgc2luaCBraMO0bmcgdGjhu4Mgc+G7rWEgxJHhu5VpLiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgbXNnID0gdGhpcy50aXRsZSArICIgIiArIHRoaXMuY3VycmVudEl0ZW1bcGFyYW1Db2RlXSArICIgxJHDoyB04buTbiB04bqhaSI7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgbXNnID0gW3RoaXMudGl0bGUsICIgIiwgdGhpcy5jdXJyZW50SXRlbVtwYXJhbUNvZGVdLCAiIMSRw6MgYuG7iyB0aGF5IMSR4buVaSBi4bufaSBuZ8aw4budaSBkw7luZyBraMOhYywgdnVpIGzDsm5nIG7huqFwIGzhuqFpIHRyxrDhu5tjIGtoaSB0aGF5IMSR4buVaSBk4buvIGxp4buHdS4iXS5qb2luKCIiKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSA0MDM6CiAgICAgICAgICAgIG1zZyA9IHRoaXMuJHQoImkxOG5QZXJtaXNzaW9uLkFjdGlvbi5NZXNzYWdlQ29tbW9uIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gVHLDuW5nIG3Doy4gw4FwIGThu6VuZyBjaG8gVlRISCwgS0gvTkNDL05WCgogICAgICAgICAgY2FzZSB0aGlzLiRtcy5lbnVtLkVudW1FcnJvckNvZGUuSW52YWxpZFJlZm5vOgogICAgICAgICAgICBtc2cgPSBtZS5oYW5kbGVFcnJvckludmFsaWRSZWZubyhlcnIsIHBhcmFtQ29kZSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgLy8gcHZkdW9uZzEgLSAxNi8wNC8yMDIwIC0gQuG7lSBzdW5nIG3DoyBs4buXaSA5OSA9PiBUcuG6oyB24buBIG1lc2FnZSB0aMO0bmcgYsOhbyDEkcOjIGPDsyBs4buXaSB44bqjeSByYQoKICAgICAgICAgIGNhc2UgdGhpcy4kbXMuZW51bS5FbnVtRXJyb3JDb2RlLkVycm9yOgogICAgICAgICAgICB7CiAgICAgICAgICAgICAgbXNnID0gIsSQw6MgY8OzIGzhu5dpIHjhuqN5IHJhIjsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlmIChlcnIuU3lzdGVtTWVzc2FnZS5pbmRleE9mKCJkdXBsaWNhdGUga2V5IikgPiAtMSkgewogICAgICAgICAgICAgIG1zZyA9IHRoaXMudGl0bGUgKyAiICIgKyB0aGlzLmN1cnJlbnRJdGVtW3BhcmFtQ29kZV0gKyAiIMSRw6MgdOG7k24gdOG6oWkiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGVyciA9PT0gInN0cmluZyIpIHsKICAgICAgICBtc2cgPSBlcnI7CiAgICAgIH0KCiAgICAgIHJldHVybiBtc2c7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGThu68gbGnhu4d1IG7hur91IHRyxrDhu51uZyBo4bujcCBzdWJtaXQgbOG7l2kNCiAgICAgKiBDcmVhdGVkIGJ5OiBwdmR1b25nMSAtIDE1LzExLzIwMTkNCiAgICAgKi8KICAgIGFmdGVyU3VibWl0RXJyb3I6IGZ1bmN0aW9uIGFmdGVyU3VibWl0RXJyb3IoKSB7fSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBk4buvIGxp4buHdSBzYXUga2hpIGPhuqV0IHRow6BuaCBjw7RuZw0KICAgICAqIGNyZWF0ZWQgYm5kdWMgMjcuMTEuMjAxOQ0KICAgICAqLwogICAgcHJvY2Vzc0RhdGFBZnRlclN1Ym1pdDogZnVuY3Rpb24gcHJvY2Vzc0RhdGFBZnRlclN1Ym1pdChlbnRpdHksIHJlc3VsdERhdGEpIHt9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IGThu68gbGnhu4d1IGPhuqV0DQogICAgICogKi8KICAgIGdldFNhdmVEYXRhOiBmdW5jdGlvbiBnZXRTYXZlRGF0YShtb2RlLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGRhdGEgPSBudWxsLAogICAgICAgICAgZGVzY3JpcHRpb25Mb2cgPSBudWxsOyAvL21hc3RlcgoKICAgICAgaWYgKHR5cGVvZiBtZS5jdXJyZW50SXRlbS5nZXREYXRhID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgZGF0YSA9IF9vYmplY3RTcHJlYWQoe30sIG1lLmN1cnJlbnRJdGVtLmdldERhdGEoKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YSA9IF9vYmplY3RTcHJlYWQoe30sIG1lLmN1cnJlbnRJdGVtKTsKICAgICAgfQoKICAgICAgaWYgKG1lLm1vZHVsZSAmJiBtZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXSkgewogICAgICAgIHZhciBmaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICAgIGlmIChmaWVsZC51bmlxdWUpIHsKICAgICAgICAgIGRhdGFbZmllbGQudW5pcXVlXSA9IGRhdGFbZmllbGQudW5pcXVlXS50cmltKCk7CiAgICAgICAgfQogICAgICB9IC8vZHV54buHdCB44butIGzDvSBjw6FjIGThu68gbGnhu4d1IG3hu58gcuG7mW5nCiAgICAgIC8vcHZkdXkgMjMvMDMvMjAyMSBz4butYSBs4buXaSBj4bqldCB1bml0IGRhdGEgdHLGsOG7nW5nIGjhu6NwIG51bGwgYuG7iyBs4buXaS4uLgoKCiAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCJFeHREYXRhIikpIHsKICAgICAgICB2YXIgZXh0RGF0YSA9IHt9OwoKICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHsKICAgICAgICAgIGlmIChtZS5vcmlnaW5GaWVsZHMuaW5kZXhPZihpKSA9PT0gLTEpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtpXTsgLy92YWx1ZSBjw7MgZ2nDoSB0cuG7iyB0aOG7iSBt4bubaSBhZGQgdsOgbyBleHREYXRhCgogICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09ICIiKSB7CiAgICAgICAgICAgICAgZXh0RGF0YVtpXSA9IHZhbHVlICsgIiI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGRhdGEuRXh0RGF0YSA9IEpTT04uc3RyaW5naWZ5KGV4dERhdGEpOwogICAgICB9IC8vZGV0YWlsCgoKICAgICAgaWYgKG1lLnN0b3JlRGV0YWlsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIG1lLnN0b3JlRGV0YWlsKSB7CiAgICAgICAgICBkYXRhW2tleV0gPSBtZS5nZXREZXRhaWxTYXZlRGF0YShrZXksIG1lLnN0b3JlRGV0YWlsW2tleV0sIGlzY3VzdG9tQXVkaXRpbmdsb2cpOwogICAgICAgIH0KICAgICAgfSAvL3B2ZHV5IDA4LzAzLzIwMjEga2hpIHPhu61hIHPhur0gdHJ1eeG7gW4gb2xkRGF0YSDEkeG7gyB44butIGzDvSAtIGdoaSBuaOG6rXQga8O9IHRydXkgY+G6rXAsIGPhuq1wIG5o4bqtdCBjw6J5Li4uLgoKCiAgICAgIGlmIChtb2RlID09PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuRWRpdCkgewogICAgICAgIGRhdGEuT2xkRGF0YSA9IG1lLm9sZERhdGFJdGVtOwogICAgICB9IC8vY3VzdG9tIGThu68gbGnhu4d1IHRyxrDhu5tjIGtoaSBj4bqldAoKCiAgICAgIG1lLmN1c3RvbVNhdmVEYXRhKG1lLmVkaXRNb2RlLCBkYXRhKTsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IGThu68gbGnhu4d1IGNoaSB0aeG6v3QgxJHhu4MgY+G6pXQNCiAgICAgKi8KICAgIGdldERldGFpbFNhdmVEYXRhOiBmdW5jdGlvbiBnZXREZXRhaWxTYXZlRGF0YShrZXksIHN0b3JlLCBpc2N1c3RvbUF1ZGl0aW5nbG9nKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBuZXdSZWNvcmRzID0gc3RvcmUuZ2V0TmV3UmVjb3JkcygpLAogICAgICAgICAgdXBkYXRlZFJlY29yZHMgPSBzdG9yZS5nZXRVcGRhdGVkUmVjb3JkcygpLAogICAgICAgICAgcmVtb3ZlZFJlY29yZHMgPSBzdG9yZS5nZXRSZW1vdmVkUmVjb3JkcygpLAogICAgICAgICAgcmVzdWx0ID0gW107CiAgICAgIHZhciBjdXN0b21EZXNjcmlwdGlvbkxvZyA9IHsKICAgICAgICBpbnNlcnRzOiBbXSwKICAgICAgICB1cGRhdGVzOiBbXSwKICAgICAgICBkZWxldGVzOiBbXQogICAgICB9OyAvL1jhu60gbMO9IGNobyBjw6FjIGLhuqNuIGdoaSB0aMOqbSBt4bubaQoKICAgICAgaWYgKG5ld1JlY29yZHMgJiYgbmV3UmVjb3Jkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgbmV3UmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgICAgIHJlY29yZC5FbnRpdHlTdGF0ZSA9IHRoaXMuJG1zLmVudW0uTW9kZWxTdGF0ZS5JbnNlcnQ7CiAgICAgICAgICByZXN1bHQuYWRkKHJlY29yZC5nZXREYXRhKCkpOwoKICAgICAgICAgIGlmIChpc2N1c3RvbUF1ZGl0aW5nbG9nKSB7CiAgICAgICAgICAgIGN1c3RvbURlc2NyaXB0aW9uTG9nLmluc2VydHMucHVzaChtZS5nZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2cocmVjb3JkLmdldERhdGEoKSwge30sIG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuSW5zZXJ0LCB0cnVlKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gLy9Y4butIGzDvSBjaG8gY8OhYyBi4bqjbiBnaGkgc+G7rWEKCgogICAgICBpZiAodXBkYXRlZFJlY29yZHMgJiYgdXBkYXRlZFJlY29yZHMubGVuZ3RoID4gMCkgewogICAgICAgIHVwZGF0ZWRSZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCkgewogICAgICAgICAgdmFyIGRldGFpbERhdGEgPSByZWNvcmQuZ2V0RGF0YSgpOyAvLwlvbGREYXRhID0gbWUuZ2V0T2xkRGF0YShyZWNvcmQpOwogICAgICAgICAgLy9pZiAob2xkRGF0YSkgewogICAgICAgICAgLy8JZGV0YWlsRGF0YS5vbGRfZGF0YSA9IG9sZERhdGE7CiAgICAgICAgICAvL30KCiAgICAgICAgICBkZXRhaWxEYXRhLkVudGl0eVN0YXRlID0gdGhpcy4kbXMuZW51bS5Nb2RlbFN0YXRlLlVwZGF0ZTsKICAgICAgICAgIHJlc3VsdC5hZGQoZGV0YWlsRGF0YSk7CgogICAgICAgICAgaWYgKGlzY3VzdG9tQXVkaXRpbmdsb2cpIHsKICAgICAgICAgICAgY3VzdG9tRGVzY3JpcHRpb25Mb2cudXBkYXRlcy5wdXNoKG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhkZXRhaWxEYXRhLCBtZS5vbGREYXRhSXRlbSwgbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5VcGRhdGUsIHRydWUpKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSAvL1jhu60gbMO9IGNobyBjw6FjIGLhuqNuIGdoaSB4w7NhCgoKICAgICAgaWYgKHJlbW92ZWRSZWNvcmRzICYmIHJlbW92ZWRSZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICByZW1vdmVkUmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgICAgIHJlY29yZC5FbnRpdHlTdGF0ZSA9IHRoaXMuJG1zLmVudW0uTW9kZWxTdGF0ZS5EZWxldGU7CiAgICAgICAgICByZXN1bHQuYWRkKHJlY29yZC5nZXREYXRhKCkpOwoKICAgICAgICAgIGlmIChpc2N1c3RvbUF1ZGl0aW5nbG9nKSB7CiAgICAgICAgICAgIGN1c3RvbURlc2NyaXB0aW9uTG9nLmRlbGV0ZXMucHVzaChtZS5nZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2cocmVjb3JkLmdldERhdGEoKSwge30sIG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuRGVsZXRlLCB0cnVlKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChpc2N1c3RvbUF1ZGl0aW5nbG9nKSB7CiAgICAgICAgbWUuZGVzY3JpcHRpb25BdWRpdGluZ0xvZy5kZXRhaWwucHVzaChjdXN0b21EZXNjcmlwdGlvbkxvZyk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSBk4buvIGxp4buHdSB0aOG7sWMgaGnhu4duIGPhuqV0DQogICAgICovCiAgICBjdXN0b21TYXZlRGF0YTogZnVuY3Rpb24gY3VzdG9tU2F2ZURhdGEoZWRpdE1vZGUsIGRhdGEpIHt9LAoKICAgIC8qKg0KICAgICAqIFZhbGlkYXRlIGzhu5dpIG5naGnhu4dwIHbhu6UNCiAgICAgKiBDcmVhdGVkQnk6IFBES0lFTiAyNS8wNy8yMDE5DQogICAgICovCiAgICB2YWxpZGF0ZUJ1c2luZXNzOiBmdW5jdGlvbiB2YWxpZGF0ZUJ1c2luZXNzKHNhdmVQYXJhbSwgYWN0aW9uKSB7CiAgICAgIHJldHVybiB0cnVlOyAvL3JldHVybiB0aGlzLmJ1c2luZXNzRXJyb3JMaXN0Lmxlbmd0aCA9PSAwOwogICAgfSwKICAgIC8vSMOgbSB44butIGzDvSBz4buxIGtp4buHbiBkw7NuZyBmb3JtCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTguMDYuMjAyMCkKICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHt9LAogICAgLy9LaeG7g20gdHJhIGZvcm0gxJHDoyBi4buLIHRoYXkgxJHhu5VpIGhheSBjaMawYQogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE4LjA2LjIwMjApCiAgICBjaGVja0NoYW5nZXM6IGZ1bmN0aW9uIGNoZWNrQ2hhbmdlcygpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIG1lLiRtcy5jb21tb25Gbi5jaGVja0RpZmYobWUuY3VycmVudEl0ZW0sIG1lLm9sZERhdGFJdGVtKTsKICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gc+G7sSBraeG7h24gd2lkZ2V0IGPhu6dhIGdyaWQNCiAgICAgKi8KICAgIGdyaWRXaWRnZXRFdmVudDogZnVuY3Rpb24gZ3JpZFdpZGdldEV2ZW50KGdyaWQsIHdpZGdldERhdGEsIGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAod2lkZ2V0RGF0YS5jb21tYW5kKSB7CiAgICAgICAgY2FzZSAiRGVsZXRlIjoKICAgICAgICAgIG1lLnJlbW92ZURldGFpbCh3aWRnZXREYXRhLmRhdGFSb3csIGdyaWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogWMOzYSBi4bqjbiBnaGkgY2hpIHRp4bq/dA0KICAgICAqLwogICAgcmVtb3ZlRGV0YWlsOiBmdW5jdGlvbiByZW1vdmVEZXRhaWwocmVjb3JkLCBncmlkKSB7CiAgICAgIGdyaWQuc3RvcmUucmVtb3ZlKHJlY29yZCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRow6ptIGLhuqNuIGdoaSBjaGkgdGnhur90DQogICAgICovCiAgICBhZGREZXRhaWw6IGZ1bmN0aW9uIGFkZERldGFpbChncmlkKSB7CiAgICAgIGdyaWQuYWRkTmV3KHt9LCB0cnVlKTsKICAgIH0sCgogICAgLyoqDQogICAgICogS2hhaSBiw6FvIGhhbmRsZXINCiAgICAgKiAqLwogICAgYWRkSGFuZGxlcjogZnVuY3Rpb24gYWRkSGFuZGxlcigpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5zdG9yZURldGFpbCkgewogICAgICAgIGZvciAodmFyIGtleSBpbiBtZS5zdG9yZURldGFpbCkgewogICAgICAgICAgdmFyIGdyaWQgPSBtZS5zdG9yZURldGFpbFtrZXldLm93bmVyOwoKICAgICAgICAgIGlmIChncmlkKSB7CiAgICAgICAgICAgIGdyaWQuJG9uKCJjdXN0b21BZGROZXdEYXRhIiwgbWUuZ3JpZEN1c3RvbUFkZE5ld0RhdGEpOwogICAgICAgICAgICBncmlkLiRvbigicm93YWN0aW9uY2xpY2siLCBtZS5ncmlkUm93QWN0aW9uQ2xpY2spOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBYw7NhIGhhbmRsZXIgxJHDoyBraGFpIGLDoW8gdHJvbmcgaMOgbSBhZGRIYW5kbGVyDQogICAgICogKi8KICAgIHJlbW92ZUhhbmRsZXI6IGZ1bmN0aW9uIHJlbW92ZUhhbmRsZXIoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuc3RvcmVEZXRhaWwpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gbWUuc3RvcmVEZXRhaWwpIHsKICAgICAgICAgIHZhciBncmlkID0gbWUuc3RvcmVEZXRhaWxba2V5XS5vd25lcjsKCiAgICAgICAgICBpZiAoZ3JpZCkgewogICAgICAgICAgICBncmlkLiRvZmYoImN1c3RvbUFkZE5ld0RhdGEiLCBtZS5ncmlkQ3VzdG9tQWRkTmV3RGF0YSk7CiAgICAgICAgICAgIGdyaWQuJG9mZigicm93YWN0aW9uY2xpY2siLCBtZS5ncmlkUm93QWN0aW9uQ2xpY2spOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gZOG7ryBsaeG7h3UgdGjDqm0gbeG7m2kgdHLDqm4gZ3JpZA0KICAgICAqLwogICAgZ3JpZEN1c3RvbUFkZE5ld0RhdGE6IGZ1bmN0aW9uIGdyaWRDdXN0b21BZGROZXdEYXRhKGdyaWQsIGRhdGEpIHt9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSBs4bqhaSBz4buxIGtp4buHbiBraGkgdGhhbyB0w6FjIHRyw6puIGdyaWQNCiAgICAgKiBAcGFyYW0geyp9IGNvbW1hbmQNCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZA0KICAgICAqIEBwYXJhbSB7Kn0gZXZlbnQNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDMwLjAzLjIwMjENCiAgICAgKi8KICAgIGdyaWRSb3dBY3Rpb25DbGljazogZnVuY3Rpb24gZ3JpZFJvd0FjdGlvbkNsaWNrKGNvbW1hbmQsIHJlY29yZCwgZXZlbnQpIHt9LAoKICAgIC8qKg0KICAgICAqIEto4bufaSB04bqhbyBk4buvIGxp4buHdSBraGkgdGjDqm0gbeG7m2kgZMOybmcgY2ggaXRp4bq/dA0KICAgICAqIEBwYXJhbSBkZWZhdWx0RGF0YQ0KICAgICAqLwogICAgaW5pdE5ld0RldGFpbDogZnVuY3Rpb24gaW5pdE5ld0RldGFpbChkZWZhdWx0RGF0YSkgewogICAgICByZXR1cm4gZGVmYXVsdERhdGE7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IGPhuqV1IGjDrG5oIGPhu5l0IGPhu6dhIGdyaWQgZGV0YWlsDQogICAgICogKi8KICAgIGdldEdyaWREZXRhaWxDb2x1bW5Db25maWc6IGZ1bmN0aW9uIGdldEdyaWREZXRhaWxDb2x1bW5Db25maWcoKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbHVtbkRldGFpbDsKICAgIH0sCgogICAgLyoNCiAgICAgKiBwdmR1eSAwNS8wNC8yMDIxOiB0aMOqbSBow6BtIHjDs2EgdHJvbmcgYmFzZSBkZXRhaWwgxJHhu4MgY8OzIHRo4buDIHjDs2EgdHLDqm4gZm9ybSBjaGkgdGnhur90Lg0KICAgICAqLwogICAgZGVsZXRlOiBmdW5jdGlvbiBfZGVsZXRlKHJlY29yZCkgewogICAgICB2YXIgX3RoaXM4ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KCkgewogICAgICAgIHZhciBtZSwgY29uZmlnTWVzc2FnZSwgYW5zd2VyLCB0ZW1wLCBpLCBhdWRpdGluZ0xvZywgcGFyYW0sIHJlc3VsdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczg7CgogICAgICAgICAgICAgICAgaWYgKG1lLmNoZWNrQWN0aW9uUGVybWlzc2lvbihtZS4kdCgiaTE4blBlcm1pc3Npb24uU3ViU3lzdGVtQ29kZS5Db2RlLkRFTEVURSIpKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmdldERlbGV0ZUNvbmZpcm1NZXNzYWdlKHJlY29yZCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIGNvbmZpZ01lc3NhZ2UgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kbXMubXNnQm94LnNob3dRdWVzdGlvbihjb25maWdNZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgYW5zd2VyID0gX2NvbnRleHQ5LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoYW5zd2VyID09ICJZZXMiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDI4OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wID0ge307CiAgICAgICAgICAgICAgICBfY29udGV4dDkudDAgPSByZWdlbmVyYXRvclJ1bnRpbWUua2V5cyhyZWNvcmQpOwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgaWYgKChfY29udGV4dDkudDEgPSBfY29udGV4dDkudDAoKSkuZG9uZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDIyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpID0gX2NvbnRleHQ5LnQxLnZhbHVlOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5LnQyID0gaTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gX2NvbnRleHQ5LnQyID09PSAicGFyZW50Tm9kZSIgPyAxNyA6IF9jb250ZXh0OS50MiA9PT0gImlzSGlkZSIgPyAxNyA6IF9jb250ZXh0OS50MiA9PT0gImlzU2VsZWN0ZWQiID8gMTcgOiBfY29udGV4dDkudDIgPT09ICJsZXZlbCIgPyAxNyA6IF9jb250ZXh0OS50MiA9PT0gIl9fdktleVZhbHVlIiA/IDE3IDogX2NvbnRleHQ5LnQyID09PSAiX2lzU2VsZWN0ZWRNdWx0aXBsZSIgPyAxNyA6IF9jb250ZXh0OS50MiA9PT0gImV4cGFuZGVkIiA/IDE3IDogMTg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJicmVhayIsIDIwKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHRlbXBbaV0gPSByZWNvcmRbaV07CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgiYnJlYWsiLCAyMCk7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBhdWRpdGluZ0xvZyA9IHsKICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IE1TSnNvbi5zZXJpYWxpemUobWUuZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nKHJlY29yZCkpLAogICAgICAgICAgICAgICAgICByZWZlcmVuY2U6IG1lLmJ1aWxkUmVmZXJlbmNlKHJlY29yZCksCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogbWUuYWN0aW9uQXVkaXRpbmdMb2csCiAgICAgICAgICAgICAgICAgIGVudGl0eTogbWUubW9kdWxlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogW3RlbXBdLAogICAgICAgICAgICAgICAgICBCeVBhc3NWYWxpZGF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgQXVkaXRpbmdMb2c6IE1TSnNvbi5zZXJpYWxpemUoYXVkaXRpbmdMb2cpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyNjsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KG1lLm1vZHVsZSwgIi9kZWxldGUiKSwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDI2OgogICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICBtZS5hZnRlckRlbGV0ZShyZWNvcmQsIHJlc3VsdCk7CgogICAgICAgICAgICAgIGNhc2UgMjg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTkpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gc2F1IGtoaSB4w7NhDQogICAgICogcHZkdXkgMDUvMDQvMjAyMTogdGjDqm0gdGjhurFuZyB4w7NhIHRyb25nIGJhc2UgZGV0YWlsDQogICAgICovCiAgICBhZnRlckRlbGV0ZTogZnVuY3Rpb24gYWZ0ZXJEZWxldGUocmVjb3JkLCByZXN1bHQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG1vZHVsZU5hbWUgPSBtZS5nZXRNb2R1bGVOYW1lKCkgfHwgIiI7CgogICAgICBpZiAocmVzdWx0LlN1Y2Nlc3MpIHsKICAgICAgICBtZS4kdG9hc3Quc3VjY2VzcyhtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuRGVsZXRlU3VjY2VzcyIpKTsKICAgICAgICByZWNvcmQgPSBbXTsKICAgICAgICBtZS5zZWxlY3RlZCA9IFtdOyAvLyBwdmR1eSAwNS8wNS8yMDIxOiBraGkgeMOzYSB0csOqbiBkYW5oIHPDoWNoIHRow6wgxJHDs25nIHBvcHVwIMSRaS4KCiAgICAgICAgbWUuaGlkZSgpOyAvLyBOTVRVQU4zIDMvMTEvMjAyMTogc2F1IGtoaSB4w7NhIHBo4bqjaSByZWxvYWQgbOG6oWkgdHJhbmcKCiAgICAgICAgbWUucmVsb2FkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyoqDQogICAgICAgICAqIFPhu61hIGzhu5dpIGtoaSB4w7NhIG5oaeG7gXUgYuG6o24gZ2hpDQogICAgICAgICAqIE1vZGlmaXlCeTogTlRBbmggKDA5LzAzLzIwMjEpDQogICAgICAgICAqLwogICAgICAgIHZhciBDT0RFID0gbWUuJG1zLmVudW0uU2VydmljZVJlc3BvbnNlQ29kZTsgLy8gTmhp4buBdSBi4bqjbiBnaGkgbXXhu5FuIHjDs2EgxJHDoyBjw7MgcGjDoXQgc2luaAoKICAgICAgICBpZiAocmVzdWx0LkRhdGEgJiYgcmVzdWx0LkRhdGEubGVuZ3RoID4gMSkgewogICAgICAgICAgLy8gaWYocmVzdWx0LkRhdGFbMF0uQ29kZSA9PSAnQXJpc2UnKXsKICAgICAgICAgIC8vICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkRlbGV0ZUFyaXNlbmVkIikpOwogICAgICAgICAgLy8gfQogICAgICAgICAgdmFyIGxpc3RBcmlzZW5kID0gW107IC8vbm5sYW0gdOG6oW0gdGjhu51pIHjDs2EgxJFv4bqhbiBuw6B5IMSRaSBzYXUgc+G6vSB24bq9IGZvcm0gcG9wdXAgc2hvdyBkw6FuaCBzw6FjaCBwaMOhdCBzaW5oIHNhdQogICAgICAgICAgLy8gcmVzdWx0LkRhdGEuZm9yRWFjaChlbGVtZW50ID0+IHsKICAgICAgICAgIC8vICAgbGlzdEFyaXNlbmQucHVzaChlbGVtZW50LkVudGl0eS5Bc3NldFR5cGVDb2RlKTsKICAgICAgICAgIC8vIH0pOwoKICAgICAgICAgIHN3aXRjaCAocmVzdWx0LkNvZGUpIHsKICAgICAgICAgICAgY2FzZSBDT0RFLlBhcnRJbnZhbGlkRGF0YToKICAgICAgICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5DYW5Ob3REZWxldGVBcmlzZSIpKTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgbWUuJHRvYXN0LmVycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuQ2FuTm90RGVsZXRlQXJpc2UiKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9IC8vbWUucmVsb2FkKCk7CiAgICAgICAgICAvLyByZWNvcmQgPSBbXTsKICAgICAgICAgIC8vbWUuc2VsZWN0aW9uQ2hhbmdlKHJlY29yZCk7CiAgICAgICAgICAvLyBtZS5zZWxlY3RlZCA9IFtdOwoKICAgICAgICB9IC8vIGPDsyAxIGLhuqNuIGdoaSBjw7MgcGjDoXQgc2luaDoKICAgICAgICBlbHNlIHsKICAgICAgICAgIHN3aXRjaCAocmVzdWx0LkNvZGUpIHsKICAgICAgICAgICAgLy8geMOzYSAxIGLhuqNuIGdoaSB2w6AgYuG6o24gZ2hpIMSRw7MgYuG7iyBjw7MgcGjDoXQgc2luaDoKICAgICAgICAgICAgY2FzZSBDT0RFLkFyaXNlbmVkOgogICAgICAgICAgICAgIG1lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuRGVsZXRlQXJpc2VuZWQiKS5mb3JtYXQobW9kdWxlTmFtZSkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyB4w7NhIG5oaeG7gXUgYuG6o24gZ2hpIHbDoCBjw7MgMSBi4bqjbiBnaGkgYuG7iyBjw7MgcGjDoXQgc2luaDoKCiAgICAgICAgICAgIGNhc2UgQ09ERS5QYXJ0SW52YWxpZERhdGE6CiAgICAgICAgICAgICAgLy9ubmxhbSB04bqhbSB0aOG7nWkgeMOzYSDEkW/huqFuIG7DoHkgxJFpIHNhdSBz4bq9IHbhur0gZm9ybSBwb3B1cCBzaG93IGTDoW5oIHPDoWNoIHBow6F0IHNpbmggc2F1CiAgICAgICAgICAgICAgLy8gbGlzdEFyaXNlbmQgPSBbXTsKICAgICAgICAgICAgICAvLyBsaXN0QXJpc2VuZC5wdXNoKHJlc3VsdC5EYXRhWzBdLkVudGl0eS5Bc3NldFR5cGVDb2RlKTsKICAgICAgICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5EZWxldGVNdWx0aUhhc09uZUFyaXNlbmVkIikpOwoKICAgICAgICAgICAgICBpZiAocmVzdWx0LkRhdGEpIHsKICAgICAgICAgICAgICAgIHZhciBrZXlGaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQua2V5OwogICAgICAgICAgICAgICAgcmVjb3JkLmZvckVhY2goZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0LkRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpW2tleUZpZWxkXSAhPSBpdGVtLkVudGl0eVtrZXlGaWVsZF0gJiYgaVtrZXlGaWVsZF0pIHsKICAgICAgICAgICAgICAgICAgICAgIG1lLmdyaWQuZGF0YXgucmVtb3ZlKGkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IC8vIHJlY29yZCA9IFtdOwogICAgICAgICAgICAgIC8vbWUuc2VsZWN0aW9uQ2hhbmdlKHJlY29yZCk7CiAgICAgICAgICAgICAgLy8gbWUuc2VsZWN0ZWQgPSBbXTsKICAgICAgICAgICAgICAvL21lLnJlbG9hZCgpOwoKCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IGPDonUgdGjDtG5nIGLDoW8ga2hpIHjDs2ENCiAgICAgKiBwdmR1eSAwNS8wNC8yMDIxDQogICAgICovCiAgICBnZXREZWxldGVDb25maXJtTWVzc2FnZTogZnVuY3Rpb24gZ2V0RGVsZXRlQ29uZmlybU1lc3NhZ2UocmVjb3JkcykgewogICAgICB2YXIgX3RoaXM5ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMCgpIHsKICAgICAgICB2YXIgbWUsIG1vZHVsZU5hbWUsIHRhcmdldE5hbWUsIG1lczsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM5OwogICAgICAgICAgICAgICAgbW9kdWxlTmFtZSA9IChtZS5nZXRNb2R1bGVOYW1lKCkgfHwgIiIpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICB0YXJnZXROYW1lID0gIiI7CiAgICAgICAgICAgICAgICBtZXMgPSAiIjsKCiAgICAgICAgICAgICAgICBpZiAocmVjb3Jkcy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgIG1lcyA9IG1lLiR0KCJpMThuQmFzZUZvcm0uTWVzc2FnZS5Db25maXJtRGVsZXRlTXV0aVRpdGxlIikuZm9ybWF0KG1vZHVsZU5hbWUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IHJlY29yZHNbbWUuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0uX2NvbmZpZy5maWVsZC5uYW1lXSB8fCByZWNvcmRzW21lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQuY29kZV07CiAgICAgICAgICAgICAgICAgIG1lcyA9IG1lLiR0KCJpMThuQmFzZUZvcm0uTWVzc2FnZS5Db25maXJtRGVsZXRlIikuZm9ybWF0KG1vZHVsZU5hbWUsIG1lLiRtcy5jb21tb25Gbi5lbmNvZGVIVE1MKHRhcmdldE5hbWUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICAgICAgdGl0bGU6IG1lLiR0KCJpMThuQmFzZUZvcm0uTWVzc2FnZS5Db25maXJtRGVsZXRlVGl0bGUiKS5mb3JtYXQobW9kdWxlTmFtZSksCiAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IG1lcwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICogQ3VzdG9tIGZpbHRlciAoY8OzIHRo4buDIHTDuXkgZMO5bmcgY29tYm9ib3ggaGF5IGdyaWQgLi4uLi4pDQogICAgKiBN4bq3YyDEkeG7i25oIHRydXnhu4FuIEluYWN0aXZlIHbDoG8gbOG6pXkgcmEgY8OhYyBi4bqjbiBnaGkgxJFhbmcgaG/huqF0IMSR4buZbmcNCiAgICAqIFRETkdISUEgMjgvMTAvMjAyMQ0KICAgICogb3ZlcnJpZGFibGUNCiAgICAqLwogICAgY3VzdG9tUGF5bG9hZENvbWJvOiBmdW5jdGlvbiBjdXN0b21QYXlsb2FkQ29tYm8ocGF5bG9hZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFwYXlsb2FkLmZpbHRlcikgewogICAgICAgIHBheWxvYWQuZmlsdGVyID0gW107CiAgICAgIH0KCiAgICAgIHZhciBtYXAgPSBudWxsOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXlsb2FkLmZpbHRlci5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBpdGVtID0gcGF5bG9hZC5maWx0ZXJbaV07CgogICAgICAgIGlmIChpdGVtLnByb3BlcnR5ID09PSAiSW5hY3RpdmUiKSB7CiAgICAgICAgICBtYXAgPSBpdGVtOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIW1hcCkgewogICAgICAgIHBheWxvYWQuZmlsdGVyLnB1c2goewogICAgICAgICAgcHJvcGVydHk6ICJJbmFjdGl2ZSIsCiAgICAgICAgICB2YWx1ZTogZmFsc2UsCiAgICAgICAgICBvcGVyYXRvcjogIj0iCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGlmIChwYXlsb2FkLmZpbHRlci5sZW5ndGggPT0gMCkgewogICAgICAgIGRlbGV0ZSBwYXlsb2FkLmZpbHRlcjsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaOG7sWMgaGnhu4duIGPDoWMgY8O0bmcgdmnhu4djIHRyxrDhu5tjIGtoaSBzYXZlDQogICAgICogQGF1dGhvciB2dmtpZXQgLSAxMi4wNC4yMDIxDQogICAgICovCiAgICBiZWZvcmVTYXZlOiBmdW5jdGlvbiBiZWZvcmVTYXZlKCkgewogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGdoaSBuaOG6rXQga8O9IHRydXkgY+G6rXANCiAgICAgKiBAcGFyYW0geyp9IHJlc3VsdA0KICAgICAqIEBwYXJhbSB7Kn0gcGFyYW0NCiAgICAgKiBAcGFyYW0geyp9IGFjdGlvbg0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTQuMDUuMjAyMQ0KICAgICAqLwogICAgaW5zZXJ0QXVkaXRpbmdMb2c6IGZ1bmN0aW9uIGluc2VydEF1ZGl0aW5nTG9nKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgYXVkaXRpbmdMb2dzID0gW107CiAgICAgIGFjdGlvbiA9IG1lLmVkaXRNb2RlOyAvLyDEkOG7kWkgduG7m2kgeOG7rSBsw70gaMOgbmcgbG/huqF0CgogICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5TdWNjZXNzICYmIHBhcmFtICYmIHBhcmFtLkVudGl0eSkgewogICAgICAgIGlmIChtZS5Jc0F1ZGl0aW5nTG9nQmF0Y2gpIHsKICAgICAgICAgIGF1ZGl0aW5nTG9ncyA9IG1lLmN1c3RvbUF1ZGl0aW5nTG9nQmF0Y2gocGFyYW0uRW50aXR5LCBhY3Rpb24pOwogICAgICAgIH0gLy8gxJDhu5FpIHbhu5tpIHjhu60gbMO9IMSRxqFuCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAvLyB2dmtpZXQ6IENvZGUgY+G7p2EgbmfGsOG7nWkgbMOgbSB0csaw4bubYyDEkcOzLCBraMO0bmcgZMOhbSB4w7NhCiAgICAgICAgICAvL2114buRbiBjdXN0b20gbcO0IHThuqMgbmjhuq10IGvDvSB0aMOsIGTDuW5nIGjDoG0gbsOgeQogICAgICAgICAgdmFyIGRlc2NyaXB0aW9uQXVkaXRpbmdMb2cgPSBtZS5jdXN0b21EZXNjcmlwdGlvbkF1ZGl0aW5nTG9nKHBhcmFtLkVudGl0eSwgbWUub2xkRGF0YUl0ZW0sIGFjdGlvbiwgZmFsc2UpOwoKICAgICAgICAgIGlmIChkZXNjcmlwdGlvbkF1ZGl0aW5nTG9nICYmIE9iamVjdC5rZXlzKGRlc2NyaXB0aW9uQXVkaXRpbmdMb2cpLmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgICBtZS5kZXNjcmlwdGlvbkF1ZGl0aW5nTG9nID0gZGVzY3JpcHRpb25BdWRpdGluZ0xvZzsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lLmRlc2NyaXB0aW9uQXVkaXRpbmdMb2cubWFzdGVyID0gbWUuZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nKHBhcmFtLkVudGl0eSwgbWUub2xkRGF0YUl0ZW0sIGFjdGlvbiwgZmFsc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghbWUuYWN0aW9uQXVkaXRpbmdMb2cpIHsKICAgICAgICAgICAgLy8gbm1zaW5oIDogeOG7rSBsw70gbeG6t2MgxJHhu4tuaCBu4bq/dSBmb3JtIGzDoCB0aMOqbSBob+G6t2Mgc+G7rWEgdGjDrCB24bqrbiBnw6FuIGFjdGlvbkF1ZGl0aW5nTG9nIMSR4buDIHRyw6FuaCB0w6xuaCB0cuG6oW5nIGtow7RuZyBnaGkgTktUQwogICAgICAgICAgICAvLyBUT0RPIGPDsyB0aOG7gyBjw7MgdHLGsOG7nW5nIGjhu6NwIMSR4bq3YyBiaeG7h3QgbsOgbyDEkcOzIG3DoCBzaG93IGZvcm0gc+G7rWEgbmjGsG5nIGzDoG0gaMOgbmggxJHhu5luZyBraMOhYwogICAgICAgICAgICBtZS5hY3Rpb25BdWRpdGluZ0xvZyA9IGFjdGlvbiA9PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuQWRkID8gbWUuJG1zLmVudW0uQXVkaXRpbmdMb2dBY3Rpb24uSW5zZXJ0IDogYWN0aW9uID09IG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0ID8gbWUuJG1zLmVudW0uQXVkaXRpbmdMb2dBY3Rpb24uRWRpdCA6IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG1lLmFjdGlvbkF1ZGl0aW5nTG9nKSB7CiAgICAgICAgICAgIGF1ZGl0aW5nTG9ncyA9IFt7CiAgICAgICAgICAgICAgZGVzY3JpcHRpb246IE1TSnNvbi5zZXJpYWxpemUobWUuZGVzY3JpcHRpb25BdWRpdGluZ0xvZyksCiAgICAgICAgICAgICAgcmVmZXJlbmNlOiBtZS5idWlsZFJlZmVyZW5jZSgpLAogICAgICAgICAgICAgIGFjdGlvbjogbWUuYWN0aW9uQXVkaXRpbmdMb2csCiAgICAgICAgICAgICAgZW50aXR5OiBtZS5nZXRFbnRpdHlUeXBlKCkgfHwgbWUubW9kdWxlLAogICAgICAgICAgICAgIC8vIGNvbXBhbnlpZDogbWUuQ29udGV4dC5UZW5hbnRJRCwKICAgICAgICAgICAgICAvLyB1c2VyaWQ6IG1lLkNvbnRleHQuVXNlcklELAogICAgICAgICAgICAgIHVzZXJuYW1lOiBtZS5Db250ZXh0LlVzZXJOYW1lLAogICAgICAgICAgICAgIGRldmljZW5hbWU6IG5hdmlnYXRvci51c2VyQWdlbnQsCiAgICAgICAgICAgICAgdGltZTogbmV3IERhdGUoKSwKICAgICAgICAgICAgICBpZDogY29tbW9uRm4uZ2VuZXJhdGVVVUlEKCkKICAgICAgICAgICAgfV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIHZ2a2lldCAtIE3hurdjIMSR4buLbmggYuG7jyBxdWEga2jDtG5nIGdoaSBsb2cgbuG6v3Uga2jDtG5nIGPDsyBtYXN0ZXIgdsOgIGRldGFpbAoKCiAgICAgIGlmICghYXVkaXRpbmdMb2dzICYmIG1lLmRlc2NyaXB0aW9uQXVkaXRpbmdMb2dbIm1hc3RlciJdICYmIE9iamVjdC5rZXlzKG1lLmRlc2NyaXB0aW9uQXVkaXRpbmdMb2dbIm1hc3RlciJdKS5sZW5ndGggPT0gMCAmJiBtZS5kZXNjcmlwdGlvbkF1ZGl0aW5nTG9nWyJkZXRhaWwiXSAmJiBtZS5kZXNjcmlwdGlvbkF1ZGl0aW5nTG9nWyJkZXRhaWwiXS5sZW5ndGggPT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGF1ZGl0aW5nTG9ncy5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgICBhdWRpdGluZ0xvZ3M6IGF1ZGl0aW5nTG9ncwogICAgICAgIH07CgogICAgICAgIGlmIChhdWRpdGluZ0xvZ3MgJiYgYXVkaXRpbmdMb2dzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIEF1ZGl0aW5nTG9nQVBJLmluc2VydEF1ZGl0aW5nTG9nKHBheWxvYWQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsvL3ThuqFtIGNvbW1lbnQgxJHhu4Mga2jDtG5nIGhp4buHbiBwb3B1cCB3YXJuaW5nIGtoaSBzYW8gY2jDqXAKICAgICAgICAvLyBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICJkZXZlbG9wbWVudCIpIHsKICAgICAgICAvLyAgIG1lLiRtcy5tc2dCb3guc2hvd1dhcm5pbmcoIkRFViBjaMawYSBj4bqldSBow6xuaCBhdWRpdGluZyBsb2ciKTsKICAgICAgICAvLyB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIGN1c3RvbSBs4bqhaSBuaOG6rXQga8O9IHRydXkgY+G6rXAgY2hvIGPDoWMgY2jhu6ljIG7Eg25nIGjDoG5nIGxv4bqhdA0KICAgICAqIEBwYXJhbSB7Kn0gZW50aXR5DQogICAgICogQHBhcmFtIHsqfSBhY3Rpb24NCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDE0LjA1LjIwMjENCiAgICAgKi8KICAgIGN1c3RvbUF1ZGl0aW5nTG9nQmF0Y2g6IGZ1bmN0aW9uIGN1c3RvbUF1ZGl0aW5nTG9nQmF0Y2goZW50aXR5LCBhY3Rpb24pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gdGjhu7FjIGhp4buHbiBjdXN0b20gZW50aXR5IMSR4buRaSB24bubaSBuZ2hp4buHcCB24bulIMSR4bq3YyB0aMO5DQogICAgICogQGF1dGhvciB2dmtpZXQgLSAxNC4wNS4yMDIxDQogICAgICovCiAgICBnZXRFbnRpdHlUeXBlOiBmdW5jdGlvbiBnZXRFbnRpdHlUeXBlKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogc+G7sSBraeG7h24g4bqlbiB2w6BvIGPDoWMgYWN0aW9uIHRyw6puIGZvcm0NCiAgICAgKi8KICAgIGJ1dHRvbkNsaWNrOiBmdW5jdGlvbiBidXR0b25DbGljayhjb21tYW5kLCBlKSB7fSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gdGhhbSBz4buRIHBheWxvYWQgdHLGsOG7m2Mga2hpIGNhbGwgYXBpDQogICAgICogQGF1dGhvciB2dmtpZXQgLSAyMy4wNi4yMDIxDQogICAgICovCiAgICBjdXN0b21QYXlsb2FkOiBmdW5jdGlvbiBjdXN0b21QYXlsb2FkKHBheWxvYWQpIHsKICAgICAgcmV0dXJuIHBheWxvYWQ7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSBs4bqhaSByZWZubyBraGkgdGjDtG5nIGLDoW8gbOG7l2kgZHVwbGljYXRlDQogICAgICogQGF1dGhvciB2dmtpZXQgLSAyMi4wNy4yMDIxDQogICAgICogQHJldHVybnMNCiAgICAgKi8KICAgIGN1c3RvbVJlZk5vRHVwbGljYXRlOiBmdW5jdGlvbiBjdXN0b21SZWZOb0R1cGxpY2F0ZShkYXRhKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaMOqbSBow6BtIGN1c3RvbSBs4bqhaSBwYXJhbSB24bubaSBUSCBjw7MgY+G6o25oIGLDoW8NCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDE0LjA4Ny4yMDIxDQogICAgICovCiAgICBjdXN0b21QYXJhbUJ5UGFzc1ZhbGlkYXRlOiBmdW5jdGlvbiBjdXN0b21QYXJhbUJ5UGFzc1ZhbGlkYXRlKHBhcmFtLCBkYXRhKSB7CiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMigpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEyKTsKICAgICAgfSkpKCk7CiAgICB9CiAgfSwKCiAgLyoqDQogICAqIFRyxrDhu5tjIGtoaSBkZXN0cm95IGZvcm0NCiAgICovCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIHZhciBtZSA9IHRoaXM7IC8veMOzYSB0aGFtIGNoaeG6v3UgxJHhu4MgdHLDoW5oIGxlYWsKCiAgICBkZWxldGUgbWUucGFyYW07CiAgICBtZS5yZW1vdmVIYW5kbGVyKCk7IC8vZGVzdHJveSBjaGEgY+G7p2EgZm9ybSBz4bq9IMSDbiBwaMOtbSB04bqvdAoKICAgIGlmIChtZS5oYXNTaG9ydEtleSkgewogICAgICB0aGlzLiRtcy5jb21tb25Gbi5zaG9ydGtleVBvcFZpZXcodGhpcy4kZWwpOwogICAgfQogIH0KfTs="},null]}
{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT_vue\\src\\commons\\commonFunction.js","dependencies":[{"path":"D:\\VNT_vue\\src\\commons\\commonFunction.js","mtime":1653205086158},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucGFkLXN0YXJ0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgVnVlIGZyb20gInZ1ZSI7CmltcG9ydCBpMThuIGZyb20gIkAvaTE4bnMvaTE4biI7CmltcG9ydCB7IE1TRW51bSB9IGZyb20gIkAvY29tbW9ucy9lbnVtZXJhdGlvbiI7CmltcG9ydCBzdG9yZSBmcm9tICJAL3N0b3Jlcy9zdG9yZSI7CmltcG9ydCB7IE1vZHVsZUNvbnRleHQgfSBmcm9tICJAL3N0b3Jlcy9tb2R1bGUtY29uc3QiOwppbXBvcnQgXyBmcm9tICJsb2Rhc2giOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBtZXNzYWdlQm94IGZyb20gIkAvY29tbW9ucy9tZXNzYWdlQm94IjsKaW1wb3J0IEZpcmViYXNlIGZyb20gIkAvZmlyZWJhc2UvZmlyZWJhc2UiOwppbXBvcnQgbm90aWZpY2F0aW9uQVBJIGZyb20gIkAvYXBpcy9ub3RpZmljYXRpb24vbm90aWZpY2F0aW9uQVBJLmpzIjsKLyoqDQogKiBDbGFzcyBjaOG7qWEgY8OhYyBmdW5jdGlvbiBkw7luZyBjaHVuZyBjaG8gaOG7hyB0aOG7kW5nIHBow61hIGNsaWVudA0KICovCgp2YXIgQ29tbW9uRnVuY3Rpb24gPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIENvbW1vbkZ1bmN0aW9uKCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIENvbW1vbkZ1bmN0aW9uKTsKICB9CgogIF9jcmVhdGVDbGFzcyhDb21tb25GdW5jdGlvbiwgW3sKICAgIGtleTogImdldE1haW5Mb2FkaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRNYWluTG9hZGluZygpIHsKICAgICAgdmFyIGVsID0gZG9jdW1lbnQuYm9keS5xdWVyeVNlbGVjdG9yKCIjbWxvYWRpbmciKTsKICAgICAgcmV0dXJuIGVsOwogICAgfQogIH0sIHsKICAgIGtleTogIm1hc2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1hc2soKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuZ2V0TWFpbkxvYWRpbmcoKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJ1bm1hc2siLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVubWFzaygpIHsKICAgICAgdmFyIGVsID0gdGhpcy5nZXRNYWluTG9hZGluZygpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImluZm9Mb2dnaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbmZvTG9nZ2luZygpIHt9CiAgICAvKioNCiAgICAgKiBMb2cgZXJyb3INCiAgICAgKiBAcGFyYW0geyp9IGVycm9yDQogICAgICovCgogIH0sIHsKICAgIGtleTogImVycm9yTG9nZ2luZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZXJyb3JMb2dnaW5nKGVycm9yKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70gZXhjZXB0aW9uDQogICAgICovCgogIH0sIHsKICAgIGtleTogImhhbmRsZUV4Y2VwdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGFuZGxlRXhjZXB0aW9uKGVycm9yLCBzaG93QWxlcnQpIHsKICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CgogICAgICBpZiAoc2hvd0FsZXJ0KSB7CiAgICAgICAgdmFyIG1zZ0JveCA9IG1lc3NhZ2VCb3gsCiAgICAgICAgICAgIGxvY2FsaXplID0gaTE4bjsKICAgICAgICBtc2dCb3guc2hvd0Vycm9yKGxvY2FsaXplLnQoImkxOG5Db21tb24uR2xvYmFsRXJyb3JNZXNzYWdlIikpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBY4butIGzDvSBoaeG7g24gdGjhu4sgZGlhbG9nDQogICAgICogQGF1dGhvciBETlRoYW5nIC0gMzAuMTAuMjAxOQ0KICAgICAqIEROVGhhbmcgLSAwNi4wNS4yMDIwOiBUcm9uZyB0csaw4budbmcgaOG7o3Agb3duZXIgbMOgIHBvcHVwIHRow6wgc+G6vSBhcHBlbmQgdsOgbyBjb250ZW50IMSR4buDIGtow7RuZyBi4buLIGNow6xtIOG7nyBkxrDhu5tpDQogICAgICovCgogIH0sIHsKICAgIGtleTogInByZXBhcmVGb3JEaWFsb2ciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByZXBhcmVGb3JEaWFsb2coY29tcG9uZW50LCBvd25lciwgb3B0aW9ucykgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG93bmVyICYmIGNvbXBvbmVudCkgewogICAgICAgIHZhciBmcm1UeXBlID0gVnVlLmV4dGVuZChjb21wb25lbnQpLAogICAgICAgICAgICBmcm0gPSBuZXcgZnJtVHlwZShvcHRpb25zKTsKICAgICAgICBmcm0uJG1vdW50KCk7CgogICAgICAgIGlmIChvd25lci5pc01zUG9wdXApIHsKICAgICAgICAgIHZhciBjb250ZW50RWxlbWVudCA9IG93bmVyLiRyZWZzLnBvcHVweDsgLy9vd25lci4kZWwucXVlcnlTZWxlY3RvcignLm1zLXBvcHVwLWNvbnRlbnQubXMtcG9wdXAnKTsKCiAgICAgICAgICBjb250ZW50RWxlbWVudC5hcHBlbmRDaGlsZChmcm0uJGVsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG93bmVyIGluc3RhbmNlb2YgRWxlbWVudCkgewogICAgICAgICAgICBvd25lci5hcHBlbmRDaGlsZChmcm0uJGVsKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG93bmVyLiRlbC5hcHBlbmRDaGlsZChmcm0uJGVsKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBmcm07CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KICAgIC8qKg0KICAgICAqIEJ1aWxkIHZ1ZSBrZXkgY2hvIGRhdGENCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2VuVktleVZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZW5WS2V5VmFsdWUoZGF0YSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGZpZWxkID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAiX192S2V5VmFsdWUiOwoKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGl0ZW1bZmllbGRdID0gX3RoaXMuZ2VuZXJhdGVVVUlEKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqICBU4bqhbyB1dWlkDQogICAgICogIENyZWF0ZSBieTogcHZkdW9uZzEgLSAzMC8wOC8yMDE5DQogICAgICovCgogIH0sIHsKICAgIGtleTogImdlbmVyYXRlVVVJRCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuZXJhdGVVVUlEKCkgewogICAgICByZXR1cm4gInh4eHh4eHh4LXh4eHgtNHh4eC15eHh4LXh4eHh4eHh4eHh4eCIucmVwbGFjZSgvW3h5XS9nLCBmdW5jdGlvbiAoYykgewogICAgICAgIHZhciBkID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgZCArPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgICB2YXIgciA9IChkICsgTWF0aC5yYW5kb20oKSAqIDE2KSAlIDE2IHwgMDsKICAgICAgICBkID0gTWF0aC5mbG9vcihkIC8gMTYpOwogICAgICAgIHJldHVybiAoYyA9PT0gIngiID8gciA6IHIgJiAweDMgfCAweDgpLnRvU3RyaW5nKDE2KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiBHdWlsZCBlbXB0eQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZW5lcmF0ZUVtcHR5VVVJRCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuZXJhdGVFbXB0eVVVSUQoKSB7CiAgICAgIHJldHVybiAiMDAwMDAwMDAtMDAwMC0wMDAwLTAwMDAtMDAwMDAwMDAwMDAwIjsKICAgIH0KICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgMiDEkeG7kWkgdMaw4bujbmcgY8OzIHBo4bqjaSBsw6AgY2hhIGNvbiBj4bunYSBuaGF1IGtow7RuZw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYXNQYXJlbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhc1BhcmVudChjaGlsZCwgcGFyZW50KSB7CiAgICAgIGlmIChjaGlsZC5wYXJlbnRFbGVtZW50KSB7CiAgICAgICAgaWYgKGNoaWxkLnBhcmVudEVsZW1lbnQgPT09IHBhcmVudCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB0aGlzLmhhc1BhcmVudChjaGlsZC5wYXJlbnRFbGVtZW50LCBwYXJlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqDQogICAgICogS2nhu4NtIHRyYSDEkeG7kWkgdMaw4bujbmcgY8OzIGNsYXNzIHN0eWxlIGtow7RuZw0KICAgICAqIE1vZGlmaWVkIG5udGFtOiB0aMOqbSBjYXNlIGPhu5FpIHbDoG8gY2hvIGtow7RuZyBjaOG6v3QNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFzQ2xhc3MiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhc0NsYXNzKGVsZW1lbnQsIGNsYXNzTmFtZSkgewogICAgICBpZiAoZWxlbWVudCAmJiBlbGVtZW50LmNsYXNzTmFtZSkgewogICAgICAgIHJldHVybiBlbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mKGNsYXNzTmFtZSkgPiAtMTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0sIHsKICAgIGtleTogInNob3J0a2V5UHVzaFZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3J0a2V5UHVzaFZpZXcoZWwpIHsKICAgICAgd2luZG93LnNob3J0a2V5Vmlldy5yZW1vdmUoZWwpOwogICAgICB3aW5kb3cuc2hvcnRrZXlWaWV3LnB1c2goZWwpOwogICAgfQogIH0sIHsKICAgIGtleTogInNob3J0a2V5UG9wVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvcnRrZXlQb3BWaWV3KGVsKSB7CiAgICAgIHdpbmRvdy5zaG9ydGtleVZpZXcucmVtb3ZlKGVsKTsKICAgIH0KICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHJlbmRlciBlbGVtZW50IMSR4buZbmcNCiAgICAgKiBtb2RpZmllZCBieSBudHBob25nIDI4LzUvMjAyMSAtIGlzQXBwZW5kVGFyZ2V0OiBu4bq/dSBsw6AgYXBwZW5kIDEgxJFv4bqhbiBjb2RlIGh0bWwgdsOgbyAxIHRyb25nIHRhcmdldA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW5kZXJEeW5hbWljRWxlbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVuZGVyRHluYW1pY0VsZW1lbnQodGFyZ2V0LCBjb21wb25lbnQsIG93bmVyLCBvcHRpb25zLCBpc0FwcGVuZFRhcmdldCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKGNvbXBvbmVudCkgewogICAgICAgIHZhciBmcm1UeXBlID0gVnVlLmV4dGVuZChjb21wb25lbnQpLAogICAgICAgICAgICBmcm0gPSBuZXcgZnJtVHlwZShvcHRpb25zKTsKICAgICAgICBmcm0uJG1vdW50KCk7CgogICAgICAgIGlmICh0YXJnZXQgJiYgaXNBcHBlbmRUYXJnZXQgJiYgZnJtLiRlbCkgewogICAgICAgICAgdGFyZ2V0LmFwcGVuZENoaWxkKGZybS4kZWwpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZybTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogZm9jdXMgdsOgbyBjb250cm9sIHRyxrDhu5tjIMSRw7MNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9jdXNQcmV2aWV3Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXNQcmV2aWV3Q29udHJvbChjdXJmb2N1cykgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgdmFyIGZuID0gZnVuY3Rpb24gZm4ocGFyZW50KSB7CiAgICAgICAgdmFyIGl0ZW1zID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0Om5vdChbZGlzYWJsZWRdKSxidXR0b246bm90KFtkaXNhYmxlXSksYSIpOwoKICAgICAgICBpZiAoaXRlbXNbMF0gIT09IGN1cmZvY3VzKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpdGVtc1tpXSA9PT0gY3VyZm9jdXMpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICAgICAgICAvL2NoZWNrIGl0ZW0gdmlzaWJsZQogICAgICAgICAgICAgICAgaWYgKG1lLmlzVmlzaWJsZShpdGVtc1tqXSkpIHsKICAgICAgICAgICAgICAgICAgaXRlbXNbal0uZm9jdXMoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy9yZXNldCBmb2N1cyB0byBwYXJlbnQKCgogICAgICAgICAgICAgIGN1cmZvY3VzID0gcGFyZW50OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmbihwYXJlbnQucGFyZW50RWxlbWVudCk7CiAgICAgIH07CgogICAgICBmbihjdXJmb2N1cy5wYXJlbnRFbGVtZW50KTsKICAgIH0KICAgIC8qKg0KICAgICAgLyoqDQogICAgICogZm9jdXMgdsOgbyBjb250cm9sIHRp4bq/cCB0aGVvDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvY3VzTmV4dENvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzTmV4dENvbnRyb2woY3VyZm9jdXMpIHsKICAgICAgdmFyIGVsID0gdGhpcy5nZXROZXh0SW5wdXRDb250cm9sKGN1cmZvY3VzKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIGVsLmZvY3VzKCk7CgogICAgICAgIGlmICh0eXBlb2YgZWwuc2VsZWN0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICBlbC5zZWxlY3QoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIGVsZW1lbnQgY8OzIGhp4buDbiB0aOG7iyBraMO0bmcNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaXNWaXNpYmxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpc1Zpc2libGUoZWxlbWVudCkgewogICAgICByZXR1cm4gZWxlbWVudC5vZmZzZXRQYXJlbnQ7CiAgICB9CiAgICAvKg0KICAgICAqIEzhuqV5IGNvbnRyb2wgbmjhuq1wIGxp4buHdSB0aeG6v3AgdGhlbw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXROZXh0SW5wdXRDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXROZXh0SW5wdXRDb250cm9sKGN1cnJlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIC8vaSA9IGMuaW5kZXgoKSwKICAgICAgcCA9IGN1cnJlbnQucGFyZW50Tm9kZTsKCiAgICAgIGlmICghcCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICB2YXIgY2ggPSBwLmNoaWxkcmVuLAogICAgICAgICAgciA9IG51bGwsCiAgICAgICAgICBvLAogICAgICAgICAgaSA9IDA7CgogICAgICBmb3IgKDsgaSA8IGNoLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGNoW2ldID09PSBjdXJyZW50KSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAodmFyIGsgPSBpICsgMTsgayA8IGNoLmxlbmd0aDsgaysrKSB7CiAgICAgICAgbyA9IGNoW2tdOwoKICAgICAgICBpZiAoWyJJTlBVVCIsICJURVhUQVJFIiwgIkJVVFRPTiIsICJBIl0uaW5kZXhPZihvLnRhZ05hbWUpID4gLTEgJiYgIW8uZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpICYmICFvLmdldEF0dHJpYnV0ZSgidGFiaW5kZXgiKSAhPT0gLTEgJiYgbWUuaXNWaXNpYmxlKG8pKSB7CiAgICAgICAgICByID0gbzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgciA9IG1lLmdldEZpcnN0Q29udHJvbEZvY3VzKG8pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFyKSB7CiAgICAgICAgciA9IG1lLmdldE5leHRJbnB1dENvbnRyb2wocCk7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgY29udHJvbCBuaOG6rXAgbGnhu4d1IMSR4bqndSB0acOqbg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRGaXJzdENvbnRyb2xGb2N1cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Rmlyc3RDb250cm9sRm9jdXMocGFyZW50KSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBvYmogPSBwYXJlbnQgfHwgZG9jdW1lbnQsCiAgICAgICAgICBzZWxlY3RvciA9IFsnaW5wdXQ6bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9Ii0xIl0pJywgJ3RleHRhcmVhOm5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PSItMSJdKScsICdzZWxlY3Q6bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9Ii0xIl0pJywgJ2J1dHRvbjpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD0iLTEiXSk6bm90KC5tcy1jb24tZHJvcGRvd24pJywgJ2E6bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9Ii0xIl0pOm5vdCgubXMtY29sbGFwc2UtaXRlbS0taGVhZGVyKSddLmpvaW4oIiwiKTsKICAgICAgdmFyIGl0ZW1zID0gb2JqLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpOwoKICAgICAgaWYgKGl0ZW1zICE9IG51bGwgJiYgaXRlbXMubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBpdGVtID0gaXRlbXNbaV07CgogICAgICAgICAgaWYgKG1lLmlzVmlzaWJsZShpdGVtKSkgewogICAgICAgICAgICByZXR1cm4gaXRlbTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqDQogICAgICogVMOsbSByYSBjb250cm9sIElucHV0IMSR4bqndSB0acOqbiB0aGVvIHNjb3BlIHRydXnhu4FuIHbDoG8gdsOgIGNobyBwaMOpcCBz4butYQ0KICAgICAqIEBwYXJhbSB7RWxlbWVudH0gc2NvcGUgUGFyZW50IGPhuqduIHTDrG0gaW5wdXQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmluZEZpcnN0Q29udHJvbElucHV0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kRmlyc3RDb250cm9sSW5wdXQoc2NvcGUpIHsKICAgICAgaWYgKHNjb3BlICYmIHNjb3BlLnF1ZXJ5U2VsZWN0b3IpIHsKICAgICAgICB2YXIgaW5wdXQgPSBzY29wZS5xdWVyeVNlbGVjdG9yKCJpbnB1dDpub3QoW3R5cGU9YnV0dG9uXSk6bm90KFt0eXBlPXJhZGlvXSk6bm90KFt0eXBlPWNoZWNrYm94XSk6bm90KFtyZWFkb25seV0pOm5vdChbZGlzYWJsZWRdKTpub3QoW2NsYXNzPSdoaWRkZW4nXSksdGV4dGFyZWE6bm90KFtyZWFkb25seV0pOm5vdChbZGlzYWJsZWRdKTpub3QoW2NsYXNzPSdoaWRkZW4nXSkiKTsKICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KICAgIC8qKg0KICAgICAqIFThu7EgxJHhu5luZyBmb2N1cyB2w6BvIGNvbnRyb2wgbmjhuq1wIGxp4buHdSDEkeG6p3UgdGnDqm4gdGhlbyBzY29wZSB0cnV54buBbiB2w6BvDQogICAgICogQHBhcmFtIHtFbGVtZW50fSBzY29wZSBQaOG6oW0gdmkgY+G6p24geOG7rSBsw70gZm9jdXMNCiAgICAgKiBAYXV0aG9yIEROVGhhbmcgLSAzMS4xMC4yMDE5DQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvY3VzRmlyc3RDb250cm9sSW5wdXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzRmlyc3RDb250cm9sSW5wdXQoc2NvcGUpIHsKICAgICAgdmFyIHNlbGVjdCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsKICAgICAgdmFyIG1lID0gdGhpczsgLy8gc2V0VGltZW91dCgoKSA9PiB7CgogICAgICB2YXIgaW5wdXQgPSBtZS5maW5kRmlyc3RDb250cm9sSW5wdXQoc2NvcGUpOwoKICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgaW5wdXQuZm9jdXMoKTsKCiAgICAgICAgaWYgKHNlbGVjdCAmJiB0eXBlb2YgaW5wdXQuc2VsZWN0ID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICBpbnB1dC5zZWxlY3QoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy9u4bq/dSBrIGPDsyBpbnB1dCBuw6BvIMSR4buDIGZvY3VzIHRow6wgZm9jdXMgdsOgbyBkw7JuZyDEkeG6p3UgdGnDqm4gY+G7p2EgZ3JpZCggbuG6v3UgY8OzICkgxJHhu4MgY8OzIHRo4buDIHRo4buxYyBoaeG7h24gcGjDrW0gdOG6r3Qga2V5ZG93biB1cC9kb3duIMSR4buDIGNo4buNbiBkw7JuZwogICAgICAgIG1lLmZvY3VzRmlyc3RSb3dHcmlkKHNjb3BlKTsKICAgICAgfSAvLyB9KTsKCiAgICB9CiAgICAvKioNCiAgICAgKiBU4buxIMSR4buZbmcgZm9jdXMgdsOgbyBjb250cm9sIG5o4bqtcCBsaeG7h3UgxJHhuqd1IHRpw6puIHRoZW8gc2NvcGUgdHJ1eeG7gW4gdsOgbw0KICAgICAqIEBwYXJhbSB7RWxlbWVudH0gc2NvcGUgUGjhuqFtIHZpIGPhuqduIHjhu60gbMO9IGZvY3VzDQogICAgICogQGF1dGhvciBibmR1YyAtIDE1LjExLjIwMTkNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9jdXNGaXJzdENvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzRmlyc3RDb250cm9sKHNjb3BlKSB7CiAgICAgIGlmIChzY29wZSkgewogICAgICAgIHZhciBtZSA9IHRoaXM7IC8vIHNldFRpbWVvdXQoKCkgPT4gewoKICAgICAgICB2YXIgaW5wdXQ7CgogICAgICAgIGlmIChzY29wZS50eXBlID09PSAidGV4dCIgfHwgc2NvcGUuaGFzQXR0cmlidXRlICYmIHNjb3BlLmhhc0F0dHJpYnV0ZSgidHlwZSIpICYmIHNjb3BlLmdldEF0dHJpYnV0ZSgidHlwZSIpID09PSAidGV4dCIpIHsKICAgICAgICAgIGlucHV0ID0gc2NvcGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlucHV0ID0gbWUuZmluZEZpcnN0Q29udHJvbEZvY3VzKHNjb3BlKTsKICAgICAgICB9CgogICAgICAgIGlmIChpbnB1dCkgewogICAgICAgICAgaW5wdXQuZm9jdXMoKTsKICAgICAgICB9IC8vIH0pOwoKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogVOG7sSDEkeG7mW5nIGZvY3VzIHbDoG8gY29udHJvbCBuaOG6rXAgbGnhu4d1IHbDoG8gZMOybmcgxJHhuqd1IHRpw6puIGPhu6dhIGdyaWQoIG7hur91IGPDsyApIMSR4buDIGPDsyB0aOG7gyB0aOG7sWMgaGnhu4duIHBow61tIHThuq90IGtleWRvd24gdXAvZG93biDEkeG7gyBjaOG7jW4gZMOybmcNCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHNjb3BlIFBo4bqhbSB2aSBj4bqnbiB44butIGzDvSBmb2N1cw0KICAgICAqIEBhdXRob3Igbm5sYW0gLSAxNi4wNi4yMDIxDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvY3VzRmlyc3RSb3dHcmlkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1c0ZpcnN0Um93R3JpZChzY29wZSkgewogICAgICBpZiAoc2NvcGUpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKCiAgICAgICAgdmFyIGdyaWQ7CgogICAgICAgIGlmIChtZS5ncmlkKSB7CiAgICAgICAgICBncmlkID0gbWUuZ3JpZC4kZWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGdyaWQgPSBtZS5maW5kRmlyc3RHcmlkKHNjb3BlKTsKICAgICAgICB9CgogICAgICAgIGlmIChncmlkKSB7CiAgICAgICAgICAvL21lLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICBpZiAoZ3JpZCAmJiAhZ3JpZC5jbGFzc0xpc3QuY29udGFpbnMoJ25vdEF1dG9Gb2N1cycpKSB7CiAgICAgICAgICAgIHZhciB0ckZpcnN0ID0gZ3JpZC5xdWVyeVNlbGVjdG9yKCIubXMtdGJvZHkuZGF0YSB0ciIpOwoKICAgICAgICAgICAgaWYgKHRyRmlyc3QpIHsKICAgICAgICAgICAgICB0ckZpcnN0LmZvY3VzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIFTDrG0gcmEgY29udHJvbCBJbnB1dCDEkeG6p3UgdGnDqm4gdGhlbyBzY29wZSB0cnV54buBbiB2w6BvIHbDoCBjaG8gcGjDqXAgc+G7rWENCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHNjb3BlIFBhcmVudCBj4bqnbiB0w6xtIGlucHV0DQogICAgICogQGF1dGhvciBibmR1YyAtIDE1LjExLjIwMTkNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmluZEZpcnN0Q29udHJvbEZvY3VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kRmlyc3RDb250cm9sRm9jdXMoc2NvcGUpIHsKICAgICAgaWYgKHNjb3BlICYmIHNjb3BlLnF1ZXJ5U2VsZWN0b3IpIHsKICAgICAgICB2YXIgaW5wdXQgPSBzY29wZS5xdWVyeVNlbGVjdG9yKCJpbnB1dDpub3QoW3JlYWRvbmx5XSk6bm90KFtkaXNhYmxlZF0pLGJ1dHRvbjpub3QoW2Rpc2FibGVdKSxhLHRleHRhcmVhIik7CiAgICAgICAgcmV0dXJuIGlucHV0OwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CiAgICAvKioNCiAgICAgKiBUw6xtIHJhIGdyaWQgxJHhuqd1IHRpw6puIGPhu6dhIGZvcm0NCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHNjb3BlIFBhcmVudCBj4bqnbiB0w6xtIGdyaWQNCiAgICAgKiBAYXV0aG9yIG5ubGFtIC0gMTYuMDYuMjAyMQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaW5kRmlyc3RHcmlkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kRmlyc3RHcmlkKHNjb3BlKSB7CiAgICAgIGlmIChzY29wZSAmJiBzY29wZS5xdWVyeVNlbGVjdG9yKSB7CiAgICAgICAgdmFyIGdyaWQgPSBzY29wZS5xdWVyeVNlbGVjdG9yKCIubXMtZ3JpZC12aWV3ZXIiKTsKICAgICAgICByZXR1cm4gZ3JpZDsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70ga2hpIGZvY3VzIGNvbnRyb2wgY3Xhu5FpIGPDuW5nIHRow6wgc+G6vSB0aOG7sWMgdGhpIGZuDQogICAgICovCgogIH0sIHsKICAgIGtleTogInByb2Nlc3NVbmZvY3VzTGFzdENvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByb2Nlc3NVbmZvY3VzTGFzdENvbnRyb2woZSwgZm4pIHsKICAgICAgaWYgKGUud2hpY2ggPT09IDkgJiYgIWUuc2hpZnRLZXkpIHsKICAgICAgICAvL2NvbnNvbGUubG9nKGUudGFyZ2V0LmF0dHJpYnV0ZXMuY2xhc3MudmFsdWUpOwogICAgICAgIHZhciBjdXIgPSBlLnRhcmdldDsKICAgICAgICB2YXIgZWxzID0gZS5jdXJyZW50VGFyZ2V0LnF1ZXJ5U2VsZWN0b3JBbGwoIioiKTsKICAgICAgICB2YXIgZmxhZyA9IHRydWU7CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAoZWxzW2ldID09PSBjdXIpIHsKICAgICAgICAgICAgZmxhZyA9IGZhbHNlOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZmxhZykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBlbHNbaV0uZm9jdXMoKTsKCiAgICAgICAgICBpZiAoZWxzW2ldID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgIH0gLy9mb2N1cyBmaXJzdCBjb250cm9sCgoKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZm4oKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogS2nhu4NtIHRyYSAyIMSRw7RpIHTGsOG7o25nIGPDsyBraMOhYyBuaGF1IGtow7RuZw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjaGVja0RpZmYiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrRGlmZihuZXdWYWwsIG9sZFZhbCkgewogICAgICB2YXIgcmV0ID0gZmFsc2U7CgogICAgICBpZiAoX3R5cGVvZihuZXdWYWwpID09ICJvYmplY3QiICYmIF90eXBlb2Yob2xkVmFsKSA9PSAib2JqZWN0IikgewogICAgICAgIGZvciAodmFyIGZpZWxkIGluIG5ld1ZhbCkgewogICAgICAgICAgaWYgKF90eXBlb2YobmV3VmFsW2ZpZWxkXSkgIT0gIm9iamVjdCIgJiYgbmV3VmFsW2ZpZWxkXSAhPSBvbGRWYWxbZmllbGRdKSB7CiAgICAgICAgICAgIHJldCA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJldDsKICAgIH0KICAgIC8qKg0KICAgICAqIHB2ZHV5IDI4LzA2LzIwMjENCiAgICAgKiBs4bqpeSByYSBkYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIHRoYXkgxJHhu5VpIHbDoCBnacOhIHRy4buLIHRoYXkgxJHhu5VpDQogICAgICogdGjDqm0gxJFv4bqhbiB44butIGzDvSB0csaw4budbmcgaOG7o3AgdMOsbSBz4buxIHRoYXkgxJHhu5VpIGPhu61hIGdpw6EgdHLhu4sgZGF0ZXRpbWUNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RGlmZkxpc3RQcm9wZXJ0eSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RGlmZkxpc3RQcm9wZXJ0eShuZXdWYWwsIG9sZFZhbCkgewogICAgICB2YXIgbGlzdEZpZWxkID0gW107CgogICAgICBpZiAoX3R5cGVvZihuZXdWYWwpID09ICJvYmplY3QiICYmIF90eXBlb2Yob2xkVmFsKSA9PSAib2JqZWN0IikgewogICAgICAgIGZvciAodmFyIGZpZWxkIGluIG5ld1ZhbCkgewogICAgICAgICAgaWYgKF90eXBlb2YobmV3VmFsW2ZpZWxkXSkgIT0gIm9iamVjdCIgJiYgbmV3VmFsW2ZpZWxkXSAhPSBvbGRWYWxbZmllbGRdKSB7CiAgICAgICAgICAgIGxpc3RGaWVsZC5wdXNoKGZpZWxkKTsKICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsW2ZpZWxkXSBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAgICAgICAgdmFyIGlzQ2hhbmdlID0gZmFsc2U7IC8vIG7hur91IDIgZ2nDoSB0cuG7iyBraMOhYyBuaGF1IGhv4bq3YyBt4buZdCB0cm9uZyAyIHRo4bqxbmcgbnVsbCB0aMOsIHjDoWMgbmjhuq1uIHPhu7EgdGhheSDEkeG7lWkuCgogICAgICAgICAgICBpZiAobmV3VmFsW2ZpZWxkXSAhPSBudWxsICYmIG9sZFZhbFtmaWVsZF0gIT0gbnVsbCAmJiB0eXBlb2YgbmV3VmFsW2ZpZWxkXS5nZXRUaW1lID09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIG9sZFZhbFtmaWVsZF0uZ2V0VGltZSA9PSAiZnVuY3Rpb24iICYmIG5ld1ZhbFtmaWVsZF0uZ2V0VGltZSgpICE9IG9sZFZhbFtmaWVsZF0uZ2V0VGltZSgpKSB7CiAgICAgICAgICAgICAgaXNDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbFtmaWVsZF0gPT0gbnVsbCAmJiBvbGRWYWxbZmllbGRdICE9IG51bGwgfHwgbmV3VmFsW2ZpZWxkXSA9PSBudWxsICYmIG9sZFZhbFtmaWVsZF0gIT0gbnVsbCkgewogICAgICAgICAgICAgIGlzQ2hhbmdlID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGlzQ2hhbmdlKSB7CiAgICAgICAgICAgICAgbGlzdEZpZWxkLnB1c2goZmllbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbGlzdEZpZWxkOwogICAgfSAvL0NodXnhu4NuIGThu68gbGnhu4d1IHRow6BuaCBk4bqhbmcgdHJlZQogICAgLy8gQ3JlYXRlZCBieSBMVERBVCgxNi4wNi4yMDIwKQoKICB9LCB7CiAgICBrZXk6ICJub21hbGl6ZURhdGFUcmVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBub21hbGl6ZURhdGFUcmVlKGRhdGEsIGlkRmllbGQsIHBhcmVudEZpZWxkKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICB2YXIgZGF0YVRlbXAgPSBfdG9Db25zdW1hYmxlQXJyYXkoZGF0YSksCiAgICAgICAgICBwYXJlbnROb2RlcyA9IFtdOwoKICAgICAgZGF0YVRlbXAuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICBpZiAoIWl0ZW0uaGFzT3duUHJvcGVydHkoInBhcmVudE5vZGUiKSkgewogICAgICAgICAgaXRlbVsicGFyZW50Tm9kZSJdID0gW107CiAgICAgICAgfQoKICAgICAgICBpZiAoaXRlbVtwYXJlbnRGaWVsZF0pIHsKICAgICAgICAgIC8vVMOsbSBjaGEKICAgICAgICAgIHZhciBwYXJlbnQgPSBfLmZpbmQoZGF0YVRlbXAsIGZ1bmN0aW9uIChvKSB7CiAgICAgICAgICAgIHJldHVybiBvW2lkRmllbGRdID09PSBpdGVtW3BhcmVudEZpZWxkXTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChwYXJlbnQpIHsKICAgICAgICAgICAgaXRlbS5wYXJlbnROb2RlID0gcGFyZW50OwoKICAgICAgICAgICAgaWYgKCFwYXJlbnQuaGFzT3duUHJvcGVydHkoImNoaWxkTm9kZXMiKSkgewogICAgICAgICAgICAgIHBhcmVudFsiY2hpbGROb2RlcyJdID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghcGFyZW50Lmhhc093blByb3BlcnR5KCJpc1BhcmVudCIpKSB7CiAgICAgICAgICAgICAgcGFyZW50WyJpc1BhcmVudCJdID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGFyZW50LmNoaWxkTm9kZXMucHVzaChpdGVtKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhcmVudE5vZGVzLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIE5NU0lOSDogdGjDqm0gbcOzbiBuw6B5IHbDrCBu4bq/dSBjaOG7jW4gdGjhurFuZyBrbyBjw7MgQ2hhIHRyb25nIGxpc3QgdGjDrCBuw7MgY2jDrW5oIGzDoCBjaGEgbHXDtG4KICAgICAgICAgIHBhcmVudE5vZGVzLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHBhcmVudE5vZGVzOwogICAgfQogICAgLyoqDQogICAgICogVGjhu7FjIGhp4buHbiBnaMOpcCBjw6FjIG5vZGUgY2hhIMSRaSBrw6htIHbhu5tpIGPDoWMgbm9kZSBjb24gbHXDtG4gxJHhu4MgdGjhu7FjIGhp4buHbiBzaG93IHJhIG5nYXkgYsOqbiBkxrDhu5tpIG5vZGUgY2hhDQogICAgICogQHBhcmFtIHtbVHJlZU1vZGVsXX0gZGF0YVJlc291cmVzIERhbmggc8OhY2ggY8OhYyBub2RlIGNoYSBj4bqnbiBz4bqvcCB44bq/cA0KICAgICAqIEBwYXJhbSB7Kn0gZXhwYW5kZWQgQ8OzIE3hu58gcuG7mW5nIHJhIGtow7RuZw0KICAgICAqIEBwYXJhbSB7Kn0gbGV2ZWwNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Qm9keURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEJvZHlEYXRhKGRhdGFSZXNvdXJlcywgZXhwYW5kZWQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgbGV2ZWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IDE7CiAgICAgIHZhciBjaGlsZE5vZGVzID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgJiYgYXJndW1lbnRzWzNdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbM10gOiAiY2hpbGROb2RlcyI7CgogICAgICBpZiAoIWRhdGFSZXNvdXJlcykgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQoKICAgICAgdmFyIGRhdGEgPSBfdG9Db25zdW1hYmxlQXJyYXkoZGF0YVJlc291cmVzKTsKCiAgICAgIHZhciBib2R5RGF0YSA9IFtdOwogICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdywgaW5kZXgpIHsKICAgICAgICB2YXIgY2hpbGRyZW4gPSByb3dbY2hpbGROb2Rlc107CiAgICAgICAgdmFyIGNoaWxkcmVuTGVuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGNoaWxkcmVuKS5zbGljZSg4LCAtMSkgPT09ICJBcnJheSIgPyBjaGlsZHJlbi5sZW5ndGggOiAwOwogICAgICAgIHJvdy5sZXZlbCA9IGxldmVsOwogICAgICAgIFZ1ZS5zZXQocm93LCAiaXNIaWRlIiwgZmFsc2UpOwogICAgICAgIFZ1ZS5zZXQocm93LCAiZXhwYW5kZWQiLCBleHBhbmRlZCk7IC8vIHJvdy5leHBhbmRlZCA9IGV4cGFuZGVkOwoKICAgICAgICByb3cuaXNTZWxlY3RlZCA9IGZhbHNlOwogICAgICAgIHJvdy5faXNTZWxlY3RlZE11bHRpcGxlID0gZmFsc2U7CiAgICAgICAgYm9keURhdGEucHVzaChyb3cpOwoKICAgICAgICBpZiAoY2hpbGRyZW5MZW4gPiAwKSB7CiAgICAgICAgICByb3cuX2V4cGFuZGFibGUgPSB0cnVlOwogICAgICAgICAgYm9keURhdGEgPSBib2R5RGF0YS5jb25jYXQoX3RoaXMyLmdldEJvZHlEYXRhKGNoaWxkcmVuLCBleHBhbmRlZCwgbGV2ZWwgKyAxKSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGJvZHlEYXRhOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgZ2nDoSB0cuG7iyBlbnVtIHRoZW8gdGV4dA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRFbnVtVmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVudW1WYWx1ZShlbnVtTmFtZSwgdGV4dCkgewogICAgICB2YXIgc291cmNlID0gdGhpcy5nZXRFbnVtU291cmNlKGVudW1OYW1lKTsKICAgICAgdmFyIHRleHRUcmltID0gdGV4dC50cmltKCk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBpdGVtID0gc291cmNlW2ldOwoKICAgICAgICBpZiAodGV4dFRyaW0gPT09IGl0ZW0uZW51bVRleHQpIHsKICAgICAgICAgIHJldHVybiBpdGVtLmVudW1WYWx1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgcmEgZ2nDoSB0cuG7iyBrZXkgY+G7p2EgZW51bSB0aGVvIHZhbHVlDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIEdpw6EgdHLhu4sgY+G7p2EgZW51bSBj4bqnbiBs4bqleSByYSBlbnVtIHRleHQNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZW51bU5hbWUgRW51bU5hbWUgxJHhu4MgZ2V0IHRleHQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RW51bVRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVudW1UZXh0KHZhbHVlLCBlbnVtTmFtZSkgewogICAgICB2YXIgZSA9IE1TRW51bVtlbnVtTmFtZV0sCiAgICAgICAgICBsb2NhbGl6ZSA9IGkxOG47CgogICAgICBpZiAoZSkgewogICAgICAgIGZvciAodmFyIGtleSBpbiBlKSB7CiAgICAgICAgICBpZiAoZS5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGVba2V5XSA9PT0gdmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiB2YWx1ZTsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHJhIHJlc291cmNlIHRoZW8gZW51bQ0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZSBHacOhIHRy4buLIGPhu6dhIGVudW0gY+G6p24gbOG6pXkgcmEgZW51bSByZXNvdXJjZQ0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlbnVtTmFtZSBFbnVtTmFtZSDEkeG7gyBnZXQgdGV4dA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRFbnVtUmVzb3VyY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVudW1SZXNvdXJjZSh2YWx1ZSwgZW51bU5hbWUpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGxvY2FsaXplID0gaTE4bjsKICAgICAgdmFyIGtleSA9IG1lLmdldEVudW1UZXh0KHZhbHVlLCBlbnVtTmFtZSk7CiAgICAgIHZhciByZXNvdXJjZUtleSA9IGVudW1OYW1lICsgIi4iICsga2V5OwogICAgICB2YXIgdGV4dCA9IGxvY2FsaXplLnQoImkxOG5FbnVtLiIgKyByZXNvdXJjZUtleSk7CiAgICAgIHJldHVybiB0ZXh0OwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgZW51bXNvdXJjZSB24bubaSB0w6puIGVudW0gdHJ1eeG7gW4gdsOgbw0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlbnVtTmFtZSBUw6puIGVudW0gdHJvbmcgZW51bWVyYXRpb24NCiAgICAgKiBAcGFyYW0ge0FycmF5fSB2YWx1ZXMgRGFuaCBzw6FjaCBjw6FjIGVudW0gbOG6pXkgcmEgKG7hur91IGPhuqduIGNo4buJIMSR4buLbmgpLCBu4bq/dSBraMO0bmcgdGjDrCBz4bq9IGzhuqV5IHThuqV0IGPhuqMNCiAgICAgKiBAcGFyYW0ge0Jvb2xlYW59IHByZWZpeElkeCBDw7Mga8OobSB0aGVvIHRp4buBbiB04buRIGluZGV4IGtow7RuZzogdHJ1ZSAtIGPDsywgZmFsc2UgLSBraMO0bmcgKE3hurdjIMSR4buLbmgga2jDtG5nKQ0KICAgICAqIFZEOiBnZXRFbnVtU291cmNlKCJFbnVtQ0FCQVJlYXNvblR5cGUiLFsxMCwxMSwxMiwxM10pDQogICAgICogQ3JlYXRlZEJ5OiBQREtJRU4gMTUvMDgvMjAxOQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRFbnVtU291cmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFbnVtU291cmNlKGVudW1OYW1lLCB2YWx1ZXMsIHByZWZpeElkeCkgewogICAgICB2YXIgZSA9IE1TRW51bVtlbnVtTmFtZV0sCiAgICAgICAgICBhcnIgPSBbXSwKICAgICAgICAgIGxvY2FsaXplID0gaTE4bjsKCiAgICAgIGlmIChlKSB7CiAgICAgICAgdmFyIGlkeCA9IDA7CgogICAgICAgIGZvciAodmFyIGtleSBpbiBlKSB7CiAgICAgICAgICBpZiAoZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7CiAgICAgICAgICAgIHZhciB2ID0gZVtrZXldLAogICAgICAgICAgICAgICAgaXggPSAtMTsKCiAgICAgICAgICAgIGlmICghdmFsdWVzIHx8IChpeCA9IHZhbHVlcy5pbmRleE9mKHYpKSA+IC0xKSB7CiAgICAgICAgICAgICAgLyoNCiAgICAgICAgICAgICAgICogc+G7rWEgbOG6oWkgY8OhY2ggbOG6pXkgZOG7ryBsaeG7h3UgdGhlbyBlbnVtDQogICAgICAgICAgICAgICAqIHB2ZHV5IDAyLzAyLzIwMjANCiAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgdmFyIGVudW1UZXh0ID0gbG9jYWxpemUudCgiaTE4bkVudW0uIiArIGVudW1OYW1lICsgIi4iICsga2V5KTsKCiAgICAgICAgICAgICAgaWYgKHByZWZpeElkeCkgewogICAgICAgICAgICAgICAgZW51bVRleHQgPSArK2lkeCArICIuICIgKyBlbnVtVGV4dDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBpdGVtID0gewogICAgICAgICAgICAgICAgZW51bVZhbHVlOiB2LAogICAgICAgICAgICAgICAgZW51bUtleToga2V5LAogICAgICAgICAgICAgICAgZW51bVRleHQ6IGVudW1UZXh0CiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGl4ID4gLTEpIHsKICAgICAgICAgICAgICAgIC8vIERWUVVBTjogc+G7rWEgbOG6oWkgY8OhY2ggbOG6pXkgZW51bSBzb3VyY2UgduG7m2kgdHLGsOG7nW5nIGjhu6NwIDkgdsOgIDk5ID0+IGtow7RuZyBs4bqleSDEkcaw4bujYyAxIHRyb25nIDIKICAgICAgICAgICAgICAgIGlmIChhcnJbaXhdKSB7CiAgICAgICAgICAgICAgICAgIGFyclthcnIubGVuZ3RoXSA9IGl0ZW07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBhcnJbaXhdID0gaXRlbTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXJyLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gYXJyOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgdGhhbSBz4buRIHRyw6puIHF1ZXJ5IHN0cmluZw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRVcmxQYXJhbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFVybFBhcmFtcygpIHsKICAgICAgdmFyIHNlYXJjaDsKCiAgICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaCkgewogICAgICAgIHNlYXJjaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigxKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoOwogICAgICB9CgogICAgICB2YXIgdGVtcCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoc2VhcmNoKTsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwoKICAgICAgdmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKHRlbXAua2V5cygpKSwKICAgICAgICAgIF9zdGVwOwoKICAgICAgdHJ5IHsKICAgICAgICBmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykgewogICAgICAgICAgdmFyIHZhbHVlID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICByZXN1bHRbdmFsdWVdID0gdGVtcC5nZXQodmFsdWUpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBfaXRlcmF0b3IuZigpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqDQogICAgICogQnVpbGQgcXVlcnkgc3RyaW5nIHBhcmFtDQogICAgICogQHBhcmFtIHsqfSBwYXJhbXMNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiYnVpbGRRdWVyeVN0cmluZ1BhcmFtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYnVpbGRRdWVyeVN0cmluZ1BhcmFtcyhwYXJhbXMpIHsKICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocGFyYW1zKTsKICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtcy50b1N0cmluZygpOwogICAgfQogICAgLyoqDQogICAgICogxJDEg25nIHh14bqldCBraOG7j2kg4bupbmcgZOG7pW5nDQogICAgICogVEROR0hJQSA0LzQvMjAyMiBz4butYSBs4bqhaSBu4bq/dSDEkW5hZyDhu58gbcO0aSB0csaw4budbmcgcGjDoXQgdHJp4buDbiB0aMOsIHbhu4EgdHJhbmcgZGV2LWxvZ2luDQogICAgICovCgogIH0sIHsKICAgIGtleTogImxvZ29mZiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9nb2ZmKCkgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICJkZXZlbG9wbWVudCIpIHsKICAgICAgICB0aGlzLnJlZGlyZWN0KCIvZGV2LWxvZ2luIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5yZWRpcmVjdCgiL2xvZ291dCIpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBSZWRpcmVjdCDhu6luZyBk4bulbmcgdOG7m2kgbcOgbiBow6xuaCBraMOhYw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSB1cmwNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVkaXJlY3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZGlyZWN0KHVybCkgewogICAgICBsb2NhdGlvbi5ocmVmID0gdXJsOwogICAgfQogICAgLyoqDQogICAgICogRG93bmxvYWQNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGluaw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkb3dubG9hZExpbmsiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRvd25sb2FkTGluayhsaW5rKSB7CiAgICAgIHZhciBhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImFkb3dubG9hZCIpOwogICAgICBhLmhyZWYgPSBsaW5rOwogICAgICBhLmNsaWNrKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiBHw6FuIGNvb2tpZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzZXRDb29raWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldENvb2tpZShuYW1lLCB2YWx1ZSwgaG91cnMpIHsKICAgICAgdmFyIGV4cGlyZXMgPSAiIjsKCiAgICAgIGlmIChob3VycykgewogICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyBob3VycyAqIDYwICogNjAgKiAxMDAwKTsKICAgICAgICBleHBpcmVzID0gIjsgZXhwaXJlcz0iICsgZGF0ZS50b1VUQ1N0cmluZygpOwogICAgICB9CgogICAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgIj0iICsgKHZhbHVlIHx8ICIiKSArIGV4cGlyZXMgKyAiOyBwYXRoPS8iOwogICAgfQogICAgLyoqDQogICAgICogxJDhu41jIGNvb2tpZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb29raWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvb2tpZShuYW1lKSB7CiAgICAgIHZhciBuYW1lRVEgPSBuYW1lICsgIj0iOwogICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoIjsiKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2EubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgYyA9IGNhW2ldOwoKICAgICAgICB3aGlsZSAoYy5jaGFyQXQoMCkgPT0gIiAiKSB7CiAgICAgICAgICBjID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGMuaW5kZXhPZihuYW1lRVEpID09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgLyoqDQogICAgICogWMOzYSBjb29raWUNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlQ29va2llIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVDb29raWUobmFtZSkgewogICAgICBkb2N1bWVudC5jb29raWUgPSBuYW1lICsgIj07IFBhdGg9LzsgRXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAxIEdNVDsiOwogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70gZOG7ryBsaeG7h3UgdHLhuqMgduG7gSB04burIHNlcnZlcg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwcm9jZXNzU2VydmVyUmVzcG9uc2VEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcm9jZXNzU2VydmVyUmVzcG9uc2VEYXRhKGRhdGEpIHsKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICB2YXIgcmcgPSAvXGR7NH0tWzAxXVxkLVswLTNdXGRUWzAtMl1cZDpbMC01XVxkOlswLTVdXGQvOwoKICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHsKICAgICAgICAgIGlmIChkYXRhW2ldKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YVtpXSA9PT0gInN0cmluZyIgJiYgaS5pbmRleE9mKCJEYXRlIikgPiAtMSAmJiByZy50ZXN0KGRhdGFbaV0pKSB7CiAgICAgICAgICAgICAgZGF0YVtpXSA9IG5ldyBEYXRlKGRhdGFbaV0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKF90eXBlb2YoZGF0YVtpXSkgPT09ICJvYmplY3QiICYmIE9iamVjdC5rZXlzKGRhdGFbaV0ubGVuZ3RoID4gMCkpIHsKICAgICAgICAgICAgICB0aGlzLnByb2Nlc3NTZXJ2ZXJSZXNwb25zZURhdGEoZGF0YVtpXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHRleHQgaGnhu4NuIHRo4buLIGPhu6dhIHRyxrDhu51uZyB0aMO0bmcgdGluDQogICAgICogQHBhcmFtIHsqfSBmaWVsZCA6IFTDqm4gdHLGsOG7nW5nDQogICAgICogQHBhcmFtIHsqfSBuYW1lc3BhY2UgOiBtw6MgxJHhu4MgeGVtIGPDsyBjdXN0b20gbOG6oWkga2jDtG5nLCBu4bq/dSBraMO0bmcgdGjDrCBs4bqleSBt4bq3YyDEkeG7i25oDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbHVtblRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENvbHVtblRleHQoZmllbGQsIG5hbWVzcGFjZSkgewogICAgICB2YXIgbG9jYWxpemUgPSBpMThuLAogICAgICAgICAgY29tbW9uID0gbG9jYWxpemUubWVzc2FnZXNbbG9jYWxpemUubG9jYWxlXVsiaTE4bkNvbHVtbiJdLAogICAgICAgICAgY3VzdG9tID0gbmFtZXNwYWNlID8gY29tbW9uW25hbWVzcGFjZV0gOiBudWxsOwoKICAgICAgaWYgKGN1c3RvbSAmJiBjdXN0b20uaGFzT3duUHJvcGVydHkoZmllbGQpKSB7CiAgICAgICAgcmV0dXJuIGN1c3RvbVtmaWVsZF07CiAgICAgIH0KCiAgICAgIHJldHVybiBjb21tb25bZmllbGRdOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgdGV4dCBoaeG7g24gdGjhu4sgY+G7p2EgYuG6o25nDQogICAgICogQHBhcmFtIHsqfSB0YWJsZSA6IFTDqm4gYuG6o25nDQogICAgICogQHBhcmFtIHsqfSBuYW1lc3BhY2UgOiBtw6MgxJHhu4MgeGVtIGPDsyBjdXN0b20gbOG6oWkga2jDtG5nLCBu4bq/dSBraMO0bmcgdGjDrCBs4bqleSBt4bq3YyDEkeG7i25oDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFRhYmxlVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VGFibGVUZXh0KHRhYmxlLCBuYW1lc3BhY2UpIHsKICAgICAgdmFyIGxvY2FsaXplID0gaTE4biwKICAgICAgICAgIGNvbW1vbiA9IGxvY2FsaXplLm1lc3NhZ2VzW2xvY2FsaXplLmxvY2FsZV1bImkxOG5UYWJsZSJdLAogICAgICAgICAgY3VzdG9tID0gbmFtZXNwYWNlID8gY29tbW9uW25hbWVzcGFjZV0gOiBudWxsOwoKICAgICAgaWYgKGN1c3RvbSAmJiBjdXN0b20uaGFzT3duUHJvcGVydHkodGFibGUpKSB7CiAgICAgICAgcmV0dXJuIGN1c3RvbVt0YWJsZV07CiAgICAgIH0KCiAgICAgIHJldHVybiBjb21tb25bdGFibGVdOwogICAgfQogICAgLyoqDQogICAgICogTWFwaW5nIHThu6sgaHRtbCBlbGVtZW50IHRow6BuaCDEkeG7kWkgdMaw4bujbmcgdnVlanMgxJHhu4MgdGhhbyB0w6FjDQogICAgICogQHBhcmFtIHtvYmplY3R9IGRvbSBodG1sIGRvbWUgZWxlbWVudA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJtYXBEb21Ub1Z1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbWFwRG9tVG9WdWUoZG9tKSB7CiAgICAgIHJldHVybiBkb20uX192dWVfXzsKICAgIH0KICAgIC8qKg0KICAgICAqIENodXnhu4NuIHRp4bq/bmcgdmnhu4d0IGPDsyBk4bqldSB0aMOgbmgga2jDtG5nIGThuqV1DQogICAgICogQGF1dGhvciDEkFZUaGkgMDkvMDMvMjAyMQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVWaWV0bmFtZXNlVG9uZXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVZpZXRuYW1lc2VUb25lcyhzdHIpIHsKICAgICAgaWYgKHN0cikgewogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DoHzDoXzhuqF84bqjfMOjfMOifOG6p3zhuqV84bqtfOG6qXzhuqt8xIN84bqxfOG6r3zhurd84bqzfOG6tS9nLCAiYSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DqHzDqXzhurl84bq7fOG6vXzDqnzhu4F84bq/fOG7h3zhu4N84buFL2csICJlIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OsfMOtfOG7i3zhu4l8xKkvZywgImkiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw7J8w7N84buNfOG7j3zDtXzDtHzhu5N84buRfOG7mXzhu5V84buXfMahfOG7nXzhu5t84bujfOG7n3zhu6EvZywgIm8iKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw7l8w7p84bulfOG7p3zFqXzGsHzhu6t84bupfOG7sXzhu6184buvL2csICJ1Iik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL+G7s3zDvXzhu7V84bu3fOG7uS9nLCAieSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/EkS9nLCAiZCIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DgHzDgXzhuqB84bqifMODfMOCfOG6pnzhuqR84bqsfOG6qHzhuqp8xIJ84bqwfOG6rnzhurZ84bqyfOG6tC9nLCAiQSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DiHzDiXzhurh84bq6fOG6vHzDinzhu4B84bq+fOG7hnzhu4J84buEL2csICJFIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OMfMONfOG7inzhu4h8xKgvZywgIkkiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw5J8w5N84buMfOG7jnzDlXzDlHzhu5J84buQfOG7mHzhu5R84buWfMagfOG7nHzhu5p84buifOG7nnzhu6AvZywgIk8iKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw5l8w5p84bukfOG7pnzFqHzGr3zhu6p84buofOG7sHzhu6x84buuL2csICJVIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL+G7snzDnXzhu7R84bu2fOG7uC9nLCAiWSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/EkC9nLCAiRCIpOyAvLyBTb21lIHN5c3RlbSBlbmNvZGUgdmlldG5hbWVzZSBjb21iaW5pbmcgYWNjZW50IGFzIGluZGl2aWR1YWwgdXRmLTggY2hhcmFjdGVycwogICAgICAgIC8vIE3hu5l0IHbDoGkgYuG7mSBlbmNvZGUgY29pIGPDoWMgZOG6pXUgbcWpLCBk4bqldSBjaOG7ryBuaMawIG3hu5l0IGvDrSB04buxIHJpw6puZyBiaeG7h3QgbsOqbiB0aMOqbSBoYWkgZMOybmcgbsOgeQoKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXHUwMzAwfFx1MDMwMXxcdTAzMDN8XHUwMzA5fFx1MDMyMy9nLCAiIik7IC8vIMyAIMyBIMyDIMyJIMyjICBodXnhu4FuLCBz4bqvYywgbmfDoywgaOG7j2ksIG7hurduZwoKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvXHUwMkM2fFx1MDMwNnxcdTAzMUIvZywgIiIpOyAvLyDLhiDMhiDMmyAgw4IsIMOKLCDEgiwgxqAsIMavCiAgICAgICAgLy8gUmVtb3ZlIGV4dHJhIHNwYWNlcwogICAgICAgIC8vIELhu48gY8OhYyBraG/huqNuZyB0cuG6r25nIGxp4buBbiBuaGF1CgogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC8gKyAvZywgIiAiKTsKICAgICAgICBzdHIgPSBzdHIudHJpbSgpOyAvLyBSZW1vdmUgcHVuY3R1YXRpb25zCiAgICAgICAgLy8gQuG7jyBk4bqldSBjw6J1LCBrw60gdOG7sSDEkeG6t2MgYmnhu4d0CiAgICAgICAgLy9zdHIgPSBzdHIucmVwbGFjZSgvIXxAfCV8XF58XCp8XCh8XCl8XCt8XD18XDx8XD58XD98XC98LHxcLnxcOnxcO3xcJ3xcInxcJnxcI3xcW3xcXXx+fFwkfF98YHwtfHt8fXxcfHxcXC9nLCIgIik7CgogICAgICAgIHJldHVybiBzdHI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAiYnVpbGRGaWx0ZXJQYXJhbSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gYnVpbGRGaWx0ZXJQYXJhbShmaWx0ZXJzKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBzRmlsdGVyID0gIiI7CgogICAgICBpZiAoZmlsdGVycyAmJiAhKGZpbHRlcnMgaW5zdGFuY2VvZiBBcnJheSkpIHsKICAgICAgICBmaWx0ZXJzID0gW2ZpbHRlcnNdOwogICAgICB9CgogICAgICB2YXIgbGVuZ3RoID0gZmlsdGVycy5sZW5ndGg7CgogICAgICBpZiAobGVuZ3RoID4gMCkgewogICAgICAgIHZhciBpLAogICAgICAgICAgICBhcnJheUZpbHRlcnMgPSBbXSwKICAgICAgICAgICAgc0pvaW4gPSAiLCI7CgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGZpbHRlciA9IGZpbHRlcnNbaV0sCiAgICAgICAgICAgICAgc0NoaWxkRmlsdGVyID0gIiIsCiAgICAgICAgICAgICAgb3BlcmFuZENoaWxkID0gImFuZCI7CgogICAgICAgICAgaWYgKGZpbHRlci5jaGlsZHJlbnMgaW5zdGFuY2VvZiBBcnJheSAmJiBmaWx0ZXIuY2hpbGRyZW5zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdmFyIGNoaWxkRmlyc3QgPSBmaWx0ZXIuY2hpbGRyZW5zWzBdOwoKICAgICAgICAgICAgaWYgKGNoaWxkRmlyc3Qub3BlcmFuZCkgewogICAgICAgICAgICAgIG9wZXJhbmRDaGlsZCA9IGNoaWxkRmlyc3Qub3BlcmFuZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc0NoaWxkRmlsdGVyID0gbWUuYnVpbGRGaWx0ZXJQYXJhbShmaWx0ZXIuY2hpbGRyZW5zKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcyA9ICciJyArIGZpbHRlci5wcm9wZXJ0eSArICciLCcgKyAoZmlsdGVyLm9wZXJhdG9yID8gJyInICsgZmlsdGVyLm9wZXJhdG9yICsgJyIsJyA6ICIiKSwKICAgICAgICAgICAgICAvL03hurdjIMSR4buLbmggb3BlcmFuZCBsw6AgYGFuZGAKICAgICAgICAgIG9wZXJhbmQgPSAnImFuZCInOwogICAgICAgICAgcyArPSBtZS5ub21hbGl6ZUZpbHRlclZhbHVlKGZpbHRlci5vcGVyYXRvciwgZmlsdGVyLnZhbHVlKTsgLy944butIGzDvSB0w6xuaCBodeG7kW5nIG11w7RuIGZpbHRlciA9IDAvZmFsc2UgbmjGsG5nIG114buRbiBs4buNYyByYSBj4bqjIGPDoWMgZ2nDoSB0cuG7iyBudWxsCgogICAgICAgICAgaWYgKGZpbHRlci5udWxsVG9GYWlsICYmIChmaWx0ZXIudmFsdWUgPT09IDAgfHwgZmlsdGVyLnZhbHVlID09PSBmYWxzZSkpIHsKICAgICAgICAgICAgcyArPSAiLHRydWUiOwogICAgICAgICAgfQoKICAgICAgICAgIHMgPSAiWyIgKyBzICsgIl0iOwoKICAgICAgICAgIGlmIChzQ2hpbGRGaWx0ZXIpIHsKICAgICAgICAgICAgcyA9ICJbIiArIHMgKyAnLCInICsgb3BlcmFuZENoaWxkICsgJyIsJyArIHNDaGlsZEZpbHRlciArICJdIjsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaSAhPT0gMCkgewogICAgICAgICAgICBpZiAoZmlsdGVyLm9wZXJhbmQpIHsKICAgICAgICAgICAgICBvcGVyYW5kID0gJyInICsgZmlsdGVyLm9wZXJhbmQgKyAnIic7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFycmF5RmlsdGVycy5hZGQob3BlcmFuZCk7CiAgICAgICAgICB9CgogICAgICAgICAgYXJyYXlGaWx0ZXJzLmFkZChzKTsKICAgICAgICB9CgogICAgICAgIHNGaWx0ZXIgPSBhcnJheUZpbHRlcnMuam9pbihzSm9pbik7CgogICAgICAgIGlmIChsZW5ndGggPiAxKSB7CiAgICAgICAgICBzRmlsdGVyID0gIlsiICsgc0ZpbHRlciArICJdIjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzRmlsdGVyOwogICAgfQogIH0sIHsKICAgIGtleTogIm5vbWFsaXplRmlsdGVyVmFsdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5vbWFsaXplRmlsdGVyVmFsdWUob3BlcmF0b3IsIHZhbHVlKSB7CiAgICAgIHZhciByZXQgPSAiIjsKCiAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgICBjYXNlICJpbiI6CiAgICAgICAgY2FzZSAibm90aW4iOgogICAgICAgICAgcmV0ID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAibnVtYmVyIikgewogICAgICAgICAgICByZXQgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICJib29sZWFuIikgewogICAgICAgICAgICByZXQgPSB2YWx1ZTsKICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZS5nZXRIb3VycygpID09PSAwICYmIHZhbHVlLmdldE1pbnV0ZXMoKSA9PT0gMCAmJiB2YWx1ZS5nZXRTZWNvbmRzKCkgPT09IDApIHsKICAgICAgICAgICAgICByZXQgPSBbJyInLCBtb21lbnQodmFsdWUpLmZvcm1hdCgiWVlZWS1NTS1ERCIpLCAnVDAwOjAwOjAwIiddLmpvaW4oIiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldCA9IFsnIicsIG1vbWVudCh2YWx1ZSkuZm9ybWF0KCJZWVlZLU1NLUREVGhoOm1tOnNzIiksICciJ10uam9pbigiIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldCA9IFsnIicsIHZhbHVlLCAnIiddLmpvaW4oIiIpOwogICAgICAgICAgfQoKICAgICAgfQoKICAgICAgcmV0dXJuIHJldDsKICAgIH0KICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHRoYW0gc+G7kSB0csaw4bubYyBraGkgZ+G7jWkgbMOqbiBzZXJ2ZXIgbG9hZCBk4buvIGxp4buHdSBjaG8gY29tYm9ib3gNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicHJvY2Vzc0NvbWJvYm94UGFyYW1SZXF1ZXN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcm9jZXNzQ29tYm9ib3hQYXJhbVJlcXVlc3QocGFyYW0pIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGZvciAodmFyIGkgaW4gcGFyYW0pIHsKICAgICAgICB2YXIgdmFsdWUgPSBwYXJhbVtpXTsKCiAgICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgICBjYXNlICJmaWx0ZXIiOgogICAgICAgICAgICAvL2NodeG6qW4gaMOzYSB0aGFtIHPhu5EgZmlsdGVyCiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSBtZS5idWlsZEZpbHRlclBhcmFtKHZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAiY29uZGl0aW9uIjoKICAgICAgICAgICAgLy9zdHJpbmdnaWZ5IGNvbmRpdGlvbiDEkeG7gyBidWlsZCB0csOqbiBjIwogICAgICAgICAgICBpZiAodmFsdWUgJiYgT2JqZWN0LmtleXModmFsdWUpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBwYXJhbVtpXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAic2V0TG9jYWxTdG9yYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRMb2NhbFN0b3JhZ2Uoa2V5LCB2YWx1ZSkgewogICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aGlzLnByb2Nlc3NMb2NhbFN0b3JhZ2VLZXkoa2V5KSwgdmFsdWUpOwogICAgfQogIH0sIHsKICAgIGtleTogImdldExvY2FsU3RvcmFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TG9jYWxTdG9yYWdlKGtleSkgewogICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy5wcm9jZXNzTG9jYWxTdG9yYWdlS2V5KGtleSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInJlbW92ZUxvY2FsU3RvcmFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlTG9jYWxTdG9yYWdlKGtleSkgewogICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aGlzLnByb2Nlc3NMb2NhbFN0b3JhZ2VLZXkoa2V5KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicHJvY2Vzc0xvY2FsU3RvcmFnZUtleSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc0xvY2FsU3RvcmFnZUtleShrZXkpIHsKICAgICAgcmV0dXJuIFt3aW5kb3cuX2FwcENvbmZpZy5zdG9yYWdlS2V5LCBrZXldLmpvaW4oIl8iKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzbGVlcCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2xlZXAobXMpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQocmVzb2x2ZSwgbXMpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJjaGVja0Z1bGxNb250aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tGdWxsTW9udGgoZnJvbURhdGUsIHRvRGF0ZSkgewogICAgICB2YXIgc2hvcnRUZXh0ID0gIiIsCiAgICAgICAgICBsb2NhbGl6ZSA9IGkxOG47CgogICAgICBpZiAoZnJvbURhdGUgJiYgdG9EYXRlKSB7CiAgICAgICAgaWYgKGZyb21EYXRlLmdldERhdGUoKSA9PSAxKSB7CiAgICAgICAgICB2YXIgZnJvbVllYXIgPSBmcm9tRGF0ZS5nZXRGdWxsWWVhcigpLAogICAgICAgICAgICAgIGZyb21Nb250aCA9IGZyb21EYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICB2YXIgdG9ZZWFyID0gdG9EYXRlLmdldEZ1bGxZZWFyKCksCiAgICAgICAgICAgICAgdG9Nb250aCA9IHRvRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgdmFyIGRheXNPZk1vbnRoID0gMzIgLSBuZXcgRGF0ZSh0b1llYXIsIHRvTW9udGgsIDMyKS5nZXREYXRlKCk7CgogICAgICAgICAgaWYgKHRvRGF0ZSAmJiBkYXlzT2ZNb250aCA9PSB0b0RhdGUuZ2V0RGF0ZSgpKSB7CiAgICAgICAgICAgIGlmIChmcm9tTW9udGggPT0gdG9Nb250aCAmJiBmcm9tWWVhciA9PSB0b1llYXIpIHsKICAgICAgICAgICAgICBzaG9ydFRleHQgPSBsb2NhbGl6ZS50KCJpMThuUmVwb3J0LlJlcG9ydFRlcm0iKS5mb3JtYXQoZnJvbU1vbnRoICsgMSwgZnJvbVllYXIpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGZyb21Nb250aCA8IHRvTW9udGggJiYgZnJvbVllYXIgPT0gdG9ZZWFyKSB7CiAgICAgICAgICAgICAgc2hvcnRUZXh0ID0gbG9jYWxpemUudCgiaTE4blJlcG9ydC5SZXBvcnRUZXJtUmFuZ2UiKS5mb3JtYXQoZnJvbU1vbnRoICsgMSwgdG9Nb250aCArIDEsIGZyb21ZZWFyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHNob3J0VGV4dDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzaG9ydFRleHQ7CiAgICB9CiAgICAvKioNCiAgICAgKiBIw6BtIGfhu41pIGxpbmsgaGVscCB0cnV54buBbiB2w6BvIMSRxrDhu51uZyBk4bqrbiDEkeG6v24gdOG7q25nIG3DoG4gaMOsbmgNCiAgICAgKiBAcGFyYW0geyp9IGhlbHBJZCANCiAgICAgKiBAcmV0dXJucyANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGVscEFtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaGVscEFtcyhoZWxwSWQpIHsKICAgICAgcmV0dXJuIFt3aW5kb3cuX2FwcENvbmZpZy5oZWxwVVJMLCBoZWxwSWRdLmpvaW4oIiIpOwogICAgfQogICAgLyoqDQogICAgICogSMOgbSBidWlsZCBsaW5rIGhlbHAgduG7m2kgSUQoc2NyZWVuY29kZSkgdHJ1eeG7gW4gdsOgbw0KICAgICAqIEBwYXJhbSB7Kn0gaGVscElkIGtp4buDbSB0cmEgdsOgIHVwcGVyY2FzZSBrw70gdOG7sSDEkeG6p3UgbMOqbiDEkeG7gyBnaMOpcCB2w6BvIGVudW0NCiAgICAgKiBAcmV0dXJucyANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0TGlua0hlbHBDZWdvdiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TGlua0hlbHBDZWdvdihoZWxwSWQpIHsKICAgICAgdmFyIGhlbHBJZENvbnZlcnRlZCA9IGhlbHBJZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGhlbHBJZC5zbGljZSgxKTsKICAgICAgcmV0dXJuIFt3aW5kb3cuX2FwcENvbmZpZy5oZWxwVVJMLCBNU0VudW0uSGVscElEW2hlbHBJZENvbnZlcnRlZF1dLmpvaW4oIiIpOwogICAgfQogICAgLyoqDQogICAgICogRnVuYyBi4buPIGThuqV1IHRp4bq/bmcgdmnhu4d0DQogICAgICogQHBhcmFtIHtTdHJpbmd9IHN0cg0KICAgICAqIEBhdXRob3IgTkNUaGFuaDENCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlVW5pY29kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlVW5pY29kZShzdHIpIHsKICAgICAgdmFyIHRtcCA9IHN0cjsKICAgICAgdG1wID0gdG1wLnRvTG93ZXJDYXNlKCk7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/DoHzDoXzhuqF84bqjfMOjfMOifOG6p3zhuqV84bqtfOG6qXzhuqt8xIN84bqxfOG6r3zhurd84bqzfOG6tS9nLCAiYSIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvw6h8w6l84bq5fOG6u3zhur18w6p84buBfOG6v3zhu4d84buDfOG7hS9nLCAiZSIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvw6x8w6184buLfOG7iXzEqS9nLCAiaSIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvw7J8w7N84buNfOG7j3zDtXzDtHzhu5N84buRfOG7mXzhu5V84buXfMahfOG7nXzhu5t84bujfOG7n3zhu6EvZywgIm8iKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL8O5fMO6fOG7pXzhu6d8xal8xrB84burfOG7qXzhu7F84butfOG7ry9nLCAidSIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgv4buzfMO9fOG7tXzhu7d84bu5L2csICJ5Iik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/EkS9nLCAiZCIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvIXxAfCV8XF58XCp8XCh8XCl8XCt8XD18XDx8XD58XD98XC98LHxcLnxcOnxcO3xcJ3xcInxcJnxcI3xcW3xcXXx+fFwkfF98YHwtfHt8fXxcfHxcXC9nLCAiICIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvICsgL2csICIgIik7CiAgICAgIHRtcCA9IHRtcC50cmltKCk7CiAgICAgIHJldHVybiB0bXA7CiAgICB9CiAgICAvKioNCiAgICAgKiBMb2FkIGThu68gbGnhu4d1IGNvbWJvYm94DQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENhY2hlQ29tYm9ib3hEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDYWNoZUNvbWJvYm94RGF0YSh0eXBlLCBwYXlsb2FkLCBsb2FkUHJvbWlzZSwgbG9hZFNjb3BlKSB7CiAgICAgIHZhciBrZXkgPSBbdHlwZSwgSlNPTi5zdHJpbmdpZnkocGF5bG9hZCldLmpvaW4oIl8iKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgY2FjaGUgPSB3aW5kb3cuX2Nib0RhdGFba2V5XTsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgaWYgKGNhY2hlKSB7CiAgICAgICAgICByZXNvbHZlKGNhY2hlKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGxvYWRQcm9taXNlLmNhbGwobG9hZFNjb3BlLCBwYXlsb2FkKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIHdpbmRvdy5fY2JvRGF0YVtrZXldID0gcmVzdWx0OwogICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIExvYWQgZOG7ryBsaeG7h3UgY29tYm9ib3gNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlQ2FjaGVDb21ib2JveERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUNhY2hlQ29tYm9ib3hEYXRhKGtleSkgewogICAgICB2YXIgY2FjaGVzID0gd2luZG93Ll9jYm9EYXRhOwoKICAgICAgaWYgKGNhY2hlcykgewogICAgICAgIHZhciBrZXlzID0gW107CgogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGtleSkpIHsKICAgICAgICAgIGtleXMgPSBrZXk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2Yga2V5ID09PSAic3RyaW5nIikgewogICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGtleXMucHVzaChTdHJpbmcoa2V5KSk7CiAgICAgICAgfQoKICAgICAgICBrZXlzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHZhciBrZXkgPSBbaXRlbSwgIiJdLmpvaW4oIl8iKS50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgIHJlbW92ZUtleXMgPSBbXTsKCiAgICAgICAgICBmb3IgKHZhciBpIGluIGNhY2hlcykgewogICAgICAgICAgICBpZiAoaS5pbmRleE9mKGtleSkgPT09IDApIHsKICAgICAgICAgICAgICByZW1vdmVLZXlzLnB1c2goaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgcmVtb3ZlS2V5cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIGNhY2hlS2V5ID0gcmVtb3ZlS2V5c1tfaV07CiAgICAgICAgICAgIGRlbGV0ZSBjYWNoZXNbY2FjaGVLZXldOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBUw6FjaCB04burIGtow7NhIHTDrG0ga2nhur9tIHRow6BuaCBjw6FjIHThu6sgdGhlbyBxdXkgdOG6r2MNCiAgICAgKiAxLiBO4bq/dSBjw7Mgbmdv4bq3YyBrw6lwICIiIHRow6wgdMOsbSDEkcO6bmcga8OtIHThu7EgdHJvbmcgbmdv4bq3YyBrw6lwDQogICAgICogMi4gTuG6v3Uga2jDtG5nIHRow6wgY2jhu4kgY+G6p24gY2jhu6lhIGPhuqMgMiBrw60gdOG7sSBsw6AgxJHhu6cNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5d29yZCB04burIGtow7NhIHTDrG0ga2nhur9tDQogICAgICogQGF1dGhvciBOVkxBTSAyMy4xMS4yMDIwDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNwbGl0S2V5V29yZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc3BsaXRLZXlXb3JkKGtleXdvcmQpIHsKICAgICAgdmFyIHdvcmRBcnIgPSBbXTsKCiAgICAgIGlmICh0eXBlb2Yga2V5d29yZCAhPT0gInN0cmluZyIpIHsKICAgICAgICBrZXl3b3JkID0gXy50b1N0cmluZyhrZXl3b3JkKTsKICAgICAgfQoKICAgICAgdmFyIGZpcnN0RG91YmxlUXVvdGVJZHggPSBrZXl3b3JkLmluZGV4T2YoJyInKSwKICAgICAgICAgIGxhc3REb3VibGVRdW90ZUlkeCA9IGtleXdvcmQubGFzdEluZGV4T2YoJyInKTsKICAgICAgLyoqDQogICAgICAgKiBDw6FjIFRIIHTDrG0ga2nhur9tIGZ1bGwgdGV4dA0KICAgICAgICogMS4gxJDDonkgbMOgIGZvbw0KICAgICAgICogMi4gIsSQw6J5IGzDoCBmb28NCiAgICAgICAqIDMuIMSQw6J5ICJsw6AgZm9vIg0KICAgICAgICogNC4gIsSQw6J5IGzDoCIgZm9vDQogICAgICAgKi8KCiAgICAgIGlmIChmaXJzdERvdWJsZVF1b3RlSWR4ID09PSAtMSB8fCBmaXJzdERvdWJsZVF1b3RlSWR4ID09PSBsYXN0RG91YmxlUXVvdGVJZHggfHwgZmlyc3REb3VibGVRdW90ZUlkeCAhPT0gMCB8fCBsYXN0RG91YmxlUXVvdGVJZHggIT09IGtleXdvcmQubGVuZ3RoIC0gMSkgewogICAgICAgIHdvcmRBcnIgPSBrZXl3b3JkLnNwbGl0KC9ccysvKTsgLy90w6FjaCB0aGVvIGThuqV1IGPDoWNoCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGZ1bGxUZXh0ID0ga2V5d29yZC5zbGljZShmaXJzdERvdWJsZVF1b3RlSWR4ICsgMSwgbGFzdERvdWJsZVF1b3RlSWR4KTsKCiAgICAgICAgaWYgKCFfLmlzRW1wdHkoZnVsbFRleHQpKSB7CiAgICAgICAgICB3b3JkQXJyLnB1c2goZnVsbFRleHQpOwogICAgICAgIH0KICAgICAgfSAvLyBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRBcnIubGVuZ3RoOyArK2kpIHsKICAgICAgLy8gICAgIHdvcmRBcnJbaV0gPSB3b3JkQXJyW2ldLnJlcGxhY2UoL1teYS16XGRdL2csICdcXCQmJyk7Ly9jaMOobiB0aMOqbSAxIGvDrSB04burCiAgICAgIC8vIH0KCgogICAgICByZXR1cm4gd29yZEFycjsKICAgIH0KICAgIC8qKg0KICAgICAqIGjDoG0gc2VhcmNoIGxvY2FsDQogICAgICogcHJvcGVydGllczogZGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyBj4bqnbiBzZWFyY2gNCiAgICAgKiBzZWFyY2hUZXh0OiB0ZXh0IG5o4bqtcCDhu58gw7Qgc2VhcmNoDQogICAgICogc291cmNlOiBk4buvIGxp4buHdSBn4buRYyBkw7luZyDEkeG7gyBmaWx0ZXINCiAgICAgKiBncmlkOiBncmlkIGZpbHRlcg0KICAgICAqIE5UQW5oMjogdGjDqm0gbm90U2VhcmNoVGV4dCA9IHRydWUgxJHhu4MgbOG7jWMgdOG7qyBjw6FjIG3DoG4gaMOsbmggZGFuaCBzw6FjaCBk4bqhbmcgdHJlZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaWx0ZXJGbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmlsdGVyRm4ocHJvcGVydGllcywgc291cmNlLCBncmlkLCBzZWFyY2hUZXh0LCBmb3JtKSB7CiAgICAgIHZhciBub3RTZWFyY2hUZXh0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDUgJiYgYXJndW1lbnRzWzVdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbNV0gOiBmYWxzZTsKICAgICAgdmFyIGRhdGEgPSBbXSwKICAgICAgICAgIG1lID0gdGhpczsKICAgICAgdmFyIHNvdXJjZVRlbXAgPSBbXTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHsKICAgICAgICBPYmplY3QuYXNzaWduKHNvdXJjZVRlbXAsIHNvdXJjZSk7IC8vIE5UQW5oMjogdGjDqm0gbm90U2VhcmNoVGV4dCBz4butYSBidWcga2jDtG5nIGzhu41jIMSRxrDhu6NjIGPhu5l0IHThu6sgY8OhYyBtw6BuIGjDrG5oIGRhbmggc8OhY2ggdHLhuqFuZyB0cmVlIGTDuW5nIGZpbHRlciBsb2NhbAoKICAgICAgICBpZiAoc2VhcmNoVGV4dCAmJiBzZWFyY2hUZXh0ICE9ICIiIHx8IG5vdFNlYXJjaFRleHQgPT0gdHJ1ZSkgewogICAgICAgICAgc291cmNlVGVtcC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChtZS5jaGVja1NlYXJjaFRleHQoaXRlbSwgcHJvcGVydGllcywgc2VhcmNoVGV4dCkgJiYgbWUuY2hlY2tGaWx0ZXJIZWFkZXIoaXRlbSwgZ3JpZCkgJiYgZm9ybS5jaGVja0ZpbHRlckdyaWRUcmVlQ3VzdG9tKGl0ZW0sIHByb3BlcnRpZXMsIHNlYXJjaFRleHQpKSB7CiAgICAgICAgICAgICAgaWYgKGRhdGEuaW5kZXhPZihpdGVtKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIGRhdGEucHVzaChpdGVtKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChncmlkICYmIGdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgICAgICAgICAgbWUuZmluZFBhcmVudE5vZGUoc291cmNlLCBkYXRhLCBpdGVtLCBmb3JtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRhID0gc291cmNlVGVtcDsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChmb3JtLmZpbHRlckhlYWRlciAmJiBmb3JtLmZpbHRlckhlYWRlci5sZW5ndGggPiAwKSB7CiAgICAgICAgZ3JpZC5kYXRhVGVtcCA9IGRhdGE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZ3JpZC5kYXRhVGVtcCA9IHNvdXJjZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICAvKg0KICAgICAqICBIw6BtIHTDrG0ga2nhur9tIGPDoWMgbm9kZSBjaGEga2hpIHRo4buxYyBoaeG7h24gdMOsbSBraeG6v20gZOG7ryBsaeG7h3UuDQogICAgICogIHB2ZHV5IDA2LzAxLzIwMjENCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmluZFBhcmVudE5vZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRQYXJlbnROb2RlKGl0ZW1zLCBmaWx0ZXJJdGVtcywgaXRlbUNoaWxkLCBmb3JtKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBrZXkgPSAiIiwKICAgICAgICAgIHBhcmVudEtleSA9ICJQYXJlbnRJRCI7CgogICAgICBpZiAoZm9ybSAmJiBmb3JtLmdyaWQgJiYgZm9ybS5ncmlkLmlkUHJvcGVydHkpIHsKICAgICAgICBrZXkgPSBmb3JtLmdyaWQuaWRQcm9wZXJ0eTsKICAgICAgfQoKICAgICAgaWYgKGZvcm0gJiYgZm9ybS5ncmlkICYmIGZvcm0uZ3JpZC5wYXJlbnRJZFByb3BlcnR5KSB7CiAgICAgICAgcGFyZW50S2V5ID0gZm9ybS5ncmlkLnBhcmVudElkUHJvcGVydHk7CiAgICAgIH0KCiAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbVtrZXldID09IGl0ZW1DaGlsZFtwYXJlbnRLZXldICYmICFmaWx0ZXJJdGVtcy5maW5kKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICByZXR1cm4geFtrZXldID09IGl0ZW1ba2V5XTsKICAgICAgICB9KSkgewogICAgICAgICAgaWYgKGZpbHRlckl0ZW1zLmluZGV4T2YoaXRlbSkgPT09IC0xKSB7CiAgICAgICAgICAgIGZpbHRlckl0ZW1zLnB1c2goaXRlbSk7CiAgICAgICAgICB9CgogICAgICAgICAgbWUuZmluZFBhcmVudE5vZGUoaXRlbXMsIGZpbHRlckl0ZW1zLCBpdGVtLCBmb3JtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICogaMOgbSBmaWx0ZXIgY29sDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNoZWNrRmlsdGVySGVhZGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja0ZpbHRlckhlYWRlcihpdGVtLCBncmlkKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBsaXN0RmlsdGVySGVhZGVyID0gW10sCiAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgIGxpc3RGaWx0ZXJIZWFkZXIgPSBncmlkLmdldEZpbHRlckhlYWRlcih0cnVlKTsKCiAgICAgIGlmIChsaXN0RmlsdGVySGVhZGVyLmxlbmd0aCA+IDApIHsKICAgICAgICBsaXN0RmlsdGVySGVhZGVyLmZvckVhY2goZnVuY3Rpb24gKGZpbHRlcikgewogICAgICAgICAgdmFyIHZhbHVlID0gZmlsdGVyLnZhbHVlID8gKGZpbHRlci52YWx1ZSArICIiKS50b0xvd2VyQ2FzZSgpIDogIiI7CgogICAgICAgICAgc3dpdGNoIChmaWx0ZXIub3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkNvbnRhaW5zOgogICAgICAgICAgICAgIGlmICghKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA/IGl0ZW1bZmlsdGVyLnByb3BlcnR5XS50b0xvd2VyQ2FzZSgpIDogIiIpLmNvbnRhaW5zKHZhbHVlKSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLk5vdGNvbnRhaW5zOgogICAgICAgICAgICAgIGlmICgoaXRlbVtmaWx0ZXIucHJvcGVydHldID8gaXRlbVtmaWx0ZXIucHJvcGVydHldLnRvTG93ZXJDYXNlKCkgOiAiIikuY29udGFpbnModmFsdWUpKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuU3RhcnRzV2l0aDoKICAgICAgICAgICAgICBpZiAoIShpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPyBpdGVtW2ZpbHRlci5wcm9wZXJ0eV0udG9Mb3dlckNhc2UoKSA6ICIiKS5zdGFydHNXaXRoKHZhbHVlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuRW5kc1dpdGg6CiAgICAgICAgICAgICAgaWYgKCEoaXRlbVtmaWx0ZXIucHJvcGVydHldID8gaXRlbVtmaWx0ZXIucHJvcGVydHldLnRvTG93ZXJDYXNlKCkgOiAiIikuZW5kc3dpdGgodmFsdWUpKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuRXF1YWxzOgogICAgICAgICAgICAgIGlmIChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gIT0gZmlsdGVyLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuTm90RXF1YWxzOgogICAgICAgICAgICAgIGlmIChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPT0gZmlsdGVyLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuR3JlYXRlclRoYW46CiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA8PSBmaWx0ZXIudmFsdWUpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLy8gY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkdyZWF0ZXJUaGFuOgogICAgICAgICAgICAvLyAgIGlmKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA8IGZpbHRlci52YWx1ZSl7CiAgICAgICAgICAgIC8vICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAvLyAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgLy8gICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5MZXNzVGhhbjoKICAgICAgICAgICAgICBpZiAoaXRlbVtmaWx0ZXIucHJvcGVydHldID49IGZpbHRlci52YWx1ZSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkxlc3NUaGFuRXF1YWxzOgogICAgICAgICAgICAgIGlmIChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPiBmaWx0ZXIudmFsdWUpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5CZXR3ZWVuOgogICAgICAgICAgICAgIC8vaWYoaXRlbVtmaWx0ZXIucHJvcGVydHldID4gZmlsdGVyLnZhbHVlKXsKICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy99CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLk51bGw6CiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLk5vdE51bGw6CiAgICAgICAgICAgICAgaWYgKCFpdGVtW2ZpbHRlci5wcm9wZXJ0eV0pIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNoZWNrOwogICAgfQogICAgLyoqDQogICAgICogaMOgbSBzZWFyY2ggdGhlbyB0ZXh0DQogICAgICovCgogIH0sIHsKICAgIGtleTogImNoZWNrU2VhcmNoVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tTZWFyY2hUZXh0KGl0ZW0sIHByb3BlcnRpZXMsIHNlYXJjaFRleHQpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGNoZWNrID0gZmFsc2U7CgogICAgICBpZiAoc2VhcmNoVGV4dCkgewogICAgICAgIHZhciB0ZXh0ID0gc2VhcmNoVGV4dC50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwcm9wZXJ0aWVzKSkgewogICAgICAgICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkgewogICAgICAgICAgICBpZiAoaXRlbVtmaWVsZF0gJiYgaXRlbVtmaWVsZF0udG9Mb3dlckNhc2UoKS5jb250YWlucyh0ZXh0KSkgewogICAgICAgICAgICAgIGNoZWNrID0gdHJ1ZTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNoZWNrOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgdGjDtG5nIHRpbiBjaGFubmVsIGNodW5nIMSR4buDIGfhu61pL25o4bqtbiB0aMO0bmcgYsOhbyBnaeG7r2EgY8OhYyB0YWINCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0QnJvYWRjYXN0Q2hhbm5lbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QnJvYWRjYXN0Q2hhbm5lbCgpIHsKICAgICAgaWYgKCF3aW5kb3cuX19iYykgewogICAgICAgIHdpbmRvdy5fX2JjID0gbmV3IEJyb2FkY2FzdENoYW5uZWwod2luZG93Ll9hcHBDb25maWcuYnJvYWRjYXN0Q2hhbm5lbCk7CiAgICAgIH0KCiAgICAgIHJldHVybiB3aW5kb3cuX19iYzsKICAgIH0KICAgIC8qKg0KICAgICAqIFRETkdISUENCiAgICAgKiAyMi85LzIwMjENCiAgICAgKiBjb252ZXJ0IHThu6sgc3RyaW5nIHNhbmcga2nhu4N1IGRhdGUNCiAgICAgKiBAcGFyYW0geyp9IGRhdGVTdHJpbmcgc3RyaW5nIHRydXnhu4FuIHbDoG8gdsOtIGThu6U6ICcxOC8wNy8xOTk5Jw0KICAgICAqIGZvcm1hdFR5cGUgPSAxIGzDoCBjaHXhu5dpIMSRYW5nIHRoZW8ga2nhu4N1IGRkL21tL3l5eXkgMiBsw6Aga2nhu4N1IHl5eXkvbW0vZGQgMyBsw6Aga2nhu4N1IG1tL2RkL3l5eQ0KICAgICAqIHThu7EgdGjDqm0gY8OhYyBjYXNlIHNhdSBu4bq/dSBn4bq3cCB0aMOqbQ0KICAgICAqIGNoYXJTcGxpdCBsw6Aga8O9IHThu7Egc3BsaXQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY29udmVydFN0cmluZ1RvRGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydFN0cmluZ1RvRGF0ZShkYXRlU3RyaW5nLCBjaGFyU3BsaXQsIGZvcm1hdFR5cGUpIHsKICAgICAgaWYgKHR5cGVvZiBkYXRlU3RyaW5nICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiBuZXcgRGF0ZSgpOwogICAgICB9CgogICAgICB2YXIgZGF0ZVBhcnQgPSBkYXRlU3RyaW5nLnNwbGl0KGNoYXJTcGxpdCA/IGNoYXJTcGxpdCA6ICIvIik7CiAgICAgIHZhciByZXN1bHQ7CgogICAgICBzd2l0Y2ggKGZvcm1hdFR5cGUpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXN1bHQgPSBuZXcgRGF0ZShkYXRlUGFydFsyXSwgcGFyc2VJbnQoZGF0ZVBhcnRbMV0pIC0gMSwgZGF0ZVBhcnRbMF0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMjoKICAgICAgICAgIHJlc3VsdCA9IG5ldyBEYXRlKGRhdGVQYXJ0WzBdLCBwYXJzZUludChkYXRlUGFydFsxXSkgLSAxLCBkYXRlUGFydFszXSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJlc3VsdCA9IG5ldyBEYXRlKGRhdGVQYXJ0WzJdLCBwYXJzZUludChkYXRlUGFydFsxXSkgLSAxLCBkYXRlUGFydFswXSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKg0KICAgICAqIEjDoG0gY29udmVydCB04burIERhdGVUaW1lIHNhbmcgc3RyaW5nIGZvcm1hdCBk4bqhbmcgZGQvbW0veXl5eQ0KICAgICAqIEBwYXJhbSB7Kn0gZGF0ZSBkYXRlIHRydXnhu4FuIGThuqFuZyBEYXRlVGltZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0RGF0ZVRvU3RyaW5nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0RGF0ZVRvU3RyaW5nKGRhdGUpIHsKICAgICAgaWYgKHR5cGVvZiBkYXRlICE9PSAic3RyaW5nIiAmJiBkYXRlKSB7CiAgICAgICAgdmFyIGRkID0gU3RyaW5nKGRhdGUuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAiMCIpOwogICAgICAgIHZhciBtbSA9IFN0cmluZyhkYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAiMCIpOyAvL0phbnVhcnkgaXMgMCEKCiAgICAgICAgdmFyIHl5eXkgPSBkYXRlLmdldEZ1bGxZZWFyKCk7CiAgICAgICAgcmV0dXJuIGRkICsgIi8iICsgbW0gKyAiLyIgKyB5eXl5OwogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkYXRlID09PSAic3RyaW5nIiAmJiBkYXRlKSB7CiAgICAgICAgcmV0dXJuIGRhdGU7CiAgICAgIH0KCiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIC8qKg0KICAgICAqIEJ1aWxkIGNvZGUgdOG7qyBjaHXhu5dpIG5o4bqtcCB2w6BvDQogICAgICogVkQ6IFRy4bqnbiDEkOG6oWkgTmdoxKlhID0+IFRETg0KICAgICAqIFRETkdISUEgNy8xMC8yMDIxDQogICAgICogQHBhcmFtIHsqfSBuYW1lIGNodeG7l2kgdsOgbw0KICAgICAqIEBwYXJhbSB7Kn0gbWF4TGVuZ3RoIMSR4buZIGTDoGkgZ2nhu5tpIGjhuqFuDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdlbmVyYXRlRmlyc3RDaGFyYWN0ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlRmlyc3RDaGFyYWN0ZXIobmFtZSwgbWF4TGVuZ3RoKSB7CiAgICAgIHZhciBzdHJDb2RlID0gIiI7CgogICAgICBpZiAobmFtZSkgewogICAgICAgIHZhciBhcnJXb3JkID0gbmFtZS5zcGxpdCgiICIpOwoKICAgICAgICBpZiAoYXJyV29yZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAvL0zhurdwIHF1YSBjw6FjIHThu6sKICAgICAgICAgIGFycldvcmQuZm9yRWFjaChmdW5jdGlvbiAoZWxlbWVudCkgewogICAgICAgICAgICAvL0xv4bqhaSBi4buPIGPDoWMgdOG7qyBy4buVbmcgKGPDsyBuaGnhu4F1IGPDoWNoIHRy4buRbmcpCiAgICAgICAgICAgIGlmIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgLy9s4bq3cCBxdWEgY8OhYyBrw70gdOG7sSDEkeG7gyBs4bqleSB24buBIGvDvSB04buxIMSR4bqndSB0acOqbgogICAgICAgICAgICAgIHZhciBhcnJDaGFyID0gZWxlbWVudC5zcGxpdCgiIik7CgogICAgICAgICAgICAgIGlmIChhcnJDaGFyLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHN0ckNvZGUgKz0gYXJyQ2hhclswXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHN0ckNvZGUpIHsKICAgICAgICAvL0xv4bqhaSBi4buPIGvDvSB04buxIHRp4bq/bmcgdmnhu4d0CiAgICAgICAgc3RyQ29kZSA9IHRoaXMucmVtb3ZlVmlldG5hbWVzZVRvbmVzKHN0ckNvZGUpOyAvL2NodXnhu4NuIHRow6BuaCBjaOG7ryBob2EKCiAgICAgICAgc3RyQ29kZSA9IHN0ckNvZGUudG9VcHBlckNhc2UoKTsgLy8gY2hlY2sgcnVsZSBtYXggbGVuZ3RoLCBj4bqvdCBjaHXhu5dpIMSRaSBu4bq/dSB0aOG7q2EKCiAgICAgICAgaWYgKHN0ckNvZGUgJiYgbWF4TGVuZ3RoICYmIHN0ckNvZGUubGVuZ3RoID4gbWF4TGVuZ3RoKSB7CiAgICAgICAgICBzdHJDb2RlID0gc3RyQ29kZS5zdWJzdHIoMCwgbWF4TGVuZ3RoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBzdHJDb2RlOwogICAgfQogICAgLyoqDQogICAgICogSMOgbSBzb3J0IGFyciB0aGVvIG1vZGUNCiAgICAgKiBURE5HSElBIDMxLzEwLzIwMjENCiAgICAgKiBAcGFyYW0geyp9IG1vZGUNCiAgICAgKiBAcGFyYW0geyp9IGRhdGENCiAgICAgKiBAcGFyYW0geyp9IGRhdGFGaWVsZA0KICAgICAqIEBwYXJhbSB7Kn0gaXNDYXN0VG9EYXRlIHRyb25nIHRyxrDhu51uZyBo4bujcCBwaOG6o2kgY2FzdCB24buBIGRhdGUgbeG7m2kgc28gc8OhbmggxJHGsOG7o2MgdGjDrCB0cnV54buBbiB2w6BvDQogICAgICogQHJldHVybnMNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic29ydEFycmF5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzb3J0QXJyYXkobW9kZSwgZGF0YSwgZGF0YUZpZWxkLCBpc0Nhc3RUb0RhdGUpIHsKICAgICAgLy9ow6BtIHNvcnQKICAgICAgZnVuY3Rpb24gY29tcGFyZShhLCBiKSB7CiAgICAgICAgdmFyIGZpcnN0ID0gYVtkYXRhRmllbGRdLAogICAgICAgICAgICBzZWNvbmQgPSBiW2RhdGFGaWVsZF07CgogICAgICAgIGlmIChpc0Nhc3RUb0RhdGUpIHsKICAgICAgICAgIGZpcnN0ID0gbmV3IERhdGUoYVtkYXRhRmllbGRdKS5nZXRUaW1lKCk7CiAgICAgICAgICBzZWNvbmQgPSBuZXcgRGF0ZShiW2RhdGFGaWVsZF0pLmdldFRpbWUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChmaXJzdCA8IHNlY29uZCkgcmV0dXJuIG1vZGUgPT0gTVNFbnVtLlNvcnRTdGF0dXMuZGVzYyA/IDEgOiAtMTsKICAgICAgICBpZiAoZmlyc3QgPiBzZWNvbmQpIHJldHVybiBtb2RlID09IE1TRW51bS5Tb3J0U3RhdHVzLmFzYyA/IDEgOiAtMTsKICAgICAgICByZXR1cm4gMDsKICAgICAgfQoKICAgICAgcmV0dXJuIGRhdGEuc29ydChjb21wYXJlKTsKICAgIH0KICAgIC8qKg0KICAgICAqIGRpc3RpbmN0IG3huqNuZyB0cnV54buBbiB2w6BvDQogICAgICogQHBhcmFtIHsqfSBhcnJheSBt4bqjbmcgY+G6p24gZGlzdGluY3QNCiAgICAgKiBAcGFyYW0geyp9IGtleSBmaWVsZE5hbWUgZGlzdGluY3QNCiAgICAgKiBURE5HSElBIDMxLzEwLzIwMjENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkaXN0aW5jdEFycmF5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkaXN0aW5jdEFycmF5KGFycmF5LCBrZXkpIHsKICAgICAgdmFyIGFycmF5VW5pcXVlQnlLZXkgPSBfdG9Db25zdW1hYmxlQXJyYXkobmV3IE1hcChhcnJheS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gW2l0ZW1ba2V5XSwgaXRlbV07CiAgICAgIH0pKS52YWx1ZXMoKSk7CgogICAgICByZXR1cm4gYXJyYXlVbmlxdWVCeUtleTsKICAgIH0KICAgIC8qKg0KICAgICAqIFThuqNpIGZpbGUgduG7gSwgY2hvIHbDoG8gaWZyYW1lDQogICAgICogTlRESUVNIDAzLjEyLjIwMjENCiAgICAgKiBAcGFyYW0ge3VybH0gdXJsIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkb3dubG9hZEZpbGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRvd25sb2FkRmlsZSh1cmwpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgaXNTaG93TG9hZGluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsKICAgICAgdmFyIGlmcmFtZUlkID0gJ2Rvd25sb2FkSWZyYW1lJzsKICAgICAgdmFyIGlmcmFtZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlmcmFtZUlkKTsKCiAgICAgIHZhciBjaGVja0xvYWRlZCA9IGZ1bmN0aW9uIGNoZWNrTG9hZGVkKCkgewogICAgICAgIHZhciBpZnJhbWVEb2MgPSBpZnJhbWUuY29udGVudERvY3VtZW50IHx8IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50OyAvLyBraeG7g20gdHJhIMSRw6MgZG93bmxvYWQgeG9uZyBjaMawYQoKICAgICAgICBpZiAoaWZyYW1lRG9jLnJlYWR5U3RhdGUgPT0gJ2NvbXBsZXRlJykgewogICAgICAgICAgX3RoaXMzLnVubWFzaygpOwoKICAgICAgICAgIHJldHVybjsKICAgICAgICB9IC8vIGNoZWNrIHRy4bqhbmcgdGjDoWkgbeG7l2kgMjAwbXMKCgogICAgICAgIHNldFRpbWVvdXQoY2hlY2tMb2FkZWQsIDIwMCk7CiAgICAgIH07IC8vIE5NVFVBTjIgMDguMDQuMjAyMjogbHXDtG4geG/DoSBjw6FpIGlmcmFtZSBjxakgxJFpIMSR4buDIHNob3cgbWFzawoKCiAgICAgIGlmIChpZnJhbWUpIHsKICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGlmcmFtZSk7CiAgICAgIH0gLy8gTk1UVUFOMiAxNC4wNC4yMDIyOiBsdcO0biB04bqhbyBt4bubaSBjw6FpIGlmcmFtZQoKCiAgICAgIGlmcmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lmcmFtZScpOwogICAgICBpZnJhbWUuaWQgPSBpZnJhbWVJZDsKICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnc3JjJywgdXJsKTsKICAgICAgaWZyYW1lLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnaGlkZGVuJyk7CgogICAgICBpZiAoaXNTaG93TG9hZGluZykgewogICAgICAgIHRoaXMubWFzaygpOwogICAgICB9CgogICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGlmcmFtZSk7CgogICAgICBpZiAoaXNTaG93TG9hZGluZykgewogICAgICAgIGNoZWNrTG9hZGVkKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIEjDoG0gcmVtb3ZlIGPDoWMga8O9IGhp4buHdSBodG1sIHThu6sgY2h14buXaSB0cnV54buBbiB2w6BvDQogICAgICogQHBhcmFtIHtDaHXhu5dpIG7hu5lpIGR1bmcgdHJ1eeG7gW4gdsOgb30gY29udGVudFN0cmluZyANCiAgICAgKiBAcmV0dXJucyANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlSFRNTCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlSFRNTChjb250ZW50U3RyaW5nKSB7CiAgICAgIHJldHVybiBjb250ZW50U3RyaW5nLnJlcGxhY2UoLyg8KFtePl0rKT4pL2lnLCAiIik7CiAgICB9CiAgICAvKioNCiAgICAgKiBIw6BtIGVuY29kZSBjw6FjIGvDvSBoaeG7h3UsIHNjcmlwdCDEkeG7gyBnaeG7ryBuZ3V5w6puIG7hu5lpIGR1bmcgdGV4dA0KICAgICAqIEBwYXJhbSB7Q2h14buXaSBu4buZaSBkdW5nIHRydXnhu4FuIHbDoG99IGNvbnRlbnRTdHJpbmcgDQogICAgICogVkQ6ICI8Yj5Cw6BpPC9iPiB0b8OhbiB0deG7lWkgdGjGoSIgPT4gIiZsdDtCw6BpOyZsdDsvYiZndDsgdG/DoW4gdHXhu5VpIHRoxqEiDQogICAgICogc+G7rSBk4bulbmcgbuG6v3UgcGjhuqNpIGzhuqV5IHRleHQgbmd1ecOqbiBjw6FjIHRo4bq7IHNjcmlwdA0KICAgICAqIEByZXR1cm5zIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJlbmNvZGVIVE1MIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBlbmNvZGVIVE1MKGNvbnRlbnRTdHJpbmcpIHsKICAgICAgdmFyIHR4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICAgIHR4dC5pbm5lckhUTUwgPSBjb250ZW50U3RyaW5nOwogICAgICBjb250ZW50U3RyaW5nID0gdHh0LmlubmVySFRNTDsKICAgICAgdHh0ID0gbnVsbDsKICAgICAgcmV0dXJuIGNvbnRlbnRTdHJpbmc7CiAgICB9CiAgICAvKioNCiAgICAqIEjDoG0gZGVjb2RlIGPDoWMga8O9IGhp4buHdSwgc2NyaXB0IMSR4buDIGdp4buvIG5ndXnDqm4gbuG7mWkgZHVuZyB0ZXh0DQogICAgKiBAcGFyYW0ge0NodeG7l2kgbuG7mWkgZHVuZyB0cnV54buBbiB2w6BvfSBjb250ZW50U3RyaW5nIA0KICAgICogVkQ6ICImbHQ7QsOgaTsmbHQ7L2ImZ3Q7IHRvw6FuIHR14buVaSB0aMahIiA9PiAiPGI+QsOgaTwvYj4gdG/DoW4gdHXhu5VpIHRoxqEiDQogICAgKiBz4butIGThu6VuZyBu4bq/dSBs4bqleSByYSBnacOhIHRy4buLIGNo4bupYSBjw6FjIHRo4bq7LCBrw70gaGnhu4d1IMSRw6MgxJHGsOG7o2MgZW5jb2RlDQogICAgKiBAcmV0dXJucyANCiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZWNvZGVIVE1MIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkZWNvZGVIVE1MKGNvbnRlbnRTdHJpbmcpIHsKICAgICAgdmFyIHR4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRleHRhcmVhIik7CiAgICAgIHR4dC5pbm5lckhUTUwgPSBjb250ZW50U3RyaW5nOwogICAgICByZXR1cm4gY29udGVudFN0cmluZyA9IHR4dC52YWx1ZTsKICAgIH0KICAgIC8qKg0KICAgICAqIFRETkdISUEgMTAvMTIvMjAyMQ0KICAgICAqIGZvcm1hdCBs4bqhaSBuZ8OgeSB0aMOhbmcgbsSDbSB0aGVvIHRlbXBsYXRlIHRydXnhu4FuIHbDoG8gbeG6t2MgxJHhu4tuaCBsw6AgZGQvbW0veXl5eQ0KICAgICAqIEBwYXJhbSB7R2nDoSB0cuG7iyBuZ8OgeSB0aMOhbmd9IHZhbHVlIA0KICAgICAqIEBwYXJhbSB7S2nhu4N1IGZvcm1hdH0gZm9ybWF0VHlwZSANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9ybWF0RGF0ZVRpbWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1hdERhdGVUaW1lKHZhbHVlLCBmb3JtYXRUeXBlKSB7CiAgICAgIHJldHVybiBtb21lbnQodmFsdWUpLmZvcm1hdChmb3JtYXRUeXBlID8gZm9ybWF0VHlwZSA6ICJERC9NTS9ZWVlZIik7CiAgICB9CiAgICAvKiogREhQSEkgMjQvMTIvMjAyMQ0KICAgICAqIHRow6ptIGThuqV1IHbDoG8gc+G7kSBk4bqhbmcgdOG7qyB4eHh4ID0+IHgueHh4eCANCiAgICAgKiBAcGFyYW0ge1Phu5EgdHJ1eeG7gW4gdsOgb30gbnVtYmVyIA0KICAgICAqIEBwYXJhbSB7TG/huqFpIGThuqV1IG114buRbiB0aMOqbSB2w6BvLCBt4bq3YyDEkeG7i25oIGzDoCBk4bqldSAnLid9IHR5cGVDb21tYXMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvcm1hdE51bWJlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9ybWF0TnVtYmVyKG51bWJlciwgdHlwZUNvbW1hcykgewogICAgICByZXR1cm4gbnVtYmVyLnRvU3RyaW5nKCkucmVwbGFjZSgvXEIoPz0oXGR7M30pKyg/IVxkKSkvZywgdHlwZW9mIHR5cGVDb21tYXMgIT09ICd1bmRlZmluZWQnID8gdHlwZUNvbW1hcyA6ICcuJyk7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSB0aMO0bmcgdGluIGxvZyBmaXJlYmFzZSBraGkgdXBkYXRlDQogICAgICogTlRUSEFOSDENCiAgICAgKiBAcGFyYW0geyp9IG1lbnVOYW1lQ3VycmVudCBUw6puIG1lbnUgaGnhu4duIHThuqFpICh0csO5bmcgduG7m2kgbmFtZSB0cm9uZyByb3V0ZXIpDQogICAgICogQHBhcmFtIHsqfSBjb250ZXh0IA0KICAgICAqIEByZXR1cm5zIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJsb2dEYXRhRmlyZUJhc2VVcGRhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvZ0RhdGFGaXJlQmFzZVVwZGF0ZShtZW51TmFtZUN1cnJlbnQsIGNvbnRleHQpIHsKICAgICAgdmFyIGdyb3VwVHlwZSA9IG51bGwsCiAgICAgICAgICBidXNpbmVzc1R5cGUgPSBudWxsLAogICAgICAgICAgbWVudUl0ZW1zID0gd2luZG93Lm1lbnVJdGVtcywKICAgICAgICAgIC8vVGjDtG5nIHRpbiBjw6FjIG1lbnUgY2hhCiAgICAgIGFsbENoaWxkTWVudSA9IHdpbmRvdy5hbGxDaGlsZE1lbnUsCiAgICAgICAgICAvL1Row7RuZyB0aW4gY8OhYyBtZW51IGNvbgogICAgICByb3V0ZXJzID0gd2luZG93LmluZm9yUm91dGVyczsgLy9UaMO0bmcgdGluIHJvdXRlcgogICAgICAvL0zhuqV5IHRyb25nIG1lbnUgY2hhCgogICAgICB2YXIgbWVudVBhcmVudCA9IG1lbnVJdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSBtZW51TmFtZUN1cnJlbnQ7CiAgICAgIH0pOyAvL0zhuqV5IHRyb25nIG1lbnUgY29uCgogICAgICB2YXIgbWVudUNoaWxkID0gYWxsQ2hpbGRNZW51LmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5uYW1lID09IG1lbnVOYW1lQ3VycmVudDsKICAgICAgfSk7CgogICAgICBpZiAobWVudVBhcmVudCB8fCBtZW51Q2hpbGQpIHsKICAgICAgICBpZiAobWVudVBhcmVudCkgewogICAgICAgICAgLy9O4bq/dSBjw7MgdGjDrCBs4bqleSBtZW51IGtow7RuZyBjw7MgbWVudSBjb24gKGdyb3VwVHlwZSA9IEJ1c2luZXNzVHlwZSkKICAgICAgICAgIGlmICghbWVudVBhcmVudC5oYXNDaGlsZCkgewogICAgICAgICAgICBncm91cFR5cGUgPSBidXNpbmVzc1R5cGUgPSBtZW51UGFyZW50LnRleHQ7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJ1c2luZXNzVHlwZSA9IG1lbnVDaGlsZC50ZXh0OwogICAgICAgICAgZ3JvdXBUeXBlID0gbWVudUl0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgcmV0dXJuIG1lbnVDaGlsZC5wYXJlbnQgPT0gaXRlbS5uYW1lOwogICAgICAgICAgfSkudGV4dDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy9LaMO0bmcgY8OzIHRyb25nIG1lbnUgdGjDrCB0w6xtIHRyb25nIHJvdXRlcgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm91dGVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHJvdXRlcnNbaV0uY2hpbGRyZW4pIHsKICAgICAgICAgICAgdmFyIHJvdXRlciA9IHJvdXRlcnNbaV0uY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gbWVudU5hbWVDdXJyZW50OwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyb3V0ZXIpIHsKICAgICAgICAgICAgICBtZW51TmFtZUN1cnJlbnQgPSByb3V0ZXJzW2ldLm5hbWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMubG9nRGF0YUZpcmVCYXNlVXBkYXRlKG1lbnVOYW1lQ3VycmVudCwgY29udGV4dCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoZ3JvdXBUeXBlICYmIGJ1c2luZXNzVHlwZSkgewogICAgICAgIEZpcmViYXNlLmxvZ0RhdGFGaXJlQmFzZShncm91cFR5cGUsIGJ1c2luZXNzVHlwZSwgTVNFbnVtLkZpcmVCYXNlQWN0aW9uVHlwZS5VcGRhdGUsIGNvbnRleHQpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBUaMOqbSBjw6FjIHRow7RuZyBiw6FvIHThu5tpIGPDoWMgxJHGoW4gduG7iw0KICAgICAqIE5NVFVBTjMgMDgvMDMvMjAyMg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IG5vdGlmaWNhdGlvbnMgbeG6o25nIGRhbmggc8OhY2ggY8OhYyB0aMO0bmcgYsOhbywgdGjDtG5nIGLDoW8gbMOgIG9iamVjdCANCiAgICAgKiB7DQogICAgICogICAgT3JnYW5pemF0aW9uSUQ6IElEIMSRxqFuIHbhu4sgbmjhuq1uIGhv4bq3YyB04bqhbyB0aMO0bmcgYsOhbw0KICAgICAqICAgIENvbnRlbnQ6IE7hu5lpIGR1bmcgY8OidSB0aMO0bmcgYsOhbw0KICAgICAqICAgIFR5cGU6IEtp4buDdSB0aMO0bmcgYsOhbyBwaOG7pWMgduG7pSBoaeG7g24gdGjhu4sNCiAgICAgKiAgICBFeHRyYURhdGE6IEThu68gbGnhu4d1IGLhu5Ugc3VuZw0KICAgICAqIH0NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gc3ViU3lzdGVtQ29kZSBlbnVtIGTDuW5nIMSR4buDIGzhuqV5IGPDonUgc3FsIGluc2VydCB0aMO0bmcgYsOhbw0KICAgICAqIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJpbnNlcnROb3RpZmljYXRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbnNlcnROb3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnMsIHN1YlN5c3RlbUNvZGUpIHsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgTm90aWZpY2F0aW9uczogbm90aWZpY2F0aW9ucywKICAgICAgICBTdWJTeXN0ZW1Db2RlOiBzdWJTeXN0ZW1Db2RlCiAgICAgIH07CiAgICAgIG5vdGlmaWNhdGlvbkFQSS5pbnNlcnQocGF5bG9hZCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQ29tbW9uRnVuY3Rpb247Cn0oKTsKCmV4cG9ydCBkZWZhdWx0IG5ldyBDb21tb25GdW5jdGlvbigpOw=="},null]}
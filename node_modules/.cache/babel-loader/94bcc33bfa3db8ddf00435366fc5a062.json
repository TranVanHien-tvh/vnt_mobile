{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT_vue\\src\\commons\\commonFunction.js","dependencies":[{"path":"D:\\VNT_vue\\src\\commons\\commonFunction.js","mtime":1656127386808},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGguanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucGFkLXN0YXJ0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgVnVlIGZyb20gInZ1ZSI7CmltcG9ydCBpMThuIGZyb20gIkAvaTE4bnMvaTE4biI7CmltcG9ydCB7IE1TRW51bSB9IGZyb20gIkAvY29tbW9ucy9lbnVtZXJhdGlvbiI7CmltcG9ydCBzdG9yZSBmcm9tICJAL3N0b3Jlcy9zdG9yZSI7CmltcG9ydCB7IE1vZHVsZUNvbnRleHQgfSBmcm9tICJAL3N0b3Jlcy9tb2R1bGUtY29uc3QiOwppbXBvcnQgXyBmcm9tICJsb2Rhc2giOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBtZXNzYWdlQm94IGZyb20gIkAvY29tbW9ucy9tZXNzYWdlQm94IjsgLy8gaW1wb3J0IEZpcmViYXNlIGZyb20gIkAvZmlyZWJhc2UvZmlyZWJhc2UiOwoKaW1wb3J0IG5vdGlmaWNhdGlvbkFQSSBmcm9tICJAL2FwaXMvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbkFQSS5qcyI7Ci8qKg0KICogQ2xhc3MgY2jhu6lhIGPDoWMgZnVuY3Rpb24gZMO5bmcgY2h1bmcgY2hvIGjhu4cgdGjhu5FuZyBwaMOtYSBjbGllbnQNCiAqLwoKdmFyIENvbW1vbkZ1bmN0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBDb21tb25GdW5jdGlvbigpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb21tb25GdW5jdGlvbik7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQ29tbW9uRnVuY3Rpb24sIFt7CiAgICBrZXk6ICJnZXRNYWluTG9hZGluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TWFpbkxvYWRpbmcoKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcigiI21sb2FkaW5nIik7CiAgICAgIHJldHVybiBlbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtYXNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtYXNrKCkgewogICAgICB2YXIgZWwgPSB0aGlzLmdldE1haW5Mb2FkaW5nKCk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAidW5tYXNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1bm1hc2soKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuZ2V0TWFpbkxvYWRpbmcoKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbmZvTG9nZ2luZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5mb0xvZ2dpbmcoKSB7fQogICAgLyoqDQogICAgICogTG9nIGVycm9yDQogICAgICogQHBhcmFtIHsqfSBlcnJvcg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJlcnJvckxvZ2dpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVycm9yTG9nZ2luZyhlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgIH0KICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGV4Y2VwdGlvbg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVFeGNlcHRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUV4Y2VwdGlvbihlcnJvciwgc2hvd0FsZXJ0KSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwoKICAgICAgaWYgKHNob3dBbGVydCkgewogICAgICAgIHZhciBtc2dCb3ggPSBtZXNzYWdlQm94LAogICAgICAgICAgICBsb2NhbGl6ZSA9IGkxOG47CiAgICAgICAgbXNnQm94LnNob3dFcnJvcihsb2NhbGl6ZS50KCJpMThuQ29tbW9uLkdsb2JhbEVycm9yTWVzc2FnZSIpKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70gaGnhu4NuIHRo4buLIGRpYWxvZw0KICAgICAqIEBhdXRob3IgRE5UaGFuZyAtIDMwLjEwLjIwMTkNCiAgICAgKiBETlRoYW5nIC0gMDYuMDUuMjAyMDogVHJvbmcgdHLGsOG7nW5nIGjhu6NwIG93bmVyIGzDoCBwb3B1cCB0aMOsIHPhur0gYXBwZW5kIHbDoG8gY29udGVudCDEkeG7gyBraMO0bmcgYuG7iyBjaMOsbSDhu58gZMaw4bubaQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwcmVwYXJlRm9yRGlhbG9nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcmVwYXJlRm9yRGlhbG9nKGNvbXBvbmVudCwgb3duZXIsIG9wdGlvbnMpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChvd25lciAmJiBjb21wb25lbnQpIHsKICAgICAgICB2YXIgZnJtVHlwZSA9IFZ1ZS5leHRlbmQoY29tcG9uZW50KSwKICAgICAgICAgICAgZnJtID0gbmV3IGZybVR5cGUob3B0aW9ucyk7CiAgICAgICAgZnJtLiRtb3VudCgpOwoKICAgICAgICBpZiAob3duZXIuaXNNc1BvcHVwKSB7CiAgICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSBvd25lci4kcmVmcy5wb3B1cHg7IC8vb3duZXIuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5tcy1wb3B1cC1jb250ZW50Lm1zLXBvcHVwJyk7CgogICAgICAgICAgY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChvd25lciBpbnN0YW5jZW9mIEVsZW1lbnQpIHsKICAgICAgICAgICAgb3duZXIuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvd25lci4kZWwuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZnJtOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CiAgICAvKioNCiAgICAgKiBCdWlsZCB2dWUga2V5IGNobyBkYXRhDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdlblZLZXlWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuVktleVZhbHVlKGRhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBmaWVsZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogIl9fdktleVZhbHVlIjsKCiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpdGVtW2ZpZWxkXSA9IF90aGlzLmdlbmVyYXRlVVVJRCgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiAgVOG6oW8gdXVpZA0KICAgICAqICBDcmVhdGUgYnk6IHB2ZHVvbmcxIC0gMzAvMDgvMjAxOQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZW5lcmF0ZVVVSUQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHsKICAgICAgcmV0dXJuICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIGQgKz0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgdmFyIHIgPSAoZCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7CiAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICByZXR1cm4gKGMgPT09ICJ4IiA/IHIgOiByICYgMHgzIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICogR3VpbGQgZW1wdHkNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2VuZXJhdGVFbXB0eVVVSUQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlRW1wdHlVVUlEKCkgewogICAgICByZXR1cm4gIjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCI7CiAgICB9CiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIDIgxJHhu5FpIHTGsOG7o25nIGPDsyBwaOG6o2kgbMOgIGNoYSBjb24gY+G7p2EgbmhhdSBraMO0bmcNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFzUGFyZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNQYXJlbnQoY2hpbGQsIHBhcmVudCkgewogICAgICBpZiAoY2hpbGQucGFyZW50RWxlbWVudCkgewogICAgICAgIGlmIChjaGlsZC5wYXJlbnRFbGVtZW50ID09PSBwYXJlbnQpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5oYXNQYXJlbnQoY2hpbGQucGFyZW50RWxlbWVudCwgcGFyZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgxJHhu5FpIHTGsOG7o25nIGPDsyBjbGFzcyBzdHlsZSBraMO0bmcNCiAgICAgKiBNb2RpZmllZCBubnRhbTogdGjDqm0gY2FzZSBj4buRaSB2w6BvIGNobyBraMO0bmcgY2jhur90DQogICAgICovCgogIH0sIHsKICAgIGtleTogImhhc0NsYXNzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHsKICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5jbGFzc05hbWUpIHsKICAgICAgICByZXR1cm4gZWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZihjbGFzc05hbWUpID4gLTE7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG9ydGtleVB1c2hWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG9ydGtleVB1c2hWaWV3KGVsKSB7CiAgICAgIHdpbmRvdy5zaG9ydGtleVZpZXcucmVtb3ZlKGVsKTsKICAgICAgd2luZG93LnNob3J0a2V5Vmlldy5wdXNoKGVsKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJzaG9ydGtleVBvcFZpZXciLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNob3J0a2V5UG9wVmlldyhlbCkgewogICAgICB3aW5kb3cuc2hvcnRrZXlWaWV3LnJlbW92ZShlbCk7CiAgICB9CiAgICAvKioNCiAgICAgKiBY4butIGzDvSByZW5kZXIgZWxlbWVudCDEkeG7mW5nDQogICAgICogbW9kaWZpZWQgYnkgbnRwaG9uZyAyOC81LzIwMjEgLSBpc0FwcGVuZFRhcmdldDogbuG6v3UgbMOgIGFwcGVuZCAxIMSRb+G6oW4gY29kZSBodG1sIHbDoG8gMSB0cm9uZyB0YXJnZXQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVuZGVyRHluYW1pY0VsZW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbmRlckR5bmFtaWNFbGVtZW50KHRhcmdldCwgY29tcG9uZW50LCBvd25lciwgb3B0aW9ucywgaXNBcHBlbmRUYXJnZXQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChjb21wb25lbnQpIHsKICAgICAgICB2YXIgZnJtVHlwZSA9IFZ1ZS5leHRlbmQoY29tcG9uZW50KSwKICAgICAgICAgICAgZnJtID0gbmV3IGZybVR5cGUob3B0aW9ucyk7CiAgICAgICAgZnJtLiRtb3VudCgpOwoKICAgICAgICBpZiAodGFyZ2V0ICYmIGlzQXBwZW5kVGFyZ2V0ICYmIGZybS4kZWwpIHsKICAgICAgICAgIHRhcmdldC5hcHBlbmRDaGlsZChmcm0uJGVsKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmcm07CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIGZvY3VzIHbDoG8gY29udHJvbCB0csaw4bubYyDEkcOzDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvY3VzUHJldmlld0NvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzUHJldmlld0NvbnRyb2woY3VyZm9jdXMpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHZhciBmbiA9IGZ1bmN0aW9uIGZuKHBhcmVudCkgewogICAgICAgIHZhciBpdGVtcyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dDpub3QoW2Rpc2FibGVkXSksYnV0dG9uOm5vdChbZGlzYWJsZV0pLGEiKTsKCiAgICAgICAgaWYgKGl0ZW1zWzBdICE9PSBjdXJmb2N1cykgewogICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoaXRlbXNbaV0gPT09IGN1cmZvY3VzKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgICAgICAgLy9jaGVjayBpdGVtIHZpc2libGUKICAgICAgICAgICAgICAgIGlmIChtZS5pc1Zpc2libGUoaXRlbXNbal0pKSB7CiAgICAgICAgICAgICAgICAgIGl0ZW1zW2pdLmZvY3VzKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IC8vcmVzZXQgZm9jdXMgdG8gcGFyZW50CgoKICAgICAgICAgICAgICBjdXJmb2N1cyA9IHBhcmVudDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZm4ocGFyZW50LnBhcmVudEVsZW1lbnQpOwogICAgICB9OwoKICAgICAgZm4oY3VyZm9jdXMucGFyZW50RWxlbWVudCk7CiAgICB9CiAgICAvKioNCiAgICAgIC8qKg0KICAgICAqIGZvY3VzIHbDoG8gY29udHJvbCB0aeG6v3AgdGhlbw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1c05leHRDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1c05leHRDb250cm9sKGN1cmZvY3VzKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuZ2V0TmV4dElucHV0Q29udHJvbChjdXJmb2N1cyk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC5mb2N1cygpOwoKICAgICAgICBpZiAodHlwZW9mIGVsLnNlbGVjdCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgZWwuc2VsZWN0KCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogS2nhu4NtIHRyYSBlbGVtZW50IGPDsyBoaeG7g24gdGjhu4sga2jDtG5nDQogICAgICovCgogIH0sIHsKICAgIGtleTogImlzVmlzaWJsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNWaXNpYmxlKGVsZW1lbnQpIHsKICAgICAgcmV0dXJuIGVsZW1lbnQub2Zmc2V0UGFyZW50OwogICAgfQogICAgLyoNCiAgICAgKiBM4bqleSBjb250cm9sIG5o4bqtcCBsaeG7h3UgdGnhur9wIHRoZW8NCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0TmV4dElucHV0Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TmV4dElucHV0Q29udHJvbChjdXJyZW50KSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICAvL2kgPSBjLmluZGV4KCksCiAgICAgIHAgPSBjdXJyZW50LnBhcmVudE5vZGU7CgogICAgICBpZiAoIXApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgdmFyIGNoID0gcC5jaGlsZHJlbiwKICAgICAgICAgIHIgPSBudWxsLAogICAgICAgICAgbywKICAgICAgICAgIGkgPSAwOwoKICAgICAgZm9yICg7IGkgPCBjaC5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChjaFtpXSA9PT0gY3VycmVudCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKHZhciBrID0gaSArIDE7IGsgPCBjaC5sZW5ndGg7IGsrKykgewogICAgICAgIG8gPSBjaFtrXTsKCiAgICAgICAgaWYgKFsiSU5QVVQiLCAiVEVYVEFSRSIsICJCVVRUT04iLCAiQSJdLmluZGV4T2Yoby50YWdOYW1lKSA+IC0xICYmICFvLmdldEF0dHJpYnV0ZSgiZGlzYWJsZWQiKSAmJiAhby5nZXRBdHRyaWJ1dGUoInRhYmluZGV4IikgIT09IC0xICYmIG1lLmlzVmlzaWJsZShvKSkgewogICAgICAgICAgciA9IG87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHIgPSBtZS5nZXRGaXJzdENvbnRyb2xGb2N1cyhvKTsKICAgICAgICB9CgogICAgICAgIGlmIChyKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghcikgewogICAgICAgIHIgPSBtZS5nZXROZXh0SW5wdXRDb250cm9sKHApOwogICAgICB9CgogICAgICByZXR1cm4gcjsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IGNvbnRyb2wgbmjhuq1wIGxp4buHdSDEkeG6p3UgdGnDqm4NCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Rmlyc3RDb250cm9sRm9jdXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEZpcnN0Q29udHJvbEZvY3VzKHBhcmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgb2JqID0gcGFyZW50IHx8IGRvY3VtZW50LAogICAgICAgICAgc2VsZWN0b3IgPSBbJ2lucHV0Om5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PSItMSJdKScsICd0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD0iLTEiXSknLCAnc2VsZWN0Om5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PSItMSJdKScsICdidXR0b246bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9Ii0xIl0pOm5vdCgubXMtY29uLWRyb3Bkb3duKScsICdhOm5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PSItMSJdKTpub3QoLm1zLWNvbGxhcHNlLWl0ZW0tLWhlYWRlciknXS5qb2luKCIsIik7CiAgICAgIHZhciBpdGVtcyA9IG9iai5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTsKCiAgICAgIGlmIChpdGVtcyAhPSBudWxsICYmIGl0ZW1zLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGl0ZW1zW2ldOwoKICAgICAgICAgIGlmIChtZS5pc1Zpc2libGUoaXRlbSkpIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKg0KICAgICAqIFTDrG0gcmEgY29udHJvbCBJbnB1dCDEkeG6p3UgdGnDqm4gdGhlbyBzY29wZSB0cnV54buBbiB2w6BvIHbDoCBjaG8gcGjDqXAgc+G7rWENCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHNjb3BlIFBhcmVudCBj4bqnbiB0w6xtIGlucHV0DQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbmRGaXJzdENvbnRyb2xJbnB1dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEZpcnN0Q29udHJvbElucHV0KHNjb3BlKSB7CiAgICAgIGlmIChzY29wZSAmJiBzY29wZS5xdWVyeVNlbGVjdG9yKSB7CiAgICAgICAgdmFyIGlucHV0ID0gc2NvcGUucXVlcnlTZWxlY3RvcigiaW5wdXQ6bm90KFt0eXBlPWJ1dHRvbl0pOm5vdChbdHlwZT1yYWRpb10pOm5vdChbdHlwZT1jaGVja2JveF0pOm5vdChbcmVhZG9ubHldKTpub3QoW2Rpc2FibGVkXSk6bm90KFtjbGFzcz0naGlkZGVuJ10pLHRleHRhcmVhOm5vdChbcmVhZG9ubHldKTpub3QoW2Rpc2FibGVkXSk6bm90KFtjbGFzcz0naGlkZGVuJ10pIik7CiAgICAgICAgcmV0dXJuIGlucHV0OwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CiAgICAvKioNCiAgICAgKiBU4buxIMSR4buZbmcgZm9jdXMgdsOgbyBjb250cm9sIG5o4bqtcCBsaeG7h3UgxJHhuqd1IHRpw6puIHRoZW8gc2NvcGUgdHJ1eeG7gW4gdsOgbw0KICAgICAqIEBwYXJhbSB7RWxlbWVudH0gc2NvcGUgUGjhuqFtIHZpIGPhuqduIHjhu60gbMO9IGZvY3VzDQogICAgICogQGF1dGhvciBETlRoYW5nIC0gMzEuMTAuMjAxOQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1c0ZpcnN0Q29udHJvbElucHV0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1c0ZpcnN0Q29udHJvbElucHV0KHNjb3BlKSB7CiAgICAgIHZhciBzZWxlY3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7CiAgICAgIHZhciBtZSA9IHRoaXM7IC8vIHNldFRpbWVvdXQoKCkgPT4gewoKICAgICAgdmFyIGlucHV0ID0gbWUuZmluZEZpcnN0Q29udHJvbElucHV0KHNjb3BlKTsKCiAgICAgIGlmIChpbnB1dCkgewogICAgICAgIGlucHV0LmZvY3VzKCk7CgogICAgICAgIGlmIChzZWxlY3QgJiYgdHlwZW9mIGlucHV0LnNlbGVjdCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgaW5wdXQuc2VsZWN0KCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vbuG6v3UgayBjw7MgaW5wdXQgbsOgbyDEkeG7gyBmb2N1cyB0aMOsIGZvY3VzIHbDoG8gZMOybmcgxJHhuqd1IHRpw6puIGPhu6dhIGdyaWQoIG7hur91IGPDsyApIMSR4buDIGPDsyB0aOG7gyB0aOG7sWMgaGnhu4duIHBow61tIHThuq90IGtleWRvd24gdXAvZG93biDEkeG7gyBjaOG7jW4gZMOybmcKICAgICAgICBtZS5mb2N1c0ZpcnN0Um93R3JpZChzY29wZSk7CiAgICAgIH0gLy8gfSk7CgogICAgfQogICAgLyoqDQogICAgICogVOG7sSDEkeG7mW5nIGZvY3VzIHbDoG8gY29udHJvbCBuaOG6rXAgbGnhu4d1IMSR4bqndSB0acOqbiB0aGVvIHNjb3BlIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHNjb3BlIFBo4bqhbSB2aSBj4bqnbiB44butIGzDvSBmb2N1cw0KICAgICAqIEBhdXRob3IgYm5kdWMgLSAxNS4xMS4yMDE5DQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvY3VzRmlyc3RDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1c0ZpcnN0Q29udHJvbChzY29wZSkgewogICAgICBpZiAoc2NvcGUpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKCiAgICAgICAgdmFyIGlucHV0OwoKICAgICAgICBpZiAoc2NvcGUudHlwZSA9PT0gInRleHQiIHx8IHNjb3BlLmhhc0F0dHJpYnV0ZSAmJiBzY29wZS5oYXNBdHRyaWJ1dGUoInR5cGUiKSAmJiBzY29wZS5nZXRBdHRyaWJ1dGUoInR5cGUiKSA9PT0gInRleHQiKSB7CiAgICAgICAgICBpbnB1dCA9IHNjb3BlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpbnB1dCA9IG1lLmZpbmRGaXJzdENvbnRyb2xGb2N1cyhzY29wZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5wdXQpIHsKICAgICAgICAgIGlucHV0LmZvY3VzKCk7CiAgICAgICAgfSAvLyB9KTsKCiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIFThu7EgxJHhu5luZyBmb2N1cyB2w6BvIGNvbnRyb2wgbmjhuq1wIGxp4buHdSB2w6BvIGTDsm5nIMSR4bqndSB0acOqbiBj4bunYSBncmlkKCBu4bq/dSBjw7MgKSDEkeG7gyBjw7MgdGjhu4MgdGjhu7FjIGhp4buHbiBwaMOtbSB04bqvdCBrZXlkb3duIHVwL2Rvd24gxJHhu4MgY2jhu41uIGTDsm5nDQogICAgICogQHBhcmFtIHtFbGVtZW50fSBzY29wZSBQaOG6oW0gdmkgY+G6p24geOG7rSBsw70gZm9jdXMNCiAgICAgKiBAYXV0aG9yIG5ubGFtIC0gMTYuMDYuMjAyMQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1c0ZpcnN0Um93R3JpZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXNGaXJzdFJvd0dyaWQoc2NvcGUpIHsKICAgICAgaWYgKHNjb3BlKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsgLy8gc2V0VGltZW91dCgoKSA9PiB7CgogICAgICAgIHZhciBncmlkOwoKICAgICAgICBpZiAobWUuZ3JpZCkgewogICAgICAgICAgZ3JpZCA9IG1lLmdyaWQuJGVsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBncmlkID0gbWUuZmluZEZpcnN0R3JpZChzY29wZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZ3JpZCkgewogICAgICAgICAgLy9tZS4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgaWYgKGdyaWQgJiYgIWdyaWQuY2xhc3NMaXN0LmNvbnRhaW5zKCdub3RBdXRvRm9jdXMnKSkgewogICAgICAgICAgICB2YXIgdHJGaXJzdCA9IGdyaWQucXVlcnlTZWxlY3RvcigiLm1zLXRib2R5LmRhdGEgdHIiKTsKCiAgICAgICAgICAgIGlmICh0ckZpcnN0KSB7CiAgICAgICAgICAgICAgdHJGaXJzdC5mb2N1cygpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBUw6xtIHJhIGNvbnRyb2wgSW5wdXQgxJHhuqd1IHRpw6puIHRoZW8gc2NvcGUgdHJ1eeG7gW4gdsOgbyB2w6AgY2hvIHBow6lwIHPhu61hDQogICAgICogQHBhcmFtIHtFbGVtZW50fSBzY29wZSBQYXJlbnQgY+G6p24gdMOsbSBpbnB1dA0KICAgICAqIEBhdXRob3IgYm5kdWMgLSAxNS4xMS4yMDE5DQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbmRGaXJzdENvbnRyb2xGb2N1cyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEZpcnN0Q29udHJvbEZvY3VzKHNjb3BlKSB7CiAgICAgIGlmIChzY29wZSAmJiBzY29wZS5xdWVyeVNlbGVjdG9yKSB7CiAgICAgICAgdmFyIGlucHV0ID0gc2NvcGUucXVlcnlTZWxlY3RvcigiaW5wdXQ6bm90KFtyZWFkb25seV0pOm5vdChbZGlzYWJsZWRdKSxidXR0b246bm90KFtkaXNhYmxlXSksYSx0ZXh0YXJlYSIpOwogICAgICAgIHJldHVybiBpbnB1dDsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQogICAgLyoqDQogICAgICogVMOsbSByYSBncmlkIMSR4bqndSB0acOqbiBj4bunYSBmb3JtDQogICAgICogQHBhcmFtIHtFbGVtZW50fSBzY29wZSBQYXJlbnQgY+G6p24gdMOsbSBncmlkDQogICAgICogQGF1dGhvciBubmxhbSAtIDE2LjA2LjIwMjENCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmluZEZpcnN0R3JpZCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZEZpcnN0R3JpZChzY29wZSkgewogICAgICBpZiAoc2NvcGUgJiYgc2NvcGUucXVlcnlTZWxlY3RvcikgewogICAgICAgIHZhciBncmlkID0gc2NvcGUucXVlcnlTZWxlY3RvcigiLm1zLWdyaWQtdmlld2VyIik7CiAgICAgICAgcmV0dXJuIGdyaWQ7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGtoaSBmb2N1cyBjb250cm9sIGN14buRaSBjw7luZyB0aMOsIHPhur0gdGjhu7FjIHRoaSBmbg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwcm9jZXNzVW5mb2N1c0xhc3RDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcm9jZXNzVW5mb2N1c0xhc3RDb250cm9sKGUsIGZuKSB7CiAgICAgIGlmIChlLndoaWNoID09PSA5ICYmICFlLnNoaWZ0S2V5KSB7CiAgICAgICAgLy9jb25zb2xlLmxvZyhlLnRhcmdldC5hdHRyaWJ1dGVzLmNsYXNzLnZhbHVlKTsKICAgICAgICB2YXIgY3VyID0gZS50YXJnZXQ7CiAgICAgICAgdmFyIGVscyA9IGUuY3VycmVudFRhcmdldC5xdWVyeVNlbGVjdG9yQWxsKCIqIik7CiAgICAgICAgdmFyIGZsYWcgPSB0cnVlOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKGVsc1tpXSA9PT0gY3VyKSB7CiAgICAgICAgICAgIGZsYWcgPSBmYWxzZTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZsYWcpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgZWxzW2ldLmZvY3VzKCk7CgogICAgICAgICAgaWYgKGVsc1tpXSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgewogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9IC8vZm9jdXMgZmlyc3QgY29udHJvbAoKCiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGZuKCk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgMiDEkcO0aSB0xrDhu6NuZyBjw7Mga2jDoWMgbmhhdSBraMO0bmcNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY2hlY2tEaWZmIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja0RpZmYobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgdmFyIHJldCA9IGZhbHNlOwoKICAgICAgaWYgKF90eXBlb2YobmV3VmFsKSA9PSAib2JqZWN0IiAmJiBfdHlwZW9mKG9sZFZhbCkgPT0gIm9iamVjdCIpIHsKICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBuZXdWYWwpIHsKICAgICAgICAgIGlmIChfdHlwZW9mKG5ld1ZhbFtmaWVsZF0pICE9ICJvYmplY3QiICYmIG5ld1ZhbFtmaWVsZF0gIT0gb2xkVmFsW2ZpZWxkXSkgewogICAgICAgICAgICByZXQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICAvKioNCiAgICAgKiBwdmR1eSAyOC8wNi8yMDIxDQogICAgICogbOG6qXkgcmEgZGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyB0aGF5IMSR4buVaSB2w6AgZ2nDoSB0cuG7iyB0aGF5IMSR4buVaQ0KICAgICAqIHRow6ptIMSRb+G6oW4geOG7rSBsw70gdHLGsOG7nW5nIGjhu6NwIHTDrG0gc+G7sSB0aGF5IMSR4buVaSBj4butYSBnacOhIHRy4buLIGRhdGV0aW1lDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldERpZmZMaXN0UHJvcGVydHkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldERpZmZMaXN0UHJvcGVydHkobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgdmFyIGxpc3RGaWVsZCA9IFtdOwoKICAgICAgaWYgKF90eXBlb2YobmV3VmFsKSA9PSAib2JqZWN0IiAmJiBfdHlwZW9mKG9sZFZhbCkgPT0gIm9iamVjdCIpIHsKICAgICAgICBmb3IgKHZhciBmaWVsZCBpbiBuZXdWYWwpIHsKICAgICAgICAgIGlmIChfdHlwZW9mKG5ld1ZhbFtmaWVsZF0pICE9ICJvYmplY3QiICYmIG5ld1ZhbFtmaWVsZF0gIT0gb2xkVmFsW2ZpZWxkXSkgewogICAgICAgICAgICBsaXN0RmllbGQucHVzaChmaWVsZCk7CiAgICAgICAgICB9IGVsc2UgaWYgKG5ld1ZhbFtmaWVsZF0gaW5zdGFuY2VvZiBEYXRlKSB7CiAgICAgICAgICAgIHZhciBpc0NoYW5nZSA9IGZhbHNlOyAvLyBu4bq/dSAyIGdpw6EgdHLhu4sga2jDoWMgbmhhdSBob+G6t2MgbeG7mXQgdHJvbmcgMiB0aOG6sW5nIG51bGwgdGjDrCB4w6FjIG5o4bqtbiBz4buxIHRoYXkgxJHhu5VpLgoKICAgICAgICAgICAgaWYgKG5ld1ZhbFtmaWVsZF0gIT0gbnVsbCAmJiBvbGRWYWxbZmllbGRdICE9IG51bGwgJiYgdHlwZW9mIG5ld1ZhbFtmaWVsZF0uZ2V0VGltZSA9PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBvbGRWYWxbZmllbGRdLmdldFRpbWUgPT0gImZ1bmN0aW9uIiAmJiBuZXdWYWxbZmllbGRdLmdldFRpbWUoKSAhPSBvbGRWYWxbZmllbGRdLmdldFRpbWUoKSkgewogICAgICAgICAgICAgIGlzQ2hhbmdlID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWxbZmllbGRdID09IG51bGwgJiYgb2xkVmFsW2ZpZWxkXSAhPSBudWxsIHx8IG5ld1ZhbFtmaWVsZF0gPT0gbnVsbCAmJiBvbGRWYWxbZmllbGRdICE9IG51bGwpIHsKICAgICAgICAgICAgICBpc0NoYW5nZSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0NoYW5nZSkgewogICAgICAgICAgICAgIGxpc3RGaWVsZC5wdXNoKGZpZWxkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGxpc3RGaWVsZDsKICAgIH0gLy9DaHV54buDbiBk4buvIGxp4buHdSB0aMOgbmggZOG6oW5nIHRyZWUKICAgIC8vIENyZWF0ZWQgYnkgTFREQVQoMTYuMDYuMjAyMCkKCiAgfSwgewogICAga2V5OiAibm9tYWxpemVEYXRhVHJlZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbm9tYWxpemVEYXRhVHJlZShkYXRhLCBpZEZpZWxkLCBwYXJlbnRGaWVsZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgdmFyIGRhdGFUZW1wID0gX3RvQ29uc3VtYWJsZUFycmF5KGRhdGEpLAogICAgICAgICAgcGFyZW50Tm9kZXMgPSBbXTsKCiAgICAgIGRhdGFUZW1wLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgaWYgKCFpdGVtLmhhc093blByb3BlcnR5KCJwYXJlbnROb2RlIikpIHsKICAgICAgICAgIGl0ZW1bInBhcmVudE5vZGUiXSA9IFtdOwogICAgICAgIH0KCiAgICAgICAgaWYgKGl0ZW1bcGFyZW50RmllbGRdKSB7CiAgICAgICAgICAvL1TDrG0gY2hhCiAgICAgICAgICB2YXIgcGFyZW50ID0gXy5maW5kKGRhdGFUZW1wLCBmdW5jdGlvbiAobykgewogICAgICAgICAgICByZXR1cm4gb1tpZEZpZWxkXSA9PT0gaXRlbVtwYXJlbnRGaWVsZF07CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAocGFyZW50KSB7CiAgICAgICAgICAgIGl0ZW0ucGFyZW50Tm9kZSA9IHBhcmVudDsKCiAgICAgICAgICAgIGlmICghcGFyZW50Lmhhc093blByb3BlcnR5KCJjaGlsZE5vZGVzIikpIHsKICAgICAgICAgICAgICBwYXJlbnRbImNoaWxkTm9kZXMiXSA9IFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIXBhcmVudC5oYXNPd25Qcm9wZXJ0eSgiaXNQYXJlbnQiKSkgewogICAgICAgICAgICAgIHBhcmVudFsiaXNQYXJlbnQiXSA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHBhcmVudC5jaGlsZE5vZGVzLnB1c2goaXRlbSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwYXJlbnROb2Rlcy5wdXNoKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBOTVNJTkg6IHRow6ptIG3Ds24gbsOgeSB2w6wgbuG6v3UgY2jhu41uIHRo4bqxbmcga28gY8OzIENoYSB0cm9uZyBsaXN0IHRow6wgbsOzIGNow61uaCBsw6AgY2hhIGx1w7RuCiAgICAgICAgICBwYXJlbnROb2Rlcy5wdXNoKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBwYXJlbnROb2RlczsKICAgIH0KICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24gZ2jDqXAgY8OhYyBub2RlIGNoYSDEkWkga8OobSB24bubaSBjw6FjIG5vZGUgY29uIGx1w7RuIMSR4buDIHRo4buxYyBoaeG7h24gc2hvdyByYSBuZ2F5IGLDqm4gZMaw4bubaSBub2RlIGNoYQ0KICAgICAqIEBwYXJhbSB7W1RyZWVNb2RlbF19IGRhdGFSZXNvdXJlcyBEYW5oIHPDoWNoIGPDoWMgbm9kZSBjaGEgY+G6p24gc+G6r3AgeOG6v3ANCiAgICAgKiBAcGFyYW0geyp9IGV4cGFuZGVkIEPDsyBN4bufIHLhu5luZyByYSBraMO0bmcNCiAgICAgKiBAcGFyYW0geyp9IGxldmVsDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEJvZHlEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCb2R5RGF0YShkYXRhUmVzb3VyZXMsIGV4cGFuZGVkKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIGxldmVsID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAxOwogICAgICB2YXIgY2hpbGROb2RlcyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogImNoaWxkTm9kZXMiOwoKICAgICAgaWYgKCFkYXRhUmVzb3VyZXMpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KCiAgICAgIHZhciBkYXRhID0gX3RvQ29uc3VtYWJsZUFycmF5KGRhdGFSZXNvdXJlcyk7CgogICAgICB2YXIgYm9keURhdGEgPSBbXTsKICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3csIGluZGV4KSB7CiAgICAgICAgdmFyIGNoaWxkcmVuID0gcm93W2NoaWxkTm9kZXNdOwogICAgICAgIHZhciBjaGlsZHJlbkxlbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChjaGlsZHJlbikuc2xpY2UoOCwgLTEpID09PSAiQXJyYXkiID8gY2hpbGRyZW4ubGVuZ3RoIDogMDsKICAgICAgICByb3cubGV2ZWwgPSBsZXZlbDsKICAgICAgICBWdWUuc2V0KHJvdywgImlzSGlkZSIsIGZhbHNlKTsKICAgICAgICBWdWUuc2V0KHJvdywgImV4cGFuZGVkIiwgZXhwYW5kZWQpOyAvLyByb3cuZXhwYW5kZWQgPSBleHBhbmRlZDsKCiAgICAgICAgcm93LmlzU2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgICByb3cuX2lzU2VsZWN0ZWRNdWx0aXBsZSA9IGZhbHNlOwogICAgICAgIGJvZHlEYXRhLnB1c2gocm93KTsKCiAgICAgICAgaWYgKGNoaWxkcmVuTGVuID4gMCkgewogICAgICAgICAgcm93Ll9leHBhbmRhYmxlID0gdHJ1ZTsKICAgICAgICAgIGJvZHlEYXRhID0gYm9keURhdGEuY29uY2F0KF90aGlzMi5nZXRCb2R5RGF0YShjaGlsZHJlbiwgZXhwYW5kZWQsIGxldmVsICsgMSkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBib2R5RGF0YTsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IGdpw6EgdHLhu4sgZW51bSB0aGVvIHRleHQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RW51bVZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFbnVtVmFsdWUoZW51bU5hbWUsIHRleHQpIHsKICAgICAgdmFyIHNvdXJjZSA9IHRoaXMuZ2V0RW51bVNvdXJjZShlbnVtTmFtZSk7CiAgICAgIHZhciB0ZXh0VHJpbSA9IHRleHQudHJpbSgpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgaXRlbSA9IHNvdXJjZVtpXTsKCiAgICAgICAgaWYgKHRleHRUcmltID09PSBpdGVtLmVudW1UZXh0KSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5lbnVtVmFsdWU7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHJhIGdpw6EgdHLhu4sga2V5IGPhu6dhIGVudW0gdGhlbyB2YWx1ZQ0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZSBHacOhIHRy4buLIGPhu6dhIGVudW0gY+G6p24gbOG6pXkgcmEgZW51bSB0ZXh0DQogICAgICogQHBhcmFtIHtTdHJpbmd9IGVudW1OYW1lIEVudW1OYW1lIMSR4buDIGdldCB0ZXh0DQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEVudW1UZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFbnVtVGV4dCh2YWx1ZSwgZW51bU5hbWUpIHsKICAgICAgdmFyIGUgPSBNU0VudW1bZW51bU5hbWVdLAogICAgICAgICAgbG9jYWxpemUgPSBpMThuOwoKICAgICAgaWYgKGUpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZSkgewogICAgICAgICAgaWYgKGUuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBlW2tleV0gPT09IHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSByYSByZXNvdXJjZSB0aGVvIGVudW0NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgR2nDoSB0cuG7iyBj4bunYSBlbnVtIGPhuqduIGzhuqV5IHJhIGVudW0gcmVzb3VyY2UNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZW51bU5hbWUgRW51bU5hbWUgxJHhu4MgZ2V0IHRleHQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RW51bVJlc291cmNlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRFbnVtUmVzb3VyY2UodmFsdWUsIGVudW1OYW1lKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBsb2NhbGl6ZSA9IGkxOG47CiAgICAgIHZhciBrZXkgPSBtZS5nZXRFbnVtVGV4dCh2YWx1ZSwgZW51bU5hbWUpOwogICAgICB2YXIgcmVzb3VyY2VLZXkgPSBlbnVtTmFtZSArICIuIiArIGtleTsKICAgICAgdmFyIHRleHQgPSBsb2NhbGl6ZS50KCJpMThuRW51bS4iICsgcmVzb3VyY2VLZXkpOwogICAgICByZXR1cm4gdGV4dDsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IGVudW1zb3VyY2UgduG7m2kgdMOqbiBlbnVtIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZW51bU5hbWUgVMOqbiBlbnVtIHRyb25nIGVudW1lcmF0aW9uDQogICAgICogQHBhcmFtIHtBcnJheX0gdmFsdWVzIERhbmggc8OhY2ggY8OhYyBlbnVtIGzhuqV5IHJhIChu4bq/dSBj4bqnbiBjaOG7iSDEkeG7i25oKSwgbuG6v3Uga2jDtG5nIHRow6wgc+G6vSBs4bqleSB04bqldCBj4bqjDQogICAgICogQHBhcmFtIHtCb29sZWFufSBwcmVmaXhJZHggQ8OzIGvDqG0gdGhlbyB0aeG7gW4gdOG7kSBpbmRleCBraMO0bmc6IHRydWUgLSBjw7MsIGZhbHNlIC0ga2jDtG5nIChN4bq3YyDEkeG7i25oIGtow7RuZykNCiAgICAgKiBWRDogZ2V0RW51bVNvdXJjZSgiRW51bUNBQkFSZWFzb25UeXBlIixbMTAsMTEsMTIsMTNdKQ0KICAgICAqIENyZWF0ZWRCeTogUERLSUVOIDE1LzA4LzIwMTkNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0RW51bVNvdXJjZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RW51bVNvdXJjZShlbnVtTmFtZSwgdmFsdWVzLCBwcmVmaXhJZHgpIHsKICAgICAgdmFyIGUgPSBNU0VudW1bZW51bU5hbWVdLAogICAgICAgICAgYXJyID0gW10sCiAgICAgICAgICBsb2NhbGl6ZSA9IGkxOG47CgogICAgICBpZiAoZSkgewogICAgICAgIHZhciBpZHggPSAwOwoKICAgICAgICBmb3IgKHZhciBrZXkgaW4gZSkgewogICAgICAgICAgaWYgKGUuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICB2YXIgdiA9IGVba2V5XSwKICAgICAgICAgICAgICAgIGl4ID0gLTE7CgogICAgICAgICAgICBpZiAoIXZhbHVlcyB8fCAoaXggPSB2YWx1ZXMuaW5kZXhPZih2KSkgPiAtMSkgewogICAgICAgICAgICAgIC8qDQogICAgICAgICAgICAgICAqIHPhu61hIGzhuqFpIGPDoWNoIGzhuqV5IGThu68gbGnhu4d1IHRoZW8gZW51bQ0KICAgICAgICAgICAgICAgKiBwdmR1eSAwMi8wMi8yMDIwDQogICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgIHZhciBlbnVtVGV4dCA9IGxvY2FsaXplLnQoImkxOG5FbnVtLiIgKyBlbnVtTmFtZSArICIuIiArIGtleSk7CgogICAgICAgICAgICAgIGlmIChwcmVmaXhJZHgpIHsKICAgICAgICAgICAgICAgIGVudW1UZXh0ID0gKytpZHggKyAiLiAiICsgZW51bVRleHQ7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgaXRlbSA9IHsKICAgICAgICAgICAgICAgIGVudW1WYWx1ZTogdiwKICAgICAgICAgICAgICAgIGVudW1LZXk6IGtleSwKICAgICAgICAgICAgICAgIGVudW1UZXh0OiBlbnVtVGV4dAogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChpeCA+IC0xKSB7CiAgICAgICAgICAgICAgICAvLyBEVlFVQU46IHPhu61hIGzhuqFpIGPDoWNoIGzhuqV5IGVudW0gc291cmNlIHbhu5tpIHRyxrDhu51uZyBo4bujcCA5IHbDoCA5OSA9PiBraMO0bmcgbOG6pXkgxJHGsOG7o2MgMSB0cm9uZyAyCiAgICAgICAgICAgICAgICBpZiAoYXJyW2l4XSkgewogICAgICAgICAgICAgICAgICBhcnJbYXJyLmxlbmd0aF0gPSBpdGVtOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYXJyW2l4XSA9IGl0ZW07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGFyci5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGFycjsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHRoYW0gc+G7kSB0csOqbiBxdWVyeSBzdHJpbmcNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0VXJsUGFyYW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVcmxQYXJhbXMoKSB7CiAgICAgIHZhciBzZWFyY2g7CgogICAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2gpIHsKICAgICAgICBzZWFyY2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaDsKICAgICAgfQoKICAgICAgdmFyIHRlbXAgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHNlYXJjaCk7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKCiAgICAgIHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcih0ZW1wLmtleXMoKSksCiAgICAgICAgICBfc3RlcDsKCiAgICAgIHRyeSB7CiAgICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgcmVzdWx0W3ZhbHVlXSA9IHRlbXAuZ2V0KHZhbHVlKTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIF9pdGVyYXRvci5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yLmYoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKg0KICAgICAqIEJ1aWxkIHF1ZXJ5IHN0cmluZyBwYXJhbQ0KICAgICAqIEBwYXJhbSB7Kn0gcGFyYW1zDQogICAgICovCgogIH0sIHsKICAgIGtleTogImJ1aWxkUXVlcnlTdHJpbmdQYXJhbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGJ1aWxkUXVlcnlTdHJpbmdQYXJhbXMocGFyYW1zKSB7CiAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHBhcmFtcyk7CiAgICAgIHJldHVybiBzZWFyY2hQYXJhbXMudG9TdHJpbmcoKTsKICAgIH0KICAgIC8qKg0KICAgICAqIMSQxINuZyB4deG6pXQga2jhu49pIOG7qW5nIGThu6VuZw0KICAgICAqIFRETkdISUEgNC80LzIwMjIgc+G7rWEgbOG6oWkgbuG6v3UgxJFuYWcg4bufIG3DtGkgdHLGsOG7nW5nIHBow6F0IHRyaeG7g24gdGjDrCB24buBIHRyYW5nIGRldi1sb2dpbg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJsb2dvZmYiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvZ29mZigpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAiZGV2ZWxvcG1lbnQiKSB7CiAgICAgICAgdGhpcy5yZWRpcmVjdCgiL2Rldi1sb2dpbiIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucmVkaXJlY3QoIi9sb2dvdXQiKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogUmVkaXJlY3Qg4bupbmcgZOG7pW5nIHThu5tpIG3DoG4gaMOsbmgga2jDoWMNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlZGlyZWN0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZWRpcmVjdCh1cmwpIHsKICAgICAgbG9jYXRpb24uaHJlZiA9IHVybDsKICAgIH0KICAgIC8qKg0KICAgICAqIERvd25sb2FkDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGxpbmsNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZG93bmxvYWRMaW5rIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkb3dubG9hZExpbmsobGluaykgewogICAgICB2YXIgYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJhZG93bmxvYWQiKTsKICAgICAgYS5ocmVmID0gbGluazsKICAgICAgYS5jbGljaygpOwogICAgfQogICAgLyoqDQogICAgICogR8OhbiBjb29raWUNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic2V0Q29va2llIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzZXRDb29raWUobmFtZSwgdmFsdWUsIGhvdXJzKSB7CiAgICAgIHZhciBleHBpcmVzID0gIiI7CgogICAgICBpZiAoaG91cnMpIHsKICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgZGF0ZS5zZXRUaW1lKGRhdGUuZ2V0VGltZSgpICsgaG91cnMgKiA2MCAqIDYwICogMTAwMCk7CiAgICAgICAgZXhwaXJlcyA9ICI7IGV4cGlyZXM9IiArIGRhdGUudG9VVENTdHJpbmcoKTsKICAgICAgfQoKICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9IiArICh2YWx1ZSB8fCAiIikgKyBleHBpcmVzICsgIjsgcGF0aD0vIjsKICAgIH0KICAgIC8qKg0KICAgICAqIMSQ4buNYyBjb29raWUNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29va2llIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb29raWUobmFtZSkgewogICAgICB2YXIgbmFtZUVRID0gbmFtZSArICI9IjsKICAgICAgdmFyIGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGMgPSBjYVtpXTsKCiAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09ICIgIikgewogICAgICAgICAgYyA9IGMuc3Vic3RyaW5nKDEsIGMubGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIGlmIChjLmluZGV4T2YobmFtZUVRKSA9PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIC8qKg0KICAgICAqIFjDs2EgY29va2llDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUNvb2tpZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQ29va2llKG5hbWUpIHsKICAgICAgZG9jdW1lbnQuY29va2llID0gbmFtZSArICI9OyBQYXRoPS87IEV4cGlyZXM9VGh1LCAwMSBKYW4gMTk3MCAwMDowMDowMSBHTVQ7IjsKICAgIH0KICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGThu68gbGnhu4d1IHRy4bqjIHbhu4EgdOG7qyBzZXJ2ZXINCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicHJvY2Vzc1NlcnZlclJlc3BvbnNlRGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc1NlcnZlclJlc3BvbnNlRGF0YShkYXRhKSB7CiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgdmFyIHJnID0gL1xkezR9LVswMV1cZC1bMC0zXVxkVFswLTJdXGQ6WzAtNV1cZDpbMC01XVxkLzsKCiAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgICBpZiAoZGF0YVtpXSkgewogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFbaV0gPT09ICJzdHJpbmciICYmIGkuaW5kZXhPZigiRGF0ZSIpID4gLTEgJiYgcmcudGVzdChkYXRhW2ldKSkgewogICAgICAgICAgICAgIGRhdGFbaV0gPSBuZXcgRGF0ZShkYXRhW2ldKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChfdHlwZW9mKGRhdGFbaV0pID09PSAib2JqZWN0IiAmJiBPYmplY3Qua2V5cyhkYXRhW2ldLmxlbmd0aCA+IDApKSB7CiAgICAgICAgICAgICAgdGhpcy5wcm9jZXNzU2VydmVyUmVzcG9uc2VEYXRhKGRhdGFbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSB0ZXh0IGhp4buDbiB0aOG7iyBj4bunYSB0csaw4budbmcgdGjDtG5nIHRpbg0KICAgICAqIEBwYXJhbSB7Kn0gZmllbGQgOiBUw6puIHRyxrDhu51uZw0KICAgICAqIEBwYXJhbSB7Kn0gbmFtZXNwYWNlIDogbcOjIMSR4buDIHhlbSBjw7MgY3VzdG9tIGzhuqFpIGtow7RuZywgbuG6v3Uga2jDtG5nIHRow6wgbOG6pXkgbeG6t2MgxJHhu4tuaA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb2x1bW5UZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRDb2x1bW5UZXh0KGZpZWxkLCBuYW1lc3BhY2UpIHsKICAgICAgdmFyIGxvY2FsaXplID0gaTE4biwKICAgICAgICAgIGNvbW1vbiA9IGxvY2FsaXplLm1lc3NhZ2VzW2xvY2FsaXplLmxvY2FsZV1bImkxOG5Db2x1bW4iXSwKICAgICAgICAgIGN1c3RvbSA9IG5hbWVzcGFjZSA/IGNvbW1vbltuYW1lc3BhY2VdIDogbnVsbDsKCiAgICAgIGlmIChjdXN0b20gJiYgY3VzdG9tLmhhc093blByb3BlcnR5KGZpZWxkKSkgewogICAgICAgIHJldHVybiBjdXN0b21bZmllbGRdOwogICAgICB9CgogICAgICByZXR1cm4gY29tbW9uW2ZpZWxkXTsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHRleHQgaGnhu4NuIHRo4buLIGPhu6dhIGLhuqNuZw0KICAgICAqIEBwYXJhbSB7Kn0gdGFibGUgOiBUw6puIGLhuqNuZw0KICAgICAqIEBwYXJhbSB7Kn0gbmFtZXNwYWNlIDogbcOjIMSR4buDIHhlbSBjw7MgY3VzdG9tIGzhuqFpIGtow7RuZywgbuG6v3Uga2jDtG5nIHRow6wgbOG6pXkgbeG6t2MgxJHhu4tuaA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRUYWJsZVRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFRhYmxlVGV4dCh0YWJsZSwgbmFtZXNwYWNlKSB7CiAgICAgIHZhciBsb2NhbGl6ZSA9IGkxOG4sCiAgICAgICAgICBjb21tb24gPSBsb2NhbGl6ZS5tZXNzYWdlc1tsb2NhbGl6ZS5sb2NhbGVdWyJpMThuVGFibGUiXSwKICAgICAgICAgIGN1c3RvbSA9IG5hbWVzcGFjZSA/IGNvbW1vbltuYW1lc3BhY2VdIDogbnVsbDsKCiAgICAgIGlmIChjdXN0b20gJiYgY3VzdG9tLmhhc093blByb3BlcnR5KHRhYmxlKSkgewogICAgICAgIHJldHVybiBjdXN0b21bdGFibGVdOwogICAgICB9CgogICAgICByZXR1cm4gY29tbW9uW3RhYmxlXTsKICAgIH0KICAgIC8qKg0KICAgICAqIE1hcGluZyB04burIGh0bWwgZWxlbWVudCB0aMOgbmggxJHhu5FpIHTGsOG7o25nIHZ1ZWpzIMSR4buDIHRoYW8gdMOhYw0KICAgICAqIEBwYXJhbSB7b2JqZWN0fSBkb20gaHRtbCBkb21lIGVsZW1lbnQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibWFwRG9tVG9WdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG1hcERvbVRvVnVlKGRvbSkgewogICAgICByZXR1cm4gZG9tLl9fdnVlX187CiAgICB9CiAgICAvKioNCiAgICAgKiBDaHV54buDbiB0aeG6v25nIHZp4buHdCBjw7MgZOG6pXUgdGjDoG5oIGtow7RuZyBk4bqldQ0KICAgICAqIEBhdXRob3IgxJBWVGhpIDA5LzAzLzIwMjENCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicmVtb3ZlVmlldG5hbWVzZVRvbmVzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVWaWV0bmFtZXNlVG9uZXMoc3RyKSB7CiAgICAgIGlmIChzdHIpIHsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw6B8w6F84bqhfOG6o3zDo3zDonzhuqd84bqlfOG6rXzhuql84bqrfMSDfOG6sXzhuq984bq3fOG6s3zhurUvZywgImEiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw6h8w6l84bq5fOG6u3zhur18w6p84buBfOG6v3zhu4d84buDfOG7hS9nLCAiZSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DrHzDrXzhu4t84buJfMSpL2csICJpIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OyfMOzfOG7jXzhu498w7V8w7R84buTfOG7kXzhu5l84buVfOG7l3zGoXzhu5184bubfOG7o3zhu5984buhL2csICJvIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8O5fMO6fOG7pXzhu6d8xal8xrB84burfOG7qXzhu7F84butfOG7ry9nLCAidSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/hu7N8w7184bu1fOG7t3zhu7kvZywgInkiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvxJEvZywgImQiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw4B8w4F84bqgfOG6onzDg3zDgnzhuqZ84bqkfOG6rHzhuqh84bqqfMSCfOG6sHzhuq584bq2fOG6snzhurQvZywgIkEiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw4h8w4l84bq4fOG6unzhurx8w4p84buAfOG6vnzhu4Z84buCfOG7hC9nLCAiRSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DjHzDjXzhu4p84buIfMSoL2csICJJIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OSfMOTfOG7jHzhu458w5V8w5R84buSfOG7kHzhu5h84buUfOG7lnzGoHzhu5x84buafOG7onzhu5584bugL2csICJPIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OZfMOafOG7pHzhu6Z8xah8xq984buqfOG7qHzhu7B84busfOG7ri9nLCAiVSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/hu7J8w5184bu0fOG7tnzhu7gvZywgIlkiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvxJAvZywgIkQiKTsgLy8gU29tZSBzeXN0ZW0gZW5jb2RlIHZpZXRuYW1lc2UgY29tYmluaW5nIGFjY2VudCBhcyBpbmRpdmlkdWFsIHV0Zi04IGNoYXJhY3RlcnMKICAgICAgICAvLyBN4buZdCB2w6BpIGLhu5kgZW5jb2RlIGNvaSBjw6FjIGThuqV1IG3FqSwgZOG6pXUgY2jhu68gbmjGsCBt4buZdCBrw60gdOG7sSByacOqbmcgYmnhu4d0IG7Dqm4gdGjDqm0gaGFpIGTDsm5nIG7DoHkKCiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL1x1MDMwMHxcdTAzMDF8XHUwMzAzfFx1MDMwOXxcdTAzMjMvZywgIiIpOyAvLyDMgCDMgSDMgyDMiSDMoyAgaHV54buBbiwgc+G6r2MsIG5nw6MsIGjhu49pLCBu4bq3bmcKCiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL1x1MDJDNnxcdTAzMDZ8XHUwMzFCL2csICIiKTsgLy8gy4YgzIYgzJsgIMOCLCDDiiwgxIIsIMagLCDGrwogICAgICAgIC8vIFJlbW92ZSBleHRyYSBzcGFjZXMKICAgICAgICAvLyBC4buPIGPDoWMga2hv4bqjbmcgdHLhuq9uZyBsaeG7gW4gbmhhdQoKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvICsgL2csICIgIik7CiAgICAgICAgc3RyID0gc3RyLnRyaW0oKTsgLy8gUmVtb3ZlIHB1bmN0dWF0aW9ucwogICAgICAgIC8vIELhu48gZOG6pXUgY8OidSwga8OtIHThu7EgxJHhurdjIGJp4buHdAogICAgICAgIC8vc3RyID0gc3RyLnJlcGxhY2UoLyF8QHwlfFxefFwqfFwofFwpfFwrfFw9fFw8fFw+fFw/fFwvfCx8XC58XDp8XDt8XCd8XCJ8XCZ8XCN8XFt8XF18fnxcJHxffGB8LXx7fH18XHx8XFwvZywiICIpOwoKICAgICAgICByZXR1cm4gc3RyOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImJ1aWxkRmlsdGVyUGFyYW0iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGJ1aWxkRmlsdGVyUGFyYW0oZmlsdGVycykgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgc0ZpbHRlciA9ICIiOwoKICAgICAgaWYgKGZpbHRlcnMgJiYgIShmaWx0ZXJzIGluc3RhbmNlb2YgQXJyYXkpKSB7CiAgICAgICAgZmlsdGVycyA9IFtmaWx0ZXJzXTsKICAgICAgfQoKICAgICAgdmFyIGxlbmd0aCA9IGZpbHRlcnMubGVuZ3RoOwoKICAgICAgaWYgKGxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgaSwKICAgICAgICAgICAgYXJyYXlGaWx0ZXJzID0gW10sCiAgICAgICAgICAgIHNKb2luID0gIiwiOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBmaWx0ZXIgPSBmaWx0ZXJzW2ldLAogICAgICAgICAgICAgIHNDaGlsZEZpbHRlciA9ICIiLAogICAgICAgICAgICAgIG9wZXJhbmRDaGlsZCA9ICJhbmQiOwoKICAgICAgICAgIGlmIChmaWx0ZXIuY2hpbGRyZW5zIGluc3RhbmNlb2YgQXJyYXkgJiYgZmlsdGVyLmNoaWxkcmVucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHZhciBjaGlsZEZpcnN0ID0gZmlsdGVyLmNoaWxkcmVuc1swXTsKCiAgICAgICAgICAgIGlmIChjaGlsZEZpcnN0Lm9wZXJhbmQpIHsKICAgICAgICAgICAgICBvcGVyYW5kQ2hpbGQgPSBjaGlsZEZpcnN0Lm9wZXJhbmQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNDaGlsZEZpbHRlciA9IG1lLmJ1aWxkRmlsdGVyUGFyYW0oZmlsdGVyLmNoaWxkcmVucyk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHMgPSAnIicgKyBmaWx0ZXIucHJvcGVydHkgKyAnIiwnICsgKGZpbHRlci5vcGVyYXRvciA/ICciJyArIGZpbHRlci5vcGVyYXRvciArICciLCcgOiAiIiksCiAgICAgICAgICAgICAgLy9N4bq3YyDEkeG7i25oIG9wZXJhbmQgbMOgIGBhbmRgCiAgICAgICAgICBvcGVyYW5kID0gJyJhbmQiJzsKICAgICAgICAgIHMgKz0gbWUubm9tYWxpemVGaWx0ZXJWYWx1ZShmaWx0ZXIub3BlcmF0b3IsIGZpbHRlci52YWx1ZSk7IC8veOG7rSBsw70gdMOsbmggaHXhu5FuZyBtdcO0biBmaWx0ZXIgPSAwL2ZhbHNlIG5oxrBuZyBtdeG7kW4gbOG7jWMgcmEgY+G6oyBjw6FjIGdpw6EgdHLhu4sgbnVsbAoKICAgICAgICAgIGlmIChmaWx0ZXIubnVsbFRvRmFpbCAmJiAoZmlsdGVyLnZhbHVlID09PSAwIHx8IGZpbHRlci52YWx1ZSA9PT0gZmFsc2UpKSB7CiAgICAgICAgICAgIHMgKz0gIix0cnVlIjsKICAgICAgICAgIH0KCiAgICAgICAgICBzID0gIlsiICsgcyArICJdIjsKCiAgICAgICAgICBpZiAoc0NoaWxkRmlsdGVyKSB7CiAgICAgICAgICAgIHMgPSAiWyIgKyBzICsgJywiJyArIG9wZXJhbmRDaGlsZCArICciLCcgKyBzQ2hpbGRGaWx0ZXIgKyAiXSI7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGkgIT09IDApIHsKICAgICAgICAgICAgaWYgKGZpbHRlci5vcGVyYW5kKSB7CiAgICAgICAgICAgICAgb3BlcmFuZCA9ICciJyArIGZpbHRlci5vcGVyYW5kICsgJyInOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhcnJheUZpbHRlcnMuYWRkKG9wZXJhbmQpOwogICAgICAgICAgfQoKICAgICAgICAgIGFycmF5RmlsdGVycy5hZGQocyk7CiAgICAgICAgfQoKICAgICAgICBzRmlsdGVyID0gYXJyYXlGaWx0ZXJzLmpvaW4oc0pvaW4pOwoKICAgICAgICBpZiAobGVuZ3RoID4gMSkgewogICAgICAgICAgc0ZpbHRlciA9ICJbIiArIHNGaWx0ZXIgKyAiXSI7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gc0ZpbHRlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJub21hbGl6ZUZpbHRlclZhbHVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBub21hbGl6ZUZpbHRlclZhbHVlKG9wZXJhdG9yLCB2YWx1ZSkgewogICAgICB2YXIgcmV0ID0gIiI7CgogICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7CiAgICAgICAgY2FzZSAiaW4iOgogICAgICAgIGNhc2UgIm5vdGluIjoKICAgICAgICAgIHJldCA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgcmV0ID0gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgcmV0ID0gdmFsdWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgICBpZiAodmFsdWUuZ2V0SG91cnMoKSA9PT0gMCAmJiB2YWx1ZS5nZXRNaW51dGVzKCkgPT09IDAgJiYgdmFsdWUuZ2V0U2Vjb25kcygpID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0ID0gWyciJywgbW9tZW50KHZhbHVlKS5mb3JtYXQoIllZWVktTU0tREQiKSwgJ1QwMDowMDowMCInXS5qb2luKCIiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXQgPSBbJyInLCBtb21lbnQodmFsdWUpLmZvcm1hdCgiWVlZWS1NTS1ERFRoaDptbTpzcyIpLCAnIiddLmpvaW4oIiIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXQgPSBbJyInLCB2YWx1ZSwgJyInXS5qb2luKCIiKTsKICAgICAgICAgIH0KCiAgICAgIH0KCiAgICAgIHJldHVybiByZXQ7CiAgICB9CiAgICAvKioNCiAgICAgKiBY4butIGzDvSB0aGFtIHPhu5EgdHLGsOG7m2Mga2hpIGfhu41pIGzDqm4gc2VydmVyIGxvYWQgZOG7ryBsaeG7h3UgY2hvIGNvbWJvYm94DQogICAgICovCgogIH0sIHsKICAgIGtleTogInByb2Nlc3NDb21ib2JveFBhcmFtUmVxdWVzdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc0NvbWJvYm94UGFyYW1SZXF1ZXN0KHBhcmFtKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBmb3IgKHZhciBpIGluIHBhcmFtKSB7CiAgICAgICAgdmFyIHZhbHVlID0gcGFyYW1baV07CgogICAgICAgIHN3aXRjaCAoaSkgewogICAgICAgICAgY2FzZSAiZmlsdGVyIjoKICAgICAgICAgICAgLy9jaHXhuqluIGjDs2EgdGhhbSBz4buRIGZpbHRlcgogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHZhbHVlID0gbWUuYnVpbGRGaWx0ZXJQYXJhbSh2YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgImNvbmRpdGlvbiI6CiAgICAgICAgICAgIC8vc3RyaW5nZ2lmeSBjb25kaXRpb24gxJHhu4MgYnVpbGQgdHLDqm4gYyMKICAgICAgICAgICAgaWYgKHZhbHVlICYmIE9iamVjdC5rZXlzKHZhbHVlKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgcGFyYW1baV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogInNldExvY2FsU3RvcmFnZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0TG9jYWxTdG9yYWdlKGtleSwgdmFsdWUpIHsKICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0odGhpcy5wcm9jZXNzTG9jYWxTdG9yYWdlS2V5KGtleSksIHZhbHVlKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJnZXRMb2NhbFN0b3JhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExvY2FsU3RvcmFnZShrZXkpIHsKICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKHRoaXMucHJvY2Vzc0xvY2FsU3RvcmFnZUtleShrZXkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJyZW1vdmVMb2NhbFN0b3JhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUxvY2FsU3RvcmFnZShrZXkpIHsKICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0odGhpcy5wcm9jZXNzTG9jYWxTdG9yYWdlS2V5KGtleSkpOwogICAgfQogIH0sIHsKICAgIGtleTogInByb2Nlc3NMb2NhbFN0b3JhZ2VLZXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByb2Nlc3NMb2NhbFN0b3JhZ2VLZXkoa2V5KSB7CiAgICAgIHJldHVybiBbd2luZG93Ll9hcHBDb25maWcuc3RvcmFnZUtleSwga2V5XS5qb2luKCJfIik7CiAgICB9CiAgfSwgewogICAga2V5OiAic2xlZXAiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNsZWVwKG1zKSB7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIHJldHVybiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiY2hlY2tGdWxsTW9udGgiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrRnVsbE1vbnRoKGZyb21EYXRlLCB0b0RhdGUpIHsKICAgICAgdmFyIHNob3J0VGV4dCA9ICIiLAogICAgICAgICAgbG9jYWxpemUgPSBpMThuOwoKICAgICAgaWYgKGZyb21EYXRlICYmIHRvRGF0ZSkgewogICAgICAgIGlmIChmcm9tRGF0ZS5nZXREYXRlKCkgPT0gMSkgewogICAgICAgICAgdmFyIGZyb21ZZWFyID0gZnJvbURhdGUuZ2V0RnVsbFllYXIoKSwKICAgICAgICAgICAgICBmcm9tTW9udGggPSBmcm9tRGF0ZS5nZXRNb250aCgpOwogICAgICAgICAgdmFyIHRvWWVhciA9IHRvRGF0ZS5nZXRGdWxsWWVhcigpLAogICAgICAgICAgICAgIHRvTW9udGggPSB0b0RhdGUuZ2V0TW9udGgoKTsKICAgICAgICAgIHZhciBkYXlzT2ZNb250aCA9IDMyIC0gbmV3IERhdGUodG9ZZWFyLCB0b01vbnRoLCAzMikuZ2V0RGF0ZSgpOwoKICAgICAgICAgIGlmICh0b0RhdGUgJiYgZGF5c09mTW9udGggPT0gdG9EYXRlLmdldERhdGUoKSkgewogICAgICAgICAgICBpZiAoZnJvbU1vbnRoID09IHRvTW9udGggJiYgZnJvbVllYXIgPT0gdG9ZZWFyKSB7CiAgICAgICAgICAgICAgc2hvcnRUZXh0ID0gbG9jYWxpemUudCgiaTE4blJlcG9ydC5SZXBvcnRUZXJtIikuZm9ybWF0KGZyb21Nb250aCArIDEsIGZyb21ZZWFyKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChmcm9tTW9udGggPCB0b01vbnRoICYmIGZyb21ZZWFyID09IHRvWWVhcikgewogICAgICAgICAgICAgIHNob3J0VGV4dCA9IGxvY2FsaXplLnQoImkxOG5SZXBvcnQuUmVwb3J0VGVybVJhbmdlIikuZm9ybWF0KGZyb21Nb250aCArIDEsIHRvTW9udGggKyAxLCBmcm9tWWVhcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzaG9ydFRleHQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gc2hvcnRUZXh0OwogICAgfQogICAgLyoqDQogICAgICogSMOgbSBn4buNaSBsaW5rIGhlbHAgdHJ1eeG7gW4gdsOgbyDEkcaw4budbmcgZOG6q24gxJHhur9uIHThu6tuZyBtw6BuIGjDrG5oDQogICAgICogQHBhcmFtIHsqfSBoZWxwSWQgDQogICAgICogQHJldHVybnMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImhlbHBBbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhlbHBBbXMoaGVscElkKSB7CiAgICAgIHJldHVybiBbd2luZG93Ll9hcHBDb25maWcuaGVscFVSTCwgaGVscElkXS5qb2luKCIiKTsKICAgIH0KICAgIC8qKg0KICAgICAqIEjDoG0gYnVpbGQgbGluayBoZWxwIHbhu5tpIElEKHNjcmVlbmNvZGUpIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcGFyYW0geyp9IGhlbHBJZCBraeG7g20gdHJhIHbDoCB1cHBlcmNhc2Uga8O9IHThu7EgxJHhuqd1IGzDqm4gxJHhu4MgZ2jDqXAgdsOgbyBlbnVtDQogICAgICogQHJldHVybnMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldExpbmtIZWxwQ2Vnb3YiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldExpbmtIZWxwQ2Vnb3YoaGVscElkKSB7CiAgICAgIHZhciBoZWxwSWRDb252ZXJ0ZWQgPSBoZWxwSWQuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBoZWxwSWQuc2xpY2UoMSk7CiAgICAgIHJldHVybiBbd2luZG93Ll9hcHBDb25maWcuaGVscFVSTCwgTVNFbnVtLkhlbHBJRFtoZWxwSWRDb252ZXJ0ZWRdXS5qb2luKCIiKTsKICAgIH0KICAgIC8qKg0KICAgICAqIEZ1bmMgYuG7jyBk4bqldSB0aeG6v25nIHZp4buHdA0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzdHINCiAgICAgKiBAYXV0aG9yIE5DVGhhbmgxDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZVVuaWNvZGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZVVuaWNvZGUoc3RyKSB7CiAgICAgIHZhciB0bXAgPSBzdHI7CiAgICAgIHRtcCA9IHRtcC50b0xvd2VyQ2FzZSgpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvw6B8w6F84bqhfOG6o3zDo3zDonzhuqd84bqlfOG6rXzhuql84bqrfMSDfOG6sXzhuq984bq3fOG6s3zhurUvZywgImEiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL8OofMOpfOG6uXzhurt84bq9fMOqfOG7gXzhur984buHfOG7g3zhu4UvZywgImUiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL8OsfMOtfOG7i3zhu4l8xKkvZywgImkiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL8OyfMOzfOG7jXzhu498w7V8w7R84buTfOG7kXzhu5l84buVfOG7l3zGoXzhu5184bubfOG7o3zhu5984buhL2csICJvIik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/DuXzDunzhu6V84bunfMWpfMawfOG7q3zhu6l84buxfOG7rXzhu68vZywgInUiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL+G7s3zDvXzhu7V84bu3fOG7uS9nLCAieSIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvxJEvZywgImQiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoLyF8QHwlfFxefFwqfFwofFwpfFwrfFw9fFw8fFw+fFw/fFwvfCx8XC58XDp8XDt8XCd8XCJ8XCZ8XCN8XFt8XF18fnxcJHxffGB8LXx7fH18XHx8XFwvZywgIiAiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoLyArIC9nLCAiICIpOwogICAgICB0bXAgPSB0bXAudHJpbSgpOwogICAgICByZXR1cm4gdG1wOwogICAgfQogICAgLyoqDQogICAgICogTG9hZCBk4buvIGxp4buHdSBjb21ib2JveA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDYWNoZUNvbWJvYm94RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q2FjaGVDb21ib2JveERhdGEodHlwZSwgcGF5bG9hZCwgbG9hZFByb21pc2UsIGxvYWRTY29wZSkgewogICAgICB2YXIga2V5ID0gW3R5cGUsIEpTT04uc3RyaW5naWZ5KHBheWxvYWQpXS5qb2luKCJfIikudG9Mb3dlckNhc2UoKSwKICAgICAgICAgIGNhY2hlID0gd2luZG93Ll9jYm9EYXRhW2tleV07CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgIGlmIChjYWNoZSkgewogICAgICAgICAgcmVzb2x2ZShjYWNoZSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBsb2FkUHJvbWlzZS5jYWxsKGxvYWRTY29wZSwgcGF5bG9hZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICB3aW5kb3cuX2Nib0RhdGFba2V5XSA9IHJlc3VsdDsKICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiBMb2FkIGThu68gbGnhu4d1IGNvbWJvYm94DQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUNhY2hlQ29tYm9ib3hEYXRhIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVDYWNoZUNvbWJvYm94RGF0YShrZXkpIHsKICAgICAgdmFyIGNhY2hlcyA9IHdpbmRvdy5fY2JvRGF0YTsKCiAgICAgIGlmIChjYWNoZXMpIHsKICAgICAgICB2YXIga2V5cyA9IFtdOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShrZXkpKSB7CiAgICAgICAgICBrZXlzID0ga2V5OwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGtleSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBrZXlzLnB1c2goU3RyaW5nKGtleSkpOwogICAgICAgIH0KCiAgICAgICAga2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICB2YXIga2V5ID0gW2l0ZW0sICIiXS5qb2luKCJfIikudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICByZW1vdmVLZXlzID0gW107CgogICAgICAgICAgZm9yICh2YXIgaSBpbiBjYWNoZXMpIHsKICAgICAgICAgICAgaWYgKGkuaW5kZXhPZihrZXkpID09PSAwKSB7CiAgICAgICAgICAgICAgcmVtb3ZlS2V5cy5wdXNoKGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IHJlbW92ZUtleXMubGVuZ3RoOyBfaSsrKSB7CiAgICAgICAgICAgIHZhciBjYWNoZUtleSA9IHJlbW92ZUtleXNbX2ldOwogICAgICAgICAgICBkZWxldGUgY2FjaGVzW2NhY2hlS2V5XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogVMOhY2ggdOG7qyBraMOzYSB0w6xtIGtp4bq/bSB0aMOgbmggY8OhYyB04burIHRoZW8gcXV5IHThuq9jDQogICAgICogMS4gTuG6v3UgY8OzIG5nb+G6t2Mga8OpcCAiIiB0aMOsIHTDrG0gxJHDum5nIGvDrSB04buxIHRyb25nIG5nb+G6t2Mga8OpcA0KICAgICAqIDIuIE7hur91IGtow7RuZyB0aMOsIGNo4buJIGPhuqduIGNo4bupYSBj4bqjIDIga8OtIHThu7EgbMOgIMSR4bunDQogICAgICogQHBhcmFtIHtzdHJpbmd9IGtleXdvcmQgdOG7qyBraMOzYSB0w6xtIGtp4bq/bQ0KICAgICAqIEBhdXRob3IgTlZMQU0gMjMuMTEuMjAyMA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzcGxpdEtleVdvcmQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNwbGl0S2V5V29yZChrZXl3b3JkKSB7CiAgICAgIHZhciB3b3JkQXJyID0gW107CgogICAgICBpZiAodHlwZW9mIGtleXdvcmQgIT09ICJzdHJpbmciKSB7CiAgICAgICAga2V5d29yZCA9IF8udG9TdHJpbmcoa2V5d29yZCk7CiAgICAgIH0KCiAgICAgIHZhciBmaXJzdERvdWJsZVF1b3RlSWR4ID0ga2V5d29yZC5pbmRleE9mKCciJyksCiAgICAgICAgICBsYXN0RG91YmxlUXVvdGVJZHggPSBrZXl3b3JkLmxhc3RJbmRleE9mKCciJyk7CiAgICAgIC8qKg0KICAgICAgICogQ8OhYyBUSCB0w6xtIGtp4bq/bSBmdWxsIHRleHQNCiAgICAgICAqIDEuIMSQw6J5IGzDoCBmb28NCiAgICAgICAqIDIuICLEkMOieSBsw6AgZm9vDQogICAgICAgKiAzLiDEkMOieSAibMOgIGZvbyINCiAgICAgICAqIDQuICLEkMOieSBsw6AiIGZvbw0KICAgICAgICovCgogICAgICBpZiAoZmlyc3REb3VibGVRdW90ZUlkeCA9PT0gLTEgfHwgZmlyc3REb3VibGVRdW90ZUlkeCA9PT0gbGFzdERvdWJsZVF1b3RlSWR4IHx8IGZpcnN0RG91YmxlUXVvdGVJZHggIT09IDAgfHwgbGFzdERvdWJsZVF1b3RlSWR4ICE9PSBrZXl3b3JkLmxlbmd0aCAtIDEpIHsKICAgICAgICB3b3JkQXJyID0ga2V5d29yZC5zcGxpdCgvXHMrLyk7IC8vdMOhY2ggdGhlbyBk4bqldSBjw6FjaAogICAgICB9IGVsc2UgewogICAgICAgIHZhciBmdWxsVGV4dCA9IGtleXdvcmQuc2xpY2UoZmlyc3REb3VibGVRdW90ZUlkeCArIDEsIGxhc3REb3VibGVRdW90ZUlkeCk7CgogICAgICAgIGlmICghXy5pc0VtcHR5KGZ1bGxUZXh0KSkgewogICAgICAgICAgd29yZEFyci5wdXNoKGZ1bGxUZXh0KTsKICAgICAgICB9CiAgICAgIH0gLy8gZm9yIChsZXQgaSA9IDA7IGkgPCB3b3JkQXJyLmxlbmd0aDsgKytpKSB7CiAgICAgIC8vICAgICB3b3JkQXJyW2ldID0gd29yZEFycltpXS5yZXBsYWNlKC9bXmEtelxkXS9nLCAnXFwkJicpOy8vY2jDqG4gdGjDqm0gMSBrw60gdOG7qwogICAgICAvLyB9CgoKICAgICAgcmV0dXJuIHdvcmRBcnI7CiAgICB9CiAgICAvKioNCiAgICAgKiBow6BtIHNlYXJjaCBsb2NhbA0KICAgICAqIHByb3BlcnRpZXM6IGRhbmggc8OhY2ggY8OhYyB0csaw4budbmcgY+G6p24gc2VhcmNoDQogICAgICogc2VhcmNoVGV4dDogdGV4dCBuaOG6rXAg4bufIMO0IHNlYXJjaA0KICAgICAqIHNvdXJjZTogZOG7ryBsaeG7h3UgZ+G7kWMgZMO5bmcgxJHhu4MgZmlsdGVyDQogICAgICogZ3JpZDogZ3JpZCBmaWx0ZXINCiAgICAgKiBOVEFuaDI6IHRow6ptIG5vdFNlYXJjaFRleHQgPSB0cnVlIMSR4buDIGzhu41jIHThu6sgY8OhYyBtw6BuIGjDrG5oIGRhbmggc8OhY2ggZOG6oW5nIHRyZWUNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZmlsdGVyRm4iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbHRlckZuKHByb3BlcnRpZXMsIHNvdXJjZSwgZ3JpZCwgc2VhcmNoVGV4dCwgZm9ybSkgewogICAgICB2YXIgbm90U2VhcmNoVGV4dCA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ICYmIGFyZ3VtZW50c1s1XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzVdIDogZmFsc2U7CiAgICAgIHZhciBkYXRhID0gW10sCiAgICAgICAgICBtZSA9IHRoaXM7CiAgICAgIHZhciBzb3VyY2VUZW1wID0gW107CgogICAgICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2UpKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzb3VyY2VUZW1wLCBzb3VyY2UpOyAvLyBOVEFuaDI6IHRow6ptIG5vdFNlYXJjaFRleHQgc+G7rWEgYnVnIGtow7RuZyBs4buNYyDEkcaw4bujYyBj4buZdCB04burIGPDoWMgbcOgbiBow6xuaCBkYW5oIHPDoWNoIHRy4bqhbmcgdHJlZSBkw7luZyBmaWx0ZXIgbG9jYWwKCiAgICAgICAgaWYgKHNlYXJjaFRleHQgJiYgc2VhcmNoVGV4dCAhPSAiIiB8fCBub3RTZWFyY2hUZXh0ID09IHRydWUpIHsKICAgICAgICAgIHNvdXJjZVRlbXAuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAobWUuY2hlY2tTZWFyY2hUZXh0KGl0ZW0sIHByb3BlcnRpZXMsIHNlYXJjaFRleHQpICYmIG1lLmNoZWNrRmlsdGVySGVhZGVyKGl0ZW0sIGdyaWQpICYmIGZvcm0uY2hlY2tGaWx0ZXJHcmlkVHJlZUN1c3RvbShpdGVtLCBwcm9wZXJ0aWVzLCBzZWFyY2hUZXh0KSkgewogICAgICAgICAgICAgIGlmIChkYXRhLmluZGV4T2YoaXRlbSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBkYXRhLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZ3JpZCAmJiBncmlkLmlzR3JpZFRyZWUpIHsKICAgICAgICAgICAgICAgIG1lLmZpbmRQYXJlbnROb2RlKHNvdXJjZSwgZGF0YSwgaXRlbSwgZm9ybSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YSA9IHNvdXJjZVRlbXA7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoZm9ybS5maWx0ZXJIZWFkZXIgJiYgZm9ybS5maWx0ZXJIZWFkZXIubGVuZ3RoID4gMCkgewogICAgICAgIGdyaWQuZGF0YVRlbXAgPSBkYXRhOwogICAgICB9IGVsc2UgewogICAgICAgIGdyaWQuZGF0YVRlbXAgPSBzb3VyY2U7CiAgICAgIH0KCiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgLyoNCiAgICAgKiAgSMOgbSB0w6xtIGtp4bq/bSBjw6FjIG5vZGUgY2hhIGtoaSB0aOG7sWMgaGnhu4duIHTDrG0ga2nhur9tIGThu68gbGnhu4d1Lg0KICAgICAqICBwdmR1eSAwNi8wMS8yMDIxDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbmRQYXJlbnROb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaW5kUGFyZW50Tm9kZShpdGVtcywgZmlsdGVySXRlbXMsIGl0ZW1DaGlsZCwgZm9ybSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIga2V5ID0gIiIsCiAgICAgICAgICBwYXJlbnRLZXkgPSAiUGFyZW50SUQiOwoKICAgICAgaWYgKGZvcm0gJiYgZm9ybS5ncmlkICYmIGZvcm0uZ3JpZC5pZFByb3BlcnR5KSB7CiAgICAgICAga2V5ID0gZm9ybS5ncmlkLmlkUHJvcGVydHk7CiAgICAgIH0KCiAgICAgIGlmIChmb3JtICYmIGZvcm0uZ3JpZCAmJiBmb3JtLmdyaWQucGFyZW50SWRQcm9wZXJ0eSkgewogICAgICAgIHBhcmVudEtleSA9IGZvcm0uZ3JpZC5wYXJlbnRJZFByb3BlcnR5OwogICAgICB9CgogICAgICBpdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW1ba2V5XSA9PSBpdGVtQ2hpbGRbcGFyZW50S2V5XSAmJiAhZmlsdGVySXRlbXMuZmluZChmdW5jdGlvbiAoeCkgewogICAgICAgICAgcmV0dXJuIHhba2V5XSA9PSBpdGVtW2tleV07CiAgICAgICAgfSkpIHsKICAgICAgICAgIGlmIChmaWx0ZXJJdGVtcy5pbmRleE9mKGl0ZW0pID09PSAtMSkgewogICAgICAgICAgICBmaWx0ZXJJdGVtcy5wdXNoKGl0ZW0pOwogICAgICAgICAgfQoKICAgICAgICAgIG1lLmZpbmRQYXJlbnROb2RlKGl0ZW1zLCBmaWx0ZXJJdGVtcywgaXRlbSwgZm9ybSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIC8qKg0KICAgICAqIGjDoG0gZmlsdGVyIGNvbA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjaGVja0ZpbHRlckhlYWRlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tGaWx0ZXJIZWFkZXIoaXRlbSwgZ3JpZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgbGlzdEZpbHRlckhlYWRlciA9IFtdLAogICAgICAgICAgY2hlY2sgPSB0cnVlOwogICAgICBsaXN0RmlsdGVySGVhZGVyID0gZ3JpZC5nZXRGaWx0ZXJIZWFkZXIodHJ1ZSk7CgogICAgICBpZiAobGlzdEZpbHRlckhlYWRlci5sZW5ndGggPiAwKSB7CiAgICAgICAgbGlzdEZpbHRlckhlYWRlci5mb3JFYWNoKGZ1bmN0aW9uIChmaWx0ZXIpIHsKICAgICAgICAgIHZhciB2YWx1ZSA9IGZpbHRlci52YWx1ZSA/IChmaWx0ZXIudmFsdWUgKyAiIikudG9Mb3dlckNhc2UoKSA6ICIiOwoKICAgICAgICAgIHN3aXRjaCAoZmlsdGVyLm9wZXJhdG9yKSB7CiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5Db250YWluczoKICAgICAgICAgICAgICBpZiAoIShpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPyBpdGVtW2ZpbHRlci5wcm9wZXJ0eV0udG9Mb3dlckNhc2UoKSA6ICIiKS5jb250YWlucyh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5Ob3Rjb250YWluczoKICAgICAgICAgICAgICBpZiAoKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA/IGl0ZW1bZmlsdGVyLnByb3BlcnR5XS50b0xvd2VyQ2FzZSgpIDogIiIpLmNvbnRhaW5zKHZhbHVlKSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLlN0YXJ0c1dpdGg6CiAgICAgICAgICAgICAgaWYgKCEoaXRlbVtmaWx0ZXIucHJvcGVydHldID8gaXRlbVtmaWx0ZXIucHJvcGVydHldLnRvTG93ZXJDYXNlKCkgOiAiIikuc3RhcnRzV2l0aCh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkVuZHNXaXRoOgogICAgICAgICAgICAgIGlmICghKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA/IGl0ZW1bZmlsdGVyLnByb3BlcnR5XS50b0xvd2VyQ2FzZSgpIDogIiIpLmVuZHN3aXRoKHZhbHVlKSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkVxdWFsczoKICAgICAgICAgICAgICBpZiAoaXRlbVtmaWx0ZXIucHJvcGVydHldICE9IGZpbHRlci52YWx1ZSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLk5vdEVxdWFsczoKICAgICAgICAgICAgICBpZiAoaXRlbVtmaWx0ZXIucHJvcGVydHldID09IGZpbHRlci52YWx1ZSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkdyZWF0ZXJUaGFuOgogICAgICAgICAgICAgIGlmIChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPD0gZmlsdGVyLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIC8vIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5HcmVhdGVyVGhhbjoKICAgICAgICAgICAgLy8gICBpZihpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPCBmaWx0ZXIudmFsdWUpewogICAgICAgICAgICAvLyAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgLy8gICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgIC8vICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuTGVzc1RoYW46CiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA+PSBmaWx0ZXIudmFsdWUpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5MZXNzVGhhbkVxdWFsczoKICAgICAgICAgICAgICBpZiAoaXRlbVtmaWx0ZXIucHJvcGVydHldID4gZmlsdGVyLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuQmV0d2VlbjoKICAgICAgICAgICAgICAvL2lmKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA+IGZpbHRlci52YWx1ZSl7CiAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5OdWxsOgogICAgICAgICAgICAgIGlmIChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0pIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5Ob3ROdWxsOgogICAgICAgICAgICAgIGlmICghaXRlbVtmaWx0ZXIucHJvcGVydHldKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBjaGVjazsKICAgIH0KICAgIC8qKg0KICAgICAqIGjDoG0gc2VhcmNoIHRoZW8gdGV4dA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjaGVja1NlYXJjaFRleHQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrU2VhcmNoVGV4dChpdGVtLCBwcm9wZXJ0aWVzLCBzZWFyY2hUZXh0KSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBjaGVjayA9IGZhbHNlOwoKICAgICAgaWYgKHNlYXJjaFRleHQpIHsKICAgICAgICB2YXIgdGV4dCA9IHNlYXJjaFRleHQudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocHJvcGVydGllcykpIHsKICAgICAgICAgIHByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgaWYgKGl0ZW1bZmllbGRdICYmIGl0ZW1bZmllbGRdLnRvTG93ZXJDYXNlKCkuY29udGFpbnModGV4dCkpIHsKICAgICAgICAgICAgICBjaGVjayA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBjaGVjazsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHRow7RuZyB0aW4gY2hhbm5lbCBjaHVuZyDEkeG7gyBn4butaS9uaOG6rW4gdGjDtG5nIGLDoW8gZ2nhu69hIGPDoWMgdGFiDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEJyb2FkY2FzdENoYW5uZWwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEJyb2FkY2FzdENoYW5uZWwoKSB7CiAgICAgIGlmICghd2luZG93Ll9fYmMpIHsKICAgICAgICB3aW5kb3cuX19iYyA9IG5ldyBCcm9hZGNhc3RDaGFubmVsKHdpbmRvdy5fYXBwQ29uZmlnLmJyb2FkY2FzdENoYW5uZWwpOwogICAgICB9CgogICAgICByZXR1cm4gd2luZG93Ll9fYmM7CiAgICB9CiAgICAvKioNCiAgICAgKiBURE5HSElBDQogICAgICogMjIvOS8yMDIxDQogICAgICogY29udmVydCB04burIHN0cmluZyBzYW5nIGtp4buDdSBkYXRlDQogICAgICogQHBhcmFtIHsqfSBkYXRlU3RyaW5nIHN0cmluZyB0cnV54buBbiB2w6BvIHbDrSBk4bulOiAnMTgvMDcvMTk5OScNCiAgICAgKiBmb3JtYXRUeXBlID0gMSBsw6AgY2h14buXaSDEkWFuZyB0aGVvIGtp4buDdSBkZC9tbS95eXl5IDIgbMOgIGtp4buDdSB5eXl5L21tL2RkIDMgbMOgIGtp4buDdSBtbS9kZC95eXkNCiAgICAgKiB04buxIHRow6ptIGPDoWMgY2FzZSBzYXUgbuG6v3UgZ+G6t3AgdGjDqm0NCiAgICAgKiBjaGFyU3BsaXQgbMOgIGvDvSB04buxIHNwbGl0DQogICAgICovCgogIH0sIHsKICAgIGtleTogImNvbnZlcnRTdHJpbmdUb0RhdGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnRTdHJpbmdUb0RhdGUoZGF0ZVN0cmluZywgY2hhclNwbGl0LCBmb3JtYXRUeXBlKSB7CiAgICAgIGlmICh0eXBlb2YgZGF0ZVN0cmluZyAhPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gbmV3IERhdGUoKTsKICAgICAgfQoKICAgICAgdmFyIGRhdGVQYXJ0ID0gZGF0ZVN0cmluZy5zcGxpdChjaGFyU3BsaXQgPyBjaGFyU3BsaXQgOiAiLyIpOwogICAgICB2YXIgcmVzdWx0OwoKICAgICAgc3dpdGNoIChmb3JtYXRUeXBlKSB7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgcmVzdWx0ID0gbmV3IERhdGUoZGF0ZVBhcnRbMl0sIHBhcnNlSW50KGRhdGVQYXJ0WzFdKSAtIDEsIGRhdGVQYXJ0WzBdKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZXN1bHQgPSBuZXcgRGF0ZShkYXRlUGFydFswXSwgcGFyc2VJbnQoZGF0ZVBhcnRbMV0pIC0gMSwgZGF0ZVBhcnRbM10pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXN1bHQgPSBuZXcgRGF0ZShkYXRlUGFydFsyXSwgcGFyc2VJbnQoZGF0ZVBhcnRbMV0pIC0gMSwgZGF0ZVBhcnRbMF0pOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioNCiAgICAgKiBIw6BtIGNvbnZlcnQgdOG7qyBEYXRlVGltZSBzYW5nIHN0cmluZyBmb3JtYXQgZOG6oW5nIGRkL21tL3l5eXkNCiAgICAgKiBAcGFyYW0geyp9IGRhdGUgZGF0ZSB0cnV54buBbiBk4bqhbmcgRGF0ZVRpbWUNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY29udmVydERhdGVUb1N0cmluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY29udmVydERhdGVUb1N0cmluZyhkYXRlKSB7CiAgICAgIGlmICh0eXBlb2YgZGF0ZSAhPT0gInN0cmluZyIgJiYgZGF0ZSkgewogICAgICAgIHZhciBkZCA9IFN0cmluZyhkYXRlLmdldERhdGUoKSkucGFkU3RhcnQoMiwgIjAiKTsKICAgICAgICB2YXIgbW0gPSBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgIjAiKTsgLy9KYW51YXJ5IGlzIDAhCgogICAgICAgIHZhciB5eXl5ID0gZGF0ZS5nZXRGdWxsWWVhcigpOwogICAgICAgIHJldHVybiBkZCArICIvIiArIG1tICsgIi8iICsgeXl5eTsKICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGF0ZSA9PT0gInN0cmluZyIgJiYgZGF0ZSkgewogICAgICAgIHJldHVybiBkYXRlOwogICAgICB9CgogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICAvKioNCiAgICAgKiBCdWlsZCBjb2RlIHThu6sgY2h14buXaSBuaOG6rXAgdsOgbw0KICAgICAqIFZEOiBUcuG6p24gxJDhuqFpIE5naMSpYSA9PiBURE4NCiAgICAgKiBURE5HSElBIDcvMTAvMjAyMQ0KICAgICAqIEBwYXJhbSB7Kn0gbmFtZSBjaHXhu5dpIHbDoG8NCiAgICAgKiBAcGFyYW0geyp9IG1heExlbmd0aCDEkeG7mSBkw6BpIGdp4bubaSBo4bqhbg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZW5lcmF0ZUZpcnN0Q2hhcmFjdGVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZW5lcmF0ZUZpcnN0Q2hhcmFjdGVyKG5hbWUsIG1heExlbmd0aCkgewogICAgICB2YXIgc3RyQ29kZSA9ICIiOwoKICAgICAgaWYgKG5hbWUpIHsKICAgICAgICB2YXIgYXJyV29yZCA9IG5hbWUuc3BsaXQoIiAiKTsKCiAgICAgICAgaWYgKGFycldvcmQubGVuZ3RoID4gMCkgewogICAgICAgICAgLy9M4bq3cCBxdWEgY8OhYyB04burCiAgICAgICAgICBhcnJXb3JkLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgLy9Mb+G6oWkgYuG7jyBjw6FjIHThu6sgcuG7lW5nIChjw7Mgbmhp4buBdSBjw6FjaCB0cuG7kW5nKQogICAgICAgICAgICBpZiAoZWxlbWVudCkgewogICAgICAgICAgICAgIC8vbOG6t3AgcXVhIGPDoWMga8O9IHThu7EgxJHhu4MgbOG6pXkgduG7gSBrw70gdOG7sSDEkeG6p3UgdGnDqm4KICAgICAgICAgICAgICB2YXIgYXJyQ2hhciA9IGVsZW1lbnQuc3BsaXQoIiIpOwoKICAgICAgICAgICAgICBpZiAoYXJyQ2hhci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICBzdHJDb2RlICs9IGFyckNoYXJbMF07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzdHJDb2RlKSB7CiAgICAgICAgLy9Mb+G6oWkgYuG7jyBrw70gdOG7sSB0aeG6v25nIHZp4buHdAogICAgICAgIHN0ckNvZGUgPSB0aGlzLnJlbW92ZVZpZXRuYW1lc2VUb25lcyhzdHJDb2RlKTsgLy9jaHV54buDbiB0aMOgbmggY2jhu68gaG9hCgogICAgICAgIHN0ckNvZGUgPSBzdHJDb2RlLnRvVXBwZXJDYXNlKCk7IC8vIGNoZWNrIHJ1bGUgbWF4IGxlbmd0aCwgY+G6r3QgY2h14buXaSDEkWkgbuG6v3UgdGjhu6thCgogICAgICAgIGlmIChzdHJDb2RlICYmIG1heExlbmd0aCAmJiBzdHJDb2RlLmxlbmd0aCA+IG1heExlbmd0aCkgewogICAgICAgICAgc3RyQ29kZSA9IHN0ckNvZGUuc3Vic3RyKDAsIG1heExlbmd0aCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gc3RyQ29kZTsKICAgIH0KICAgIC8qKg0KICAgICAqIEjDoG0gc29ydCBhcnIgdGhlbyBtb2RlDQogICAgICogVEROR0hJQSAzMS8xMC8yMDIxDQogICAgICogQHBhcmFtIHsqfSBtb2RlDQogICAgICogQHBhcmFtIHsqfSBkYXRhDQogICAgICogQHBhcmFtIHsqfSBkYXRhRmllbGQNCiAgICAgKiBAcGFyYW0geyp9IGlzQ2FzdFRvRGF0ZSB0cm9uZyB0csaw4budbmcgaOG7o3AgcGjhuqNpIGNhc3QgduG7gSBkYXRlIG3hu5tpIHNvIHPDoW5oIMSRxrDhu6NjIHRow6wgdHJ1eeG7gW4gdsOgbw0KICAgICAqIEByZXR1cm5zDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNvcnRBcnJheSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc29ydEFycmF5KG1vZGUsIGRhdGEsIGRhdGFGaWVsZCwgaXNDYXN0VG9EYXRlKSB7CiAgICAgIC8vaMOgbSBzb3J0CiAgICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikgewogICAgICAgIHZhciBmaXJzdCA9IGFbZGF0YUZpZWxkXSwKICAgICAgICAgICAgc2Vjb25kID0gYltkYXRhRmllbGRdOwoKICAgICAgICBpZiAoaXNDYXN0VG9EYXRlKSB7CiAgICAgICAgICBmaXJzdCA9IG5ldyBEYXRlKGFbZGF0YUZpZWxkXSkuZ2V0VGltZSgpOwogICAgICAgICAgc2Vjb25kID0gbmV3IERhdGUoYltkYXRhRmllbGRdKS5nZXRUaW1lKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZmlyc3QgPCBzZWNvbmQpIHJldHVybiBtb2RlID09IE1TRW51bS5Tb3J0U3RhdHVzLmRlc2MgPyAxIDogLTE7CiAgICAgICAgaWYgKGZpcnN0ID4gc2Vjb25kKSByZXR1cm4gbW9kZSA9PSBNU0VudW0uU29ydFN0YXR1cy5hc2MgPyAxIDogLTE7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkYXRhLnNvcnQoY29tcGFyZSk7CiAgICB9CiAgICAvKioNCiAgICAgKiBkaXN0aW5jdCBt4bqjbmcgdHJ1eeG7gW4gdsOgbw0KICAgICAqIEBwYXJhbSB7Kn0gYXJyYXkgbeG6o25nIGPhuqduIGRpc3RpbmN0DQogICAgICogQHBhcmFtIHsqfSBrZXkgZmllbGROYW1lIGRpc3RpbmN0DQogICAgICogVEROR0hJQSAzMS8xMC8yMDIxDQogICAgICogQHJldHVybnMNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGlzdGluY3RBcnJheSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzdGluY3RBcnJheShhcnJheSwga2V5KSB7CiAgICAgIHZhciBhcnJheVVuaXF1ZUJ5S2V5ID0gX3RvQ29uc3VtYWJsZUFycmF5KG5ldyBNYXAoYXJyYXkubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIFtpdGVtW2tleV0sIGl0ZW1dOwogICAgICB9KSkudmFsdWVzKCkpOwoKICAgICAgcmV0dXJuIGFycmF5VW5pcXVlQnlLZXk7CiAgICB9CiAgICAvKioNCiAgICAgKiBU4bqjaSBmaWxlIHbhu4EsIGNobyB2w6BvIGlmcmFtZQ0KICAgICAqIE5URElFTSAwMy4xMi4yMDIxDQogICAgICogQHBhcmFtIHt1cmx9IHVybCANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZG93bmxvYWRGaWxlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkb3dubG9hZEZpbGUodXJsKSB7CiAgICAgIHZhciBfdGhpczMgPSB0aGlzOwoKICAgICAgdmFyIGlzU2hvd0xvYWRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7CiAgICAgIHZhciBpZnJhbWVJZCA9ICdkb3dubG9hZElmcmFtZSc7CiAgICAgIHZhciBpZnJhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZnJhbWVJZCk7CgogICAgICB2YXIgY2hlY2tMb2FkZWQgPSBmdW5jdGlvbiBjaGVja0xvYWRlZCgpIHsKICAgICAgICB2YXIgaWZyYW1lRG9jID0gaWZyYW1lLmNvbnRlbnREb2N1bWVudCB8fCBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsgLy8ga2nhu4NtIHRyYSDEkcOjIGRvd25sb2FkIHhvbmcgY2jGsGEKCiAgICAgICAgaWYgKGlmcmFtZURvYy5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScpIHsKICAgICAgICAgIF90aGlzMy51bm1hc2soKTsKCiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSAvLyBjaGVjayB0cuG6oW5nIHRow6FpIG3hu5dpIDIwMG1zCgoKICAgICAgICBzZXRUaW1lb3V0KGNoZWNrTG9hZGVkLCAyMDApOwogICAgICB9OyAvLyBOTVRVQU4yIDA4LjA0LjIwMjI6IGx1w7RuIHhvw6EgY8OhaSBpZnJhbWUgY8WpIMSRaSDEkeG7gyBzaG93IG1hc2sKCgogICAgICBpZiAoaWZyYW1lKSB7CiAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChpZnJhbWUpOwogICAgICB9IC8vIE5NVFVBTjIgMTQuMDQuMjAyMjogbHXDtG4gdOG6oW8gbeG7m2kgY8OhaSBpZnJhbWUKCgogICAgICBpZnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKICAgICAgaWZyYW1lLmlkID0gaWZyYW1lSWQ7CiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIHVybCk7CiAgICAgIGlmcmFtZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ2hpZGRlbicpOwoKICAgICAgaWYgKGlzU2hvd0xvYWRpbmcpIHsKICAgICAgICB0aGlzLm1hc2soKTsKICAgICAgfQoKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpOwoKICAgICAgaWYgKGlzU2hvd0xvYWRpbmcpIHsKICAgICAgICBjaGVja0xvYWRlZCgpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBIw6BtIHJlbW92ZSBjw6FjIGvDvSBoaeG7h3UgaHRtbCB04burIGNodeG7l2kgdHJ1eeG7gW4gdsOgbw0KICAgICAqIEBwYXJhbSB7Q2h14buXaSBu4buZaSBkdW5nIHRydXnhu4FuIHbDoG99IGNvbnRlbnRTdHJpbmcgDQogICAgICogQHJldHVybnMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZUhUTUwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUhUTUwoY29udGVudFN0cmluZykgewogICAgICByZXR1cm4gY29udGVudFN0cmluZy5yZXBsYWNlKC8oPChbXj5dKyk+KS9pZywgIiIpOwogICAgfQogICAgLyoqDQogICAgICogSMOgbSBlbmNvZGUgY8OhYyBrw70gaGnhu4d1LCBzY3JpcHQgxJHhu4MgZ2nhu68gbmd1ecOqbiBu4buZaSBkdW5nIHRleHQNCiAgICAgKiBAcGFyYW0ge0NodeG7l2kgbuG7mWkgZHVuZyB0cnV54buBbiB2w6BvfSBjb250ZW50U3RyaW5nIA0KICAgICAqIFZEOiAiPGI+QsOgaTwvYj4gdG/DoW4gdHXhu5VpIHRoxqEiID0+ICImbHQ7QsOgaTsmbHQ7L2ImZ3Q7IHRvw6FuIHR14buVaSB0aMahIg0KICAgICAqIHPhu60gZOG7pW5nIG7hur91IHBo4bqjaSBs4bqleSB0ZXh0IG5ndXnDqm4gY8OhYyB0aOG6uyBzY3JpcHQNCiAgICAgKiBAcmV0dXJucyANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZW5jb2RlSFRNTCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZW5jb2RlSFRNTChjb250ZW50U3RyaW5nKSB7CiAgICAgIHZhciB0eHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwogICAgICB0eHQuaW5uZXJIVE1MID0gY29udGVudFN0cmluZzsKICAgICAgY29udGVudFN0cmluZyA9IHR4dC5pbm5lckhUTUw7CiAgICAgIHR4dCA9IG51bGw7CiAgICAgIHJldHVybiBjb250ZW50U3RyaW5nOwogICAgfQogICAgLyoqDQogICAgKiBIw6BtIGRlY29kZSBjw6FjIGvDvSBoaeG7h3UsIHNjcmlwdCDEkeG7gyBnaeG7ryBuZ3V5w6puIG7hu5lpIGR1bmcgdGV4dA0KICAgICogQHBhcmFtIHtDaHXhu5dpIG7hu5lpIGR1bmcgdHJ1eeG7gW4gdsOgb30gY29udGVudFN0cmluZyANCiAgICAqIFZEOiAiJmx0O0LDoGk7Jmx0Oy9iJmd0OyB0b8OhbiB0deG7lWkgdGjGoSIgPT4gIjxiPkLDoGk8L2I+IHRvw6FuIHR14buVaSB0aMahIg0KICAgICogc+G7rSBk4bulbmcgbuG6v3UgbOG6pXkgcmEgZ2nDoSB0cuG7iyBjaOG7qWEgY8OhYyB0aOG6uywga8O9IGhp4buHdSDEkcOjIMSRxrDhu6NjIGVuY29kZQ0KICAgICogQHJldHVybnMgDQogICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVjb2RlSFRNTCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGVjb2RlSFRNTChjb250ZW50U3RyaW5nKSB7CiAgICAgIHZhciB0eHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwogICAgICB0eHQuaW5uZXJIVE1MID0gY29udGVudFN0cmluZzsKICAgICAgcmV0dXJuIGNvbnRlbnRTdHJpbmcgPSB0eHQudmFsdWU7CiAgICB9CiAgICAvKioNCiAgICAgKiBURE5HSElBIDEwLzEyLzIwMjENCiAgICAgKiBmb3JtYXQgbOG6oWkgbmfDoHkgdGjDoW5nIG7Eg20gdGhlbyB0ZW1wbGF0ZSB0cnV54buBbiB2w6BvIG3hurdjIMSR4buLbmggbMOgIGRkL21tL3l5eXkNCiAgICAgKiBAcGFyYW0ge0dpw6EgdHLhu4sgbmfDoHkgdGjDoW5nfSB2YWx1ZSANCiAgICAgKiBAcGFyYW0ge0tp4buDdSBmb3JtYXR9IGZvcm1hdFR5cGUgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvcm1hdERhdGVUaW1lIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb3JtYXREYXRlVGltZSh2YWx1ZSwgZm9ybWF0VHlwZSkgewogICAgICByZXR1cm4gbW9tZW50KHZhbHVlKS5mb3JtYXQoZm9ybWF0VHlwZSA/IGZvcm1hdFR5cGUgOiAiREQvTU0vWVlZWSIpOwogICAgfQogICAgLyoqIERIUEhJIDI0LzEyLzIwMjENCiAgICAgKiB0aMOqbSBk4bqldSB2w6BvIHPhu5EgZOG6oW5nIHThu6sgeHh4eCA9PiB4Lnh4eHggDQogICAgICogQHBhcmFtIHtT4buRIHRydXnhu4FuIHbDoG99IG51bWJlciANCiAgICAgKiBAcGFyYW0ge0xv4bqhaSBk4bqldSBtdeG7kW4gdGjDqm0gdsOgbywgbeG6t2MgxJHhu4tuaCBsw6AgZOG6pXUgJy4nfSB0eXBlQ29tbWFzIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JtYXROdW1iZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1hdE51bWJlcihudW1iZXIsIHR5cGVDb21tYXMpIHsKICAgICAgcmV0dXJuIG51bWJlci50b1N0cmluZygpLnJlcGxhY2UoL1xCKD89KFxkezN9KSsoPyFcZCkpL2csIHR5cGVvZiB0eXBlQ29tbWFzICE9PSAndW5kZWZpbmVkJyA/IHR5cGVDb21tYXMgOiAnLicpOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgdGjDtG5nIHRpbiBsb2cgZmlyZWJhc2Uga2hpIHVwZGF0ZQ0KICAgICAqIE5UVEhBTkgxDQogICAgICogQHBhcmFtIHsqfSBtZW51TmFtZUN1cnJlbnQgVMOqbiBtZW51IGhp4buHbiB04bqhaSAodHLDuW5nIHbhu5tpIG5hbWUgdHJvbmcgcm91dGVyKQ0KICAgICAqIEBwYXJhbSB7Kn0gY29udGV4dCANCiAgICAgKiBAcmV0dXJucyANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9nRGF0YUZpcmVCYXNlVXBkYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2dEYXRhRmlyZUJhc2VVcGRhdGUobWVudU5hbWVDdXJyZW50LCBjb250ZXh0KSB7CiAgICAgIHZhciBncm91cFR5cGUgPSBudWxsLAogICAgICAgICAgYnVzaW5lc3NUeXBlID0gbnVsbCwKICAgICAgICAgIG1lbnVJdGVtcyA9IHdpbmRvdy5tZW51SXRlbXMsCiAgICAgICAgICAvL1Row7RuZyB0aW4gY8OhYyBtZW51IGNoYQogICAgICBhbGxDaGlsZE1lbnUgPSB3aW5kb3cuYWxsQ2hpbGRNZW51LAogICAgICAgICAgLy9UaMO0bmcgdGluIGPDoWMgbWVudSBjb24KICAgICAgcm91dGVycyA9IHdpbmRvdy5pbmZvclJvdXRlcnM7IC8vVGjDtG5nIHRpbiByb3V0ZXIKICAgICAgLy9M4bqleSB0cm9uZyBtZW51IGNoYQoKICAgICAgdmFyIG1lbnVQYXJlbnQgPSBtZW51SXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gbWVudU5hbWVDdXJyZW50OwogICAgICB9KTsgLy9M4bqleSB0cm9uZyBtZW51IGNvbgoKICAgICAgdmFyIG1lbnVDaGlsZCA9IGFsbENoaWxkTWVudS5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSBtZW51TmFtZUN1cnJlbnQ7CiAgICAgIH0pOwoKICAgICAgaWYgKG1lbnVQYXJlbnQgfHwgbWVudUNoaWxkKSB7CiAgICAgICAgaWYgKG1lbnVQYXJlbnQpIHsKICAgICAgICAgIC8vTuG6v3UgY8OzIHRow6wgbOG6pXkgbWVudSBraMO0bmcgY8OzIG1lbnUgY29uIChncm91cFR5cGUgPSBCdXNpbmVzc1R5cGUpCiAgICAgICAgICBpZiAoIW1lbnVQYXJlbnQuaGFzQ2hpbGQpIHsKICAgICAgICAgICAgZ3JvdXBUeXBlID0gYnVzaW5lc3NUeXBlID0gbWVudVBhcmVudC50ZXh0OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBidXNpbmVzc1R5cGUgPSBtZW51Q2hpbGQudGV4dDsKICAgICAgICAgIGdyb3VwVHlwZSA9IG1lbnVJdGVtcy5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBtZW51Q2hpbGQucGFyZW50ID09IGl0ZW0ubmFtZTsKICAgICAgICAgIH0pLnRleHQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vS2jDtG5nIGPDsyB0cm9uZyBtZW51IHRow6wgdMOsbSB0cm9uZyByb3V0ZXIKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvdXRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChyb3V0ZXJzW2ldLmNoaWxkcmVuKSB7CiAgICAgICAgICAgIHZhciByb3V0ZXIgPSByb3V0ZXJzW2ldLmNoaWxkcmVuLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICByZXR1cm4gaXRlbS5uYW1lID09IG1lbnVOYW1lQ3VycmVudDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocm91dGVyKSB7CiAgICAgICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gcm91dGVyc1tpXS5uYW1lOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLmxvZ0RhdGFGaXJlQmFzZVVwZGF0ZShtZW51TmFtZUN1cnJlbnQsIGNvbnRleHQpOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBpZiAoZ3JvdXBUeXBlICYmIGJ1c2luZXNzVHlwZSkgewogICAgICAvLyAgIEZpcmViYXNlLmxvZ0RhdGFGaXJlQmFzZSgKICAgICAgLy8gICAgIGdyb3VwVHlwZSwKICAgICAgLy8gICAgIGJ1c2luZXNzVHlwZSwKICAgICAgLy8gICAgIE1TRW51bS5GaXJlQmFzZUFjdGlvblR5cGUuVXBkYXRlLAogICAgICAvLyAgICAgY29udGV4dAogICAgICAvLyAgICk7CiAgICAgIC8vIH0KCiAgICB9CiAgICAvKioNCiAgICAgKiBUaMOqbSBjw6FjIHRow7RuZyBiw6FvIHThu5tpIGPDoWMgxJHGoW4gduG7iw0KICAgICAqIE5NVFVBTjMgMDgvMDMvMjAyMg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IG5vdGlmaWNhdGlvbnMgbeG6o25nIGRhbmggc8OhY2ggY8OhYyB0aMO0bmcgYsOhbywgdGjDtG5nIGLDoW8gbMOgIG9iamVjdCANCiAgICAgKiB7DQogICAgICogICAgT3JnYW5pemF0aW9uSUQ6IElEIMSRxqFuIHbhu4sgbmjhuq1uIGhv4bq3YyB04bqhbyB0aMO0bmcgYsOhbw0KICAgICAqICAgIENvbnRlbnQ6IE7hu5lpIGR1bmcgY8OidSB0aMO0bmcgYsOhbw0KICAgICAqICAgIFR5cGU6IEtp4buDdSB0aMO0bmcgYsOhbyBwaOG7pWMgduG7pSBoaeG7g24gdGjhu4sNCiAgICAgKiAgICBFeHRyYURhdGE6IEThu68gbGnhu4d1IGLhu5Ugc3VuZw0KICAgICAqIH0NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gc3ViU3lzdGVtQ29kZSBlbnVtIGTDuW5nIMSR4buDIGzhuqV5IGPDonUgc3FsIGluc2VydCB0aMO0bmcgYsOhbw0KICAgICAqIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJpbnNlcnROb3RpZmljYXRpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBpbnNlcnROb3RpZmljYXRpb25zKG5vdGlmaWNhdGlvbnMsIHN1YlN5c3RlbUNvZGUpIHsKICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgTm90aWZpY2F0aW9uczogbm90aWZpY2F0aW9ucywKICAgICAgICBTdWJTeXN0ZW1Db2RlOiBzdWJTeXN0ZW1Db2RlCiAgICAgIH07CiAgICAgIG5vdGlmaWNhdGlvbkFQSS5pbnNlcnQocGF5bG9hZCk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gQ29tbW9uRnVuY3Rpb247Cn0oKTsKCmV4cG9ydCBkZWZhdWx0IG5ldyBDb21tb25GdW5jdGlvbigpOw=="},null]}
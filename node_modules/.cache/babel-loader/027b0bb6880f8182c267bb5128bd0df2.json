{"remainingRequest":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT Mobile\\vnt_mobile\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\VNT Mobile\\vnt_mobile\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\VNT Mobile\\vnt_mobile\\src\\components\\mscombobox\\msCombobox.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\VNT Mobile\\vnt_mobile\\src\\components\\mscombobox\\msCombobox.vue","mtime":1670055811959},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovVk5UIE1vYmlsZS92bnRfbW9iaWxlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJEOi9WTlQgTW9iaWxlL3ZudF9tb2JpbGUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC1pbmRleC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZS5qcyI7Ci8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCi8vCmltcG9ydCBNc0NvbWJvQm94RHJvcGRvd24gZnJvbSAiLi9Nc0NvbWJvQm94RHJvcGRvd24udnVlIjsKaW1wb3J0IE1zQ29tYm9Cb3hJdGVtIGZyb20gIi4vTXNDb21ib0JveEl0ZW0udnVlIjsKaW1wb3J0IGNvbW1vbkZuIGZyb20gIkAvY29tbW9ucy9jb21tb25GdW5jdGlvbi5qcyI7CmltcG9ydCBtc0Jhc2VDb21wb25lbnQgZnJvbSAiQC9jb21wb25lbnRzL21zYmFzZS9tc0Jhc2VDb21wb25lbnQudnVlIjsKaW1wb3J0IEV2ZW50QnVzR2xvYmFsLCB7IEdsb2JhbEV2ZW50TmFtZSB9IGZyb20gIkAvY29tbW9ucy9ldmVudEJ1c0dsb2JhbCI7CmltcG9ydCBwb3B1cFV0aWwgZnJvbSAiQC9jb21tb25zL3BvcHVwVXRpbCI7CmltcG9ydCBpMThuIGZyb20gIkAvaTE4bnMvaTE4biI7CmltcG9ydCBtZXNzYWdlQm94IGZyb20gIkAvY29tbW9ucy9tZXNzYWdlQm94IjsKaW1wb3J0IF8gZnJvbSAibG9kYXNoIjsKaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAiQC9taXhpbnMvY29tbW9uL2ZpbHRlciI7CmltcG9ydCB7IHNldFRpbWVvdXQgfSBmcm9tICJ0aW1lcnMiOwppbXBvcnQgeyB2YWxpZGF0ZUNvbWJvYm94IH0gZnJvbSAiQC9taXhpbnMvY29tcG9uZW50L3ZhbGlkYXRlQ29tYm9ib3giOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIk1zQ29tYm9ib3giLAogIGNvbXBvbmVudHM6IHsKICAgIE1zQ29tYm9Cb3hEcm9wZG93bjogTXNDb21ib0JveERyb3Bkb3duLAogICAgTXNDb21ib0JveEl0ZW06IE1zQ29tYm9Cb3hJdGVtCiAgfSwKICBleHRlbmRzOiBtc0Jhc2VDb21wb25lbnQsCiAgbWl4aW5zOiBbZmlsdGVyLCB2YWxpZGF0ZUNvbWJvYm94XSwKICBpbmhlcml0QXR0cnM6IGZhbHNlLAogIHByb3BzOiB7CiAgICB2YWx1ZToge30sCiAgICBjdXN0b21Ub29sdGlwOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFtPYmplY3RdCiAgICB9LAogICAgcGxhY2Vob2xkZXI6IHsKICAgICAgZGVmYXVsdDogbnVsbCwKICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXQogICAgfSwKICAgIG1heEl0ZW1zRGlzcGxheTogewogICAgICBkZWZhdWx0OiA1LAogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICBjb2x1bW5zOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICBkZWZhdWx0OiBmdW5jdGlvbiBfZGVmYXVsdCgpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogVHLGsOG7nW5nIGzDoG0gdmFsdWUNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTUuMDYuMjAyMA0KICAgICAqLwogICAgdmFsdWVGaWVsZDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogVHLGsOG7nW5nIGzDoG0gdGV4dCBkaXNwbGF5DQogICAgICogQ3JlYXRlZEJ5IExUREFUIDE1LjA2LjIwMjANCiAgICAgKi8KICAgIGRpc3BsYXlGaWVsZDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCiAgICAvL0Thu68gbGnhu4d1IGPhu6dhIGNvbWJvYm94CiAgICBkYXRhOiB7CiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uIF9kZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfSwKICAgICAgdHlwZTogQXJyYXkKICAgIH0sCiAgICAvL8SQ4buZIHLhu5luZyBj4bunYSAxIGl0ZW0KICAgIGl0ZW1TaXplOiB7CiAgICAgIGRlZmF1bHQ6IDM2LAogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICAvL0No4buJIG5o4bqtbiBnacOhIHRy4buLIGPDsyB0cm9uZyBkYW5oIHPDoWNoCiAgICBmb3JjZVNlbGVjdGlvbjogewogICAgICBkZWZhdWx0OiB0cnVlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgLy9Mw6AgY29tYm90cmVlIGhheSBraMO0bmcKICAgIGlzVHJlZTogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIC8vUGFyZW50IEZpZWxkCiAgICBpZFByb3BlcnR5OiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIC8vRmllbGQgY2jhu6lhIHBhcmVudElECiAgICBwYXJlbnRJZFByb3BlcnR5OiB7CiAgICAgIGRlZmF1bHQ6ICJQYXJlbnRJRCIsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIC8vS2jDtG5nIGNobyBwaMOpcCBjaOG7jW4gdHLGsOG7nW5nIGzDoCBjaGEKICAgIG5vdFNlbGVjdGlvblBhcmVudDogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIC8vxJDhu5kgcsO0bmcgY+G7p2EgZHJvcGRvd24gdMOtbmggYuG6sW5nIHB4CiAgICBkcm9wZG93bldpZHRoOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlcl0KICAgIH0sCiAgICAvL01vZGUgcXVlcnkgbOG6pXkgZOG7ryBsaeG7h3UgdOG7qyBzZXJ2ZXIgaGF5IGNsaWVudAogICAgcXVlcnlNb2RlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogImxvY2FsIgogICAgfSwKICAgIHJlbW90ZUZpbHRlcjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIC8vR8OhbiBnacOhIHRy4buLIHRleHQgbMO6YyBiYW4gxJHhuqd1CiAgICBpbml0VGV4dDogewogICAgICBkZWZhdWx0OiBudWxsLAogICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddCiAgICB9LAogICAgLy8gLy9Db21ibyBt4bq3YyDEkeG7i25oIGNo4buNbiBi4bqjbiBnaGkgdGhlbyBpbmRleAogICAgLy8gaW5pdEluZGV4OiB7CiAgICAvLyAgIGRlZmF1bHQ6IDAsCiAgICAvLyAgIHR5cGU6IE51bWJlcgogICAgLy8gfSwKICAgIGRpc2FibGVkOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgcmVhZE9ubHk6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICAvL2No4buJIGNobyBwaMOpcCBjaOG7jW4ga2jDtG5nIGNobyBwaMOpcCBuaOG6rXAgdGV4dAogICAgc2VsZWN0T25seTogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIGF1dG9Mb2FkOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgZGlzcGxheToge30sCiAgICBtYXBwaW5nRmllbGQ6IHsKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKICAgIGZpcnN0RXhwYW5kTG9hZDogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIGtleUZpZWxkOiB7CiAgICAgIC8vIGRlZmF1bHQ6ICdfX3ZLZXlWYWx1ZScsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIG1heExlbmd0aDogewogICAgICBkZWZhdWx0OiBudWxsLAogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICBsZWZ0SWNvbjogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCgogICAgLyoqDQogICAgICogQ8OidSBow6xuaCBxdWlja3NlYXJjaA0KICAgICAqLwogICAgcXVpY2tTZWFyY2g6IHsKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAoKICAgIC8qKg0KICAgICAqIEThu68gbGnhu4d1IHRydXnhu4FuIGvDqG0gcXVpY2tzZWFyY2gNCiAgICAgKi8KICAgIHF1aWNrU2VhcmNoUGFyYW06IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBudWxsCiAgICB9LAoKICAgIC8qKg0KICAgICAqIEPDonUgaMOsbmggYWRkDQogICAgICovCiAgICBxdWlja0FkZDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCiAgICBpc1Nob3dUZXh0OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCgogICAgLyoqDQogICAgICogY2hlY2sgcXV54buBbiB24bubaSBxdWlja2FkZA0KICAgICAqLwogICAgaXNQZXJtaXNzaW9uOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICAvL3B2ZHV5IDE3LzAzLzIwMjE6IHRow6ptIHByb3AgcnVsZSDEkeG7gyBjw7MgdGjhu4MgY3VzdG9tIOG7nyBuZ2/DoGkgZm9ybQogICAgcnVsZXM6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAiIgogICAgfSwKCiAgICAvKg0KICAgICAqIEjDoG0gc2hvdyByYSBjw6J1IHRow7RuZyBiw6FvIHJpw6puZyB0aGVvIHThu6tuZyB0csaw4budbmcgaOG7o3ANCiAgICAgKiB2w60gZOG7pTogY3VzdG9tV2FycmluZyB7cnVsZXM6J3JlcXVpcmVkJywgbWVzOiAnVMOgaSBz4bqjbiBuw6B5IGzDoCBj4bunYSBwdmR1eSd9DQogICAgICovCiAgICBjdXN0b21XYXJyaW5nOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKCiAgICAvKioNCiAgICAgKiBEYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIGThu68gbGnhu4d1IGzhuqV5IHbhu4ENCiAgICAgKi8KICAgIHJlcXVlc3RGaWVsZDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCiAgICBzaG93VGl0bGU6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgLyoqDQogICAgICogRGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyBk4buvIGxp4buHdSBs4bqleSB24buBDQogICAgICovCiAgICB0aXRsZTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogY3VzdG9tIGzhuqFpIHRoYW0gc+G7kSBmaWx0ZXINCiAgICAgKi8KICAgIGJ1aWxkRmlsdGVyOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgICBkZWZhdWx0OiBudWxsCiAgICB9LAogICAgaXNSZWxvYWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgLyoqDQogICAgICogc2l6ZSBwYWdpbmcNCiAgICAgKi8KICAgIHBhZ2VTaXplOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMTAKICAgIH0sCgogICAgLyoqDQogICAgICogR2nDoSB0cuG7iyBi4bqjbiBnaGkgdOG6pXQgY+G6ow0KICAgICAqLwogICAgc2VsZWN0QWxsVmFsdWU6IHsKICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSwKICAgICAgZGVmYXVsdDogLTEKICAgIH0sCgogICAgLyoqDQogICAgICogVGV4dCBoaeG7g24gdGjhu4sgdOG6pXQgY+G6ow0KICAgICAqLwogICAgc2VsZWN0QWxsVGV4dDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogQ8OzIGhp4buDbiB0aOG7iyBi4bqjbiBnaGkgdOG6pXQgY+G6oyBraMO0bmcNCiAgICAgKi8KICAgIHNob3dTZWxlY3RBbGw6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgLyoqDQogICAgICogTuG6v3UgZm9jdXMgdGjDrCBt4bubaSB2YWxpZGF0ZQ0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTguMDguMjAyMQ0KICAgICAqLwogICAgdmFsaWRhdGVPbkZvY3VzOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIFZhbGlkYXRlIGtoaSBibHVyDQogICAgICogQGF1dGhvciBOREhVWSAwNi4wMS4yMDIxDQogICAgICovCiAgICB2YWxpZGF0ZU9uQmx1cjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIEdpw6EgdHLhu4sgdmFsdWUgY2hvIGPhu6dhIGdpw6EgdHLhu4sgIlThuqV0IGPhuqMiDQogICAgICovCiAgICB2YWx1ZUFsbFNlbGVjdGVkOiB7CiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10sCiAgICAgIGRlZmF1bHQ6IC0xCiAgICB9LAoKICAgIC8qKg0KICAgICAqIFTDqm4gZW51bSBj4bunYSBjb21ib2JveA0KICAgICAqLwogICAgbmFtZUVudW06IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiBudWxsCiAgICB9LAoKICAgIC8qKg0KICAgICAqIGPhu50g4bqpbiBoaeG7h24gbsO6dCB0aMOqbSBuaGFuaCBiw6puIG5nb8OgaSBjb21ibw0KICAgICAqIE5NVFVBTjIgMDMuMTEuMjAyMQ0KICAgICAqLwogICAgaXNIYXNDb21ib0FkZDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBj4budIMSR4bq/IG7hur91IGdpw6EgdHLhu4sgbmjhuq1wIHbDoG8gbMOgIHRy4buRbmcgdGjDrCBz4bq9IGLhu48gY2jhu41uDQogICAgICogTk1UVUFOMiAzMC4xMi4yMDIxDQogICAgICovCiAgICBhbGxvd0Rlc2VsZWN0SXRlbTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBj4budIGNobyBwaMOpcCBsdcO0biBnaeG7ryBs4bqhaSBnacOhIHRy4buLIG5o4bqtcA0KICAgICAqIE5NVFVBTjIgMDQuMDEuMjAyMg0KICAgICAqLwogICAgYWxsb3dGcmVlVGV4dDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiB0cnVlOiBi4buPIHF1YSBjaOG7ryBob2EvIHRoxrDhu51uZw0KICAgICAqIE5NVFVBTjIgMDQuMDEuMjAyMg0KICAgICAqLwogICAgaWdub3JlQ2FzZTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBzZXQgdHlwZUFoZWFkUG9pbnRlciB24buBIC0xDQogICAgICogTlRUSEFOSDENCiAgICAgKi8KICAgIHJlc2V0VHlwZUFoZWFkUG9pbnRlcjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBjw7MgbXXhu5FuIHNob3cgY2hlY2sgYm94IGhheSBraMO0bmcNCiAgICAgKi8KICAgIGlzU2hvd0NoZWNrQm94OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCgogICAgLyoqDQogICAgICogY8OzIG114buRbiBkcm9wZG93biBjw7MgxJHhu5kgZMOgaSBmaXQgduG7m2kgY29tYm8gdGjDrCBjaG8gYuG6sW5nIHRydWUNCiAgICAgKiBURE5HSElBIDMvMy8yMDIxDQogICAgICovCiAgICBmb3JjZU1heFdpZHRoOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIENvbWJvIHRyb25nIGLhu5kgbOG7jWMgdGjDrCBwaOG6o2kgY8OzIHRyxrDhu51uZyBuw6B5DQogICAgICogTk1UVUFOMyAxNC80LzIwMjINCiAgICAgKi8KICAgIGZpbHRlck5hbWU6IHsKICAgICAgdHlwZTogU3RyaW5nCiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgdmFyIG1lID0gdGhpczsKICAgIG1lLmluaXRTdGF0aWNEYXRhKCk7CiAgICByZXR1cm4gewogICAgICBpbnRlcm5hbERhdGFTb3VyY2U6IFtdLAogICAgICBpbnRlcm5hbFRleHQ6IG51bGwsCiAgICAgIGV4cGFuZGVkOiBmYWxzZSwKICAgICAgZHJvcGRvd25Ub3B4OiAwLAogICAgICBkcm9wZG93bkxlZnR4OiAwLAogICAgICBpbnRlcm5hbFNlbGVjdGVkSXRlbTogbnVsbCwKICAgICAgdHlwZUFoZWFkUG9pbnRlcjogLTEsCiAgICAgIGZvY3VzZWQ6IGZhbHNlLAogICAgICAvL8SQVlRoaSAgMDMvMDMvMjAyMQogICAgICAvL2vDrWNoIHRoxrDhu5tjIG3hurdjIMSR4buLbmggY+G7p2EgaXRlbVNpemUgY+G7p2EgY29tYm94IGtoaSDEkcaw4bujYyBkw7luZyB0csOqbiBsxrDhu5tpIEVkaXRvcgogICAgICBncmlkSXRlbVNpemU6IDQ4LAogICAgICB0b29sdGlwTGVmdDogMCwKICAgICAgZHJvcGRvd25TY3JvbGxUb3A6IDAsCgogICAgICAvKioNCiAgICAgICAqIMSQYW5nIGxvYWQgZOG7ryBsaeG7h3UNCiAgICAgICAqLwogICAgICBsb2FkaW5nOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogVGhhbSBz4buRIGxvYWQgZOG7ryBsaeG7h3UgbOG6p24gZ+G6p24gbmjhuqV0DQogICAgICAgKi8KICAgICAgbGFzdFJlcXVlc3RQYXJhbTogbnVsbAogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICAvKioNCiAgICAgKiBkYXRhIHNvdXJjZSBjaG8gdG9vbHRpcA0KICAgICAqIGNyZWF0ZWQgYnkgbnRwaG9uZyAyOS81LzIwMjENCiAgICAgKi8KICAgIHRvb2x0aXBEYXRhU291cmNlOiBmdW5jdGlvbiB0b29sdGlwRGF0YVNvdXJjZSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGRhdGFTb3VyY2UgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2U7CgogICAgICBpZiAobWUuX2FsbERhdGEgJiYgbWUuX2FsbERhdGEubGVuZ3RoID4gMCkgewogICAgICAgIGRhdGFTb3VyY2UgPSBtZS5fYWxsRGF0YTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRhdGFTb3VyY2U7CiAgICB9LAogICAgbGlzdGVuZXJzOiBmdW5jdGlvbiBsaXN0ZW5lcnMoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgaW5wdXQ6IGZ1bmN0aW9uIGlucHV0KGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gbWUub25JbnB1dChldmVudCk7CiAgICAgICAgfSwKICAgICAgICBmb2N1czogZnVuY3Rpb24gZm9jdXMoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBtZS5vbkZvY3VzKGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIGNoYW5nZTogZnVuY3Rpb24gY2hhbmdlKGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gbWUub25DaGFuZ2UoZXZlbnQpOwogICAgICAgIH0sCiAgICAgICAgYmx1cjogZnVuY3Rpb24gYmx1cihldmVudCkgewogICAgICAgICAgcmV0dXJuIG1lLm9uQmx1cihldmVudCk7CiAgICAgICAgfSwKICAgICAgICBrZXlkb3duOiBmdW5jdGlvbiBrZXlkb3duKGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gbWUub25LZXlkb3duKGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIGNsaWNrOiBmdW5jdGlvbiBjbGljayhldmVudCkgewogICAgICAgICAgcmV0dXJuIG1lLm9uQ2xpY2soZXZlbnQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICAvL1TDrW5oIMSR4buZIHLhu5luZyBj4bunYSBkcm9wZG93biBjb21ib2JveCDEkeG7gyBzY3JvbGwKICAgIHN0eWxlU2Nyb2xsZXI6IGZ1bmN0aW9uIHN0eWxlU2Nyb2xsZXIoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgIm1heC1oZWlnaHQiOiBtZS5tYXhJdGVtc0Rpc3BsYXkgKiBtZS5pdGVtU2l6ZSArICJweCIKICAgICAgfTsKICAgIH0sCgogICAgLyoqDQogICAgICogxJBWVGhpIDAzLzAzLzIwMjEgdMO5eSBiaeG6v24gbOG6oWkgxJHhu5kgcuG7mW5nIGPhu6dhIGl0ZW0gU2l6ZSBraGkgZMO5bmcgY29tYm94IHRyw6puIGzGsOG7m2kgRWRpdG9yID00OHB4DQogICAgICovCiAgICBpdGVtU2l6ZUNvbXB1dGU6IGZ1bmN0aW9uIGl0ZW1TaXplQ29tcHV0ZSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS4kZWRpdG9yQ2xhc3MpIHsKICAgICAgICByZXR1cm4gbWUuZ3JpZEl0ZW1TaXplOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBtZS5pdGVtU2l6ZTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiDEkFZUaGkgMDMvMDMvMjAyMSBu4bq/dSBjb21ib3ggbcOgIMSRxrDhu6NjIGTDuW5nIHRyw6puIGzGsOG7m2kgRWRpdG9yIHRow6wgYXBwbHkgdGjDqm0gY2xhc3MgxJHhu4MgdMO5eSBiaeG6v24gxJHhu5kgcuG7mW5nDQogICAgICovCiAgICBkcm9wZG93bkNsYXNzOiBmdW5jdGlvbiBkcm9wZG93bkNsYXNzKCkgewogICAgICBpZiAodGhpcy4kZWRpdG9yQ2xhc3MpIHsKICAgICAgICByZXR1cm4gdGhpcy4kZWRpdG9yQ2xhc3M7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDw7MgaGnhu4NuIHRo4buLIHF1aWNrYWRkIGtow7RuZw0KICAgICAqLwogICAgaGFzU2hvd1F1aWNrQWRkOiBmdW5jdGlvbiBoYXNTaG93UXVpY2tBZGQoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciByZXMgPSBmYWxzZTsKCiAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAwICYmIG1lLnF1aWNrQWRkKSB7CiAgICAgICAgaWYgKG1lLl9hbGxEYXRhKSB7CiAgICAgICAgICByZXMgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAobWUubGFzdFJlcXVlc3RQYXJhbSkgewogICAgICAgICAgcmVzID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgcnVsZXM6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgbWUudmFsaWRhdGUobWUpOwogICAgICB9CiAgICB9LAogICAgZGF0YTogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgICBpZiAobWUubG9hZGluZykgewogICAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbWUuZG9IaWdodGxpZ2h0SXRlbSgpOwogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobmV3VmFsID09IG51bGwpIHsKICAgICAgICAgIC8vdMOsbmggaHXhu5FuZyBjw7MgdGjDqm0vc+G7rWEveMOzYSBk4buvIGxp4buHdSBn4buRYyAtPiByZXNldCDEkeG7gyBraGkgZXhwYW5kIHPhur0gbG9hZCBs4bqhaSBk4buvIGxp4buHdQogICAgICAgICAgbWUubGFzdFF1ZXJ5U3RyaW5nID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgICAgICBtZS5fYWxsRGF0YSA9IG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChtZS5xdWVyeU1vZGUgIT09ICJyZW1vdGUiKSB7CiAgICAgICAgICAgIG1lLl9hbGxEYXRhID0gbmV3VmFsOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UgIT0gbmV3VmFsICYmICEobWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCA9PT0gMCAmJiBuZXdWYWwubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICBtZS5pbml0RGF0YSgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBTZXQgbOG6oWkgZ2nDoSB0cuG7iyBoaeG7g24gdGjhu4sga2hpIGdpw6EgdHLhu4sgY+G7p2EgYmnhur9uIGluaXRUZXh0IHRoYXkgxJHhu5VpDQogICAgICovCiAgICBpbml0VGV4dDogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgICBpZiAobmV3VmFsIHx8IG9sZFZhbCkgewogICAgICAgICAgdmFyIHZhbCA9IG5ld1ZhbCA/IG5ld1ZhbCA6IG9sZFZhbDsgLy8gTk1UVUFOMiAwNC4wMS4yMDIxOiBjaG8gcGjDqXAgbOG6pXkgZ2nDoSB0cuG7iyBt4bubaSBuaOG6pXQKCiAgICAgICAgICBpZiAobWUuYWxsb3dGcmVlVGV4dCkgewogICAgICAgICAgICB2YWwgPSBuZXdWYWwgPyBuZXdWYWwgOiAiIjsKICAgICAgICAgIH0KCiAgICAgICAgICBtZS5zZXRJbml0VGV4dCh2YWwpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIG7hur91IHRleHQgaGnhu4duIHRo4buLIHRoYXkgxJHhu5VpIHRoaSB2YWxpZGF0ZQ0KICAgICAqIE1vZGlmeSBieSDEkFZUaGkgMDUvMDIvMjAyMCB0cnV54buBbiB0aMOqbSBtZSB2w6BvIHZhbGlkYXRlIChtZSkgxJHhu4Mga2hpIG5nxrDhu51pIGTDuW5nIGNo4buNbiBnacOhIHRy4buLIGNoxrBhIGPDsyB0cm9uZyBkYW5oIG3hu6VjDQogICAgICAgIHRoaSBiw6FvIGzhu5dpDQogICAgICovCiAgICBpbnRlcm5hbFRleHQ6IHsKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgICAgbmV3VmFsID0gbmV3VmFsID8gbmV3VmFsIDogIiI7CiAgICAgICAgb2xkVmFsID0gb2xkVmFsID8gb2xkVmFsIDogIiI7IC8vIHZ2a2lldCAtIDE4LjA4LjIwMjE6IFRow6ptIMSRaeG7gXUga2nhu4duIHBo4bulYyB24bulIGNobyBUSCBu4bq/dSBmb2N1cyB2w6BvIGNvbnRyb2wgdGjDrCBt4bubaSB2YWxpZGF0ZQogICAgICAgIC8vIFbDrSBk4bulOiBUSCBMxrB1IHbDoCBUaMOqbSBt4bubaSwgc2F1IGtoaSBsxrB1IHhvbmcgdGjDrCB04buxIMSR4buZbmcgYsOhbyBs4buXaSBjb250cm9sIGtow7RuZyDEkcaw4bujYyDEkeG7gyB0cuG7kW5nCgogICAgICAgIGlmIChuZXdWYWwgIT0gb2xkVmFsICYmICghbWUudmFsaWRhdGVPbkZvY3VzIHx8IG1lLmZvY3VzZWQpKSB7CiAgICAgICAgICAvL0FkZCBtZSBieSDEkFZUaGkgMDUvMDIvMjAyMSBwaOG7pWMgduG7pSB2YWxpZGF0ZSBnacOhIHRy4buLIG5nxrDhu51pIGTDuW5nIG5o4bqtcCBzYWkgZm9yY2VTZWxlY3Rpb24KICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBtZS52YWxpZGF0ZShtZSk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0gLy8gbWUuJGVtaXQoJ2lucHV0JyxuZXdWYWwpOwoKICAgICAgfQogICAgfSwKICAgIC8vS2hpIHRoYXkgxJHhu5VpIHPhu5EgcGjhuqduIHThu60gY+G7p2EgY29tYm94IHRow6wgdGhp4bq/dCBs4bqtcCBs4bqhaSB24buLIHRyw60gY+G7p2EgZHJvcGRvdwogICAgaW50ZXJuYWxEYXRhU291cmNlOiB7CiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7IC8vxJBWVGhpIHPhu61hIGzhu5dpIDkwNDkxIGtow7RuZyB0aGF5IMSR4buVaSB24buLIHRyw60ga2hpIGfDtSB0ZXh0IMSR4buDIHNlYXJjaCB0csOqbiBjb21ib3gKCiAgICAgICAgbWUuY2hhbmdlRHJvcGRvd25Qb3NpdGlvbigpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIE7hur91IGdpw6EgdHLhu4sgVk1vZGVsIGPhu6dhIGNvbWJvIHRoYXkgxJHhu5VpIHRow6wgZ8OhbiBs4bqhaSBnacOhIHRy4buLIG3hu5tpIHbDoCBzZWxlY3QgdsOgbyBpdGVtIHTGsMahbmcg4bupbmcgY8OzIHRyb25nIGRhdGENCiAgICAgKi8KICAgIHZhbHVlOiB7CiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICAgIGlmIChuZXdWYWwgIT0gb2xkVmFsKSB7CiAgICAgICAgICBpZiAobmV3VmFsICE9IG51bGwgJiYgbmV3VmFsICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbmV3VmFsOyAvL3jhu60gbMO9IGdpw6EgdHLhu4sgdOG6pXQgY+G6owoKICAgICAgICAgICAgaWYgKG5ld1ZhbCA9PT0gbWUuc2VsZWN0QWxsVmFsdWUgJiYgIW1lLmluaXRUZXh0KSB7CiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxUZXh0ID0gbWUuX3NlbGVjdEFsbFRleHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0gfHwgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW1bbWUudmFsdWVGaWVsZF0gIT09IG5ld1ZhbCkgewogICAgICAgICAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UgIT0gbWUuZGF0YSkgewogICAgICAgICAgICAgICAgbWUuaW5pdERhdGEoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG1lLmRvSGlnaHRsaWdodEl0ZW0oKTsKCiAgICAgICAgICAgICAgaWYgKG1lLnJlc2V0VHlwZUFoZWFkUG9pbnRlcikgewogICAgICAgICAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IC0xOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPj0gMCkgewogICAgICAgICAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSwgZmFsc2UpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIW1lLmZvcmNlU2VsZWN0aW9uICYmIG1lLnZhbHVlRmllbGQgPT0gbWUuZGlzcGxheUZpZWxkKSB7CiAgICAgICAgICAgICAgICAgIG1lLnNldEludGVybmFsVGV4dChtZS5pbnRlcm5hbFZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIG7hur91IGLhuq90IGJ14buZYyBwaOG6o2kgY2jhu41uIGdpw6EgdHLhu4sgdGjDrCBt4bubaSByZXNldAogICAgICAgICAgICBpZiAobWUuZm9yY2VTZWxlY3Rpb24pIHsKICAgICAgICAgICAgICBtZS5yZXNldCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICAvL0jDoG0ga2jhu59pIHThuqFvIGThu68gbGnhu4d1IGhvb2sgZnVuYwogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgbWUgPSB0aGlzOyAvLyBtZS5pbml0SW5kZXggPSAwOwoKICAgIG1lLmluaXRDb21ibygpOyAvLyBtZS5zZXRJbml0SW5kZXgoKTsKCiAgICBtZS5pbml0RGF0YSgpOwoKICAgIGlmIChtZS5hdXRvTG9hZCkgewogICAgICBtZS5kb1F1ZXJ5SW50ZXJuYWwobnVsbCwgZmFsc2UpOwogICAgfQoKICAgIEV2ZW50QnVzR2xvYmFsLiRvbihHbG9iYWxFdmVudE5hbWUuc2Nyb2xsRXZlbnQsIG1lLnNjcm9sbEV2ZW50KTsKCiAgICBpZiAobWUubWFwcGluZ0ZpZWxkKSB7CiAgICAgIGZvciAodmFyIGtleSBpbiBtZS5tYXBwaW5nRmllbGQpIHsKICAgICAgICBtZS4kb3B0aW9ucy5wcm9wc0RhdGFba2V5XSA9IG51bGw7CiAgICAgIH0KICAgIH0gLy8gbWUuaW5pdERhdGEoKTsKICAgIC8vIG1lLnNldEluaXRUZXh0KCk7CgogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7IC8vRGVib3VuY2UgcXVlcnkgxJHhu4MgZGVsYXkgbG9hZAoKICAgIGlmIChtZS5xdWVyeU1vZGUgIT0gInJlbW90ZSIpIHsKICAgICAgbWUuaW50ZXJuYWxRdWVyeURlbGF5ID0gMjA7CiAgICB9CgogICAgbWUuZG9RdWVyeSA9IF8uZGVib3VuY2UobWUuZG9RdWVyeUludGVybmFsLCBtZS5pbnRlcm5hbFF1ZXJ5RGVsYXkpOwogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBtZS5jbGlja19vdXQpOyAvL2luaXQgYWxsdGV4dAoKICAgIG1lLl9zZWxlY3RBbGxUZXh0ID0gbWUuc2VsZWN0QWxsVGV4dCB8fCBpMThuLnQoImkxOG5Db21wb25lbnQuQ29tYm9ib3guU2VsZWN0QWxsSXRlbVRleHQiKTsKICB9LAogIGJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uIGJlZm9yZURlc3Ryb3koKSB7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgbWUuY29sbGFwc2UoKTsKCiAgICBpZiAobWUuJHJlZnMuZHJvcGRvd25QYW5lbCkgewogICAgICBtZS4kcmVmcy5kcm9wZG93blBhbmVsLiRlbC5yZW1vdmUoKTsKICAgIH0KCiAgICBFdmVudEJ1c0dsb2JhbC4kb2ZmKEdsb2JhbEV2ZW50TmFtZS5zY3JvbGxFdmVudCwgbWUuc2Nyb2xsRXZlbnQpOwogICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBtZS5jbGlja19vdXQpOwogIH0sCiAgbWV0aG9kczogewogICAgZ2V0VG9vbHRpcENsYXNzOiBmdW5jdGlvbiBnZXRUb29sdGlwQ2xhc3MoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuJGVsKSB7CiAgICAgICAgbWUudG9vbHRpcExlZnQgPSAtbWUuJGVsLm9mZnNldFdpZHRoIC8gMjsKICAgICAgfQoKICAgICAgaWYgKG1lLmN1c3RvbVRvb2x0aXApIHsKICAgICAgICByZXR1cm4gInRvb2x0aXAtIiArIG1lLmN1c3RvbVRvb2x0aXAudHlwZS50b0xvd2VyQ2FzZSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAiIjsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBraeG7g20gdHJhIHhlbSBk4buvIGxp4buHdSB0csOqbiBjb21ib2JveCBjw7MgdHLhu5FuZyBoYXkga2jDtG5nDQogICAgICogQGF1dGhvciB0bWNoaSAxNi4wNC4yMDIxDQogICAgICovCiAgICBpc051bGxPckVtcHR5dmFsdWU6IGZ1bmN0aW9uIGlzTnVsbE9yRW1wdHl2YWx1ZSgpIHsKICAgICAgaWYgKHRoaXMudmFsdWUgPT0gbnVsbCB8fCB0aGlzLnZhbHVlID09IHt9KSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIELhuq90IHPhu7Ega2nhu4duIGtoaSBzY3JvbGwgdHLDqm4gY2jGsMahbmcgdHLDrG5oIHRow6wgxJHDs25nIGNvbWJvYm94IGzhuqFpDQogICAgICogQ3JlYXRlZCBieSBMVERBVA0KICAgICAqLwogICAgc2Nyb2xsRXZlbnQ6IGZ1bmN0aW9uIHNjcm9sbEV2ZW50KGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5leHBhbmRlZCkgewogICAgICAgIG1lLmNvbGxhcHNlKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogTeG6t2MgxJHhu4tuaCBjaOG7jW4gZ2nDoSB0cuG7iyB0aGVvIGluZGV4IGJhbiDEkeG6p3UNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUDQogICAgICovCiAgICBzZXRJbml0SW5kZXg6IGZ1bmN0aW9uIHNldEluaXRJbmRleCgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5pbml0SW5kZXggPj0gMCAmJiBtZS5pbnRlcm5hbERhdGFTb3VyY2UgJiYgbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCA+IDAgJiYgbWUudHlwZUFoZWFkUG9pbnRlciA8IDApIHsKICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gbWUuaW5pdEluZGV4OwogICAgICAgIG1lLnNldEludGVybmFsSXRlbShtZS5pbnRlcm5hbERhdGFTb3VyY2VbbWUudHlwZUFoZWFkUG9pbnRlcl0sIGZhbHNlKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBTZXQgZ2nDoSB0cuG7iyBoaeG7h24gdGjhu4sgYmFuIMSR4bqndSBjaG8gY29tYm9ib3gga2hpIGNvbWJvIGNoxrBhIGPDsyBk4buvIGxp4buHdQ0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQoMjUuMDYuMjAyMCkNCiAgICAgKi8KICAgIHNldEluaXRUZXh0OiBmdW5jdGlvbiBzZXRJbml0VGV4dCh2YWwpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuaW50ZXJuYWxUZXh0ID0gKHR5cGVvZiB2YWwgPT0gInN0cmluZyIgPyB2YWwgOiBtZS5pbml0VGV4dCkgfHwgIiI7IC8vVEROR0hJQSB04bqhbyB0aMOqbSBow6BtIGtp4buDbSB0cmEgbuG6v3UgdGV4dCBraOG7m3AgduG7m2kgZGF0YSBzb3VyY2UgdGjDrCBnw6FuIGdpw6EgdHLhu4sgY29tYm8gYuG6sW5nIGx1w7RuCgogICAgICBpZiAobWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgc2VsZWN0ZWQgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgaWYgKG1lLmlnbm9yZUNhc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGl0ZW1bbWUuZGlzcGxheUZpZWxkXS50b0xvd2VyQ2FzZSgpLnRyaW0oKSA9PSBtZS5pbnRlcm5hbFRleHQudG9Mb3dlckNhc2UoKS50cmltKCk7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIGl0ZW1bbWUuZGlzcGxheUZpZWxkXSA9PSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChtZS5hbGxvd0ZyZWVUZXh0KSB7CiAgICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSA9IG51bGw7CiAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsKICAgICAgICB9CgogICAgICAgIGlmIChzZWxlY3RlZCAhPSBudWxsKSB7CiAgICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSA9IHNlbGVjdGVkOwogICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IHNlbGVjdGVkW21lLnZhbHVlRmllbGRdOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaOG7sWMgaGnhu4duIHF1ZXJ5IGThu68gbGnhu4d1LCBjw7MgdGjhu4MgdOG7qyBsb2NhbCBob+G6t2MgcmVtb3RlIHTDuXkgdGhlbyBj4bqldSBow6xuaA0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAxMS8xMi8yMDE5DQogICAgICovCiAgICBkb1F1ZXJ5SW50ZXJuYWw6IGZ1bmN0aW9uIGRvUXVlcnlJbnRlcm5hbChzZWFyY2hTdHJpbmcsIGV4cGFuZCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgZXZlbnQgPSB7CiAgICAgICAgcHJldmVudERlZmF1bHQ6IGZhbHNlLAogICAgICAgIHNlbmRlcjogbWUKICAgICAgfSwKICAgICAgICAgIHF1ZXJ5U3RyaW5nID0gc2VhcmNoU3RyaW5nOwogICAgICBtZS4kZW1pdCgiYmVmb3JlUXVlcnkiLCBldmVudCk7CgogICAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGlmIChtZS5sYXN0UXVlcnlTdHJpbmcgPT09IHF1ZXJ5U3RyaW5nICYmICFtZS5pc1JlbG9hZCkgewogICAgICAgIGlmIChleHBhbmQpIHsKICAgICAgICAgIG1lLmV4cGFuZCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5kcm9wZG93blNjcm9sbFRvcCA9IDA7CiAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlID0gW107CiAgICAgICAgbWUubGFzdFF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmc7CiAgICAgICAgbWUucXVlcnlpbmcgPSB0cnVlOyAvLyBtZS50eXBlQWhlYWRQb2ludGVyID0gLTE7CgogICAgICAgIGlmIChtZS5xdWVyeU1vZGUgPT09ICJyZW1vdGUiICYmICFtZS5fYWxsRGF0YSkgewogICAgICAgICAgaWYgKG1lLmlzVHJlZSkgewogICAgICAgICAgICBxdWVyeVN0cmluZyA9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgbWUuZG9SZW1vdGVRdWVyeShxdWVyeVN0cmluZyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG1lLmRvTG9jYWxRdWVyeShxdWVyeVN0cmluZyk7CgogICAgICAgICAgICBpZiAoZXhwYW5kICYmICFtZS5leHBhbmRlZCkgewogICAgICAgICAgICAgIG1lLmV4cGFuZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1lLmRvSGlnaHRsaWdodEl0ZW0odHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0gLy8gbWUuJHByb3BzLmlzUmVsb2FkID0gZmFsc2U7CgogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHNhdSBraGkgcXVlcnkgeG9uZyBk4buvIGxp4buHdQ0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAyNC4wNi4yMDIwDQogICAgICovCiAgICBhZnRlclF1ZXJ5OiBmdW5jdGlvbiBhZnRlclF1ZXJ5KGV4cGFuZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKGV4cGFuZCkgewogICAgICAgIG1lLmV4cGFuZCgpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFF1ZXJ5IGThu68gbGnhu4d1IGFwaQ0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAyNC4wNi4yMDIwDQogICAgICovCiAgICBkb1JlbW90ZVF1ZXJ5OiBmdW5jdGlvbiBkb1JlbW90ZVF1ZXJ5KHF1ZXJ5U3RyaW5nLCBleHBhbmQpIHsKICAgICAgLy9CdWlsZCBmaWx0ZXIsCiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBmaWx0ZXJzID0gW10sCiAgICAgICAgICBmaWx0ZXJGaWVsZHMgPSBtZS5maWx0ZXJGaWVsZHM7CiAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgaWYgKHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICB2YXIgX2ZpbHRlciA9IG51bGw7CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIGZpbHRlckZpZWxkcykgewogICAgICAgICAgICBpZiAoZmlsdGVyRmllbGRzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICB2YXIgZiA9IGZpbHRlckZpZWxkc1trZXldOwoKICAgICAgICAgICAgICBpZiAoX2ZpbHRlcikgewogICAgICAgICAgICAgICAgX2ZpbHRlci5jaGlsZHJlbnMucHVzaCh7CiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBrZXksCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBxdWVyeVN0cmluZywKICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IGYsCiAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJvciIKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBfZmlsdGVyID0gewogICAgICAgICAgICAgICAgICBwcm9wZXJ0eToga2V5LAogICAgICAgICAgICAgICAgICB2YWx1ZTogcXVlcnlTdHJpbmcsCiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBmLAogICAgICAgICAgICAgICAgICBvcGVyYW5kOiAiYW5kIiwKICAgICAgICAgICAgICAgICAgY2hpbGRyZW5zOiBbXQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoX2ZpbHRlcikgewogICAgICAgICAgICBmaWx0ZXJzLnB1c2goX2ZpbHRlcik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB2YXIgcGF5bG9hZCA9IHt9OwogICAgICAgIHBheWxvYWQuc2tpcCA9IDA7CiAgICAgICAgcGF5bG9hZC50YWtlID0gbWUucGFnZVNpemU7CiAgICAgICAgcGF5bG9hZC5wYWdlQXBwZW5kID0gZmFsc2U7CgogICAgICAgIGlmIChmaWx0ZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHBheWxvYWQuZmlsdGVyID0gZmlsdGVyczsKICAgICAgICB9CgogICAgICAgIHZhciBjb2x1bW5zID0gW21lLmRpc3BsYXlGaWVsZCwgbWUudmFsdWVGaWVsZF07CgogICAgICAgIGlmIChtZS5jb2x1bW5zICYmIG1lLmNvbHVtbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgbWUuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtLmRhdGFGaWVsZCAmJiBjb2x1bW5zLmluZGV4T2YoaXRlbS5kYXRhRmllbGQpKSB7CiAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKGl0ZW0uZGF0YUZpZWxkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobWUucmVxdWVzdEZpZWxkKSB7CiAgICAgICAgICBtZS5yZXF1ZXN0RmllbGQuc3BsaXQoIiwiKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgIGlmIChpdGVtICYmIGNvbHVtbnMuaW5kZXhPZihpdGVtKSkgewogICAgICAgICAgICAgIGNvbHVtbnMucHVzaChpdGVtKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBwYXlsb2FkLmNvbHVtbnMgPSBjb2x1bW5zLmpvaW4oIiwiKTsKICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtID0gcGF5bG9hZDsKCiAgICAgICAgaWYgKHR5cGVvZiBtZS5idWlsZEZpbHRlciA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICBtZS5idWlsZEZpbHRlcihwYXlsb2FkKTsKICAgICAgICB9CgogICAgICAgIG1lLmxvYWRpbmcgPSB0cnVlOwogICAgICAgIG1lLiRlbWl0KCJsb2FkRGF0YSIsIHBheWxvYWQpOyAvL1RWTG9pIDI4LjA4LjIwMjEgQ2hvIHThuq90IGx1w7RuIGPhu50g4bufIMSRw6J5IG7hu69hLCBQaMOybmcgdHLGsOG7nW5nIGjhu6NwIHjhu5UgY29tYm8gbmjGsG5nIGtvIGfhu41pIEFQSSB0aMOsIGtvIHThuq90IMSRxrDhu6NjIGPhu50gbG9hZGluZy4KCiAgICAgICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogUXVlcnkgZOG7ryBsaeG7h3UgbG9jYWwNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMjQuMDYuMjAyMA0KICAgICAqLwogICAgZG9Mb2NhbFF1ZXJ5OiBmdW5jdGlvbiBkb0xvY2FsUXVlcnkocXVlcnlTdHJpbmcpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGZpbHRlckRhdGEgPSBtZS5maWx0ZXJEYXRhKHF1ZXJ5U3RyaW5nKTsKCiAgICAgIGlmIChxdWVyeVN0cmluZyAmJiBtZS5jb21ib1R5cGUgPT09IDMpIHsKICAgICAgICB2YXIgZmlyc3RJdGVtID0gZmlsdGVyRGF0YVswXTsgLy90aMOqbSBjaGEgdsOgbyDEkeG7gyBidWlsZCBjw6J5CgogICAgICAgIHZhciByb290cyA9IFtdOwogICAgICAgIHZhciBpID0gMDsKCiAgICAgICAgd2hpbGUgKGkgPCBmaWx0ZXJEYXRhLmxlbmd0aCkgewogICAgICAgICAgdmFyIGl0ZW0gPSBmaWx0ZXJEYXRhW2ldLAogICAgICAgICAgICAgIHBhcmVudCA9IGl0ZW0ucGFyZW50Tm9kZTsKCiAgICAgICAgICBpZiAoIXBhcmVudCB8fCBBcnJheS5pc0FycmF5KHBhcmVudCkpIHsKICAgICAgICAgICAgcm9vdHMucHVzaChpdGVtKTsKICAgICAgICAgIH0gZWxzZSBpZiAoZmlsdGVyRGF0YS5pbmRleE9mKHBhcmVudCkgPT09IC0xKSB7CiAgICAgICAgICAgIGZpbHRlckRhdGEucHVzaChwYXJlbnQpOwogICAgICAgICAgfQoKICAgICAgICAgIGkrKzsKICAgICAgICB9IC8vc+G6r3AgeOG6v3Agcm9vdCB0aGVvIMSRw7puZyB0aOG7qSB04buxCgoKICAgICAgICBpZiAocm9vdHMubGVuZ3RoID4gMSkgewogICAgICAgICAgdmFyIF9ycyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBtZS5fYWxsRGF0YS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIF9pdGVtMiA9IG1lLl9hbGxEYXRhW19pXTsKCiAgICAgICAgICAgIGlmIChyb290cy5pbmRleE9mKF9pdGVtMikgPiAtMSkgewogICAgICAgICAgICAgIF9ycy5wdXNoKF9pdGVtMik7CgogICAgICAgICAgICAgIGlmIChfcnMubGVuZ3RoID09PSByb290cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJvb3RzID0gX3JzOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSAvL2J1aWxkIGPDonkKCgogICAgICAgIHZhciBycyA9IFtdOwoKICAgICAgICB2YXIgZm5QdXNoID0gZnVuY3Rpb24gZm5QdXNoKGl0ZW0pIHsKICAgICAgICAgIHJzLnB1c2goaXRlbSk7CgogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbS5jaGlsZE5vZGVzKSkgewogICAgICAgICAgICBpdGVtLmNoaWxkTm9kZXMuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICBpZiAoZmlsdGVyRGF0YS5pbmRleE9mKGNoaWxkKSA+IC0xKSB7CiAgICAgICAgICAgICAgICBmblB1c2goY2hpbGQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgcm9vdHMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgZm5QdXNoKGl0ZW0pOwogICAgICAgIH0pOyAvL3Phuq9wIHjhur9wIHRoZW8gbWlzYUNvZGUKCiAgICAgICAgZmlsdGVyRGF0YSA9IHJzOwogICAgICB9CgogICAgICBtZS5fZmlsdGVyRGF0YSA9IGZpbHRlckRhdGE7CiAgICAgIHZhciBjb3VudCA9IE1hdGgubWluKG1lLl9maWx0ZXJEYXRhLmxlbmd0aCwgbWUucGFnZVNpemUpOwogICAgICB2YXIgZHMgPSBbXTsKCiAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IGNvdW50OyBfaTIrKykgewogICAgICAgIGRzLnB1c2gobWUuX2ZpbHRlckRhdGFbX2kyXSk7CiAgICAgIH0KCiAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZSA9IGRzOwogICAgfSwKICAgIGZpbHRlckRhdGE6IGZ1bmN0aW9uIGZpbHRlckRhdGEocXVlcnlTdHJpbmcpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG1hdGNoSXRlbSA9IFtdOwoKICAgICAgaWYgKHF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgbWUuX2FsbERhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIHZhbGlkID0gZmFsc2U7CgogICAgICAgICAgZm9yICh2YXIgZiBpbiBtZS5maWx0ZXJGaWVsZHMpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gaXRlbVtmXTsKICAgICAgICAgICAgdmFyIHRlc3QgPSBtZS50ZXN0RmlsdGVyKG1lLmZpbHRlckZpZWxkc1tmXSwgdmFsdWUsIHF1ZXJ5U3RyaW5nKTsKCiAgICAgICAgICAgIGlmICh0ZXN0KSB7CiAgICAgICAgICAgICAgdmFsaWQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHZhbGlkKSB7CiAgICAgICAgICAgIG1hdGNoSXRlbS5wdXNoKGl0ZW0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIG1hdGNoSXRlbSA9IG1lLl9hbGxEYXRhOwogICAgICB9CgogICAgICByZXR1cm4gbWF0Y2hJdGVtOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBjaHXhu5dpIGPhuqduIHF1ZXJ5LCB0csaw4budbmcgaOG7o3AgbnVtYmVyIHRow6wgbOG6pXkgdmFsdWUgYuG7jyBxdWEga8O9IHThu7EgcGjDom4gY8OhY2gNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTEvMTIvMjAxOQ0KICAgICAqLwogICAgZ2V0UXVlcnlTdHJpbmc6IGZ1bmN0aW9uIGdldFF1ZXJ5U3RyaW5nKCkgewogICAgICByZXR1cm4gKHRoaXMuaW50ZXJuYWxUZXh0IHx8ICIiKS50cmltKCk7CiAgICB9LAogICAgLy9DbGljayByYSBuZ2/DoGkgY29tYm8gxJHDs25nIGNvbWJvIGzhuqFpCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgMTguMDYuMjAyMAogICAgY2xpY2tfb3V0OiBmdW5jdGlvbiBjbGlja19vdXQoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFjb21tb25Gbi5oYXNQYXJlbnQoZS50YXJnZXQsIG1lLiRlbCkgJiYgbWUuJHJlZnMuZHJvcGRvd25QYW5lbCAmJiBtZS4kcmVmcy5kcm9wZG93blBhbmVsLiRlbCAmJiAhY29tbW9uRm4uaGFzUGFyZW50KGUudGFyZ2V0LCBtZS4kcmVmcy5kcm9wZG93blBhbmVsLiRlbCkpIHsKICAgICAgICBtZS5jb2xsYXBzZSgpOwogICAgICB9CiAgICB9LAogICAgLy9SZXNldCBs4bqhaSBjw6FjIGdpw6EgdHLhu4sgdHJvbmcgY29tYm9ib3gKICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuaW50ZXJuYWxUZXh0ID0gIiI7CiAgICAgIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtID0gbnVsbDsKICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IC0xOwogICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsKICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNldCBnacOhIHRy4buLIGhp4buDbiB0aOG7iw0KICAgICAqIEBwcmFtIHZhbHVlIGdpw6EgdHLhu4sgaGnhu4NuIHRo4buLDQogICAgICovCiAgICBzZXRJbnRlcm5hbFRleHQ6IGZ1bmN0aW9uIHNldEludGVybmFsVGV4dCh2YWx1ZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5pbnRlcm5hbFRleHQgPSB2YWx1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogU2V0IHZhbHVlIGNobyBjb21ibw0KICAgICAqLwogICAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHZhbHVlKSB7CiAgICAgIHZhciB1c2VyQWN0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiBmYWxzZTsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IHZhbHVlOwogICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsKICAgICAgbWUuZG9IaWdodGxpZ2h0SXRlbSgpOwoKICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPj0gMCkgewogICAgICAgIG1lLnNldEludGVybmFsSXRlbShtZS5pbnRlcm5hbERhdGFTb3VyY2VbbWUudHlwZUFoZWFkUG9pbnRlcl0sIHVzZXJBY3Rpb24pOwogICAgICB9CiAgICB9LAogICAgLy9T4buxIGtp4buHbiBuaOG6rXAgbGnhu4d1IHRyw6puIGlucHV0CiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApCiAgICBvbklucHV0OiBmdW5jdGlvbiBvbklucHV0KGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuX3R5cGluZyA9IHRydWU7CgogICAgICBpZiAoIW1lLmV4cGFuZGVkKSB7CiAgICAgICAgbWUuZXhwYW5kKCk7IC8vIG1lLmRvUXVlcnlJbnRlcm5hbChtZS5nZXRRdWVyeVN0cmluZygpLCB0cnVlKTsKICAgICAgfQoKICAgICAgaWYgKCFtZS5pbnRlcm5hbFRleHQpIHsKICAgICAgICAvLyBpZiAobWUuaW50ZXJuYWxWYWx1ZSkgewogICAgICAgIC8vICAgbGV0IG1ldGFEYXRhID0gewogICAgICAgIC8vICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAvLyAgICAgbmV3RGF0YTogbnVsbCwKICAgICAgICAvLyAgIH07CiAgICAgICAgLy8gICBtZS4kZW1pdCgic2VsZWN0ZWQiLCBtZXRhRGF0YSk7CiAgICAgICAgLy8gfQoKICAgICAgICAvKioNCiAgICAgICAgICogcmVzZXQgbOG6oWkgY29tYm8ga2hpIGludGVybmFsVGV4dCBy4buXbmcNCiAgICAgICAgICogTk1UVUFOMyAxNi8xMS8yMDIxDQogICAgICAgICAqLwogICAgICAgIG1lLnJlc2V0KCk7CgogICAgICAgIGlmICghbWUuZm9yY2VTZWxlY3Rpb24pIHsKICAgICAgICAgIG1lLnJlc2V0KCk7CiAgICAgICAgfQogICAgICB9CgogICAgICBtZS5kb1F1ZXJ5KG1lLmludGVybmFsVGV4dCwgdHJ1ZSk7CiAgICAgIG1lLl90eXBpbmcgPSBmYWxzZTsKCiAgICAgIGlmICghbWUuZm9yY2VTZWxlY3Rpb24gJiYgbWUudmFsdWVGaWVsZCA9PSBtZS5kaXNwbGF5RmllbGQpIHsKICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbWUuaW50ZXJuYWxUZXh0OwogICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICB9IGVsc2UgaWYgKG1lLmZvcmNlU2VsZWN0aW9uICYmIG1lLmFsbG93RGVzZWxlY3RJdGVtICYmIG1lLmludGVybmFsVGV4dCA9PSAiIikgewogICAgICAgIG1lLmludGVybmFsVmFsdWUgPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgdmFyIGRhdGFFbXB0eSA9IHt9OwogICAgICAgIGRhdGFFbXB0eVttZS52YWx1ZUZpZWxkXSA9IG51bGw7CiAgICAgICAgZGF0YUVtcHR5W21lLmRpc3BsYXlGaWVsZF0gPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgdmFyIG1ldGFEYXRhID0gewogICAgICAgICAgb2xkRGF0YTogbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0sCiAgICAgICAgICBuZXdEYXRhOiBkYXRhRW1wdHkKICAgICAgICB9OwogICAgICAgIG1lLiRlbWl0KCJzZWxlY3RlZCIsIG1ldGFEYXRhKTsKICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsKICAgICAgfSBlbHNlIGlmIChtZS5hbGxvd0ZyZWVUZXh0KSB7CiAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7CiAgICAgICAgbWUuc2V0SW5pdFRleHQobWUuaW50ZXJuYWxUZXh0KTsKICAgICAgICB2YXIgX2RhdGFFbXB0eSA9IHt9OwogICAgICAgIF9kYXRhRW1wdHlbbWUudmFsdWVGaWVsZF0gPSBtZS5pbnRlcm5hbFZhbHVlOwogICAgICAgIF9kYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICB2YXIgX21ldGFEYXRhID0gewogICAgICAgICAgb2xkRGF0YTogbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0sCiAgICAgICAgICBuZXdEYXRhOiBfZGF0YUVtcHR5CiAgICAgICAgfTsKICAgICAgICBtZS4kZW1pdCgic2VsZWN0ZWQiLCBfbWV0YURhdGEpOwogICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICB9CgogICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKHRydWUpOwogICAgICBtZS5hZGp1c3RTY3JvbGwoKTsKICAgIH0sCiAgICAvL1Phu7Ega2nhu4duIGNsaWNrIHbDoG8gaW5wdXQKICAgIC8vQ3JlYXRlZCBieSBOTkxBTSAoMTkvMDQvMjAyMSkKICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soZSkgewogICAgICB0aGlzLiRlbWl0KCJjbGljayIsIGUpOwogICAgfSwKICAgIC8vU+G7sSBraeG7h24gZm9jdXMgdsOgbyBpbnB1dAogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQogICAgb25Gb2N1czogZnVuY3Rpb24gb25Gb2N1cyhlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLmZvY3VzZWQgPSB0cnVlOwogICAgICBtZS4kZW1pdCgiZm9jdXMiLCBlKTsKICAgIH0sCiAgICAvL1Phu7Ega2nhu4duIGNoYW5nZSBpbnB1dAogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQogICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5mb2N1c2VkKSB7CiAgICAgICAgaWYgKG1lLmZvcmNlU2VsZWN0aW9uKSB7CiAgICAgICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA8IDApIHsKICAgICAgICAgICAgLy9tZS5yZXNldCgpOwogICAgICAgICAgICAvLyBsZXQgZGF0YUVtcHR5ID0ge307CiAgICAgICAgICAgIC8vICAgZGF0YUVtcHR5W21lLnZhbHVlRmllbGRdID0gbnVsbDsKICAgICAgICAgICAgLy8gICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICAgICAgLy8gICBsZXQgbWV0YURhdGEgPSB7CiAgICAgICAgICAgIC8vICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAgICAgLy8gICAgIG5ld0RhdGE6IGRhdGFFbXB0eSwKICAgICAgICAgICAgLy8gICAgIHVzZXJBY3Rpb246IGZhbHNlCiAgICAgICAgICAgIC8vICAgfTsKICAgICAgICAgICAgLy9UT0RPIGJuZHVjIDkuNy4yMDIxOiBC4buPIHJhaXNlIHNlbGVjdGQgZXZlbnQgxJFpIHbDrCBjw6FjIGZvcm0gxJFhbmcgaGFuZGxlIMSR4buDIGfDoW4gbOG6oWkgaW5pdFRleHQgLT4gbOG7l2kgdmFsaWRhdGUgZm9yY2VTZWxlY3Rpb24KICAgICAgICAgICAgLy8gbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOwogICAgICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsKICAgICAgICAgIH0gZWxzZSBpZiAobWUuYWxsb3dEZXNlbGVjdEl0ZW0gJiYgbWUuaW50ZXJuYWxUZXh0ID09ICIiKSB7CiAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSAtMTsKICAgICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7CiAgICAgICAgICAgIHZhciBkYXRhRW1wdHkgPSB7fTsKICAgICAgICAgICAgZGF0YUVtcHR5W21lLnZhbHVlRmllbGRdID0gbnVsbDsKICAgICAgICAgICAgZGF0YUVtcHR5W21lLmRpc3BsYXlGaWVsZF0gPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgICAgIHZhciBtZXRhRGF0YSA9IHsKICAgICAgICAgICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAgICAgICBuZXdEYXRhOiBkYXRhRW1wdHksCiAgICAgICAgICAgICAgdXNlckFjdGlvbjogZmFsc2UKICAgICAgICAgICAgfTsKICAgICAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOwogICAgICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSBtZS5maWx0ZXJJbmRleEl0ZW1CeVRleHQoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG1lLnZhbHVlRmllbGQgPT0gbWUuZGlzcGxheUZpZWxkKSB7CiAgICAgICAgICAgIG1lLmludGVybmFsVmFsdWUgPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IG1lLmZpbHRlckluZGV4SXRlbUJ5VGV4dCgpOwoKICAgICAgICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPCAwKSB7CiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7CiAgICAgICAgICAgICAgdmFyIF9kYXRhRW1wdHkyID0ge307CiAgICAgICAgICAgICAgX2RhdGFFbXB0eTJbbWUudmFsdWVGaWVsZF0gPSBudWxsOwogICAgICAgICAgICAgIF9kYXRhRW1wdHkyW21lLmRpc3BsYXlGaWVsZF0gPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgICAgICAgdmFyIF9tZXRhRGF0YTIgPSB7CiAgICAgICAgICAgICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAgICAgICAgIG5ld0RhdGE6IF9kYXRhRW1wdHkyLAogICAgICAgICAgICAgICAgdXNlckFjdGlvbjogZmFsc2UKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIG1lLiRlbWl0KCJzZWxlY3RlZCIsIF9tZXRhRGF0YTIpOwogICAgICAgICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vVE9ETyBibmR1YyA1LjUuMjAyMSBjaOG7lyBuw6B5IGfhu41pIGNoYW5nZSBsw6BtIGfDrCBuaOG7iQogICAgICAvLyBtZS4kZW1pdCgiY2hhbmdlIiwgbWUuaW50ZXJuYWxWYWx1ZSk7CgogICAgfSwKICAgIC8vU+G7sSBraeG7h24gYmx1ciBpbnB1dAogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQogICAgLy8gcHZkdXkgMDcvMDUvMjAyMTogc+G7rWEgbOG6oWkgY29tYm9ib3ggKMSRw6MgdHJhbyDEkeG7lWkgduG7m2kgU0EgYW5oIEJORHVjKQogICAgb25CbHVyOiBmdW5jdGlvbiBvbkJsdXIoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5mb2N1c2VkID0gZmFsc2U7IC8vbuG6v3Uga2jDtG5nIGPDsyB2YWx1ZSBtw6Agc291cmNlIGNo4buJIGPDsyAxIGLhuqNuIGdoaSArIHRleHQgaGnhu4NuIHRo4buLIMSRYW5nIG1hcCAtPiBzZWxlY3QgaXRlbSBuw6B5CgogICAgICBpZiAobWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCA9PT0gMSAmJiBtZS5pbnRlcm5hbFRleHQgJiYgIW1lLmludGVybmFsVmFsdWUpIHsKICAgICAgICB2YXIgZmlyc3RJdGVtID0gbWUuaW50ZXJuYWxEYXRhU291cmNlWzBdOwogICAgICAgIG1lLnNldEludGVybmFsSXRlbShmaXJzdEl0ZW0pOwogICAgICB9IC8vbWUudmFsaWRhdGUobWUpOwoKCiAgICAgIGlmIChtZS5pbnRlcm5hbFRleHQgIT0gIiIpIHsKICAgICAgICBpZiAobWUudmFsaWRhdGVPbkJsdXIpIHsKICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG1lLnZhbGlkYXRlQmx1cigpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IC8vVEROR0hJQSAxNi85LzIwMjEgbuG6v3UgZm9yY2Ugc2VsZWN0aW9uIHRow6wgb3V0IGZvY3VzIHJhIG3DoCB4w7NhIGjhur90IHRleHQgdGjDrCBzZXQgbOG6oWkgZ2nDoSB0cuG7iyBjxakgY2hvIGNvbWJvCiAgICAgIC8vIE5NVFVBTjIgMTMuMDQuMjAyMjogbuG6v3Uga2jDtG5nIGNobyBi4buPIGNo4buNbiB0aMOsIG3hu5tpIHNldCBs4bqhaSBnacOhIHRy4buLIGPFqQoKCiAgICAgIGlmIChtZS5mb3JjZVNlbGVjdGlvbiAmJiAhbWUuYWxsb3dEZXNlbGVjdEl0ZW0gJiYgbWUuaW50ZXJuYWxUZXh0ID09ICIiICYmIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgbWUuaW50ZXJuYWxUZXh0ID0gbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW1bbWUuZGlzcGxheUZpZWxkXTsKICAgICAgfSAvL1RETkdISUEgMTQvMTEvMjAyMTogaGnhu4duIHThuqFpIG7hur91IHjDs2EgaOG6v3QgdGV4dCDEkWkgY29tYm8gdOG7sSBjaOG7jW4gbOG6oWkgZ2nDoSB0cuG7iyA9PiBjYXNlIG7hur91IHjDs2EgaOG6v3QgdGjDrCByZXNldCBsdcO0bgoKCiAgICAgIGlmIChtZS5pbnRlcm5hbFRleHQgPT0gIiIgJiYgIW1lLmludGVybmFsU2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgbWUucmVzZXQoKTsKICAgICAgfQoKICAgICAgbWUuJGVtaXQoImJsdXIiLCBlKTsKICAgIH0sCiAgICAvL1Phu7Ega2nhu4duIGtleWRvd24gaW5wdXQKICAgIC8vQ3JlYXRlZCBieSBMVERBVCAoMTYuMDYuMjAyMCkKICAgIG9uS2V5ZG93bjogZnVuY3Rpb24gb25LZXlkb3duKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoZS53aGljaCkgewogICAgICAgIGNhc2UgNDA6CiAgICAgICAgICB7CiAgICAgICAgICAgIGlmICghbWUuZXhwYW5kZWQpIHsKICAgICAgICAgICAgICBtZS5kb1F1ZXJ5SW50ZXJuYWwobnVsbCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA8IG1lLmdldFRvdGFsRGF0YSgpIC0gMSkgewogICAgICAgICAgICAgIGlmIChtZS5ub3RTZWxlY3Rpb25QYXJlbnQpIHsKICAgICAgICAgICAgICAgIHZhciB0eXBlQWhlYWRQb2ludGVyTmV4dCA9IG1lLnR5cGVBaGVhZFBvaW50ZXIgKyAxOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSB0eXBlQWhlYWRQb2ludGVyTmV4dDsgaSA8IG1lLmdldFRvdGFsRGF0YSgpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlcisrOwogICAgICAgICAgICAgICAgICBtZS5hZGp1c3RTY3JvbGwodHlwZUFoZWFkUG9pbnRlck5leHQpOwoKICAgICAgICAgICAgICAgICAgaWYgKCFtZS5pbnRlcm5hbERhdGFTb3VyY2VbaV0uaXNQYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyKys7CiAgICAgICAgICAgICAgICBtZS5hZGp1c3RTY3JvbGwoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDM4OgogICAgICAgICAgewogICAgICAgICAgICBpZiAobWUuZXhwYW5kZWQpIHsKICAgICAgICAgICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA+IDApIHsKICAgICAgICAgICAgICAgIGlmIChtZS5ub3RTZWxlY3Rpb25QYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgdmFyIHR5cGVBaGVhZFBvaW50ZXJQcmUgPSBtZS50eXBlQWhlYWRQb2ludGVyIC0gMTsKCiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pMyA9IHR5cGVBaGVhZFBvaW50ZXJQcmU7IF9pMyA+IDA7IF9pMy0tKSB7CiAgICAgICAgICAgICAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlci0tOwogICAgICAgICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbChtZS50eXBlQWhlYWRQb2ludGVyKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFtZS5pbnRlcm5hbERhdGFTb3VyY2VbX2kzXS5pc1BhcmVudCkgewogICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyLS07CiAgICAgICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMTM6CiAgICAgICAgICB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgIGlmIChtZS50eXBlQWhlYWRQb2ludGVyID49IDApIHsKICAgICAgICAgICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0obWUuaW50ZXJuYWxEYXRhU291cmNlW21lLnR5cGVBaGVhZFBvaW50ZXJdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWUuY29sbGFwc2UoKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIDk6CiAgICAgICAgICB7CiAgICAgICAgICAgIGlmIChtZS5leHBhbmRlZCkgewogICAgICAgICAgICAgIC8vIE5NVFVBTjMgMTYvMTEvMjAyMSBUaMOqbSDEkWnhu4F1IGtp4buHbiBraeG7g20gdHJhIGludGVybmFsVGV4dCBjw7MgcuG7l25nIGhheSBraMO0bmcKICAgICAgICAgICAgICAvL1RETkdISUEgY29tbWVudCBs4bqhaTogxJFv4bqhbiBuw6B5IGzDoCDEkeG7gyBu4bq/dSDhuqVuIHRhYiBtw6AgdHLDqm4gY29tYm8gY8OzIG1hcCDEkcaw4bujYyBnacOhIHRy4buLIG7DoG8gcuG7k2kgdGjDrCBz4bq9IHThu7EgY2jhu41uIGdpw6EgdHLhu4sgxJHhuqV5CiAgICAgICAgICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPj0gMCAmJiBtZS5pbnRlcm5hbFRleHQpIHsKICAgICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShtZS5pbnRlcm5hbERhdGFTb3VyY2VbbWUudHlwZUFoZWFkUG9pbnRlcl0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWUuY29sbGFwc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIG1lLiRlbWl0KCJrZXlkb3duIiwgZSk7CiAgICB9LAogICAgLy9M4bqleSB04buVbmcgc+G7kSBsxrDhu6NuZyBk4buvIGxp4buHdSB0cm9uZyBkYXRhCiAgICBnZXRUb3RhbERhdGE6IGZ1bmN0aW9uIGdldFRvdGFsRGF0YSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGg7CiAgICB9LAogICAgLy9Cw7RpIG3DoHUgaGlnaHRsaWdodCBjaG8gaXRlbQogICAgZG9IaWdodGxpZ2h0SXRlbTogZnVuY3Rpb24gZG9IaWdodGxpZ2h0SXRlbShpZ25vcmVWYWx1ZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgaW5kZXggPSAtMTsKCiAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UgJiYgbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCA+IDApIHsKICAgICAgICBpbmRleCA9IC0xOwoKICAgICAgICBpZiAoIWlnbm9yZVZhbHVlICYmIG1lLmludGVybmFsVmFsdWUgIT0gbnVsbCAmJiBtZS5pbnRlcm5hbFZhbHVlICE9IHVuZGVmaW5lZCkgewogICAgICAgICAgdmFyIHNvdXJjZXMgPSBtZS5fYWxsRGF0YSB8fCBtZS5pbnRlcm5hbERhdGFTb3VyY2U7IC8vVHLGsOG7m2Mga2hpIGxvYWQgdMOtbmggdG/DoW4gbOG6oWkgdHlwZUFoZWFkUG9pbnRlciBu4bq/dSBj4bqnbiB0aGnhur90IMSR4buDIHNjcm9sbCBkaSBjaHV54buDbiB24buBIGTDum5nIHbhu4sgdHLDrSBraGkgc2hvdyBzY3JvbGxlciBsw6puCiAgICAgICAgICAvL1TDrG0gduG7iyB0csOtIHNlbGVjdGVkSXRlbSB0cm9uZyBzb3VyY2UsIGtow7RuZyBs4bqleSBzZWxlY3RlZEluZGV4IHbDrCBjw7MgdGjhu4Mga2jDtG5nIGNow61uaCB4w6FjIGtoaSBzb3VyY2UgdGhheSDEkeG7lWkKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGl0ZW0gPSBzb3VyY2VzW2ldOwoKICAgICAgICAgICAgaWYgKGl0ZW1bbWUudmFsdWVGaWVsZF0gPT09IG1lLmludGVybmFsVmFsdWUpIHsKICAgICAgICAgICAgICBpbmRleCA9IGk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaW5kZXggPj0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCkgewogICAgICAgICAgICBmb3IgKHZhciBfaTQgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoOyBfaTQgPD0gaW5kZXg7IF9pNCsrKSB7CiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlLnB1c2goc291cmNlc1tfaTRdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGluZGV4ID09PSAtMSAmJiBtZS5pbnRlcm5hbFRleHQpIHsKICAgICAgICAgIHZhciBsb3dlclRleHQgPSBtZS5pbnRlcm5hbFRleHQudG9Mb3dlckNhc2UoKTsKCiAgICAgICAgICBpZiAobWUuY29sdW1ucyAmJiBtZS5jb2x1bW5zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgZm9yICh2YXIgX2k1ID0gMDsgX2k1IDwgbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsgX2k1KyspIHsKICAgICAgICAgICAgICB2YXIgX2l0ZW0zID0gbWUuaW50ZXJuYWxEYXRhU291cmNlW19pNV07CgogICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWUuY29sdW1ucy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgdmFyIGZpZWxkID0gbWUuY29sdW1uc1tqXS5kYXRhRmllbGQ7CiAgICAgICAgICAgICAgICB2YXIgaXRlbVZhbHVlID0gX2l0ZW0zW2ZpZWxkXTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW1WYWx1ZSA9PT0gInN0cmluZyIgJiYgaXRlbVZhbHVlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihsb3dlclRleHQpID4gLTEpIHsKICAgICAgICAgICAgICAgICAgaW5kZXggPSBfaTU7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yICh2YXIgX2k2ID0gMDsgX2k2IDwgbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsgX2k2KyspIHsKICAgICAgICAgICAgICB2YXIgX2l0ZW1WYWx1ZSA9IG1lLmludGVybmFsRGF0YVNvdXJjZVtfaTZdW21lLmRpc3BsYXlGaWVsZF07CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgX2l0ZW1WYWx1ZSA9PT0gInN0cmluZyIgJiYgX2l0ZW1WYWx1ZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YobG93ZXJUZXh0KSA+IC0xKSB7CiAgICAgICAgICAgICAgICBpbmRleCA9IF9pNjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgICAgaW5kZXggPSAwOwogICAgICAgIH0KICAgICAgfQoKICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IGluZGV4OwogICAgfSwKICAgIC8vVMOsbSBraeG6v20gaXRlbSB0cm9uZyBsaXN0CiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTYuMDYuMjAyMCkKICAgIGZpbHRlckluZGV4SXRlbUJ5VGV4dDogZnVuY3Rpb24gZmlsdGVySW5kZXhJdGVtQnlUZXh0KHF1ZXJ5VGV4dCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZmlsdGVycyA9IG1lLmZpbHRlckZpZWxkcywKICAgICAgICAgIHZhbHVlID0gcXVlcnlUZXh0IHx8IG1lLmludGVybmFsVGV4dCwKICAgICAgICAgIGluZGV4ID0gLTE7CgogICAgICBpZiAoZmlsdGVycyAmJiB2YWx1ZSkgewogICAgICAgIHZhbHVlID0gdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICBpbmRleCA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0sIF9pbmRleCkgewogICAgICAgICAgdmFyIHJldCA9IGZhbHNlOwoKICAgICAgICAgIGZvciAodmFyIGtleSBpbiBmaWx0ZXJzKSB7CiAgICAgICAgICAgIGlmIChmaWx0ZXJzLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgICB2YXIgcyA9IGZpbHRlcnNba2V5XTsKCiAgICAgICAgICAgICAgaWYgKHMgPT0gImNvbnRhaW5zIikgewogICAgICAgICAgICAgICAgcmV0ID0gaXRlbVtrZXldICYmIGl0ZW1ba2V5XS50b1N0cmluZygpICYmIGl0ZW1ba2V5XS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuY29udGFpbnModmFsdWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldCA9IGl0ZW1ba2V5XSAmJiBpdGVtW2tleV0udG9TdHJpbmcoKSAmJiBpdGVtW2tleV0udG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgodmFsdWUudG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocmV0KSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gaW5kZXg7CiAgICB9LAogICAgLy9M4bqleSBj4buZdCBmaWx0ZXIgxJHhu4MgdMOsbSBraeG6v20gbG9jYWwKICAgIC8vQ3JlYXRlZCBieSBMVERBVCAxNi4wNi4yMDIwCiAgICBnZXRGaWx0ZXJGaWVsZHM6IGZ1bmN0aW9uIGdldEZpbHRlckZpZWxkcygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBmaWx0ZXIgPSB7fTsKCiAgICAgIGlmICh0aGlzLmNvbHVtbnMgJiYgdGhpcy5jb2x1bW5zLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChpKSB7CiAgICAgICAgICB2YXIgY29sID0gX3RoaXMuY29sdW1uc1tpXTsKCiAgICAgICAgICBpZiAoIWNvbC5maWx0ZXJPcGVyYXRvcikgewogICAgICAgICAgICBjb2wuZmlsdGVyT3BlcmF0b3IgPSAiY29udGFpbnMiOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChjb2wuZGF0YUZpZWxkICYmIGNvbC5maWx0ZXJPcGVyYXRvcikgewogICAgICAgICAgICBpZiAoX3RoaXMuZmlsdGVyQ29sdW1ucyAmJiBfdGhpcy5maWx0ZXJDb2x1bW5zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBfdGhpcy5maWx0ZXJDb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgIGlmICghZmlsdGVyLmhhc093blByb3BlcnR5KGUpKSB7CiAgICAgICAgICAgICAgICAgIGZpbHRlcltlXSA9IGNvbC5maWx0ZXJPcGVyYXRvcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBmaWx0ZXJbY29sLmRhdGFGaWVsZF0gPSBjb2wuZmlsdGVyT3BlcmF0b3I7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY29sdW1ucy5sZW5ndGg7IGkrKykgewogICAgICAgICAgX2xvb3AoaSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZpbHRlclt0aGlzLmRpc3BsYXlGaWVsZF0gPSAiY29udGFpbnMiOwogICAgICB9CgogICAgICByZXR1cm4gZmlsdGVyOwogICAgfSwKICAgIC8vTOG6pXkgZWxlbWVudCBzY3JvbGwKICAgIC8vQ3JlYXRlZCBieSBMVERBVCAoMTYuMDYuMjAyMCkKICAgIGdldFNjcm9sbGVyOiBmdW5jdGlvbiBnZXRTY3JvbGxlcigpIHsKICAgICAgaWYgKHRoaXMuZXhwYW5kZWQpIHsKICAgICAgICAvLyByZXR1cm4gdGhpcy4kcmVmc1sic2Nyb2xsZXIiXTsKICAgICAgICB2YXIgZGQgPSB0aGlzLiRyZWZzWyJkcm9wZG93blBhbmVsIl07CgogICAgICAgIGlmIChkZCAmJiBkZC4kZWwgJiYgdHlwZW9mIGRkLiRlbC5xdWVyeVNlbGVjdG9yID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICByZXR1cm4gZGQuJGVsLnF1ZXJ5U2VsZWN0b3IoIi5zY3JvbGxlciIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIERpIGNodXnhu4NuIHZpZXcgxJHhur9uIGLhuqNuIGdoaSBu4bq/dSBj4bqnbg0KICAgICAqIEBwYXJhbSB7QuG6o24gZ2hpIGPhuqduIHZpZXd9IGluZGV4DQogICAgICogQ3JlYXRlZEJ5IExUREFUIDE2LjA2LjIwMjANCiAgICAgKi8KICAgIGFkanVzdFNjcm9sbDogZnVuY3Rpb24gYWRqdXN0U2Nyb2xsKCkgewogICAgICB2YXIgdHlwZUFoZWFkUG9pbnRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogdGhpcy50eXBlQWhlYWRQb2ludGVyOwogICAgICB2YXIgc2Nyb2xsZXIgPSB0aGlzLmdldFNjcm9sbGVyKCk7CgogICAgICBpZiAoc2Nyb2xsZXIpIHsKICAgICAgICAvLyBzY3JvbGxlci5zY3JvbGxUb0l0ZW0odHlwZUFoZWFkUG9pbnRlciwgdHJ1ZSk7CiAgICAgICAgc2Nyb2xsZXIuc2Nyb2xsVG9wID0gMzUgKiB0eXBlQWhlYWRQb2ludGVyOwogICAgICB9CiAgICB9LAogICAgb25TY3JvbGxlclZpc2libGU6IGZ1bmN0aW9uIG9uU2Nyb2xsZXJWaXNpYmxlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5hZGp1c3RTY3JvbGwoKTsKICAgIH0sCiAgICAvL0jDoG0geOG7rSBsw70ga2hpIGNo4buNbiBpdGVtIHRyw6puIGRyb3Bkb3duCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTYuMDYuMjAyMCkKICAgIG9uSXRlbUNsaWNrOiBmdW5jdGlvbiBvbkl0ZW1DbGljayhpdGVtLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0oaXRlbSk7CiAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CiAgICB9LAogICAgLy9TZXQgZ2nDoSB0cuG7iyDEkcaw4bujYyBjaOG7jW4KICAgIHNldEludGVybmFsSXRlbTogZnVuY3Rpb24gc2V0SW50ZXJuYWxJdGVtKGl0ZW0pIHsKICAgICAgdmFyIHVzZXJBY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRydWU7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoaXRlbSkgewogICAgICAgIGlmIChtZS5ub3RTZWxlY3Rpb25QYXJlbnQgJiYgaXRlbS5pc1BhcmVudCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1ldGFEYXRhID0gewogICAgICAgICAgb2xkRGF0YTogbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0sCiAgICAgICAgICBuZXdEYXRhOiBpdGVtCiAgICAgICAgfTsKICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSA9IGl0ZW07CiAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IGl0ZW1bbWUudmFsdWVGaWVsZF07CiAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7CiAgICAgICAgbWUuaW50ZXJuYWxUZXh0ID0gaXRlbVttZS5kaXNwbGF5RmllbGRdOwogICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSBtZS5maW5kSW5kZXhJdGVtKGl0ZW0pOwogICAgICAgIG1lLmNvbGxhcHNlKCk7CiAgICAgICAgbWUuJGVtaXQoInVwZGF0ZTpkaXNwbGF5IiwgbWUuaW50ZXJuYWxUZXh0KTsKCiAgICAgICAgaWYgKG1lLm1hcHBpbmdGaWVsZCkgewogICAgICAgICAgZm9yICh2YXIga2V5IGluIG1lLm1hcHBpbmdGaWVsZCkgewogICAgICAgICAgICB2YXIgZW1pdFN0clVwZGF0ZSA9ICJ1cGRhdGU6IiArIGtleTsKICAgICAgICAgICAgbWUuJGVtaXQoZW1pdFN0clVwZGF0ZSwgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW1bbWUubWFwcGluZ0ZpZWxkW2tleV1dKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh1c2VyQWN0aW9uID09IHRydWUpIHsKICAgICAgICAgIG1lLiRlbWl0KCJzZWxlY3RlZCIsIG1ldGFEYXRhKTsKCiAgICAgICAgICBpZiAobWV0YURhdGEub2xkRGF0YSAhPT0gbWV0YURhdGEubmV3RGF0YSkgewogICAgICAgICAgICBtZS4kZW1pdCgiY2hhbmdlIiwgbWUuaW50ZXJuYWxWYWx1ZSwgbWV0YURhdGEubmV3RGF0YSwgbWV0YURhdGEub2xkRGF0YSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLiRlbWl0KCJhdXRvU2VsZWN0ZWQiLCBtZXRhRGF0YSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy9Uw6xtIHbhu4sgdHLhu4sgY+G7p2EgaXRlbSB0cm9uZyBkYXRhCiAgICBmaW5kSW5kZXhJdGVtOiBmdW5jdGlvbiBmaW5kSW5kZXhJdGVtKGl0ZW0pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIG1lLmludGVybmFsRGF0YVNvdXJjZS5maW5kSW5kZXgoZnVuY3Rpb24gKF9pdGVtKSB7CiAgICAgICAgcmV0dXJuIF9pdGVtID09IGl0ZW07CiAgICAgIH0pOwogICAgfSwKICAgIC8vS2jhu59pIHThuqFvIGThu68gbGnhu4d1IHTEqW5oIG3hurdjIMSR4buLbmgKICAgIGluaXRTdGF0aWNEYXRhOiBmdW5jdGlvbiBpbml0U3RhdGljRGF0YSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuY29tYm9UeXBlID0gMTsKICAgICAgbWUuaW50ZXJuYWxRdWVyeURlbGF5ID0gMjAwOwogICAgICBtZS5maWx0ZXJGaWVsZHMgPSBtZS5nZXRGaWx0ZXJGaWVsZHMoKTsKICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG51bGw7CiAgICAgIG1lLmZpcnN0RXhwYW5kID0gdHJ1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogdGjDqm0gYuG6o24gZ2hpIGNo4buNbiB04bqldCBj4bqjIHbDoG8gc291cmNlDQogICAgICovCiAgICBhcHBlbmRTZWxlY3RBbGxJdGVtOiBmdW5jdGlvbiBhcHBlbmRTZWxlY3RBbGxJdGVtKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFtZS5zaG93U2VsZWN0QWxsKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgZmlyc3RJdGVtID0gbWUuaW50ZXJuYWxEYXRhU291cmNlWzBdOwoKICAgICAgaWYgKGZpcnN0SXRlbSAmJiBmaXJzdEl0ZW1bbWUudmFsdWVGaWVsZF0gIT09IG1lLnNlbGVjdEFsbFZhbHVlKSB7CiAgICAgICAgdmFyIGFsbEl0ZW0gPSB7fTsKICAgICAgICBhbGxJdGVtW21lLnZhbHVlRmllbGRdID0gbWUuc2VsZWN0QWxsVmFsdWU7CiAgICAgICAgYWxsSXRlbVttZS5kaXNwbGF5RmllbGRdID0gbWUuX3NlbGVjdEFsbFRleHQ7IC8vIHZ2a2lldCAtIDI0LjA2LjIwMjE6IELhu5Ugc3VuZyB0ZXh0IFThuqV0IGPhuqMgY2hvIHThuqV0IGPhuqMgY8OhYyBj4buZdAoKICAgICAgICBtZS5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbHVtbikgewogICAgICAgICAgYWxsSXRlbVtjb2x1bW4uZGF0YUZpZWxkXSA9IG1lLl9zZWxlY3RBbGxUZXh0OwogICAgICAgIH0pOwogICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS51bnNoaWZ0KGFsbEl0ZW0pOwogICAgICB9CiAgICB9LAogICAgLy9LaOG7n2kgdOG6oW8gZOG7ryBsaeG7h3UKICAgIGluaXREYXRhOiBmdW5jdGlvbiBpbml0RGF0YSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5sYXN0UmVxdWVzdFBhcmFtICYmIG1lLmxhc3RSZXF1ZXN0UGFyYW0ucGFnZUFwcGVuZCAmJiBtZS5zY3JvbGxEb2luZykgewogICAgICAgIC8vIGlmKG1lLmludGVybmFsRGF0YVNvdXJjZS5maWx0ZXIoaT0+aT09KSkKICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UuYXBwZW5kKG1lLmRhdGEpOwogICAgICAgIG1lLnNjcm9sbERvaW5nID0gZmFsc2U7IC8vbuG6v3UgZOG7ryBsaeG7h3UgdHLhuqMgduG7gSDDrXQgaMahbiBtb25nIMSR4bujaSAtPiDEkcOhbmggZOG6pXUga+G6v3QgdGjDumMgxJHhu4Mga2hpIHNjcm9sbCB4deG7kW5nIGsgbG9hZCB0aMOqbSBu4buvYQoKICAgICAgICBpZiAobWUuZGF0YS5sZW5ndGggPCBtZS5wYWdlU2l6ZSkgewogICAgICAgICAgbWUubGFzdFJlcXVlc3RQYXJhbS5lbmQgPSB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtLmVuZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBfdG9Db25zdW1hYmxlQXJyYXkobWUuZGF0YSk7CiAgICAgICAgbWUuYXBwZW5kU2VsZWN0QWxsSXRlbSgpOwogICAgICB9CgogICAgICBpZiAobWUua2V5RmllbGQgJiYgbWUua2V5RmllbGQgIT09IG1lLnZhbHVlRmllbGQpIHsKICAgICAgICBjb21tb25Gbi5nZW5WS2V5VmFsdWUobWUuaW50ZXJuYWxEYXRhU291cmNlLCBtZS5rZXlGaWVsZCk7CiAgICAgIH0gLy9O4bq/dSBsw6AgY29tYm8gZOG6oW5nIHRyZWUKCgogICAgICBpZiAobWUuY29tYm9UeXBlID09IDMpIHsKICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkobWUuaW50ZXJuYWxEYXRhU291cmNlKSk7CiAgICAgICAgdmFyIGRhdGFUcmVlID0gY29tbW9uRm4ubm9tYWxpemVEYXRhVHJlZShkYXRhLCBtZS5pZFByb3BlcnR5IHx8IG1lLnZhbHVlRmllbGQsIG1lLnBhcmVudElkUHJvcGVydHkpOwogICAgICAgIHZhciB0cmVlRGF0YSA9IGNvbW1vbkZuLmdldEJvZHlEYXRhKGRhdGFUcmVlLCB0cnVlKTsKCiAgICAgICAgaWYgKHRyZWVEYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgIG1lLl9hbGxEYXRhID0gdHJlZURhdGE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZSA9IFtdOwogICAgICAgICAgbWUuX2FsbERhdGEgPSBudWxsOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKG1lLl9hbGxEYXRhKSB7CiAgICAgICAgbWUuZG9Mb2NhbFF1ZXJ5KG1lLmxhc3RRdWVyeVN0cmluZyk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogS2jhu59pIHThuqFvIGNvbWJvDQogICAgICoNCiAgICAgKiBAYXV0aG9yIGhuZ2lhcCAtIDAxLjA5LjIwMTkNCiAgICAgKiAxIGzDoCBjb21ibyBraMO0bmcgY8OzIGNvbHVtbnMgKENvbWJvRWRpdG9yKQ0KICAgICAqIDIgbMOgIGNvbWJvIGPDsyBjb2x1bW5zDQogICAgICogMyBsw6AgY29tYm8gdHJlZQ0KICAgICAqLwogICAgaW5pdENvbWJvOiBmdW5jdGlvbiBpbml0Q29tYm8oKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuaXNUcmVlKSB7CiAgICAgICAgbWUuY29tYm9UeXBlID0gMzsKICAgICAgfSBlbHNlIGlmIChtZS5jb2x1bW5zICYmIG1lLmNvbHVtbnMubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgbWUuY29tYm9UeXBlID0gMjsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5jb21ib1R5cGUgPSAxOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGNsaWNrIHbDoG8gaWNvbiBkcm9wZG93bg0KICAgICAqLwogICAgdHJpZ2dlckNsaWNrOiBmdW5jdGlvbiB0cmlnZ2VyQ2xpY2soZSkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgZXhwYW5kZWQgPSBtZS5leHBhbmRlZDsgLy9kaXNhYmxlIHRow6wga2jDtG5nIGzDoG0gZ8OsCgogICAgICBpZiAobWUuZGlzYWJsZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICghZXhwYW5kZWQpIHsKICAgICAgICAvLyBpZiAobWUucGFnaW5hdGlvbikgewogICAgICAgIG1lLmRvUXVlcnlJbnRlcm5hbChudWxsLCB0cnVlKTsgLy8gfSBlbHNlIGlmIChtZS5maXJzdEV4cGFuZCkgewogICAgICAgIC8vICAgbWUuZmlyc3RFeHBhbmQgPSBmYWxzZTsKICAgICAgICAvLyAgIG1lLmRvUXVlcnlJbnRlcm5hbChudWxsLCB0cnVlKTsKICAgICAgICAvLyB9CgogICAgICAgIG1lLiRlbWl0KCJiZWZvcmVFeHBhbmQiKTsgLy8gdnZrZWl0IC0gMDYuMDQuMjAyMTogODk4MjMgLSBM4buXaSBjaHVuZzogTOG7l2kgdHLDqm4gZm9ybSDEkWnhu4F1IGNodXnhu4NuIGjDoG5nIGxv4bqhdCBkxrDhu5tpIGLhuqNuZyBjaGkgdGnhur90IGtoaSDEkcOjIGNo4buNbiB0w6BpIHPhuqNuIHRow6wgxJFhbmcga2jDtG5nIHjhu5UgY29tYm8gxJHhu4MgY2jhu41uIHRp4bq/cAogICAgICAgIC8vIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CgogICAgICAgIG1lLmNoYW5nZURyb3Bkb3duUG9zaXRpb24oKTsKICAgICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKCk7CiAgICAgIH0gLy/EkeG6t3QgbmV4dGljayDEkeG7gyB0csOhbmggbOG7l2kgcmVuZGVyIGRvbSBj4bunYSBjb21ib2JveCB0cmVlIGtoaSBjaOG7jW4gaXRlbSB04burIGRyb3Bkb3duCgoKICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS5leHBhbmRlZCA9ICFleHBhbmRlZDsKICAgICAgfSk7IC8vZm9jdXMgaW5wdXQKCiAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGhp4buDbiB0aOG7iyBkcm9wZG93bg0KICAgICAqLwogICAgZXhwYW5kOiBmdW5jdGlvbiBleHBhbmQoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLiRlbWl0KCJiZWZvcmVFeHBhbmQiKTsgLy8gdnZrZWl0IC0gMDYuMDQuMjAyMTogODk4MjMgLSBM4buXaSBjaHVuZzogTOG7l2kgdHLDqm4gZm9ybSDEkWnhu4F1IGNodXnhu4NuIGjDoG5nIGxv4bqhdCBkxrDhu5tpIGLhuqNuZyBjaGkgdGnhur90IGtoaSDEkcOjIGNo4buNbiB0w6BpIHPhuqNuIHRow6wgxJFhbmcga2jDtG5nIHjhu5UgY29tYm8gxJHhu4MgY2jhu41uIHRp4bq/cAogICAgICAvLyBtZS4kcmVmcy5pbnB1dC5mb2N1cygpOwoKICAgICAgbWUuY2hhbmdlRHJvcGRvd25Qb3NpdGlvbigpOwogICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKCk7IC8vxJHhurd0IG5leHRpY2sgxJHhu4MgdHLDoW5oIGzhu5dpIHJlbmRlciBkb20gY+G7p2EgY29tYm9ib3ggdHJlZSBraGkgY2jhu41uIGl0ZW0gdOG7qyBkcm9wZG93bgoKICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS5leHBhbmRlZCA9IHRydWU7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiDhuqluIGRyb3Bkb3duDQogICAgICovCiAgICBjb2xsYXBzZTogZnVuY3Rpb24gY29sbGFwc2UoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgbWUuZXhwYW5kZWQgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gc2V0IHbhu4sgdHLDrSBjaG8gZHJvcGRvd24gbWVudSBraGkgZXhwYW5kDQogICAgICogVE9ETzogQ2jGsGEgeOG7rSBsw70ga2hpIGPDsyBzY3JvbGwNCiAgICAgKi8KICAgIGNoYW5nZURyb3Bkb3duUG9zaXRpb246IGZ1bmN0aW9uIGNoYW5nZURyb3Bkb3duUG9zaXRpb24oKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBjb21ib0VsID0gbWUuJGVsOwoKICAgICAgaWYgKGNvbWJvRWwpIHsKICAgICAgICBjb21ib0VsID0gY29tYm9FbC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjb21iby1ib3gtaW5wdXQiKVswXTsKICAgICAgfQoKICAgICAgaWYgKGNvbWJvRWwpIHsKICAgICAgICB2YXIgY29tYm9FbFJlY3QgPSBjb21ib0VsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLAogICAgICAgICAgICBjb21ib01lbnVFbCA9IG1lLiRlbDsKICAgICAgICB2YXIgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aDsKICAgICAgICB2YXIgd2luZG93SGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQ7CiAgICAgICAgbWUuZHJvcGRvd25MZWZ0eCA9IGNvbWJvRWxSZWN0LmxlZnQ7CiAgICAgICAgbWUuZHJvcGRvd25Ub3B4ID0gY29tYm9FbFJlY3QudG9wICsgY29tYm9FbFJlY3QuaGVpZ2h0ICsgMjsKICAgICAgICBtZS5kcm9wZG93bk1heFdpZHRoeCA9IG1lLmRyb3Bkb3duTWluV2lkdGh4ID0gbWUuZHJvcGRvd25XaWR0aCA/IG1lLmRyb3Bkb3duV2lkdGggOiBjb21ib0VsUmVjdC53aWR0aDsgLy8gTuG6v3UgY2jhuqFtIHBo4bqjaSB0aMOsIGFsaWduIHNhbmcgdHLDoWkKCiAgICAgICAgaWYgKGNvbWJvRWxSZWN0LmxlZnQgKyBjb21ib01lbnVFbC5vZmZzZXRXaWR0aCA+IHdpbmRvd1dpZHRoKSB7CiAgICAgICAgICBtZS5kcm9wZG93bkxlZnR4ID0gY29tYm9FbFJlY3QucmlnaHQgLSBjb21ib01lbnVFbC5vZmZzZXRXaWR0aDsKICAgICAgICB9IC8vIE7hur91IGNo4bqhbSBib3R0b20gdGjDrCBhbGlnbiB0b3AKCgogICAgICAgIHZhciBtYXhJdGVtc0Rpc3BsYXkgPSBtZS5tYXhJdGVtc0Rpc3BsYXk7CgogICAgICAgIGlmIChtZS5jb2x1bW5zICYmIG1lLmNvbHVtbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgbWF4SXRlbXNEaXNwbGF5ICs9IDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoY29tYm9FbFJlY3QuYm90dG9tICsgbWUuaXRlbVNpemUgKiBtYXhJdGVtc0Rpc3BsYXkgKyAyID4gd2luZG93SGVpZ2h0KSB7CiAgICAgICAgICBtZS5kcm9wZG93blRvcHggPSBjb21ib0VsUmVjdC50b3AgLSAobWUuaXRlbVNpemUgKiBNYXRoLm1pbihtYXhJdGVtc0Rpc3BsYXksIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGgpICsgNCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENsaWNrIHbDoG8gaWNvbiBxdWlja3NlYXJjaA0KICAgICAqLwogICAgcXVpY2tTZWFyY2hDbGljazogZnVuY3Rpb24gcXVpY2tTZWFyY2hDbGljayhlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgIGlmIChtZS5xdWlja1NlYXJjaCkgewogICAgICAgIGlmIChtZS5kaXNhYmxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbWUuZXhwYW5kZWQgPSBmYWxzZTsKCiAgICAgICAgdmFyIHBhcmFtID0gX29iamVjdFNwcmVhZCh7fSwgbWUucXVpY2tTZWFyY2hQYXJhbSB8fCB7fSk7CgogICAgICAgIHBvcHVwVXRpbC5zaG93KG1lLCBtZS5xdWlja1NlYXJjaCwgcGFyYW0sIHsKICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFPhu7Ega2nhu4duIGNhbGxiYWNrIGtoaSBjaOG7jW4gaXRlbSB04burIGZvcm0gdMOsbSBuaGFuaA0KICAgICAgICAgICAqLwogICAgICAgICAgc2VhcmNoU3VibWl0OiBmdW5jdGlvbiBzZWFyY2hTdWJtaXQocmVjb3JkKSB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlY29yZCkpIHsKICAgICAgICAgICAgICAvLyBjaOG7jW4gdOG7qyBmb3JtIGNo4buNbiBuaGFuaCB4deG7kW5nIGNvbWJvIGRvIHJ1bGUgY+G7p2EgZOG7sSDDoW4gbMOgIMSRayBs4buNYyB0csOqbiBmb3JtIGNo4buNbiBuaGFuaCB2w6AgY29tYm8gbmjGsCBuaGF1IG7Dqm4gY8OzIHRo4buDIGLhu48gcXVhIHZhbGlkYXRlIGsgY8OzIHRyb25nIGRuYWggbeG7pWMKICAgICAgICAgICAgICAvL3bDoCBi4buPIHF1YSB2YWxpZGF0ZSBrIGPDsyB0cm9uZyBkYW5oIG3hu6VjIGLhurFuZyBjw6FjaCBraeG7g20gdHJhIHNvdXJjZSBkxrDhu5tpIGNvbWJvIGPDsyBpdGVtIGRjIGNo4buNbiB04burIGZvcm0gY2jhu41uIG5oYW5oIGssIG7hur91IGsgY8OzIHRow6wgYWRkIHbDoG8KICAgICAgICAgICAgICB2YXIgY2hlY2sgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaVttZS52YWx1ZUZpZWxkXSA9PSByZWNvcmRbMF1bbWUudmFsdWVGaWVsZF07CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmICghY2hlY2sgfHwgY2hlY2subGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5wdXNoKHJlY29yZFswXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0ocmVjb3JkWzBdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjaOG7jW4gdOG7qyBmb3JtIGNo4buNbiBuaGFuaCB4deG7kW5nIGNvbWJvIGRvIHJ1bGUgY+G7p2EgZOG7sSDDoW4gbMOgIMSRayBs4buNYyB0csOqbiBmb3JtIGNo4buNbiBuaGFuaCB2w6AgY29tYm8gbmjGsCBuaGF1IG7Dqm4gY8OzIHRo4buDIGLhu48gcXVhIHZhbGlkYXRlIGsgY8OzIHRyb25nIGRuYWggbeG7pWMKICAgICAgICAgICAgICAvL3bDoCBi4buPIHF1YSB2YWxpZGF0ZSBrIGPDsyB0cm9uZyBkYW5oIG3hu6VjIGLhurFuZyBjw6FjaCBraeG7g20gdHJhIHNvdXJjZSBkxrDhu5tpIGNvbWJvIGPDsyBpdGVtIGRjIGNo4buNbiB04burIGZvcm0gY2jhu41uIG5oYW5oIGssIG7hur91IGsgY8OzIHRow6wgYWRkIHbDoG8KICAgICAgICAgICAgICB2YXIgX2NoZWNrID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmZpbHRlcihmdW5jdGlvbiAoaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGlbbWUudmFsdWVGaWVsZF0gPT0gcmVjb3JkW21lLnZhbHVlRmllbGRdOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAoIV9jaGVjayB8fCBfY2hlY2subGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5wdXNoKHJlY29yZCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0ocmVjb3JkKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBtZS52YWxpZGF0ZShtZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBtZS4kcmVmcy5pbnB1dC5mb2N1cygpOwogICAgICAgICAgfSwKICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbiBjbG9zZSgpIHsKICAgICAgICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBWYWxpZGF0ZSBraGkgYmx1cg0KICAgICAqIG50bmdoaWEgLSAxMS8wMy8yMDIxDQogICAgICogYm5kdWMgMjEuNi4yMDIxOiDEkOG7lWkgbOG6oWkgdGjDoG5oIGfhu41pIGjDoG0gdmFsaWRhdGUgY+G7p2EgY29udHJvbCB0aGF5IHbDrCB2aeG6v3Qgc2N1c3RvbSBuaMawIG7DoHkNCiAgICAgKi8KICAgIHZhbGlkYXRlQmx1cjogZnVuY3Rpb24gdmFsaWRhdGVCbHVyKCkgewogICAgICB0aGlzLnZhbGlkYXRlKHRoaXMpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBzY3JvbGwgeHXhu5FuZyBjdeG7kWkgZHJvd25kb3duIC0+IGxvYWQgdGjDqm0gZOG7ryBsaeG7h3UNCiAgICAgKi8KICAgIGRyb3Bkb3duU2Nyb2xsRW5kOiBmdW5jdGlvbiBkcm9wZG93blNjcm9sbEVuZCgpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy8gaWYgKG1lLnBhZ2luYXRpb24pIHsKCiAgICAgIGlmIChtZS5xdWVyeU1vZGUgPT09ICJyZW1vdGUiICYmICFtZS5fYWxsRGF0YSkgewogICAgICAgIG1lLnNjcm9sbERvaW5nID0gdHJ1ZTsgLy9yZW1vdGUKCiAgICAgICAgaWYgKG1lLmxhc3RSZXF1ZXN0UGFyYW0gJiYgIW1lLmxhc3RSZXF1ZXN0UGFyYW0uZW5kKSB7CiAgICAgICAgICAvL1RPRE8gYm5kdWMgMjEuNi4yMDIxOiBnaGkgbmjhuq1uIHTDrW5oIGh14buRbmcgZ+G7jWkgdsOgbyDEkcOieSAyIGzhuqduIHRyw6puIG3DoXkgcWMgLT4gdGjDqm0ga2nhu4NtIHRyYSBuw6B5IMSR4buDIGsgbOG7l2kKICAgICAgICAgIGlmIChtZS5sYXN0UmVxdWVzdFBhcmFtLnNraXAgJiYgbWUubGFzdFJlcXVlc3RQYXJhbS5za2lwID09PSBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcGF5bG9hZCA9IG1lLmxhc3RSZXF1ZXN0UGFyYW07CiAgICAgICAgICBwYXlsb2FkLnNraXAgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoOwogICAgICAgICAgcGF5bG9hZC5wYWdlQXBwZW5kID0gdHJ1ZTsKICAgICAgICAgIG1lLiRlbWl0KCJsb2FkRGF0YSIsIHBheWxvYWQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL2xvY2FsCiAgICAgICAgdmFyIGRhdGEgPSBtZS5fZmlsdGVyRGF0YSB8fCBtZS5fYWxsRGF0YTsKCiAgICAgICAgaWYgKGRhdGEpIHsKICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZSA9IG1lLmludGVybmFsRGF0YVNvdXJjZSB8fCBbXTsKICAgICAgICAgIHZhciBzdGFydCA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGg7CiAgICAgICAgICB2YXIgY291bnQgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCwgbWUucGFnZVNpemUgKyBzdGFydCk7CgogICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgY291bnQ7IGkrKykgewogICAgICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UucHVzaChkYXRhW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy8gfQoKICAgIH0sCgogICAgLyoqDQogICAgICogeOG7rSBsw70gcGjDrW0gZXNjDQogICAgICovCiAgICBvbkVzYzogZnVuY3Rpb24gb25Fc2MoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL+G6qW4gZHJvcGRvd24gdsOgIHN0b3AgZXZlbnQgbuG6v3UgxJFhbmcgZXhwYW5kCgogICAgICBpZiAobWUuZXhwYW5kZWQpIHsKICAgICAgICBtZS5jb2xsYXBzZSgpOwogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLmNhbmNlbCA9IHRydWU7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogeOG7rSBsw70gcGjDrW0gZW50ZXINCiAgICAgKi8KICAgIG9uRW50ZXI6IGZ1bmN0aW9uIG9uRW50ZXIoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmV4cGFuZGVkICYmICFtZS5sb2FkaW5nICYmIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGggPT09IDApIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBtZS5zaG93UXVpY2tBZGQodHJ1ZSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogTeG7nyBmb3JtIHRow6ptIG5oYW5oDQogICAgICovCiAgICBzaG93UXVpY2tBZGQ6IGZ1bmN0aW9uIHNob3dRdWlja0FkZChpc2Zyb21FbnRlciwgaXNmcm9tU2hvcnRLZXkpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5leHBhbmRlZCAmJiAhbWUubG9hZGluZyAmJiBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAwIHx8IGlzZnJvbVNob3J0S2V5KSB7CiAgICAgICAgaWYgKCFtZS5xdWlja0FkZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFtZS5pc1Blcm1pc3Npb24pIHsKICAgICAgICAgIGlmICghaXNmcm9tRW50ZXIpIHsKICAgICAgICAgICAgbWUuY29sbGFwc2UoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBtZXNzYWdlQm94LnNob3dFcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLk5vdFBlcm1pc3Npb24iKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtZS5leHBhbmRlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgcGFyYW0gPSBfb2JqZWN0U3ByZWFkKHt9LCBtZS5xdWlja1NlYXJjaFBhcmFtIHx8IHt9KTsKCiAgICAgICAgaWYgKG1lLmludGVybmFsVGV4dCkgewogICAgICAgICAgcGFyYW0ucXVpY2tBZGRUZXh0ID0gbWUuaW50ZXJuYWxUZXh0OwogICAgICAgIH0KCiAgICAgICAgcG9wdXBVdGlsLnNob3cobWUsIG1lLnF1aWNrQWRkLCBwYXJhbSwgewogICAgICAgICAgLyoqDQogICAgICAgICAgICogU+G7sSBraeG7h24gY2FsbGJhY2sga2hpIHN1Ym1pdCB04burIGZvcm0gdGjDqm0gbmhhbmgNCiAgICAgICAgICAgKi8KICAgICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gc3VibWl0KHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICAgICAgICAvL3RvZG8KICAgICAgICAgICAgdmFyIHJlY29yZCA9IHJlc3VsdC5EYXRhOwoKICAgICAgICAgICAgaWYgKHJlY29yZCkgewogICAgICAgICAgICAgIGlmIChtZS5xdWVyeU1vZGUgPT09ICJyZW1vdGUiKSB7CiAgICAgICAgICAgICAgICAvL2xvYWQgbOG6oWkgcmEgxJHhu4MgcHVzaCB0aMOqbSBpY29uIHbDoG8gKGJ1ZyAxMTU4ODUgKQogICAgICAgICAgICAgICAgbWUuZG9RdWVyeUludGVybmFsKG51bGwsIGZhbHNlKTsgLy9hcHBlbmQgZGF0YSB0byBzb3VyY2UKCiAgICAgICAgICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UucHVzaChyZWNvcmQpOyAvL250cGhvbmcgMjkvNS8yMDIxIC0gdGjDqm0gYuG6o24gZ2hpIG3hu5tpIHbDoG8gc291cmNlKG7hur91IGzDoCBraeG7g3UgdHJlZSB0aMOsIHRow6ptIMSRw7puZyB24buLIHRyw60gY2hhIGNvbikKICAgICAgICAgICAgICAgIC8vbm5sYW0gMDcvMDcvMjAyMTogYSBwaG9uZyBhIGsgY2hlY2sgeGVtIGNvbWJvIGPDsyBsw6AgZOG6oW5nIHRyZWUgaGF5IGsgbcOgIGEgxJHDoyBsw6BtIHRo4bq/IG7DoHkgciDDoAoKICAgICAgICAgICAgICAgIGlmIChtZS5pc1RyZWUpIHsKICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1lLl9hbGxEYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICBtZS5fYWxsRGF0YSA9IFtdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdmFyIGlzRXhpc3RJdGVtID0gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEl0ZW0sCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JbmRleCA9IG1lLl9hbGxEYXRhLmxlbmd0aDsKCiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZS5fYWxsRGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBtZS5fYWxsRGF0YVtpXTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVttZS52YWx1ZUZpZWxkXSA9PSByZWNvcmRbbWUudmFsdWVGaWVsZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpc0V4aXN0SXRlbSA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmRbbWUucGFyZW50SWRQcm9wZXJ0eV0gJiYgaXRlbVttZS52YWx1ZUZpZWxkXSA9PSByZWNvcmRbbWUucGFyZW50SWRQcm9wZXJ0eV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJdGVtID0gaXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtSW5kZXggPSBpICsgMTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0V4aXN0SXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZFttZS5wYXJlbnRJZFByb3BlcnR5XSAmJiBwYXJlbnRJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEl0ZW0uSXNQYXJlbnQgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lLmlzVHJlZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnRJdGVtLmxldmVsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmQubGV2ZWwgPSBwYXJlbnRJdGVtLmxldmVsICsgMTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZC5wYXJlbnROb2RlID0gcGFyZW50SXRlbTsKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJlbnRJdGVtLmNoaWxkTm9kZXMgPSBbcmVjb3JkXTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIG1lLl9hbGxEYXRhLnNwbGljZShpdGVtSW5kZXgsIDAsIHJlY29yZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGV4KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBtZS5fYWxsRGF0YS5wdXNoKHJlY29yZCk7CiAgICAgICAgICAgICAgICBtZS5kb0xvY2FsUXVlcnkobnVsbCk7CiAgICAgICAgICAgICAgfSAvL3VwZGF0ZSB2YWx1ZSBhbmQgZGlzcGxheQoKCiAgICAgICAgICAgICAgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0gPSBudWxsOwogICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShyZWNvcmQpOwogICAgICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtZS52YWxpZGF0ZShtZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CiAgICAgICAgICB9LAogICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICBtZS4kcmVmcy5pbnB1dC5mb2N1cygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgY3VzdG9tUnVsZVZhbGlkYXRlUnVsZXM6IGZ1bmN0aW9uIGN1c3RvbVJ1bGVWYWxpZGF0ZVJ1bGVzKHJ1bGVzKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLnN1cGVyKCJjdXN0b21SdWxlVmFsaWRhdGVSdWxlcyIsIHJ1bGVzKTsKCiAgICAgIGlmIChtZS5mb3JjZVNlbGVjdGlvbiAmJiBydWxlcy5pbmRleE9mKCJmb3JjZVNlbGVjdGlvbiIpKSB7CiAgICAgICAgcnVsZXMucHVzaCgiZm9yY2VTZWxlY3Rpb24iKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBraGkgY2xpY2sgbsO6dCBxdWlja2FkZCBuZ2/DoGkgY29tYm8NCiAgICAgKiBOTVRVQU4yIDAzLjExLjIwMjENCiAgICAgKi8KICAgIGNvbWJvUXVpY2tBZGQ6IGZ1bmN0aW9uIGNvbWJvUXVpY2tBZGQoZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuJGVtaXQoImNvbWJvUXVpY2tBZGQiKTsKICAgIH0KICB9Cn07"},null]}
{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\VNT_vue\\src\\views\\dictionary\\employee\\Detail.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\VNT_vue\\src\\views\\dictionary\\employee\\Detail.vue","mtime":1653205086735},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCBfb2JqZWN0U3ByZWFkIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHBvcHVwVXRpbCBmcm9tICJAL2NvbW1vbnMvcG9wdXBVdGlsIjsKaW1wb3J0IG1zR3JpZFZpZXdlciBmcm9tICJAL2NvbXBvbmVudHMvbXNncmlkdmlld2VyL21zR3JpZFZpZXdlci52dWUiOwppbXBvcnQgbXNBY3RpdmUgZnJvbSAiQC9jb21wb25lbnRzL21zYWN0aXZlL21zQWN0aXZlIjsKaW1wb3J0IEJhc2VEZXRhaWxQb3B1cCBmcm9tICJAL3ZpZXdzL2Jhc2UvQmFzZURldGFpbFBvcHVwIjsKaW1wb3J0IHsgTW9kdWxlTG9jYXRpb24sIE1vZHVsZUVtcGxveWVlLCBNb2R1bGVKb2JQb3NpdGlvbiB9IGZyb20gIkAvc3RvcmVzL21vZHVsZS1jb25zdCI7CmltcG9ydCB7IGxvY2F0aW9uRGF0YSB9IGZyb20gIkAvbWl4aW5zL2NvbWJvYm94L2xvY2F0aW9uLmpzIjsKaW1wb3J0IEV2ZW50QnVzR2xvYmFsLCB7IEdsb2JhbEV2ZW50TmFtZSB9IGZyb20gIkAvY29tbW9ucy9ldmVudEJ1c0dsb2JhbCI7CmltcG9ydCBjb21tb25GbiBmcm9tICJAL2NvbW1vbnMvY29tbW9uRnVuY3Rpb24iOwppbXBvcnQgeyBkZXBhcnRtZW50TGlzdCB9IGZyb20gIkAvbWl4aW5zL2NvbWJvYm94L2RlcGFydG1lbnRMaXN0IjsKaW1wb3J0IHsgcGlja0xpc3QgfSBmcm9tICJAL21peGlucy9jb21ib2JveC9waWNrTGlzdCI7CmltcG9ydCB7IGpvYlBvc2l0aW9uU291cmNlIH0gZnJvbSAiQC9taXhpbnMvY29tYm9ib3gvam9iUG9zaXRpb24iOwppbXBvcnQgbXNEb3duTG9hZFZ1ZSBmcm9tICJAL2NvbXBvbmVudHMvbXNkb3dubG9hZC9tc0Rvd25Mb2FkLnZ1ZSI7CmltcG9ydCBBdHRhY2htZW50RGV0YWlsQVBJIGZyb20gIkAvYXBpcy9zeXN0ZW0vYXR0YWNobWVudERldGFpbEFQSS5qcyI7CmltcG9ydCBmaWxlQXBpIGZyb20gIkAvYXBpcy9zeXN0ZW0vZmlsZUFQSSI7CmltcG9ydCBQaWNrTGlzdEFQSSBmcm9tICJAL2FwaXMvZGljdGlvbmFyeS9waWNrTGlzdEFQSSI7CmltcG9ydCBNc1NpbmdsZUF0dGFjaG1lbnQgZnJvbSAiQC9jb21wb25lbnRzL21zYXR0YWNobWVudC9tc1NpbmdsZUF0dGFjaG1lbnQudnVlIjsKaW1wb3J0IEltYWdlQVBJIGZyb20gIkAvYXBpcy9zeXN0ZW0vaW1hZ2VBUEkiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkRldGFpbGVtcGxveWVlIiwKICBjb21wb25lbnRzOiB7CiAgICBtc0dyaWRWaWV3ZXI6IG1zR3JpZFZpZXdlciwKICAgIE1zU2luZ2xlQXR0YWNobWVudDogTXNTaW5nbGVBdHRhY2htZW50CiAgfSwKICBleHRlbmRzOiBCYXNlRGV0YWlsUG9wdXAsCiAgbWl4aW5zOiBbbG9jYXRpb25EYXRhLCBkZXBhcnRtZW50TGlzdCwgam9iUG9zaXRpb25Tb3VyY2UsIHBpY2tMaXN0XSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgdmFyIG1lID0gdGhpczsKICAgIG1lLnNldERhdGFDb21ibygpOwogICAgbWUuc2V0RGF0YUdyaWQoKTsKICAgIG1lLlRpbWVUeXBlSW5QZXJpb2QgPSBtZS4kbXMuY29tbW9uRm4uZ2V0RW51bVNvdXJjZSgiVGltZVR5cGVJblBlcmlvZCIpOwogICAgbWUuVGltZVR5cGVJblBlcmlvZC5zcGxpY2UoMSwgMSk7CiAgICBtZS5UaW1lVHlwZUluUGVyaW9kID0gbWUuVGltZVR5cGVJblBlcmlvZC5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgaWYgKGl0ZW0uZW51bVZhbHVlID09PSAyKSB7CiAgICAgICAgaXRlbS5lbnVtVmFsdWUgPSAxOwogICAgICB9CgogICAgICByZXR1cm4gaXRlbTsKICAgIH0pOwogICAgcmV0dXJuIHsKICAgICAgbW9kdWxlOiBNb2R1bGVFbXBsb3llZSwKICAgICAgYWN0aXZlOiBmYWxzZSwKICAgICAgaXNGdWxsU2NyZWVuOiBmYWxzZSwKICAgICAgbGlzdEl0ZW1UYWI6IFtdLAogICAgICBhY3RpdmVTdWJzeXN0ZW06ICJnZW5lcmFsSW5mbyIsCiAgICAgIGFjdGl2ZVBhcmVudFN1YnN5c3RlbTogImdlbmVyYWxJbmZvIiwKICAgICAgY2FjaGVDaGlsZHJlblRhYjogW10sCiAgICAgIHByb3ZpbmNlRGF0YTogW10sCiAgICAgIGRpc3RyaWN0RGF0YUhvbWU6IFtdLAogICAgICBkaXN0cmljdERhdGFQZXJtYW5lbnQ6IFtdLAogICAgICBkaXN0cmljdERhdGFDdXJyZW50OiBbXSwKICAgICAgd2FyZERhdGFIb21lOiBbXSwKICAgICAgd2FyZERhdGFQZXJtYW5lbnQ6IFtdLAogICAgICB3YXJkRGF0YUN1cnJlbnQ6IFtdLAogICAgICBqb2JQb3NpdGlvbjogW10sCiAgICAgIGpvYlRpdGxlOiBbXSwKICAgICAgZW1wdHlBcnI6IFtdLAogICAgICByZXdhcmRDYXRlZ29yeURldGFpbERhdGE6IFtdLAogICAgICBlbXVsYXRpb25UaXRsZURldGFpbERhdGE6IFtdLAogICAgICBhdmF0YXJVcmw6IG51bGwsCiAgICAgIGF2YXRhckZpbGU6IG51bGwsCiAgICAgIHJvd0FjdGlvbnM6IFt7CiAgICAgICAgY29tbWFuZDogIkVkaXQiLAogICAgICAgIGljb246ICJlZGl0IiwKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJpMThuQ29tbW9uLmNvbW1hbmQuZWRpdCIpCiAgICAgIH0sIHsKICAgICAgICBjb21tYW5kOiAiRGVsZXRlIiwKICAgICAgICBpY29uOiAiZGVsZXRlIiwKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJpMThuQ29tbW9uLmNvbW1hbmQuZGVsZXRlIikKICAgICAgfV0sCiAgICAgIEF0dGFjaG1lbnRSb3dBY3Rpb25zOiBbewogICAgICAgIGNvbW1hbmQ6ICJEb3dubG9hZCIsCiAgICAgICAgaWNvbjogImRvd25sb2FkIiwKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJpMThuQ29tbW9uLmNvbW1hbmQuZG93bmxvYWQiKQogICAgICB9LCB7CiAgICAgICAgY29tbWFuZDogIkRlbGV0ZSIsCiAgICAgICAgaWNvbjogImRlbGV0ZSIsCiAgICAgICAgdGV4dDogdGhpcy4kdCgiaTE4bkNvbW1vbi5jb21tYW5kLmRlbGV0ZSIpCiAgICAgIH1dLAogICAgICBsaXN0U291cmNlV29ya2luZ0RldGFpbDogW10sCiAgICAgIGxpc3RTb3VyY2VNaXNzaW9uUm9sZTogW10sCiAgICAgIGxpc3RTb3VyY2VFbXVsYXRpb25UaXRsZURldGFpbDogW10sCiAgICAgIGxpc3RTb3VyY2VSZXdhcmRDYXRlZ29yeURldGFpbDogW10sCiAgICAgIGxpc3RTb3VyY2VEaXNjaXBsaW5lRGV0YWlsOiBbXSwKICAgICAgbGlzdFNvdXJjZUFjaGlldmVtZW50SWRlYTogW10sCiAgICAgIGxpc3RTb3VyY2VBdHRhY2htZW50RGV0YWlsOiBbXSwKICAgICAgaXNPdXRTaWRlcjogZmFsc2UsCiAgICAgIGxpc3REZWxldGVBdHRhY2htZW50OiBbXSwKICAgICAgY2hhbmdlRm9ybWF0OiBudWxsLAogICAgICB0eXBlRGF0ZTogMCwKICAgICAgbGlzdFNvdXJjZUV2YWx1YXRpb25EZXRhaWw6IFtdLAogICAgICBoaWRlSW5mb3I6IGZhbHNlLAogICAgICBoaWRlRW11bGF0aW9uUmV3YXJkOiBmYWxzZSwKICAgICAgaGlkZUV2YWx1YXRpb246IGZhbHNlLAogICAgICBoaWRlQXR0YWNobWVudDogZmFsc2UsCiAgICAgIGhpZGVBY2hpZXZlbWVudElkZWE6IGZhbHNlLAogICAgICBoZWxwSWQ6ICJrbm93bGVkZ2UtYmFzZS9xdWFuLWx5LWhzY24iLAogICAgICBmaWxlU2l6ZVN1bWFyeTogMAogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICBsaXN0U291cmNlQXR0YWNobWVudERldGFpbDogZnVuY3Rpb24gbGlzdFNvdXJjZUF0dGFjaG1lbnREZXRhaWwobmV3VmFsdWUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChuZXdWYWx1ZSkgewogICAgICAgIG1lLmNhY3VsYXRlRmlsZVNpemUoKTsKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICBtZS5nZXRQcm92aW5jZURhdGEoKTsKICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIHZhciBtZSA9IHRoaXM7CiAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICB2YXIgaXRlbSA9IG1lLmdldEN1cnJlbnRJdGVtKCk7CgogICAgICBpZiAobWUuZWRpdE1vZGUgPT0gbWUuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQpIHsKICAgICAgICBtZS50aXRsZSA9ICJT4butYSBo4buTIHPGoSB0aMOgbmggdMOtY2ggIiArIChpdGVtLkZ1bGxOYW1lID8gImPhu6dhICIgKyBpdGVtLkZ1bGxOYW1lIDogIiIpOwogICAgICB9IGVsc2UgewogICAgICAgIG1lLnRpdGxlID0gIlRow6ptIG3hu5tpIGjhu5Mgc8ahIHRow6BuaCB0w61jaCI7CiAgICAgIH0KCiAgICAgIG1lLmdldERpc3RyaWN0QnlQcm92aW5jZUlEKGl0ZW0uSG9tZVByb3ZpbmNlLCAxKTsKICAgICAgbWUuZ2V0RGlzdHJpY3RCeVByb3ZpbmNlSUQoaXRlbS5QZXJtYW5lbnRQcm92aW5jZSwgMik7CiAgICAgIG1lLmdldERpc3RyaWN0QnlQcm92aW5jZUlEKGl0ZW0uQ3VycmVudFByb3ZpbmNlLCAzKTsKICAgICAgbWUuZ2V0V2FyZEJ5RGlzdHJpY3RJRChpdGVtLkhvbWVEaXN0cmljdCwgMSk7CiAgICAgIG1lLmdldFdhcmRCeURpc3RyaWN0SUQoaXRlbS5QZXJtYW5lbnREaXN0cmljdCwgMik7CiAgICAgIG1lLmdldFdhcmRCeURpc3RyaWN0SUQoaXRlbS5DdXJyZW50RGlzdHJpY3QsIDMpOwogICAgfSk7IC8vc2V0IGzhuqFpIHbhu4sgdHLDrSBj4bunYSBjw6FjIHRhYiDEkeG7gyBzY3JvbGwgeOG7i24KCiAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICB2YXIgY29udGFpbmVySW5mbyA9IF90aGlzLiRyZWZzWyJlbXBsb3llZS1kZXRhaWwiXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgIHZhciB0b3RhbEhlaWdodCA9IDA7CiAgICAgIG1lLmxpc3RJdGVtVGFiLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAvL0zhuqV5IHbhu4sgdHLDrSBkaXYgY+G6p24gc2Nyb2xsCiAgICAgICAgdmFyIHRhcmdldCA9IGl0ZW0uU2Nyb2xsVGFyZ2V0OwoKICAgICAgICBpZiAodGFyZ2V0KSB7CiAgICAgICAgICB2YXIgcGFuZWwgPSBtZS4kcmVmc1t0YXJnZXRdOwoKICAgICAgICAgIGlmIChwYW5lbCkgewogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYW5lbCkgJiYgcGFuZWwubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHBhbmVsID0gcGFuZWxbMF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpbmZvID0gcGFuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGl0ZW0uU2Nyb2xsVG9wID0gaW5mby50b3AgLSBjb250YWluZXJJbmZvLnRvcDsKICAgICAgICAgICAgdG90YWxIZWlnaHQgKz0gaW5mby5oZWlnaHQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaXRlbS5DaGlsZHJlbiAmJiBpdGVtLkNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgIGl0ZW0uQ2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgLy9M4bqleSB24buLIHRyw60gZGl2IGPhuqduIHNjcm9sbAogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gY2hpbGQuU2Nyb2xsVGFyZ2V0OwoKICAgICAgICAgICAgaWYgKHRhcmdldCkgewogICAgICAgICAgICAgIHZhciBfcGFuZWwgPSBtZS4kcmVmc1t0YXJnZXRdOwoKICAgICAgICAgICAgICBpZiAoX3BhbmVsKSB7CiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShfcGFuZWwpICYmIF9wYW5lbC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIF9wYW5lbCA9IF9wYW5lbFswXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgX2luZm8gPSBfcGFuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgogICAgICAgICAgICAgICAgY2hpbGQuU2Nyb2xsVG9wID0gX2luZm8udG9wIC0gY29udGFpbmVySW5mby50b3A7CiAgICAgICAgICAgICAgICB0b3RhbEhlaWdodCArPSBfaW5mby5oZWlnaHQ7CiAgICAgICAgICAgICAgfSAvL0NhY2hlIGzhuqFpIGxpc3QgY8OhYyBjaGlsZHJlbgoKCiAgICAgICAgICAgICAgbWUuY2FjaGVDaGlsZHJlblRhYi5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLmNhY2hlQ2hpbGRyZW5UYWIucHVzaChpdGVtKTsKICAgICAgICB9IC8vVEROR0hJQSA2LzQvMjAyMTogc2F1IGtoaSBzZXQgduG7iyB0csOtIGNobyBjw6FjIG1lbnUgbeG7m2kgdGh1IGfhu41uIG1lbnUgbOG6oWkKCgogICAgICAgIG1lLmhpZGVJbmZvciA9IGZhbHNlOwogICAgICAgIG1lLmhpZGVFbXVsYXRpb25SZXdhcmQgPSB0cnVlOwogICAgICAgIG1lLmhpZGVFdmFsdWF0aW9uID0gdHJ1ZTsKICAgICAgICBtZS5oaWRlQXR0YWNobWVudCA9IHRydWU7CiAgICAgICAgbWUuaGlkZUFjaGlldmVtZW50SWRlYSA9IHRydWU7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRFbnRpdHlUeXBlOiBmdW5jdGlvbiBnZXRFbnRpdHlUeXBlKCkgewogICAgICByZXR1cm4gImRldGFpbGVtcGxveWVlIjsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIHRyxrDhu5tjIGtoaSBzaG93cG9wdXANCiAgICAgKiBEw7luZyDEkeG7gyBmb3JtIHThu7Egb3ZlcmlkZSBs4bqhaSB0aGVvIG5naGnhu4dwIHbhu6UgdMawxqFuZyDhu6luZw0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQgMjIuMDYuMjAyMA0KICAgICAqLwogICAgYmVmb3JlU2hvd1BvcHVwOiBmdW5jdGlvbiBiZWZvcmVTaG93UG9wdXAocGFyYW0pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuaXNPdXRTaWRlciA9IG1lLm9wdGlvbnMuaXNPdXRTaWRlcjsKICAgICAgbWUuaXNGdWxsU2NyZWVuID0gbWUub3B0aW9ucy5pc0Z1bGxTY3JlZW4gPT0gdHJ1ZSA/IHRydWUgOiBtZS5pc0Z1bGxTY3JlZW47CiAgICAgIG1lLnNldE1lbnVUYWIoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ3VzdG9tIGzhuqFpIGN1cnJlbnRJdGVtIHRyxrDhu5tjIGtoaSBkw7luZyDEkeG7gyBiaW5kIGThu68gbGnhu4d1IHbDoCDDqXAga2nhu4N1IEpTT04gdGjDoG5oIE9iamVjdA0KICAgICAqIFRETkdISSAyMi85LzIwMjENCiAgICAgKi8KICAgIGJlZm9yZUJpbmREYXRhOiBmdW5jdGlvbiBiZWZvcmVCaW5kRGF0YSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuY3VycmVudEl0ZW0uRGF0ZU9mQmlydGggPSBtZS5jdXJyZW50SXRlbS5EYXRlT2ZCaXJ0aCA9PT0gIiIgPyBudWxsIDogbWUuY3VycmVudEl0ZW0uRGF0ZU9mQmlydGg7CiAgICAgIG1lLmxpc3RTb3VyY2VXb3JraW5nRGV0YWlsID0gdGhpcy4kbXMuY29tbW9uRm4uc29ydEFycmF5KHRoaXMuJG1zLmVudW0uU29ydFN0YXR1cy5kZXNjLCBKU09OLnBhcnNlKG1lLmN1cnJlbnRJdGVtLldvcmtpbmdEZXRhaWwpLCAiVG9EYXRlIik7CiAgICAgIG1lLmxpc3RTb3VyY2VNaXNzaW9uUm9sZSA9IEpTT04ucGFyc2UobWUuY3VycmVudEl0ZW0uTWlzc2lvblJvbGUpOwogICAgICBtZS5saXN0U291cmNlQWNoaWV2ZW1lbnRJZGVhID0gSlNPTi5wYXJzZShtZS5jdXJyZW50SXRlbS5BY2hpZXZlbWVudElkZWEpOwogICAgICBtZS5saXN0U291cmNlRXZhbHVhdGlvbkRldGFpbCA9IEpTT04ucGFyc2UobWUuY3VycmVudEl0ZW0uRXZhbHVhdGlvbkRldGFpbCk7CiAgICAgIG1lLmxpc3RTb3VyY2VFbXVsYXRpb25UaXRsZURldGFpbCA9IEpTT04ucGFyc2UobWUuY3VycmVudEl0ZW0uRW11bGF0aW9uVGl0bGVEZXRhaWwpOwogICAgICBtZS5saXN0U291cmNlUmV3YXJkQ2F0ZWdvcnlEZXRhaWwgPSBKU09OLnBhcnNlKG1lLmN1cnJlbnRJdGVtLlJld2FyZENhdGVnb3J5RGV0YWlsKTsgLy9LaGkgbOG6pXkgdHLDqm4gZGIgduG7gSA9PiBnw6FuIHRy4bqhbmcgdGjDoWkgY+G7p2EgYuG6o24gZ2hpIGF0dGFjaG1lbnQgbMOgIHVwZGF0ZSBOVERJRU0gMjMuMTEuMjAyMQoKICAgICAgbWUuY3VycmVudEl0ZW0uQXR0YWNobWVudERldGFpbC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaXRlbS5FbnRpdHlTdGF0ZSA9IG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuVXBkYXRlOwogICAgICB9KTsKICAgICAgbWUubGlzdFNvdXJjZUF0dGFjaG1lbnREZXRhaWwgPSBtZS5jdXJyZW50SXRlbS5BdHRhY2htZW50RGV0YWlsOwogICAgICBtZS5saXN0U291cmNlRGlzY2lwbGluZURldGFpbCA9IEpTT04ucGFyc2UobWUuY3VycmVudEl0ZW0uRGlzY2lwbGluZURldGFpbCk7CiAgICAgIG1lLmN1cnJlbnRJdGVtLklzT3V0U2lkZXIgPSBtZS5pc091dFNpZGVyOwoKICAgICAgaWYgKCFtZS5jdXJyZW50SXRlbS5Pcmdhbml6YXRpb25OYW1lICYmICFtZS5pc091dFNpZGVyKSB7CiAgICAgICAgbWUuY3VycmVudEl0ZW0uT3JnYW5pemF0aW9uTmFtZSA9IG1lLmNvbnRleHQuT3JnYW5pemF0aW9uLk9yZ2FuaXphdGlvbk5hbWU7CiAgICAgIH0KCiAgICAgIGlmIChtZS5lZGl0TW9kZSA9PT0gbWUuJG1zLmVudW0uRm9ybVN0YXRlLkFkZCkgewogICAgICAgIG1lLiRyZWZzLmNib0pvYlBvc2l0aW9uLnJlc2V0KCk7CiAgICAgICAgbWUuJHJlZnMuY2JvSm9iVGl0bGUucmVzZXQoKTsgLy8gTk1UVUFOMyAyLzEyLzIwMjE6IHRow6ptIGNoZWNrIHThu5NuIHThuqFpIHbDrCByZWYgbsOgeSBraMO0bmcgY8OzIGtoaSB0aMOqbSBjw6EgbmjDom4gbmdvw6BpIMSRxqFuIHbhu4sKCiAgICAgICAgaWYgKG1lLiRyZWZzLmNib0RlcGFydG1lbnQpIHsKICAgICAgICAgIG1lLiRyZWZzLmNib0RlcGFydG1lbnQucmVzZXQoKTsKICAgICAgICB9CgogICAgICAgIG1lLmN1cnJlbnRJdGVtLkdlbmRlciA9IDE7IC8vZGVmYXVsdCBsw7pjIHRow6ptIG3hu5tpIG3DoCBjaMawYSBjw7MgZW1wbG95ZWVDb2RlIHRow6wgY2hvICA9IFNIQ0IwMDAxCgogICAgICAgIG1lLmN1cnJlbnRJdGVtLkVtcGxveWVlQ29kZSA9IG1lLmN1cnJlbnRJdGVtLkVtcGxveWVlQ29kZSA/IG1lLmN1cnJlbnRJdGVtLkVtcGxveWVlQ29kZSA6ICJTSENCMDAwMSI7CiAgICAgIH0KCiAgICAgIG1lLmN1cnJlbnRJdGVtLkF0dGFjaG1lbnRDaGFuZ2VzID0gW107CgogICAgICBpZiAobWUuY3VycmVudEl0ZW0uRGF0ZU9mQmlydGggIT09IG51bGwpIHsKICAgICAgICBtZS5jdXJyZW50SXRlbS5UaW1lVHlwZSA9PT0gbnVsbCA/IG1lLmN1cnJlbnRJdGVtLkRhdGVPZkJpcnRoLmxlbmd0aCA+IDAgJiYgbWUuY3VycmVudEl0ZW0uRGF0ZU9mQmlydGgubGVuZ3RoID09PSA0ID8gbWUuY3VycmVudEl0ZW0uVGltZVR5cGUgPSAxIDogbWUuY3VycmVudEl0ZW0uVGltZVR5cGUgPSAwIDogbWUuY3VycmVudEl0ZW0uVGltZVR5cGU7CgogICAgICAgIGlmIChtZS5jdXJyZW50SXRlbS5UaW1lVHlwZSA9PT0gMCkgewogICAgICAgICAgbWUuY3VycmVudEl0ZW0uRGF0ZU9mQmlydGggPSBtZS4kbXMuY29tbW9uRm4uY29udmVydFN0cmluZ1RvRGF0ZShtZS5jdXJyZW50SXRlbS5EYXRlT2ZCaXJ0aCwgIi8iLCAxKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWUuY3VycmVudEl0ZW0uVGltZVR5cGUgPSBtZS5jdXJyZW50SXRlbS5UaW1lVHlwZSA9PT0gbnVsbCA/IDAgOiBtZS5jdXJyZW50SXRlbS5UaW1lVHlwZTsKICAgICAgfSAvL0zhuqV5IGF2YXRhciBOVERJRU0gMTcvMDMvMjAyMgoKCiAgICAgIG1lLnNldEF2YXRhcigpOwogICAgfSwKICAgIGdldEF1dG9JRDogZnVuY3Rpb24gZ2V0QXV0b0lEKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHJlc3VsdCwgbWU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmVzdWx0ID0gIiIsIG1lID0gX3RoaXMyOwogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDE7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KG1lLm1vZHVsZSwgIi9nZXRBdXRvSUQiKSk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQucHJldiA9IDc7CiAgICAgICAgICAgICAgICBfY29udGV4dC50MCA9IF9jb250ZXh0WyJjYXRjaCJdKDEpOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihfY29udGV4dC50MCk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCByZXN1bHQpOwoKICAgICAgICAgICAgICBjYXNlIDExOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgbnVsbCwgW1sxLCA3XV0pOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogVGjhu7FjIGhp4buHbiBnw6FuIGRhdGEgdsOgIGNvbHVtbnMgY2hvIGPDoWMgYuG6o25nDQogICAgICogVEROR0hJQSAyMS85LzIwMjENCiAgICAgKi8KICAgIHNldERhdGFHcmlkOiBmdW5jdGlvbiBzZXREYXRhR3JpZCgpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9C4bqjbmcgcXXDoSB0csOsbmggY8O0bmcgdMOhYwoKICAgICAgbWUuY29sdW1uV29ya2luZ0RldGFpbCA9IFt7CiAgICAgICAgY2FwdGlvbjogIlRo4budaSBnaWFuIiwKICAgICAgICBkYXRhRmllbGQ6ICJXb3JraW5nVGltZSIsCiAgICAgICAgd2lkdGg6IDE2MCwKICAgICAgICBhdXRvUmVzaXplOiBmYWxzZSwKICAgICAgICBhbGlnbjogImNlbnRlciIKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICLEkMahbiB24buLIiwKICAgICAgICBkYXRhRmllbGQ6ICJPcmdhbml6YXRpb25OYW1lIiwKICAgICAgICB3aWR0aDogMjAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJQaMOybmcgYmFuIiwKICAgICAgICBkYXRhRmllbGQ6ICJEZXBhcnRtZW50TmFtZSIsCiAgICAgICAgd2lkdGg6IDE1MCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiQ2jhu6ljIHbhu6UiLAogICAgICAgIGRhdGFGaWVsZDogIkpvYlBvc2l0aW9uTmFtZSIsCiAgICAgICAgd2lkdGg6IDExMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiQ2jhu6ljIGRhbmgiLAogICAgICAgIGRhdGFGaWVsZDogIkpvYlRpdGxlTmFtZSIsCiAgICAgICAgd2lkdGg6IDExMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH1dOyAvL0LhuqNuZyBxdXnhu4FuIGjhuqFuCgogICAgICBtZS5jb2x1bW5NaXNzaW9uUm9sZSA9IFt7CiAgICAgICAgY2FwdGlvbjogIk7Eg20iLAogICAgICAgIGRhdGFGaWVsZDogIlllYXIiLAogICAgICAgIHdpZHRoOiAxMDAsCiAgICAgICAgYXV0b1Jlc2l6ZTogZmFsc2UsCiAgICAgICAgYWxpZ246ICJyaWdodCIKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJRdXnhu4FuIGjhuqFuLCBuaGnhu4dtIHbhu6UgxJHGsOG7o2MgZ2lhbyIsCiAgICAgICAgZGF0YUZpZWxkOiAiUm9sZU5hbWUiLAogICAgICAgIHdpZHRoOiAyMDAsCiAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZQogICAgICB9XTsgLy9C4bqjbmcgdGjDoG5oIHTDrWNoCgogICAgICBtZS5jb2x1bW5BY2hpZXZlbWVudElkZWEgPSBbewogICAgICAgIGNhcHRpb246ICJO4buZaSBkdW5nIHPDoW5nIGtp4bq/biIsCiAgICAgICAgZGF0YUZpZWxkOiAiSW52ZW50TmFtZSIsCiAgICAgICAgd2lkdGg6IDQwMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiTsSDbSDEkeG6oXQiLAogICAgICAgIGRhdGFGaWVsZDogIlllYXIiLAogICAgICAgIHdpZHRoOiAxMDAsCiAgICAgICAgYXV0b1Jlc2l6ZTogZmFsc2UsCiAgICAgICAgYWxpZ246ICJyaWdodCIKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJD4bqlcCBjw7RuZyBuaOG6rW4iLAogICAgICAgIGRhdGFGaWVsZDogIkxldmVsIiwKICAgICAgICBlbnVtOiAiSW52ZW50QXBwcm92ZUxldmVsIiwKICAgICAgICBmb3JtYXRUeXBlOiBtZS4kbXMuZW51bS5Gb3JtYXRUeXBlLkVudW0sCiAgICAgICAgd2lkdGg6IDIwMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiVOG7h3AgxJHDrW5oIGvDqG0iLAogICAgICAgIGRhdGFGaWVsZDogIkF0dGFjaG1lbnROYW1lIiwKICAgICAgICB3aWR0aDogMzAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUsCiAgICAgICAgdGVtcGxhdGU6IG1zRG93bkxvYWRWdWUsCiAgICAgICAgY2xzQ3VzdG9tOiAiYmx1ZS10ZXh0IgogICAgICB9XTsgLy9i4bqjbmcgZGFuaCBoaeG7h3UgdGhpIMSRdWEKCiAgICAgIG1lLmVtdWxhdGlvblRpdGxlQ29sdW1ucyA9IFt7CiAgICAgICAgY2FwdGlvbjogIk7Eg20gxJHhuqF0IGRhbmggaGnhu4d1IiwKICAgICAgICBkYXRhRmllbGQ6ICJZZWFyIiwKICAgICAgICB3aWR0aDogMTgwLAogICAgICAgIGF1dG9SZXNpemU6IGZhbHNlLAogICAgICAgIGFsaWduOiAicmlnaHQiCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiRGFuaCBoaeG7h3UgdGhpIMSRdWEiLAogICAgICAgIGRhdGFGaWVsZDogIkVtdWxhdGlvblRpdGxlTmFtZSIsCiAgICAgICAgd2lkdGg6IDIwMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiU+G7kSBxdXnhur90IMSR4buLbmgiLAogICAgICAgIGRhdGFGaWVsZDogIk51bWJlciIsCiAgICAgICAgd2lkdGg6IDE1MCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiTmfDoHkgcXV54bq/dCDEkeG7i25oIiwKICAgICAgICBkYXRhRmllbGQ6ICJEYXRlIiwKICAgICAgICBmb3JtYXRUeXBlOiB0aGlzLiRtcy5lbnVtLkZvcm1hdFR5cGUuRGF0ZSwKICAgICAgICB3aWR0aDogMTUwLAogICAgICAgIGF1dG9SZXNpemU6IGZhbHNlLAogICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIkPGoSBxdWFuIHJhIHF1eeG6v3QgxJHhu4tuaCIsCiAgICAgICAgZGF0YUZpZWxkOiAiT3JnYW5pemF0aW9uQmVsb25nIiwKICAgICAgICB3aWR0aDogMjAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJU4buHcCDEkcOtbmgga8OobSIsCiAgICAgICAgZGF0YUZpZWxkOiAiQXR0YWNobWVudE5hbWUiLAogICAgICAgIHdpZHRoOiAzMDAsCiAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZTogbXNEb3duTG9hZFZ1ZSwKICAgICAgICBjbHNDdXN0b206ICJibHVlLXRleHQiCiAgICAgIH1dOyAvL0LhuqNuZyBow6xuaCB0aOG7qWMga2hlbiB0aMaw4bufbmcKCiAgICAgIG1lLnJld2FyZENhdGVnb3J5Q29sdW1ucyA9IFt7CiAgICAgICAgY2FwdGlvbjogIk7Eg20gxJHGsOG7o2Mga2hlbiB0aMaw4bufbmciLAogICAgICAgIGRhdGFGaWVsZDogIlllYXIiLAogICAgICAgIHdpZHRoOiAxODAsCiAgICAgICAgYXV0b1Jlc2l6ZTogZmFsc2UsCiAgICAgICAgYWxpZ246ICJyaWdodCIKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJIw6xuaCB0aOG7qWMga2hlbiB0aMaw4bufbmciLAogICAgICAgIGRhdGFGaWVsZDogIlJld2FyZENhdGVnb3J5TmFtZSIsCiAgICAgICAgd2lkdGg6IDIwMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiU+G7kSBxdXnhur90IMSR4buLbmgiLAogICAgICAgIGRhdGFGaWVsZDogIk51bWJlciIsCiAgICAgICAgd2lkdGg6IDE1MCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiTmfDoHkgcXV54bq/dCDEkeG7i25oIiwKICAgICAgICBkYXRhRmllbGQ6ICJEYXRlIiwKICAgICAgICBmb3JtYXRUeXBlOiB0aGlzLiRtcy5lbnVtLkZvcm1hdFR5cGUuRGF0ZSwKICAgICAgICB3aWR0aDogMTUwLAogICAgICAgIGF1dG9SZXNpemU6IGZhbHNlLAogICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIkPGoSBxdWFuIHJhIHF1eeG6v3QgxJHhu4tuaCIsCiAgICAgICAgZGF0YUZpZWxkOiAiT3JnYW5pemF0aW9uQmVsb25nIiwKICAgICAgICB3aWR0aDogMjAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJU4buHcCDEkcOtbmgga8OobSIsCiAgICAgICAgZGF0YUZpZWxkOiAiQXR0YWNobWVudE5hbWUiLAogICAgICAgIHdpZHRoOiAzMDAsCiAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZSwKICAgICAgICB0ZW1wbGF0ZTogbXNEb3duTG9hZFZ1ZSwKICAgICAgICBjbHNDdXN0b206ICJibHVlLXRleHQiCiAgICAgIH1dOyAvL0vhu7cgbHXhuq10CgogICAgICBtZS5jb2x1bW5zRGlzY2lwbGluZURldGFpbCA9IFt7CiAgICAgICAgY2FwdGlvbjogIk7hu5lpIGR1bmcga+G7tyBsdeG6rXQiLAogICAgICAgIGRhdGFGaWVsZDogIkRpc2NpcGxpbmVDb250ZW50IiwKICAgICAgICB3aWR0aDogMTIwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJIw6xuaCB0aOG7qWMga+G7tyBsdeG6rXQiLAogICAgICAgIGRhdGFGaWVsZDogIkRpc2NpcGxpbmVUeXBlIiwKICAgICAgICB3aWR0aDogMTIwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJOZ8OgeSBoaeG7h3UgbOG7sWMiLAogICAgICAgIGRhdGFGaWVsZDogIkZyb21EYXRlIiwKICAgICAgICBmb3JtYXRUeXBlOiB0aGlzLiRtcy5lbnVtLkZvcm1hdFR5cGUuRGF0ZSwKICAgICAgICB3aWR0aDogMTIwLAogICAgICAgIGF1dG9SZXNpemU6IGZhbHNlLAogICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIk5nw6B5IGjhur90IGhp4buHdSBs4buxYyIsCiAgICAgICAgZm9ybWF0VHlwZTogdGhpcy4kbXMuZW51bS5Gb3JtYXRUeXBlLkRhdGUsCiAgICAgICAgZGF0YUZpZWxkOiAiVG9EYXRlIiwKICAgICAgICB3aWR0aDogMTQwLAogICAgICAgIGF1dG9SZXNpemU6IGZhbHNlLAogICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIlPhu5EgcXV54bq/dCDEkeG7i25oIiwKICAgICAgICBkYXRhRmllbGQ6ICJOdW1iZXIiLAogICAgICAgIHdpZHRoOiAxMjAsCiAgICAgICAgYXV0b1Jlc2l6ZTogZmFsc2UKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJDxqEgcXVhbiByYSBxdXnhur90IMSR4buLbmgiLAogICAgICAgIGRhdGFGaWVsZDogIk9yZ2FuaXphdGlvbkJlbG9uZyIsCiAgICAgICAgd2lkdGg6IDEyMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiVOG7h3AgxJHDrW5oIGvDqG0iLAogICAgICAgIGRhdGFGaWVsZDogIkF0dGFjaG1lbnROYW1lIiwKICAgICAgICB3aWR0aDogMzAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUsCiAgICAgICAgdGVtcGxhdGU6IG1zRG93bkxvYWRWdWUsCiAgICAgICAgY2xzQ3VzdG9tOiAiYmx1ZS10ZXh0IgogICAgICB9XTsgLy9C4bqjbmcgxJHDoW5oIGdpw6EsIHjhur9wIGxv4bqhaQoKICAgICAgbWUuY29sdW1uRXZhbHVhdGlvbkRldGFpbCA9IFt7CiAgICAgICAgY2FwdGlvbjogIlPhu5EgcXV54bq/dCDEkeG7i25oIiwKICAgICAgICBkYXRhRmllbGQ6ICJOdW1iZXIiLAogICAgICAgIHdpZHRoOiAxNTAsCiAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIk5nw6B5IHF1eeG6v3QgxJHhu4tuaCIsCiAgICAgICAgZGF0YUZpZWxkOiAiRGF0ZSIsCiAgICAgICAgZm9ybWF0VHlwZTogdGhpcy4kbXMuZW51bS5Gb3JtYXRUeXBlLkRhdGUsCiAgICAgICAgd2lkdGg6IDE1MCwKICAgICAgICBhdXRvUmVzaXplOiBmYWxzZSwKICAgICAgICBhbGlnbjogImNlbnRlciIKICAgICAgfSwgewogICAgICAgIGNhcHRpb246ICJOxINtIMSRw6FuaCBnacOhIiwKICAgICAgICBkYXRhRmllbGQ6ICJZZWFyIiwKICAgICAgICB3aWR0aDogMTIwLAogICAgICAgIGF1dG9SZXNpemU6IGZhbHNlLAogICAgICAgIGFsaWduOiAicmlnaHQiCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiS+G6v3QgcXXhuqMgxJHDoW5oIGdpw6EiLAogICAgICAgIGRhdGFGaWVsZDogIkV2YWx1YXRpb25JRCIsCiAgICAgICAgZW51bTogIkV2YWx1YXRpb25SZXN1bHQiLAogICAgICAgIGZvcm1hdFR5cGU6IG1lLiRtcy5lbnVtLkZvcm1hdFR5cGUuRW51bSwKICAgICAgICB3aWR0aDogMjAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfSAvLyB7CiAgICAgIC8vICAgY2FwdGlvbjogIlThu4dwIMSRw61uaCBrw6htIiwKICAgICAgLy8gICBkYXRhRmllbGQ6ICJBdHRhY2htZW50TmFtZSIsCiAgICAgIC8vICAgd2lkdGg6IDMwMCwKICAgICAgLy8gICBhdXRvUmVzaXplOiB0cnVlLAogICAgICAvLyAgIHRlbXBsYXRlOiBtc0Rvd25Mb2FkVnVlLAogICAgICAvLyAgIGNsc0N1c3RvbTogImJsdWUtdGV4dCIsCiAgICAgIC8vIH0sCiAgICAgIF07IC8vdMOgaSBsaeG7h3UgxJHDrW5oIGvDqG0KCiAgICAgIG1lLmF0dGFjaG1lbnRDb2x1bW5zID0gW3sKICAgICAgICBjYXB0aW9uOiAiVMOqbiB0w6BpIGxp4buHdSIsCiAgICAgICAgZGF0YUZpZWxkOiAiTmFtZSIsCiAgICAgICAgd2lkdGg6IDMwMCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBjYXB0aW9uOiAiVOG7h3AgxJHDrW5oIGvDqG0iLAogICAgICAgIGRhdGFGaWVsZDogIkF0dGFjaG1lbnROYW1lIiwKICAgICAgICB3aWR0aDogMzAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUsCiAgICAgICAgdGVtcGxhdGU6IG1zRG93bkxvYWRWdWUsCiAgICAgICAgY2xzQ3VzdG9tOiAiYmx1ZS10ZXh0IgogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIk5nxrDhu51pIMSRw61uaCBrw6htIiwKICAgICAgICBkYXRhRmllbGQ6ICJBdXRob3IiLAogICAgICAgIHdpZHRoOiAxNTAsCiAgICAgICAgYXV0b1Jlc2l6ZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIk5nw6B5IMSRw61uaCBrw6htIiwKICAgICAgICBkYXRhRmllbGQ6ICJDcmVhdGVkRGF0ZSIsCiAgICAgICAgZm9ybWF0VHlwZTogdGhpcy4kbXMuZW51bS5Gb3JtYXRUeXBlLkRhdGUsCiAgICAgICAgd2lkdGg6IDE0MCwKICAgICAgICBhdXRvUmVzaXplOiB0cnVlLAogICAgICAgIGFsaWduOiAiY2VudGVyIgogICAgICB9LCB7CiAgICAgICAgY2FwdGlvbjogIkR1bmcgbMaw4bujbmciLAogICAgICAgIGRhdGFGaWVsZDogIkZpbGVTaXplIiwKICAgICAgICB3aWR0aDogMTAwLAogICAgICAgIGF1dG9SZXNpemU6IHRydWUKICAgICAgfV07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNldCBjw6FjIGdpw6EgdHLhu4sgY2hvIGNvbWJvIGJhbiDEkeG6p3UNCiAgICAgKiDEkGFuZyBmYWtlIGThu68gbGnhu4d1DQogICAgICogVEROR0hJQSAyMC85LzIwMjENCiAgICAgKi8KICAgIHNldERhdGFDb21ibzogZnVuY3Rpb24gc2V0RGF0YUNvbWJvKCkgewogICAgICB0aGlzLmNib0dlbmRlckRhdGEgPSBbewogICAgICAgIEdlbmRlcjogMSwKICAgICAgICBHZW5kZXJOYW1lOiAiTmFtIgogICAgICB9LCB7CiAgICAgICAgR2VuZGVyOiAwLAogICAgICAgIEdlbmRlck5hbWU6ICJO4buvIgogICAgICB9XTsgLy9zZXQgY29tYm8gdHLDrG5oIMSR4buZIGNodXnDqm4gbcO0bgoKICAgICAgdGhpcy5jYm9RdWFsaWZpY2F0aW9uID0gdGhpcy4kdCgiaTE4blBpY2tMaXN0RGF0YS5RdWFsaWZpY2F0aW9uIik7IC8vc2V0IGNvbWJvIGNo4bupYyB24bulIGNo4bupYyBkYW5oCgogICAgICB0aGlzLmNib0pvYkRhdGEgPSBbewogICAgICAgIElEOiAxLAogICAgICAgIE5hbWU6ICJHacOhbSDEkeG7kWMiCiAgICAgIH0sIHsKICAgICAgICBJRDogMiwKICAgICAgICBOYW1lOiAiTmjDom4gdmnDqm4iCiAgICAgIH0sIHsKICAgICAgICBJRDogMywKICAgICAgICBOYW1lOiAiVGjGsCBrw70iCiAgICAgIH1dOyAvL3NldCBjb21ibyBo4buNYyBow6BtCgogICAgICB0aGlzLmNib0FjYWRlbWljUmFuayA9IHRoaXMuJHQoImkxOG5QaWNrTGlzdERhdGEuQWNhZGVtaWNhUmFuayIpOyAvL3NldCBjb21ibyBo4buNYyB24buLCgogICAgICB0aGlzLmNib0FjYWRlbWljVGl0bGUgPSB0aGlzLiR0KCJpMThuUGlja0xpc3REYXRhLkFjYWRlbWljYVRpdGxlIik7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFPhu7Ega2nhu4duIHNlbGVjdCBtZW51dGFiDQogICAgICogVEROR0hJQSAyMC85LzIwMjENCiAgICAgKi8KICAgIG1lbnVJdGVtT25DbGljazogZnVuY3Rpb24gbWVudUl0ZW1PbkNsaWNrKGl0ZW0pIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKGl0ZW0uU3ViU3lzdGVtQ29kZSAhPT0gbWUuYWN0aXZlU3Vic3lzdGVtICYmIGl0ZW0uU3ViU3lzdGVtQ29kZSAhPSAib3RoZXIiKSB7CiAgICAgICAgLy9LaeG7g20gdHJhIHhlbSBjw7MgcGjhuqNpIGzDoCBub2RlIGNoYSBraMO0bmcKICAgICAgICBpZiAoaXRlbS5pc1BhcmVudCkgewogICAgICAgICAgLy9O4bq/dSBsw6Agbm9kZSBjaGEKICAgICAgICAgIG1lLmFjdGl2ZVBhcmVudFN1YnN5c3RlbSA9IGl0ZW0uU3ViU3lzdGVtQ29kZTsKICAgICAgICAgIG1lLmFjdGl2ZVN1YnN5c3RlbSA9IGl0ZW0uQ2hpbGRyZW4gPyBpdGVtLkNoaWxkcmVuWzBdLlN1YlN5c3RlbUNvZGUgOiBpdGVtLlN1YlN5c3RlbUNvZGU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vTuG6v3UgbMOgIG5vZGVlIGNvbgogICAgICAgICAgbWUuYWN0aXZlUGFyZW50U3Vic3lzdGVtID0gaXRlbS5QYXJlbnRTdWJTeXN0ZW1Db2RlOwogICAgICAgICAgbWUuYWN0aXZlU3Vic3lzdGVtID0gaXRlbS5TdWJTeXN0ZW1Db2RlOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1lbnVJbmRleCA9IG1lLmNhY2hlQ2hpbGRyZW5UYWIuaW5kZXhPZihpdGVtKTsgLy9URE5HSElBIDYvNC8yMDIyOiBjYXNlIHbhu4sgdHLDrSBj4bunYSBtZW51IMSR4buDIG3hu58gZm9ybSByw7p0IGfhu41uIGNobyDEkcO6bmcKCiAgICAgICAgaWYgKG1lbnVJbmRleCA9PSAxMykgewogICAgICAgICAgLy8gbWUuaGlkZUVtdWxhdGlvblJld2FyZCA9IGZhbHNlOwogICAgICAgICAgLy8gbWUuaGlkZUV2YWx1YXRpb24gPSBmYWxzZTsKICAgICAgICAgIG1lLmhpZGVBdHRhY2htZW50ID0gZmFsc2U7IC8vIG1lLmhpZGVBY2hpZXZlbWVudElkZWEgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIGlmIChtZW51SW5kZXggPT0gMTIpIHsKICAgICAgICAgIC8vbWUuaGlkZUVtdWxhdGlvblJld2FyZCA9IGZhbHNlOwogICAgICAgICAgbWUuaGlkZUV2YWx1YXRpb24gPSBmYWxzZTsgLy9tZS5oaWRlQWNoaWV2ZW1lbnRJZGVhID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAobWVudUluZGV4IDwgMTIgJiYgbWVudUluZGV4ID49IDkpIHsKICAgICAgICAgIG1lLmhpZGVFbXVsYXRpb25SZXdhcmQgPSBmYWxzZTsgLy9tZS5oaWRlQWNoaWV2ZW1lbnRJZGVhID0gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAobWVudUluZGV4IDwgOSAmJiBtZW51SW5kZXggPj0gNSkgewogICAgICAgICAgbWUuaGlkZUFjaGlldmVtZW50SWRlYSA9IGZhbHNlOwogICAgICAgIH0gLy9O4bq/dSB0csaw4budbmcgaOG7o3AgY2xpY2sgdsOgbyBtZW51IGNoYQoKCiAgICAgICAgaWYgKG1lbnVJbmRleCA9PSAtMSkgewogICAgICAgICAgdmFyIG1lbnVQYXJlbnRJbmRleCA9IG1lLmxpc3RJdGVtVGFiLmluZGV4T2YoaXRlbSk7CgogICAgICAgICAgc3dpdGNoIChtZW51UGFyZW50SW5kZXgpIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIG1lLmhpZGVBY2hpZXZlbWVudElkZWEgPSBmYWxzZTsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBtZS5oaWRlRW11bGF0aW9uUmV3YXJkID0gZmFsc2U7IC8vbWUuaGlkZUFjaGlldmVtZW50SWRlYSA9IGZhbHNlOwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAvLyBtZS5oaWRlRW11bGF0aW9uUmV3YXJkID0gZmFsc2U7CiAgICAgICAgICAgICAgbWUuaGlkZUV2YWx1YXRpb24gPSBmYWxzZTsgLy8gbWUuaGlkZUFjaGlldmVtZW50SWRlYSA9IGZhbHNlOwoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAvLyBtZS5oaWRlRW11bGF0aW9uUmV3YXJkID0gZmFsc2U7CiAgICAgICAgICAgICAgLy8gbWUuaGlkZUV2YWx1YXRpb24gPSBmYWxzZTsKICAgICAgICAgICAgICBtZS5oaWRlQXR0YWNobWVudCA9IGZhbHNlOyAvLyBtZS5oaWRlQWNoaWV2ZW1lbnRJZGVhID0gZmFsc2U7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBjb250YWluZXIgPSBfdGhpczMuJHJlZnNbImVtcGxveWVlLWRldGFpbCJdOwogICAgICAgICAgY29udGFpbmVyLnNjcm9sbFRvcCA9IGl0ZW0uU2Nyb2xsVG9wOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBtZS5pc0NsaWNrU3Vic3l0ZW1Sb290ID0gdHJ1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogaMOgbSB04buxIHNjcm9sbCB24buBIMSRw7puZyB0YWIgxJFhbmcgY2jhu41uDQogICAgICogVEROR0hJQSAyMC85LzIwMjENCiAgICAgKi8KICAgIHJpZ2h0RGl2U2Nyb2xsOiBmdW5jdGlvbiByaWdodERpdlNjcm9sbChzZW5kZXIpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9LaeG7g20gdHJhIHhlbSBsw6Agc+G7sSBraeG7h24ga8OpbyBjaHXhu5l0IGhheSBjbGljayBtZW51dGFiCgogICAgICBpZiAoc2VuZGVyICYmIHNlbmRlci50YXJnZXQgJiYgIW1lLmlzQ2xpY2tTdWJzeXRlbVJvb3QpIHsKICAgICAgICB2YXIgb0RpdlNjcm9sbCA9IHNlbmRlci50YXJnZXQ7CiAgICAgICAgdmFyIGFjdGl2ZWlkID0gbWUuY2FjaGVDaGlsZHJlblRhYlswXS5TdWJTeXN0ZW1Db2RlOwogICAgICAgIHZhciBwYXJlbnRBY3RpdmVpZCA9IG1lLmNhY2hlQ2hpbGRyZW5UYWJbMF0uU3ViU3lzdGVtQ29kZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZS5jYWNoZUNoaWxkcmVuVGFiLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgb1N1YnN5dGVtID0gbWUuY2FjaGVDaGlsZHJlblRhYltpXTsKCiAgICAgICAgICBpZiAob1N1YnN5dGVtLlNjcm9sbFRvcCA8PSBvRGl2U2Nyb2xsLnNjcm9sbFRvcCkgewogICAgICAgICAgICBhY3RpdmVpZCA9IG9TdWJzeXRlbS5TdWJTeXN0ZW1Db2RlOwogICAgICAgICAgICBwYXJlbnRBY3RpdmVpZCA9IG9TdWJzeXRlbS5QYXJlbnRTdWJTeXN0ZW1Db2RlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5hY3RpdmVTdWJzeXN0ZW0gPSBhY3RpdmVpZDsKICAgICAgICB0aGlzLmFjdGl2ZVBhcmVudFN1YnN5c3RlbSA9IHBhcmVudEFjdGl2ZWlkOwogICAgICB9CgogICAgICBtZS5pc0NsaWNrU3Vic3l0ZW1Sb290ID0gZmFsc2U7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEPDoGkgxJHhurd0IG7hu5lpIGR1bmcgY2hvIG1lbnUgY8OhYyB0YWINCiAgICAgKiBURE5HSElBIDIwLzkvMjAyMQ0KICAgICAqLwogICAgc2V0TWVudVRhYjogZnVuY3Rpb24gc2V0TWVudVRhYigpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUubGlzdEl0ZW1UYWIgPSBbewogICAgICAgIGluZGV4OiAxLAogICAgICAgIHRpdGxlOiAiVGjDtG5nIHRpbiBjaHVuZyIsCiAgICAgICAgU3ViU3lzdGVtQ29kZTogImdlbmVyYWxJbmZvIiwKICAgICAgICBTY3JvbGxUb3A6IDAsCiAgICAgICAgaXNQYXJlbnQ6IDEsCiAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4tZ2VuZXJhbEluZm8iLAogICAgICAgIENoaWxkcmVuOiBbewogICAgICAgICAgaW5kZXg6IDEsCiAgICAgICAgICB0aXRsZTogIlRow7RuZyB0aW4gY2h1bmciLAogICAgICAgICAgU3ViU3lzdGVtQ29kZTogImdlbmVyYWxJbmZvIiwKICAgICAgICAgIFNjcm9sbFRvcDogMCwKICAgICAgICAgIFNjcm9sbFRhcmdldDogInBuLWdlbmVyYWxJbmZvIiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJnZW5lcmFsSW5mbyIKICAgICAgICB9LCB7CiAgICAgICAgICBpbmRleDogMiwKICAgICAgICAgIHRpdGxlOiAiUXXDqiBxdcOhbiIsCiAgICAgICAgICBTdWJTeXN0ZW1Db2RlOiAiaG9tZUFkZHJlc3MiLAogICAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4taG9tZUFkZHJlc3MiLAogICAgICAgICAgUGFyZW50U3ViU3lzdGVtQ29kZTogImdlbmVyYWxJbmZvIgogICAgICAgIH0sIHsKICAgICAgICAgIGluZGV4OiAzLAogICAgICAgICAgdGl0bGU6ICLEkOG7i2EgY2jhu4kgdGjGsOG7nW5nIHRyw7oiLAogICAgICAgICAgU3ViU3lzdGVtQ29kZTogInBlcm1hbmVudEFkZHJlc3MiLAogICAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4tcGVybWFuZW50QWRkcmVzcyIsCiAgICAgICAgICBQYXJlbnRTdWJTeXN0ZW1Db2RlOiAiZ2VuZXJhbEluZm8iCiAgICAgICAgfSwgewogICAgICAgICAgaW5kZXg6IDQsCiAgICAgICAgICB0aXRsZTogIk7GoWkg4bufIGhp4buHbiBuYXkiLAogICAgICAgICAgU3ViU3lzdGVtQ29kZTogImN1cnJlbnRBZGRyZXNzIiwKICAgICAgICAgIFNjcm9sbFRvcDogMCwKICAgICAgICAgIFNjcm9sbFRhcmdldDogInBuLWN1cnJlbnRBZGRyZXNzIiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJnZW5lcmFsSW5mbyIKICAgICAgICB9LCB7CiAgICAgICAgICBpbmRleDogNSwKICAgICAgICAgIHRpdGxlOiAiVGjDtG5nIHRpbiBraMOhYyIsCiAgICAgICAgICBTdWJTeXN0ZW1Db2RlOiAib3RoZXJJbmZvciIsCiAgICAgICAgICBTY3JvbGxUb3A6IDAsCiAgICAgICAgICBTY3JvbGxUYXJnZXQ6ICJwbi1vdGhlckluZm9yIiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJnZW5lcmFsSW5mbyIKICAgICAgICB9XQogICAgICB9LCB7CiAgICAgICAgaW5kZXg6IDIsCiAgICAgICAgdGl0bGU6ICJRLlRyw6xuaCBjw7RuZyB0w6FjLCBzw6FuZyBraeG6v24iLAogICAgICAgIFN1YlN5c3RlbUNvZGU6ICJ3b3JrUHJvY2VzcyIsCiAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgIGlzUGFyZW50OiAxLAogICAgICAgIFNjcm9sbFRhcmdldDogInBuLXdvcmtQcm9jZXNzIiwKICAgICAgICBDaGlsZHJlbjogW3sKICAgICAgICAgIGluZGV4OiAxLAogICAgICAgICAgdGl0bGU6ICJDw7RuZyB2aeG7h2MgaGnhu4duIHThuqFpIiwKICAgICAgICAgIFN1YlN5c3RlbUNvZGU6ICJqb2JJbmZvIiwKICAgICAgICAgIFNjcm9sbFRvcDogMCwKICAgICAgICAgIFNjcm9sbFRhcmdldDogInBuLWpvYkluZm8iLAogICAgICAgICAgUGFyZW50U3ViU3lzdGVtQ29kZTogIndvcmtQcm9jZXNzIgogICAgICAgIH0sIHsKICAgICAgICAgIGluZGV4OiAyLAogICAgICAgICAgdGl0bGU6ICJRdcOhIHRyw6xuaCBjw7RuZyB0w6FjIiwKICAgICAgICAgIFN1YlN5c3RlbUNvZGU6ICJ3b3JrUHJvY2VzcyIsCiAgICAgICAgICBTY3JvbGxUb3A6IDAsCiAgICAgICAgICBTY3JvbGxUYXJnZXQ6ICJwbi13b3JrUHJvY2VzcyIsCiAgICAgICAgICBQYXJlbnRTdWJTeXN0ZW1Db2RlOiAid29ya1Byb2Nlc3MiCiAgICAgICAgfSwgewogICAgICAgICAgaW5kZXg6IDMsCiAgICAgICAgICB0aXRsZTogIlF1eeG7gW4gaOG6oW4sIG5oaeG7h20gduG7pSIsCiAgICAgICAgICBTdWJTeXN0ZW1Db2RlOiAicm9sZSIsCiAgICAgICAgICBTY3JvbGxUb3A6IDAsCiAgICAgICAgICBTY3JvbGxUYXJnZXQ6ICJwbi1yb2xlIiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJ3b3JrUHJvY2VzcyIKICAgICAgICB9LCB7CiAgICAgICAgICBpbmRleDogNCwKICAgICAgICAgIHRpdGxlOiAiU8Ohbmcga2nhur9uIiwKICAgICAgICAgIFN1YlN5c3RlbUNvZGU6ICJpbnZlbnQiLAogICAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4taW52ZW50IiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJ3b3JrUHJvY2VzcyIKICAgICAgICB9XQogICAgICB9LCB7CiAgICAgICAgaW5kZXg6IDMsCiAgICAgICAgdGl0bGU6ICJLaGVuIHRoxrDhu59uZywga+G7tyBsdeG6rXQiLAogICAgICAgIFN1YlN5c3RlbUNvZGU6ICJjZUdvIiwKICAgICAgICBTY3JvbGxUb3A6IDAsCiAgICAgICAgaXNQYXJlbnQ6IDEsCiAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4tcHJhaXNlIiwKICAgICAgICBDaGlsZHJlbjogW3sKICAgICAgICAgIGluZGV4OiAxLAogICAgICAgICAgdGl0bGU6ICJEYW5oIGhp4buHdSB0aGkgxJF1YSIsCiAgICAgICAgICBTdWJTeXN0ZW1Db2RlOiAicHJhaXNlIiwKICAgICAgICAgIFNjcm9sbFRvcDogMCwKICAgICAgICAgIFNjcm9sbFRhcmdldDogInBuLXByYWlzZSIsCiAgICAgICAgICBQYXJlbnRTdWJTeXN0ZW1Db2RlOiAiY2VHbyIKICAgICAgICB9LCB7CiAgICAgICAgICBpbmRleDogMiwKICAgICAgICAgIHRpdGxlOiAiSMOsbmggdGjhu6ljIGtoZW4gdGjGsOG7n25nIiwKICAgICAgICAgIFN1YlN5c3RlbUNvZGU6ICJ0eXBlT2ZSZXdhcmQiLAogICAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4tdHlwZU9mUmV3YXJkIiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJjZUdvIgogICAgICAgIH0sIHsKICAgICAgICAgIGluZGV4OiAzLAogICAgICAgICAgdGl0bGU6ICJL4bu3IGx14bqtdCIsCiAgICAgICAgICBTdWJTeXN0ZW1Db2RlOiAiZGlzY2lwbGluZSIsCiAgICAgICAgICBTY3JvbGxUb3A6IDAsCiAgICAgICAgICBTY3JvbGxUYXJnZXQ6ICJwbi1kaXNjaXBsaW5lIiwKICAgICAgICAgIFBhcmVudFN1YlN5c3RlbUNvZGU6ICJjZUdvIgogICAgICAgIH1dCiAgICAgIH1dOyAvLyB0cm9uZyDEkcahbiB24buLCgogICAgICBpZiAoIW1lLmlzT3V0U2lkZXIpIHsKICAgICAgICBtZS5saXN0SXRlbVRhYi5wdXNoKHsKICAgICAgICAgIGluZGV4OiA0LAogICAgICAgICAgaXNQYXJlbnQ6IDEsCiAgICAgICAgICB0aXRsZTogIkvhur90IHF14bqjIMSRw6FuaCBnacOhLCB44bq/cCBsb+G6oWkiLAogICAgICAgICAgU3ViU3lzdGVtQ29kZTogImV2YWx1YXRpb24iLAogICAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgICAgU2Nyb2xsVGFyZ2V0OiAicG4tZXZhbHVhdGlvbiIKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgbWUubGlzdEl0ZW1UYWIucHVzaCh7CiAgICAgICAgaW5kZXg6IG1lLmlzT3V0U2lkZXIgPyA0IDogNSwKICAgICAgICBpc1BhcmVudDogMSwKICAgICAgICB0aXRsZTogIlTDoGkgbGnhu4d1IMSRw61uaCBrw6htIiwKICAgICAgICBTdWJTeXN0ZW1Db2RlOiAiYXR0YWNobWVudCIsCiAgICAgICAgU2Nyb2xsVG9wOiAwLAogICAgICAgIFNjcm9sbFRhcmdldDogInBuLWF0dGFjaG1lbnQiCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBURE5HSElBIDIzLzkvMjAyMQ0KICAgICAqIFRo4buxYyBoaeG7h24gY2xpY2sgdsOgbyB0ZXh0IGxpbmsgxJHhu4MgbeG7nyBwb3B1cCBhZGQNCiAgICAgKi8KICAgIHRleHRMaW5rT25DbGljazogZnVuY3Rpb24gdGV4dExpbmtPbkNsaWNrKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGRldGFpbE5hbWUgPSBlLnRhcmdldC5nZXRBdHRyaWJ1dGUoIkRldGFpbE5hbWUiKTsgLy8gaWYgKGRldGFpbE5hbWUgPT0gIkludmVudERldGFpbCIpIHsKICAgICAgLy8gICBtZS4kbXMubXNnQm94LnNob3dJbmZvKG1lLiR0KCJpMThuQ29tbW9uLkZlYXR1cmVzSXNEZXZlbG9waW5nIikpOwogICAgICAvLyB9IGVsc2UgewoKICAgICAgbWUuc2hvd0Zvcm1EZXRhaWxHcmlkKHt9LCBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuQWRkLCBkZXRhaWxOYW1lKTsgLy99CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24ga2hpIOG6pW4gdHLDqm4gZ3JpZCBxdcOhIHRyw6xuaCBjw7RuZyB0w6FjDQogICAgICogVEROR0hJQSAyMi85LzIwMjENCiAgICAgKi8KICAgIHJvd0FjdGlvbkNsaWNrV29ya1Byb2Nlc3M6IGZ1bmN0aW9uIHJvd0FjdGlvbkNsaWNrV29ya1Byb2Nlc3MoY29tbWFuZCwgcmVjb3JkLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgLy8gWMOzYQogICAgICAgIGNhc2UgIkRlbGV0ZSI6CiAgICAgICAgICBtZS5kZWxldGVEZXRhaWwocmVjb3JkLCAiV29ya2luZ0RldGFpbCIpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkVkaXQiOgogICAgICAgICAgbWUuc2hvd0Zvcm1EZXRhaWxHcmlkKHJlY29yZCwgbWUuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsICJXb3JrUHJvY2Vzc0RldGFpbCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBjaHVuZyB4w7NhIHJvdyBjw6FjIGdyaWQgZGV0YWlsDQogICAgICogVEROR0hJQSAxLzExLzIwMjENCiAgICAgKi8KICAgIGRlbGV0ZURldGFpbDogZnVuY3Rpb24gZGVsZXRlRGV0YWlsKGRhdGEsIHN5c0NvZGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChkYXRhLkZpbGVOYW1lKSB7CiAgICAgICAgLy9UaMOqbSB2w6BvIEF0dGFjaG1lbnRDaGFuZ2VzIMSR4buDIHjDs2EgdHLDqm4gc3RvcmFnZSBOVERJRU0gMjUuMTIuMjAyMQogICAgICAgIHZhciBhdHRhY2htZW50Q2hhbmdlID0gewogICAgICAgICAgZmlsZTogZGF0YS5GaWxlTmFtZSwKICAgICAgICAgIG5hbWU6IGRhdGEuQXR0YWNobWVudE5hbWUsCiAgICAgICAgICBzdGF0ZTogbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5EZWxldGUKICAgICAgICB9OwogICAgICAgIG1lLmN1cnJlbnRJdGVtLkF0dGFjaG1lbnRDaGFuZ2VzLnB1c2goYXR0YWNobWVudENoYW5nZSk7CiAgICAgIH0KCiAgICAgIHN3aXRjaCAoc3lzQ29kZSkgewogICAgICAgIGNhc2UgIkVtdWxhdGlvblRpdGxlRGV0YWlsUG9wdXAiOgogICAgICAgICAgbWUubGlzdFNvdXJjZUVtdWxhdGlvblRpdGxlRGV0YWlsLnJlbW92ZShkYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJSZXdhcmRDYXRlZ29yeURldGFpbFBvcHVwIjoKICAgICAgICAgIG1lLmxpc3RTb3VyY2VSZXdhcmRDYXRlZ29yeURldGFpbC5yZW1vdmUoZGF0YSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiV29ya2luZ0RldGFpbCI6CiAgICAgICAgICBtZS5saXN0U291cmNlV29ya2luZ0RldGFpbC5yZW1vdmUoZGF0YSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiUm9sZURldGFpbCI6CiAgICAgICAgICBtZS5saXN0U291cmNlTWlzc2lvblJvbGUucmVtb3ZlKGRhdGEpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkludmVudERldGFpbCI6CiAgICAgICAgICBtZS5saXN0U291cmNlQWNoaWV2ZW1lbnRJZGVhLnJlbW92ZShkYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJEaXNjaXBsaW5lRGV0YWlsIjoKICAgICAgICAgIG1lLmxpc3RTb3VyY2VEaXNjaXBsaW5lRGV0YWlsLnJlbW92ZShkYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJFdmFsdWF0aW9uRGV0YWlsIjoKICAgICAgICAgIG1lLmxpc3RTb3VyY2VFdmFsdWF0aW9uRGV0YWlsLnJlbW92ZShkYXRhKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJBdHRhY2htZW50RGV0YWlsIjoKICAgICAgICAgIG1lLmRlbGV0ZUF0dGFjaG1lbnREZXRhaWwoZGF0YSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24ga2hpIOG6pW4gdHLDqm4gZ3JpZCBkYW5oIGhp4buHdSB0aGkgxJF1YQ0KICAgICAqIFRETkdISUEgMjIvOS8yMDIxDQogICAgICovCiAgICByb3dBY3Rpb25DbGlja0VtdWxhdGlvblRpdGxlOiBmdW5jdGlvbiByb3dBY3Rpb25DbGlja0VtdWxhdGlvblRpdGxlKGNvbW1hbmQsIHJlY29yZCwgZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgIC8vIFjDs2EKICAgICAgICBjYXNlICJEZWxldGUiOgogICAgICAgICAgbWUuZGVsZXRlRGV0YWlsKHJlY29yZCwgIkVtdWxhdGlvblRpdGxlRGV0YWlsUG9wdXAiKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJFZGl0IjoKICAgICAgICAgIG1lLnNob3dGb3JtRGV0YWlsR3JpZChyZWNvcmQsIG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0LCAiRW11bGF0aW9uVGl0bGVEZXRhaWxQb3B1cCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogVGjhu7FjIGhp4buHbiBraGkg4bqlbiB0csOqbiBncmlkIHThuq1wIMSRw61uaCBrw6htDQogICAgICogVEROR0hJQSAyMi85LzIwMjENCiAgICAgKi8KICAgIHJvd0FjdGlvbkNsaWNrQXR0YWNobWVudERldGFpbDogZnVuY3Rpb24gcm93QWN0aW9uQ2xpY2tBdHRhY2htZW50RGV0YWlsKGNvbW1hbmQsIHJlY29yZCwgZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgIC8vIFjDs2EKICAgICAgICBjYXNlICJEZWxldGUiOgogICAgICAgICAgbWUuZGVsZXRlRGV0YWlsKHJlY29yZCwgIkF0dGFjaG1lbnREZXRhaWwiKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJFZGl0IjoKICAgICAgICAgIG1lLnNob3dGb3JtRGV0YWlsR3JpZChyZWNvcmQsIG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0LCAiQXR0YWNobWVudERldGFpbCIpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkRvd25sb2FkIjoKICAgICAgICAgIG1lLmRvd25sb2FkRmlsZShyZWNvcmQpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogVOG6o2kgeHXhu5FuZyB04buHcCDEkcOtbmgga8OobQ0KICAgICAqIE5URElFTSAwOC8wNC8yMDIyDQogICAgICovCiAgICBkb3dubG9hZEZpbGU6IGZ1bmN0aW9uIGRvd25sb2FkRmlsZShyZWNvcmQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHR5cGUgPSByZWNvcmQuRmlsZVR5cGUgPT0gbWUuJG1zLmVudW0uU3RvcmFnZUZpbGVUeXBlLlRlbXAgPyByZWNvcmQuRmlsZVR5cGUgOiBtZS4kbXMuZW51bS5TdG9yYWdlRmlsZVR5cGUuQXR0YWNobWVudDsKICAgICAgdmFyIGRvd25sb2FkTGluayA9IGZpbGVBcGkuZ2V0RG93bmxvYWRMaW5rKHJlY29yZC5GaWxlTmFtZSwgdHlwZSwgbWUuY29udGV4dC5Db250ZXh0LlRlbmFudElELCByZWNvcmQuT3JnYW5pemF0aW9uSUQgPyByZWNvcmQuT3JnYW5pemF0aW9uSUQgOiBtZS5jb250ZXh0Lk9yZ2FuaXphdGlvbi5Pcmdhbml6YXRpb25JRCwgcmVjb3JkLkF0dGFjaG1lbnROYW1lKTsKICAgICAgY29tbW9uRm4uZG93bmxvYWRGaWxlKGRvd25sb2FkTGluayk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24ga2hpIOG6pW4gdHLDqm4gZ3JpZCBow6xuaCB0aOG7qWMga2hlbiB0aMaw4bufbmcNCiAgICAgKiBURE5HSElBIDIyLzkvMjAyMQ0KICAgICAqLwogICAgcm93QWN0aW9uQ2xpY2tSZXdhcmRGb3JtOiBmdW5jdGlvbiByb3dBY3Rpb25DbGlja1Jld2FyZEZvcm0oY29tbWFuZCwgcmVjb3JkLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgLy8gWMOzYQogICAgICAgIGNhc2UgIkRlbGV0ZSI6CiAgICAgICAgICBtZS5kZWxldGVEZXRhaWwocmVjb3JkLCAiUmV3YXJkQ2F0ZWdvcnlEZXRhaWxQb3B1cCIpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkVkaXQiOgogICAgICAgICAgbWUuc2hvd0Zvcm1EZXRhaWxHcmlkKHJlY29yZCwgbWUuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsICJSZXdhcmRDYXRlZ29yeURldGFpbFBvcHVwIik7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGNodW5nIHNob3cgZm9ybSBjaG8gY8OhYyBncmlkDQogICAgICogVGjhu7FjIGhp4buHbiBraGkg4bqlbiB0csOqbiBncmlkIHF1w6EgdHLDrG5oIHF1eeG7gW4gbmhp4buHbSB24bulDQogICAgICogVEROR0hJQSAyMi85LzIwMjENCiAgICAgKi8KICAgIHJvd0FjdGlvbkNsaWNrRGlzY2lwbGluZTogZnVuY3Rpb24gcm93QWN0aW9uQ2xpY2tEaXNjaXBsaW5lKGNvbW1hbmQsIHJlY29yZCwgZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgIC8vIFjDs2EKICAgICAgICBjYXNlICJEZWxldGUiOgogICAgICAgICAgbWUuZGVsZXRlRGV0YWlsKHJlY29yZCwgIkRpc2NpcGxpbmVEZXRhaWwiKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJFZGl0IjoKICAgICAgICAgIG1lLnNob3dGb3JtRGV0YWlsR3JpZChyZWNvcmQsIG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0LCAiRGlzY2lwbGluZURldGFpbCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBjaHVuZyBzaG93IGZvcm0gY2hvIGPDoWMgZ3JpZA0KICAgICAqIFRo4buxYyBoaeG7h24ga2hpIOG6pW4gdHLDqm4gZ3JpZCBxdcOhIHRyw6xuaCBxdXnhu4FuIG5oaeG7h20gduG7pQ0KICAgICAqIFRETkdISUEgMjIvOS8yMDIxDQogICAgICovCiAgICByb3dBY3Rpb25DbGlja1JvbGU6IGZ1bmN0aW9uIHJvd0FjdGlvbkNsaWNrUm9sZShjb21tYW5kLCByZWNvcmQsIGV2ZW50KSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBzd2l0Y2ggKGNvbW1hbmQpIHsKICAgICAgICAvLyBYw7NhCiAgICAgICAgY2FzZSAiRGVsZXRlIjoKICAgICAgICAgIG1lLmRlbGV0ZURldGFpbChyZWNvcmQsICJSb2xlRGV0YWlsIik7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiRWRpdCI6CiAgICAgICAgICBtZS5zaG93Rm9ybURldGFpbEdyaWQocmVjb3JkLCBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuRWRpdCwgIk1pc3Npb25Sb2xlIik7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaOG7sWMgaGnhu4duIGtoaSDhuqVuIHRyw6puIGdyaWQgcXXDoSB0csOsbmggcXV54buBbiBuaGnhu4dtIHbhu6UNCiAgICAgKiBURE5HSElBIDIyLzkvMjAyMQ0KICAgICAqLwogICAgcm93QWN0aW9uQ2xpY2tJbnZlbnQ6IGZ1bmN0aW9uIHJvd0FjdGlvbkNsaWNrSW52ZW50KGNvbW1hbmQsIHJlY29yZCwgZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgIC8vIFjDs2EKICAgICAgICBjYXNlICJEZWxldGUiOgogICAgICAgICAgbWUuZGVsZXRlRGV0YWlsKHJlY29yZCwgIkludmVudERldGFpbCIpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkVkaXQiOgogICAgICAgICAgbWUuc2hvd0Zvcm1EZXRhaWxHcmlkKHJlY29yZCwgbWUuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsICJJbnZlbnREZXRhaWwiKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24ga2hpIOG6pW4gdHLDqm4gZ3JpZCDEkcOhbmggZ2nDoQ0KICAgICAqIE5UQkFPIDE4LjAyLjIwMjINCiAgICAgKi8KICAgIHJvd0FjdGlvbkNsaWNrRXZhbHVhdGlvbjogZnVuY3Rpb24gcm93QWN0aW9uQ2xpY2tFdmFsdWF0aW9uKGNvbW1hbmQsIHJlY29yZCwgZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgIC8vIFjDs2EKICAgICAgICBjYXNlICJEZWxldGUiOgogICAgICAgICAgbWUuZGVsZXRlRGV0YWlsKHJlY29yZCwgIkV2YWx1YXRpb25EZXRhaWwiKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJFZGl0IjoKICAgICAgICAgIG1lLnNob3dGb3JtRGV0YWlsR3JpZChyZWNvcmQsIG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0LCAiRXZhbHVhdGlvbkRldGFpbCIpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBjaHVuZyBzaG93IGZvcm0gY2hvIGPDoWMgZ3JpZA0KICAgICAqIFRETkdISUEgMjIvOS8yMDIxDQogICAgICovCiAgICBzaG93Rm9ybURldGFpbEdyaWQ6IGZ1bmN0aW9uIHNob3dGb3JtRGV0YWlsR3JpZChyZWNvcmQsIG1vZGUsIFN1YlN5c3RlbUNvZGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHBhdGggPSBTdWJTeXN0ZW1Db2RlOwogICAgICB2YXIgcGFyYW0gPSB7CiAgICAgICAgZGF0YTogcmVjb3JkLAogICAgICAgIG1vZGU6IG1vZGUKICAgICAgfTsKICAgICAgdmFyIHBvcCA9IHBvcHVwVXRpbC5fdmlzaWJsZVtwYXRoXTsKCiAgICAgIGlmIChwb3ApIHsKICAgICAgICBwb3AuYWN0aXZlID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIG1lLnNob3dEZXRhaWwocGF0aCwgbW9kZSwgcGFyYW0sIG1lLmdldFBvcHVwT3B0aW9uKHBhdGgpKTsKICAgIH0sCgogICAgLyoqDQogICAgICogVEROR0hJQSAzMC8xMC8yMDIxDQogICAgICogY2FzZSDEkeG7gyB0cnV54buBbiBjw6FjIHN1Ym1pdGNhbGxiYWNrIGNobyDEkcO6bmcNCiAgICAgKiBDaG8gcGjDqXAgZGV0YWlsIGfhu41pIHThu5tpIHN1Ym1pdERldGFpbENhbGxiYWNrIGPhu6dhIGRhbmggc8OhY2ggc2F1IGtoaSBj4bqldCB4b25nDQogICAgICovCiAgICBnZXRQb3B1cE9wdGlvbjogZnVuY3Rpb24gZ2V0UG9wdXBPcHRpb24obmFtZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgb3B0aW9uRGV0YWlsID0gewogICAgICAgIHNpbmdsZTogdHJ1ZSwKICAgICAgICBjb250ZXh0OiBtZS5vcHRpb25zLmNvbnRleHQKICAgICAgfTsKCiAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgIGNhc2UgIldvcmtQcm9jZXNzRGV0YWlsIjoKICAgICAgICAgIG9wdGlvbkRldGFpbC5zdWJtaXQgPSBtZS5zdWJtaXRXb3JraW5nRGV0YWlsQ2FsbGJhY2s7CiAgICAgICAgICBvcHRpb25EZXRhaWwuaXNPdXRTaWRlciA9IG1lLmlzT3V0U2lkZXI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiTWlzc2lvblJvbGUiOgogICAgICAgICAgb3B0aW9uRGV0YWlsLnN1Ym1pdCA9IG1lLnN1Ym1pdE1pc3Npb25Sb2xlQ2FsbGJhY2s7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiSW52ZW50RGV0YWlsIjoKICAgICAgICAgIG9wdGlvbkRldGFpbC5zdWJtaXQgPSBtZS5zdWJtaXRJbnZlbnREZXRhaWxDYWxsYmFjazsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJFbXVsYXRpb25UaXRsZURldGFpbFBvcHVwIjoKICAgICAgICAgIG9wdGlvbkRldGFpbC5zdWJtaXQgPSBtZS5zdWJtaXRFbXVsYXRpb25UaXRsZURldGFpbENhbGxiYWNrOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIlJld2FyZENhdGVnb3J5RGV0YWlsUG9wdXAiOgogICAgICAgICAgb3B0aW9uRGV0YWlsLnN1Ym1pdCA9IG1lLnN1Ym1pdFJld2FyZENhdGVnb3J5RGV0YWlsQ2FsbGJhY2s7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiRGlzY2lwbGluZURldGFpbCI6CiAgICAgICAgICBvcHRpb25EZXRhaWwuc3VibWl0ID0gbWUuc3VibWl0RGlzY2lwbGluZURldGFpbENhbGxiYWNrOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIk1TQXR0YWNobWVudERldGFpbCI6CiAgICAgICAgICBvcHRpb25EZXRhaWwuZmlsZVNpemVTdW1hcnkgPSBtZS5maWxlU2l6ZVN1bWFyeTsKICAgICAgICAgIG9wdGlvbkRldGFpbC5zdWJtaXQgPSBtZS5zdWJtaXRBdHRhY2htZW50RGV0YWlsQ2FsbGJhY2s7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiRXZhbHVhdGlvbkRldGFpbCI6CiAgICAgICAgICBvcHRpb25EZXRhaWwuc3VibWl0ID0gbWUuc3VibWl0RXZhbHVhdGlvbkRldGFpbENhbGxiYWNrOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbkRldGFpbDsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB44butIGzDvSBjYWxsYmFjayBjaHVuZyBjaG8gY8OhYyBtw6BuIGRldGFpbA0KICAgICAqIFRETkdISUEgMS8xMS8yMDIxDQogICAgICovCiAgICBzdWJtaXRDYWxsYmFjazogZnVuY3Rpb24gc3VibWl0Q2FsbGJhY2sobGlzdERhdGFEZXRhaWwsIGZpZWxkRGF0YSwgZmllbGRTb3J0LCBzYXZlUGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKGFjdGlvbiA9PSAidXBkYXRlIikgewogICAgICAgIHRoaXMuc2V0TmV3RWxlbWVudChsaXN0RGF0YURldGFpbCwgZmllbGREYXRhLCBzYXZlUGFyYW0uRW50aXR5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldE5ld0lEKGxpc3REYXRhRGV0YWlsLCBmaWVsZERhdGEsIHNhdmVQYXJhbS5FbnRpdHkpOyAvL1jhu60gbMO9IHRow6ptIHbDoG8gbGlzdCBjaG8gY8OhYyBlbnRpdHkgZOG6oW5nIGFycmF5IE5URElFTSAyNi4xMS4yMDIxCgogICAgICAgIGlmIChzYXZlUGFyYW0uRW50aXR5Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIHNhdmVQYXJhbS5FbnRpdHkuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBsaXN0RGF0YURldGFpbC5wdXNoKGl0ZW0pOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxpc3REYXRhRGV0YWlsLnB1c2goc2F2ZVBhcmFtLkVudGl0eSk7CiAgICAgICAgfQogICAgICB9IC8vVGjDqm0gZGV0YWlsIGPDsyB04buHcCDEkcOtbmgga8OobSB0aMOsIHVwZGF0ZSB04buHcCBhdHRhY2htZW50Q2hhbmdlIGNobyBBdHRhY2htZW50Q2hhbmdlIGNodW5nIE5URElFTSAyNC4xMi4yMDIxCgoKICAgICAgaWYgKHNhdmVQYXJhbS5FbnRpdHkuQXR0YWNobWVudENoYW5nZXMpIHsKICAgICAgICBzYXZlUGFyYW0uRW50aXR5LkF0dGFjaG1lbnRDaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkgewogICAgICAgICAgbWUuY3VycmVudEl0ZW0uQXR0YWNobWVudENoYW5nZXMucHVzaChjaGFuZ2UpOwogICAgICAgIH0pOwogICAgICB9IC8vdGjhu7FjIGhp4buHbiBzb3J0IHRydXnhu4FuIHRow6ptIGJp4bq/biDEkcOhbmggZOG6pXUgcGjhuqNpIGNhc3QgduG7gSBkYXRlIHRyxrDhu5tjIGtoaSBzbyBzw6FuaAoKCiAgICAgIGlmIChmaWVsZFNvcnQgIT0gIlllYXIiKSB7CiAgICAgICAgbGlzdERhdGFEZXRhaWwgPSB0aGlzLiRtcy5jb21tb25Gbi5zb3J0QXJyYXkodGhpcy4kbXMuZW51bS5Tb3J0U3RhdHVzLmRlc2MsIGxpc3REYXRhRGV0YWlsLCBmaWVsZFNvcnQsIDEpOwogICAgICB9IGVsc2UgewogICAgICAgIGxpc3REYXRhRGV0YWlsID0gdGhpcy4kbXMuY29tbW9uRm4uc29ydEFycmF5KHRoaXMuJG1zLmVudW0uU29ydFN0YXR1cy5kZXNjLCBsaXN0RGF0YURldGFpbCwgZmllbGRTb3J0KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGNhbGxiYWNrIHNhdSBraGkgc2F2ZSBk4buvIGxp4buHdQ0KICAgICAqIFRETkdISUEgMS8xMS8yMDIxDQogICAgICovCiAgICBzdWJtaXREaXNjaXBsaW5lRGV0YWlsQ2FsbGJhY2s6IGZ1bmN0aW9uIHN1Ym1pdERpc2NpcGxpbmVEZXRhaWxDYWxsYmFjayhyZXN1bHQsIHBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9MxrB1IHRow7RuZyB0aW4gY8ahIHF1YW4gcmEgcXV54bq/dCDEkeG7i25oIG3hu5tpCgogICAgICBtZS5zYXZlRGVjaXNpb25Pcmdhbml6YXRpb24ocmVzdWx0LCBwYXJhbSwgYWN0aW9uLCAiRGlzY2lwbGluZURldGFpbCIpOwogICAgICBtZS5zdWJtaXRDYWxsYmFjayh0aGlzLmxpc3RTb3VyY2VEaXNjaXBsaW5lRGV0YWlsLCAiSUQiLCAiRnJvbURhdGUiLCBwYXJhbSwgYWN0aW9uKTsKICAgICAgbWUuJHJlZnMuYnRuRGlzY2lwbGluZS5mb2N1cygpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDYWxsIGJhY2sgc2F1IGtoaSB0aGVlbSBkYW5oIGhp4buHdSB0aGkgxJF1YQ0KICAgICAqIFRETkdISUEgMS8xMS8yMDIxDQogICAgICovCiAgICBzdWJtaXRFbXVsYXRpb25UaXRsZURldGFpbENhbGxiYWNrOiBmdW5jdGlvbiBzdWJtaXRFbXVsYXRpb25UaXRsZURldGFpbENhbGxiYWNrKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL0zGsHUgdGjDtG5nIHRpbiBjxqEgcXVhbiByYSBxdXnhur90IMSR4buLbmggbeG7m2kKCiAgICAgIG1lLnNhdmVEZWNpc2lvbk9yZ2FuaXphdGlvbihyZXN1bHQsIHBhcmFtLCBhY3Rpb24sICJFbXVsYXRpb25UaXRsZURldGFpbFBvcHVwIik7CiAgICAgIG1lLnN1Ym1pdENhbGxiYWNrKHRoaXMubGlzdFNvdXJjZUVtdWxhdGlvblRpdGxlRGV0YWlsLCAiSUQiLCAiRGF0ZSIsIHBhcmFtLCBhY3Rpb24pOwogICAgICBtZS4kcmVmcy5idG5FbXVsYXRpb25UaXRsZS5mb2N1cygpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDYWxsYmFjayBzYXUga2hpIHRow6ptIGjDrG5oIHRo4bupYyBraGVuIHRoxrDhu59uZw0KICAgICAqIFRETkdISUEgMS8xMS8yMDIxDQogICAgICovCiAgICBzdWJtaXRSZXdhcmRDYXRlZ29yeURldGFpbENhbGxiYWNrOiBmdW5jdGlvbiBzdWJtaXRSZXdhcmRDYXRlZ29yeURldGFpbENhbGxiYWNrKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL0zGsHUgdGjDtG5nIHRpbiBjxqEgcXVhbiByYSBxdXnhur90IMSR4buLbmggbeG7m2kKCiAgICAgIG1lLnNhdmVEZWNpc2lvbk9yZ2FuaXphdGlvbihyZXN1bHQsIHBhcmFtLCBhY3Rpb24sICJSZXdhcmRDYXRlZ29yeURldGFpbFBvcHVwIik7CiAgICAgIG1lLnN1Ym1pdENhbGxiYWNrKHRoaXMubGlzdFNvdXJjZVJld2FyZENhdGVnb3J5RGV0YWlsLCAiSUQiLCAiRGF0ZSIsIHBhcmFtLCBhY3Rpb24pOwogICAgICBtZS4kcmVmcy5idG5SZXdhcmRDYXRlZ29yeS5mb2N1cygpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDYWxsYmFjayBzYXUga2hpIHNhdmUgcXXDoSB0csOsbmggY8O0bmcgdMOhYw0KICAgICAqIFRETkdISUEgMS8xMS8yMDIxDQogICAgICovCiAgICBzdWJtaXRXb3JraW5nRGV0YWlsQ2FsbGJhY2s6IGZ1bmN0aW9uIHN1Ym1pdFdvcmtpbmdEZXRhaWxDYWxsYmFjayhyZXN1bHQsIHBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuc3VibWl0Q2FsbGJhY2sodGhpcy5saXN0U291cmNlV29ya2luZ0RldGFpbCwgIldvcmtpbmdJRCIsICJUb0RhdGUiLCBwYXJhbSwgYWN0aW9uKTsKICAgICAgbWUuJHJlZnMuYnRuV29ya2luZy5mb2N1cygpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDYWxsYmFjayBzYXUga2hpIHNhdmUgcXV54buBbiBo4bqhbiBuaGnhu4dtIHbhu6UgxJHGsOG7o2MgZ2lhbw0KICAgICAqIFRETkdISUEgMS8xMS8yMDIxDQogICAgICovCiAgICBzdWJtaXRNaXNzaW9uUm9sZUNhbGxiYWNrOiBmdW5jdGlvbiBzdWJtaXRNaXNzaW9uUm9sZUNhbGxiYWNrKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5zdWJtaXRDYWxsYmFjayh0aGlzLmxpc3RTb3VyY2VNaXNzaW9uUm9sZSwgIlJvbGVJRCIsICJZZWFyIiwgcGFyYW0sIGFjdGlvbik7CiAgICAgIG1lLiRyZWZzLmJ0blJvbGUuZm9jdXMoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ2FsbGJhY2sgc2F1IGtoaSBzYXZlIHPDoW5nIGtp4bq/bg0KICAgICAqIE5UVEhBTkgxIDA3LzEyLzIwMjENCiAgICAgKiBNb2RpZnkgMDQvMDMvMjAyMg0KICAgICAqLwogICAgc3VibWl0SW52ZW50RGV0YWlsQ2FsbGJhY2s6IGZ1bmN0aW9uIHN1Ym1pdEludmVudERldGFpbENhbGxiYWNrKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL0zGsHUgdGjDtG5nIHRpbiBjxqEgcXVhbiByYSBxdXnhur90IMSR4buLbmggbeG7m2kKCiAgICAgIG1lLnNhdmVEZWNpc2lvbk9yZ2FuaXphdGlvbihyZXN1bHQsIHBhcmFtLCBhY3Rpb24sICJJbnZlbnREZXRhaWwiKTsKICAgICAgbWUuc3VibWl0Q2FsbGJhY2sodGhpcy5saXN0U291cmNlQWNoaWV2ZW1lbnRJZGVhLCAiSW52ZW50SUQiLCAiWWVhciIsIHBhcmFtLCBhY3Rpb24pOwogICAgICBtZS4kcmVmcy5idG5JbnZlbnQuZm9jdXMoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ2FsbGJhY2sgc2F1IGtoaSBzYXZlIMSRw6FuaCBnacOhLCB44bq/cCBsb+G6oWkNCiAgICAgKiBOVEJBTyAxNy4wMi4yMDIyDQogICAgICovCiAgICBzdWJtaXRFdmFsdWF0aW9uRGV0YWlsQ2FsbGJhY2s6IGZ1bmN0aW9uIHN1Ym1pdEV2YWx1YXRpb25EZXRhaWxDYWxsYmFjayhyZXN1bHQsIHBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuc3VibWl0Q2FsbGJhY2sodGhpcy5saXN0U291cmNlRXZhbHVhdGlvbkRldGFpbCwgIklEIiwgIkRhdGUiLCBwYXJhbSwgYWN0aW9uKTsKICAgICAgbWUuJHJlZnMuYnRuRXZhbC5mb2N1cygpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDYWxsYmFjayBzYXUga2hpIHRow6ptIHThu4dwIMSRw61uaCBrw6htDQogICAgICogTlRESUVNIDE4LjExLjIwMjENCiAgICAgKi8KICAgIHN1Ym1pdEF0dGFjaG1lbnREZXRhaWxDYWxsYmFjazogZnVuY3Rpb24gc3VibWl0QXR0YWNobWVudERldGFpbENhbGxiYWNrKHJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5zdWJtaXRDYWxsYmFjayh0aGlzLmxpc3RTb3VyY2VBdHRhY2htZW50RGV0YWlsLCAiSUQiLCAiQXR0YWNobWVudE5hbWUiLCBwYXJhbSwgYWN0aW9uKTsKCiAgICAgIGlmIChwYXJhbS5BdHRhY2htZW50Q2hhbmdlcykgewogICAgICAgIHBhcmFtLkF0dGFjaG1lbnRDaGFuZ2VzLmZvckVhY2goZnVuY3Rpb24gKGNoYW5nZSkgewogICAgICAgICAgbWUuY3VycmVudEl0ZW0uQXR0YWNobWVudENoYW5nZXMucHVzaChjaGFuZ2UpOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBtZS4kcmVmcy5idG5BdHRhY2guZm9jdXMoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTMawdSB0aMO0bmcgdGluIGPGoSBxdWFuIHJhIHF1eeG6v3QgxJHhu4tuaCBt4bubaQ0KICAgICAqIE5UVEhBTkgxIDA0LzAzLzIwMjINCiAgICAgKi8KICAgIHNhdmVEZWNpc2lvbk9yZ2FuaXphdGlvbjogZnVuY3Rpb24gc2F2ZURlY2lzaW9uT3JnYW5pemF0aW9uKHJlc3VsdCwgcGFyYW0sIGFjdGlvbiwgZGV0YWlsTmFtZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZW50aXR5ID0gbnVsbDsKCiAgICAgIHN3aXRjaCAoZGV0YWlsTmFtZSkgewogICAgICAgIGNhc2UgIkludmVudERldGFpbCI6CiAgICAgICAgICBpZiAocGFyYW0uRW50aXR5ICYmIHBhcmFtLkVudGl0eS5EZWNpc2lvbk9yZ2FuaXphdGlvbikgewogICAgICAgICAgICBlbnRpdHkgPSB7CiAgICAgICAgICAgICAgUGlja0xpc3ROYW1lOiBwYXJhbS5FbnRpdHkuRGVjaXNpb25Pcmdhbml6YXRpb24sCiAgICAgICAgICAgICAgUGlja0xpc3RUeXBlOiBtZS4kbXMuZW51bS5QaWNrTGlzdFR5cGUuRGVjaXNpb25Pcmdhbml6YXRpb24KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgY2FzZSAiRW11bGF0aW9uVGl0bGVEZXRhaWxQb3B1cCI6CiAgICAgICAgY2FzZSAiUmV3YXJkQ2F0ZWdvcnlEZXRhaWxQb3B1cCI6CiAgICAgICAgY2FzZSAiRGlzY2lwbGluZURldGFpbCI6CiAgICAgICAgICBpZiAocGFyYW0uRW50aXR5ICYmIHBhcmFtLkVudGl0eS5Pcmdhbml6YXRpb25CZWxvbmcpIHsKICAgICAgICAgICAgZW50aXR5ID0gewogICAgICAgICAgICAgIFBpY2tMaXN0TmFtZTogcGFyYW0uRW50aXR5Lk9yZ2FuaXphdGlvbkJlbG9uZywKICAgICAgICAgICAgICBQaWNrTGlzdFR5cGU6IG1lLiRtcy5lbnVtLlBpY2tMaXN0VHlwZS5EZWNpc2lvbk9yZ2FuaXphdGlvbgogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgfQoKICAgICAgaWYgKGVudGl0eSkgewogICAgICAgIFBpY2tMaXN0QVBJLmluc2VydENoZWNrRHVwbGljYXRlKGVudGl0eSkudGhlbihmdW5jdGlvbiAocmVzKSB7fSkuY2F0Y2goZnVuY3Rpb24gKGVycikgewogICAgICAgICAgY29uc29sZS5sb2coZXJyKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBD4bqtcCBuaOG6rXQgbOG6oWkgYuG6o24gZ2hpIMSRxrDhu6NjIHPhu61hIGNobyBjw6FjIGLhuqNuZyBjb24NCiAgICAgKiBURE5HSElBIDMxLzEwLzIwMjENCiAgICAgKi8KICAgIHNldE5ld0VsZW1lbnQ6IGZ1bmN0aW9uIHNldE5ld0VsZW1lbnQoYXJyLCBmaWVsZERhdGEsIG9iaikgewogICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgYXJyLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIGlmIChhcnJbaW5kZXhdW2ZpZWxkRGF0YV0gPT09IG9ialtmaWVsZERhdGFdKSB7CiAgICAgICAgICBhcnJbaW5kZXhdID0gX29iamVjdFNwcmVhZCh7fSwgb2JqKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiB0cuG6oyB24buBIElEIG3hu5tpIG5o4bqldCBjaG8gYuG6o24gZ2hpDQogICAgICogVEROR0hJQSAzMS8xMC8yMDIxDQogICAgICovCiAgICBzZXROZXdJRDogZnVuY3Rpb24gc2V0TmV3SUQoYXJyLCBkYXRhRmllbGQsIG9iamVjdCkgewogICAgICB2YXIgbmV3SUQgPSAxOwoKICAgICAgaWYgKGFyci5sZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGFycklEID0gYXJyLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgcmV0dXJuIGl0ZW1bZGF0YUZpZWxkXTsKICAgICAgICB9KTsKICAgICAgICBuZXdJRCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIF90b0NvbnN1bWFibGVBcnJheShhcnJJRCkpICsgMTsKICAgICAgfQoKICAgICAgb2JqZWN0W2RhdGFGaWVsZF0gPSBuZXdJRDsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBzaG93IGPDoWMgcG9wdXANCiAgICAgKiBAcGFyYW0gbmFtZSB0w6puIGPhu6dhIGNvbXBvbmVudA0KICAgICAqLwogICAgc2hvd0RldGFpbDogZnVuY3Rpb24gc2hvd0RldGFpbChuYW1lLCBtb2RlLCBkYXRhLCBvcHRpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcG9wdXBVdGlsLnNob3cobWUsIG5hbWUsIGRhdGEsIG9wdGlvbik7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENo4buNbiB04buJbmgvdGjDoG5oIHBo4buRIHF1w6ogcXXDoW4NCiAgICAgKi8KICAgIHNlbGVjdGVkUHJvdmluY2VIb21lOiBmdW5jdGlvbiBzZWxlY3RlZFByb3ZpbmNlSG9tZShzZWxlY3RlZERhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGl0ZW0gPSBzZWxlY3RlZERhdGEubmV3RGF0YTsKICAgICAgbWUuY3VycmVudEl0ZW0uSG9tZVByb3ZpbmNlTmFtZSA9IGl0ZW0uTG9jYXRpb25OYW1lOwogICAgICBtZS5jdXJyZW50SXRlbS5Ib21lRGlzdHJpY3QgPSBudWxsOwogICAgICBtZS5jdXJyZW50SXRlbS5Ib21lV2FyZCA9IG51bGw7CiAgICAgIG1lLmN1cnJlbnRJdGVtLkhvbWVEaXN0cmljdE5hbWUgPSBudWxsOwogICAgICBtZS5jdXJyZW50SXRlbS5Ib21lV2FyZE5hbWUgPSBudWxsOwogICAgICBtZS5kaXN0cmljdERhdGFIb21lID0gW107CiAgICAgIG1lLndhcmREYXRhSG9tZSA9IFtdOwogICAgICBtZS5nZXREaXN0cmljdEJ5UHJvdmluY2VJRChpdGVtLkxvY2F0aW9uSUQsIDEpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBURE5HSElBIDIzLzkvMjAyMQ0KICAgICAqIEjDoG0geOG7rSBsw70gbG9hZCBjb21ibyBkaXN0cmljdCDEkeG7i2EgY2jhu4kgdGjGsOG7nW5nIHRyw7oNCiAgICAgKi8KICAgIHNlbGVjdGVkUHJvdmluY2VQZXJtYW5lbnQ6IGZ1bmN0aW9uIHNlbGVjdGVkUHJvdmluY2VQZXJtYW5lbnQoc2VsZWN0ZWREYXRhKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBpdGVtID0gc2VsZWN0ZWREYXRhLm5ld0RhdGE7CiAgICAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudFByb3ZpbmNlTmFtZSA9IGl0ZW0uTG9jYXRpb25OYW1lOwogICAgICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnREaXN0cmljdCA9IG51bGw7CiAgICAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudFdhcmQgPSBudWxsOwogICAgICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnREaXN0cmljdE5hbWUgPSBudWxsOwogICAgICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnRXYXJkTmFtZSA9IG51bGw7CiAgICAgIG1lLmRpc3RyaWN0RGF0YVBlcm1hbmVudCA9IFtdOwogICAgICBtZS53YXJkRGF0YVBlcm1hbmVudCA9IFtdOwogICAgICBtZS5nZXREaXN0cmljdEJ5UHJvdmluY2VJRChpdGVtLkxvY2F0aW9uSUQsIDIpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBURE5HSElBIDIzLzkvMjAyMQ0KICAgICAqIEjDoG0geOG7rSBsw70gbG9hZCBjb21ibyBkaXN0cmljdCBuxqFpIOG7nyBoaeG7h24gbmF5DQogICAgICovCiAgICBzZWxlY3RlZFByb3ZpbmNlQ3VycmVudDogZnVuY3Rpb24gc2VsZWN0ZWRQcm92aW5jZUN1cnJlbnQoc2VsZWN0ZWREYXRhKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBpdGVtID0gc2VsZWN0ZWREYXRhLm5ld0RhdGE7CiAgICAgIG1lLmN1cnJlbnRJdGVtLkN1cnJlbnREaXN0cmljdE5hbWUgPSBpdGVtLkxvY2F0aW9uTmFtZTsKICAgICAgbWUuY3VycmVudEl0ZW0uQ3VycmVudERpc3RyaWN0ID0gbnVsbDsKICAgICAgbWUuY3VycmVudEl0ZW0uQ3VycmVudFdhcmQgPSBudWxsOwogICAgICBtZS5jdXJyZW50SXRlbS5DdXJyZW50RGlzdHJpY3ROYW1lID0gbnVsbDsKICAgICAgbWUuY3VycmVudEl0ZW0uQ3VycmVudFdhcmROYW1lID0gbnVsbDsKICAgICAgbWUuZGlzdHJpY3REYXRhQ3VycmVudCA9IFtdOwogICAgICBtZS53YXJkRGF0YUN1cnJlbnQgPSBbXTsKICAgICAgbWUuZ2V0RGlzdHJpY3RCeVByb3ZpbmNlSUQoaXRlbS5Mb2NhdGlvbklELCAzKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgZGFuaCBzw6FjaCBRdeG6rW4vaHV54buHbg0KICAgICAqIFRETkdISUEgMTQvMTAvMjAyMQ0KICAgICAqLwogICAgZ2V0RGlzdHJpY3RCeVByb3ZpbmNlSUQ6IGZ1bmN0aW9uIGdldERpc3RyaWN0QnlQcm92aW5jZUlEKGlkLCBtb2RlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoaWQpIHsKICAgICAgICBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KE1vZHVsZUxvY2F0aW9uLCAiL2dldFJlZmVyZW5jZURpc3RyaWN0IiksIHsKICAgICAgICAgIHByb3ZpbmNlSUQ6IGlkCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIG1lLmRpc3RyaWN0RGF0YUhvbWUgPSByZXM7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgbWUuZGlzdHJpY3REYXRhUGVybWFuZW50ID0gcmVzOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIG1lLmRpc3RyaWN0RGF0YUN1cnJlbnQgPSByZXM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFPhu7Ega2nhu4duIHRoYXkgxJHhu5VpIFF14bqtbiBIdXnhu4duIHF1w6ogcXXDoW4NCiAgICAgKiBESFBISQ0KICAgICAqLwogICAgc2VsZWN0ZWREaXN0cmljdEhvbWU6IGZ1bmN0aW9uIHNlbGVjdGVkRGlzdHJpY3RIb21lKHNlbGVjdGVkRGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgaXRlbSA9IHNlbGVjdGVkRGF0YS5uZXdEYXRhOwogICAgICBtZS5jdXJyZW50SXRlbS5Ib21lRGlzdHJpY3ROYW1lID0gaXRlbS5Mb2NhdGlvbk5hbWU7CiAgICAgIG1lLmN1cnJlbnRJdGVtLkhvbWVXYXJkID0gbnVsbDsKICAgICAgbWUuY3VycmVudEl0ZW0uSG9tZVdhcmROYW1lID0gbnVsbDsKICAgICAgbWUud2FyZERhdGFIb21lID0gW107CiAgICAgIG1lLmdldFdhcmRCeURpc3RyaWN0SUQoaXRlbS5Mb2NhdGlvbklELCAxKTsKICAgIH0sCgogICAgLyoqDQogICAgICogU+G7sSBraeG7h24gdGhheSDEkeG7lWkgUXXhuq1uIEh1eeG7h24gdGjGsOG7nW5nIHRyw7oNCiAgICAgKiBESFBISQ0KICAgICAqLwogICAgc2VsZWN0ZWREaXN0cmljdFBlcm1hbmVudDogZnVuY3Rpb24gc2VsZWN0ZWREaXN0cmljdFBlcm1hbmVudChzZWxlY3RlZERhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGl0ZW0gPSBzZWxlY3RlZERhdGEubmV3RGF0YTsKICAgICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50RGlzdHJpY3ROYW1lID0gaXRlbS5Mb2NhdGlvbk5hbWU7CiAgICAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudFdhcmQgPSBudWxsOwogICAgICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnRXYXJkTmFtZSA9IG51bGw7CiAgICAgIG1lLndhcmREYXRhUGVybWFuZW50ID0gW107CiAgICAgIG1lLmdldFdhcmRCeURpc3RyaWN0SUQoaXRlbS5Mb2NhdGlvbklELCAyKTsKICAgIH0sCgogICAgLyoqDQogICAgICogU+G7sSBraeG7h24gdGhheSDEkeG7lWkgUXXhuq1uIEh1eeG7h24NCiAgICAgKiBESFBISQ0KICAgICAqLwogICAgc2VsZWN0ZWREaXN0cmljdEN1cnJlbnQ6IGZ1bmN0aW9uIHNlbGVjdGVkRGlzdHJpY3RDdXJyZW50KHNlbGVjdGVkRGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgaXRlbSA9IHNlbGVjdGVkRGF0YS5uZXdEYXRhOwogICAgICBtZS5jdXJyZW50SXRlbS5DdXJyZW50RGlzdHJpY3ROYW1lID0gaXRlbS5Mb2NhdGlvbk5hbWU7CiAgICAgIG1lLmN1cnJlbnRJdGVtLkN1cnJlbnRXYXJkID0gbnVsbDsKICAgICAgbWUuY3VycmVudEl0ZW0uQ3VycmVudFdhcmROYW1lID0gbnVsbDsKICAgICAgbWUud2FyZERhdGFDdXJyZW50ID0gW107CiAgICAgIG1lLmdldFdhcmRCeURpc3RyaWN0SUQoaXRlbS5Mb2NhdGlvbklELCAzKTsKICAgIH0sCgogICAgLyoqDQogICAgICogc+G7sSBraeG7h24gdGhheSDEkeG7lWkgeMOjIC8gcGjGsOG7nW5nDQogICAgICogTk1UVUFOMiAwNC4wMS4yMDIyDQogICAgICovCiAgICBzZWxlY3RlZFdhcmRIb21lOiBmdW5jdGlvbiBzZWxlY3RlZFdhcmRIb21lKHNlbGVjdGVkRGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgaXRlbSA9IHNlbGVjdGVkRGF0YS5uZXdEYXRhOwogICAgICBtZS5jdXJyZW50SXRlbS5Ib21lV2FyZE5hbWUgPSBpdGVtLkxvY2F0aW9uTmFtZTsKICAgIH0sCgogICAgLyoqDQogICAgICogc+G7sSBraeG7h24gdGhheSDEkeG7lWkgeMOjIC8gcGjGsOG7nW5nDQogICAgICogTk1UVUFOMiAwNC4wMS4yMDIyDQogICAgICovCiAgICBzZWxlY3RlZFdhcmRQZXJtYW5lbnQ6IGZ1bmN0aW9uIHNlbGVjdGVkV2FyZFBlcm1hbmVudChzZWxlY3RlZERhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGl0ZW0gPSBzZWxlY3RlZERhdGEubmV3RGF0YTsKICAgICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50V2FyZE5hbWUgPSBpdGVtLkxvY2F0aW9uTmFtZTsKICAgIH0sCgogICAgLyoqDQogICAgICogc+G7sSBraeG7h24gdGhheSDEkeG7lWkgeMOjIC8gcGjGsOG7nW5nDQogICAgICogTk1UVUFOMiAwNC4wMS4yMDIyDQogICAgICovCiAgICBzZWxlY3RlZFdhcmRDdXJyZW50OiBmdW5jdGlvbiBzZWxlY3RlZFdhcmRDdXJyZW50KHNlbGVjdGVkRGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgaXRlbSA9IHNlbGVjdGVkRGF0YS5uZXdEYXRhOwogICAgICBtZS5jdXJyZW50SXRlbS5DdXJyZW50V2FyZE5hbWUgPSBpdGVtLkxvY2F0aW9uTmFtZTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgZOG7ryBsaeG7h3UgdOG7iW5oIHRow6BuaCBwaOG7kQ0KICAgICAqIFRETkdISUEgMTQvMTAvMjAyMQ0KICAgICAqLwogICAgZ2V0UHJvdmluY2VEYXRhOiBmdW5jdGlvbiBnZXRQcm92aW5jZURhdGEoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQoTW9kdWxlTG9jYXRpb24sICIvZ2V0QWxsUHJvdmluY2UiKSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgbWUucHJvdmluY2VEYXRhID0gcmVzOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IGRhbmggc8OhY2ggWMOjL1BoxrDhu51uZw0KICAgICAqLwogICAgZ2V0V2FyZEJ5RGlzdHJpY3RJRDogZnVuY3Rpb24gZ2V0V2FyZEJ5RGlzdHJpY3RJRChpZCwgbW9kZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKGlkKSB7CiAgICAgICAgbWUuJHN0b3JlLmRpc3BhdGNoKCIiLmNvbmNhdChNb2R1bGVMb2NhdGlvbiwgIi9nZXRXYXJkQnlEaXN0cmljdElEIiksIHsKICAgICAgICAgIGRpc3RyaWN0SUQ6IGlkCiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBpZiAocmVzKSB7CiAgICAgICAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICAgIG1lLndhcmREYXRhSG9tZSA9IHJlczsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICBtZS53YXJkRGF0YVBlcm1hbmVudCA9IHJlczsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBtZS53YXJkRGF0YUN1cnJlbnQgPSByZXM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENvcHkgxJHhu4thIGNo4buJIHThu6sgMTogcXXDqiBxdcOhbiAyOiB0aMaw4budbmcgdHLDug0KICAgICAqIFRETkdISUEgMjkvMTAvMjAyMQ0KICAgICAqLwogICAgY29weUFkZHJlc3M6IGZ1bmN0aW9uIGNvcHlBZGRyZXNzKG1vZGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudFByb3ZpbmNlID0gbWUuY3VycmVudEl0ZW0uSG9tZVByb3ZpbmNlOwogICAgICAgICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50RGlzdHJpY3QgPSBtZS5jdXJyZW50SXRlbS5Ib21lRGlzdHJpY3Q7CiAgICAgICAgICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnRXYXJkID0gbWUuY3VycmVudEl0ZW0uSG9tZVdhcmQ7CiAgICAgICAgICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnRQcm92aW5jZU5hbWUgPSBtZS5jdXJyZW50SXRlbS5Ib21lUHJvdmluY2VOYW1lOwogICAgICAgICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50RGlzdHJpY3ROYW1lID0gbWUuY3VycmVudEl0ZW0uSG9tZURpc3RyaWN0TmFtZTsKICAgICAgICAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudFdhcmROYW1lID0gbWUuY3VycmVudEl0ZW0uSG9tZVdhcmROYW1lOwogICAgICAgICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50QWRkcmVzcyA9IG1lLmN1cnJlbnRJdGVtLkhvbWVBZGRyZXNzOwogICAgICAgICAgbWUuZ2V0RGlzdHJpY3RCeVByb3ZpbmNlSUQobWUuY3VycmVudEl0ZW0uUGVybWFuZW50UHJvdmluY2UsIDIpOwogICAgICAgICAgbWUuZ2V0V2FyZEJ5RGlzdHJpY3RJRChtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnREaXN0cmljdCwgMik7IC8vIC8vQ8OgaSBzZWxlY3Rpb24gY2hvIDMgY29tYm8KICAgICAgICAgIC8vIG1lLnNldEludGVybmFsVmFsdWVDb21ibygKICAgICAgICAgIC8vICAgbWUuJHJlZnMuY2JvUHJvdmluY2VQZXJtYW5lbnQsCiAgICAgICAgICAvLyAgIG1lLmN1cnJlbnRJdGVtLkhvbWVQcm92aW5jZU5hbWUsCiAgICAgICAgICAvLyAgIG1lLmN1cnJlbnRJdGVtLkhvbWVQcm92aW5jZQogICAgICAgICAgLy8gKTsKICAgICAgICAgIC8vIG1lLnNldEludGVybmFsVmFsdWVDb21ibygKICAgICAgICAgIC8vICAgbWUuJHJlZnMuY2JvRGlzdHJpY3RQZXJtYW5lbnQsCiAgICAgICAgICAvLyAgIG1lLmN1cnJlbnRJdGVtLkhvbWVEaXN0cmljdE5hbWUsCiAgICAgICAgICAvLyAgIG1lLmN1cnJlbnRJdGVtLkhvbWVEaXN0cmljdAogICAgICAgICAgLy8gKTsKICAgICAgICAgIC8vIG1lLnNldEludGVybmFsVmFsdWVDb21ibygKICAgICAgICAgIC8vICAgbWUuJHJlZnMuY2JvV2FyZFBlcm1hbmVudCwKICAgICAgICAgIC8vICAgbWUuY3VycmVudEl0ZW0uSG9tZVdhcmROYW1lLAogICAgICAgICAgLy8gICBtZS5jdXJyZW50SXRlbS5Ib21lV2FyZAogICAgICAgICAgLy8gKTsKCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgbWUuY3VycmVudEl0ZW0uQ3VycmVudFByb3ZpbmNlID0gbWUuY3VycmVudEl0ZW0uUGVybWFuZW50UHJvdmluY2U7CiAgICAgICAgICBtZS5jdXJyZW50SXRlbS5DdXJyZW50RGlzdHJpY3QgPSBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnREaXN0cmljdDsKICAgICAgICAgIG1lLmN1cnJlbnRJdGVtLkN1cnJlbnRXYXJkID0gbWUuY3VycmVudEl0ZW0uUGVybWFuZW50V2FyZDsKICAgICAgICAgIG1lLmN1cnJlbnRJdGVtLkN1cnJlbnRQcm92aW5jZU5hbWUgPSBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnRQcm92aW5jZU5hbWU7CiAgICAgICAgICBtZS5jdXJyZW50SXRlbS5DdXJyZW50RGlzdHJpY3ROYW1lID0gbWUuY3VycmVudEl0ZW0uUGVybWFuZW50RGlzdHJpY3ROYW1lOwogICAgICAgICAgbWUuY3VycmVudEl0ZW0uQ3VycmVudFdhcmROYW1lID0gbWUuY3VycmVudEl0ZW0uUGVybWFuZW50V2FyZE5hbWU7CiAgICAgICAgICBtZS5jdXJyZW50SXRlbS5DdXJyZW50QWRkcmVzcyA9IG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudEFkZHJlc3M7CiAgICAgICAgICBtZS5nZXREaXN0cmljdEJ5UHJvdmluY2VJRChtZS5jdXJyZW50SXRlbS5DdXJyZW50UHJvdmluY2UsIDMpOwogICAgICAgICAgbWUuZ2V0V2FyZEJ5RGlzdHJpY3RJRChtZS5jdXJyZW50SXRlbS5DdXJyZW50RGlzdHJpY3QsIDMpOyAvLyAvL0PDoGkgc2VsZWN0aW9uIGNobyAzIGNvbWJvCiAgICAgICAgICAvLyBtZS5zZXRJbnRlcm5hbFZhbHVlQ29tYm8oCiAgICAgICAgICAvLyAgIG1lLiRyZWZzLmNib1Byb3ZpbmNlQ3VycmVudCwKICAgICAgICAgIC8vICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50UHJvdmluY2VOYW1lLAogICAgICAgICAgLy8gICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnRQcm92aW5jZQogICAgICAgICAgLy8gKTsKICAgICAgICAgIC8vIG1lLnNldEludGVybmFsVmFsdWVDb21ibygKICAgICAgICAgIC8vICAgbWUuJHJlZnMuY2JvRGlzdHJpY3RDdXJyZW50LAogICAgICAgICAgLy8gICBtZS5jdXJyZW50SXRlbS5QZXJtYW5lbnREaXN0cmljdE5hbWUsCiAgICAgICAgICAvLyAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudERpc3RyaWN0CiAgICAgICAgICAvLyApOwogICAgICAgICAgLy8gbWUuc2V0SW50ZXJuYWxWYWx1ZUNvbWJvKAogICAgICAgICAgLy8gICBtZS4kcmVmcy5jYm9XYXJkQ3VycmVudCwKICAgICAgICAgIC8vICAgbWUuY3VycmVudEl0ZW0uUGVybWFuZW50V2FyZE5hbWUsCiAgICAgICAgICAvLyAgIG1lLmN1cnJlbnRJdGVtLlBlcm1hbmVudFdhcmQKICAgICAgICAgIC8vICk7CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQ29weSBnacOhIHRy4buLIG3hu5tpIGNobyBjb21ibyDEkeG7i2EgY2jhu4kNCiAgICAgKiBURE5HSElBIDI3LzEyLzIwMjENCiAgICAgKi8KICAgIHNldEludGVybmFsVmFsdWVDb21ibzogZnVuY3Rpb24gc2V0SW50ZXJuYWxWYWx1ZUNvbWJvKGNvbWJvLCB0ZXh0LCB2YWx1ZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgaXRlbSA9IHsKICAgICAgICBLaW5kOiAzLAogICAgICAgIExvY2F0aW9uSUQ6IHZhbHVlLAogICAgICAgIExvY2F0aW9uTmFtZTogdGV4dAogICAgICB9OwogICAgICBjb21iby5zZXRJbnRlcm5hbEl0ZW0oaXRlbSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSBk4buvIGxp4buHdSB0aOG7sWMgaGnhu4duIGPhuqV0DQogICAgICogSlNPTiBs4bqhaSBjw6FjIGLhuqNuZw0KICAgICAqLwogICAgY3VzdG9tU2F2ZURhdGE6IGZ1bmN0aW9uIGN1c3RvbVNhdmVEYXRhKGVkaXRNb2RlLCBkYXRhKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoZGF0YS5EYXRlT2ZCaXJ0aCAhPT0gbnVsbCkgewogICAgICAgIGlmIChkYXRhLlRpbWVUeXBlID09PSAwKSB7CiAgICAgICAgICBkYXRhLkRhdGVPZkJpcnRoID0gbWUuJG1zLmNvbW1vbkZuLmZvcm1hdERhdGVUaW1lKGRhdGEuRGF0ZU9mQmlydGgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZGF0YS5Xb3JraW5nRGV0YWlsID0gSlNPTi5zdHJpbmdpZnkobWUubGlzdFNvdXJjZVdvcmtpbmdEZXRhaWwpOwogICAgICBkYXRhLk1pc3Npb25Sb2xlID0gSlNPTi5zdHJpbmdpZnkobWUubGlzdFNvdXJjZU1pc3Npb25Sb2xlKTsgLy9LaGkgbMawdSB0aMOsIHjDs2EgYuG7m3QgdGjDtG5nIHRpbiBraMO0bmcgY+G6p24gdGhp4bq/dCBsacOqbiBxdWFuIMSR4bq/biB04buHcCDEkcOtbmgga8OobQoKICAgICAgbWUubGlzdFNvdXJjZUFjaGlldmVtZW50SWRlYS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgZGVsZXRlIGl0ZW0uQXR0YWNobWVudENoYW5nZXM7CiAgICAgICAgZGVsZXRlIGl0ZW0uRmlsZVR5cGU7CiAgICAgIH0pOwogICAgICBkYXRhLkFjaGlldmVtZW50SWRlYSA9IEpTT04uc3RyaW5naWZ5KG1lLmxpc3RTb3VyY2VBY2hpZXZlbWVudElkZWEpOyAvL0toaSBsxrB1IHRow6wgeMOzYSBi4bubdCB0aMO0bmcgdGluIGtow7RuZyBj4bqnbiB0aGnhur90IGxpw6puIHF1YW4gxJHhur9uIHThu4dwIMSRw61uaCBrw6htCgogICAgICBtZS5saXN0U291cmNlRW11bGF0aW9uVGl0bGVEZXRhaWwuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGRlbGV0ZSBpdGVtLkF0dGFjaG1lbnRDaGFuZ2VzOwogICAgICAgIGRlbGV0ZSBpdGVtLkZpbGVUeXBlOwogICAgICB9KTsKICAgICAgZGF0YS5FbXVsYXRpb25UaXRsZURldGFpbCA9IEpTT04uc3RyaW5naWZ5KG1lLmxpc3RTb3VyY2VFbXVsYXRpb25UaXRsZURldGFpbCk7IC8vS2hpIGzGsHUgdGjDrCB4w7NhIGLhu5t0IHRow7RuZyB0aW4ga2jDtG5nIGPhuqduIHRoaeG6v3QgbGnDqm4gcXVhbiDEkeG6v24gdOG7h3AgxJHDrW5oIGvDqG0KCiAgICAgIG1lLmxpc3RTb3VyY2VSZXdhcmRDYXRlZ29yeURldGFpbC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgZGVsZXRlIGl0ZW0uQXR0YWNobWVudENoYW5nZXM7CiAgICAgICAgZGVsZXRlIGl0ZW0uRmlsZVR5cGU7CiAgICAgIH0pOwogICAgICBkYXRhLlJld2FyZENhdGVnb3J5RGV0YWlsID0gSlNPTi5zdHJpbmdpZnkobWUubGlzdFNvdXJjZVJld2FyZENhdGVnb3J5RGV0YWlsKTsgLy9UaMOqbSBlZGl0TW9kZSBjaG8gdHLGsOG7nW5nIGRldGFpbCB04buHcCDEkcOtbmgga8OobQoKICAgICAgbWUubGlzdFNvdXJjZUF0dGFjaG1lbnREZXRhaWwuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGl0ZW0uRW50aXR5U3RhdGUgPSBpdGVtLkVudGl0eVN0YXRlID09IG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuVXBkYXRlID8gbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5VcGRhdGUgOiBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkluc2VydDsKICAgICAgfSk7IC8vTWVyZ2UgdGjDqm0gZGFuaCBzw6FjaCB4w7NhIHThu4dwIMSRw61uaCBrw6htIHbDoG8gxJHhu4EgeMOzYSBtYXN0ZXItZGV0YWlsCgogICAgICBkYXRhLkF0dGFjaG1lbnREZXRhaWwgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG1lLmxpc3RTb3VyY2VBdHRhY2htZW50RGV0YWlsKSwgX3RvQ29uc3VtYWJsZUFycmF5KG1lLmxpc3REZWxldGVBdHRhY2htZW50KSk7IC8vS2hpIGzGsHUgdGjDrCB4w7NhIGLhu5t0IHRow7RuZyB0aW4ga2jDtG5nIGPhuqduIHRoaeG6v3QgbGnDqm4gcXVhbiDEkeG6v24gdOG7h3AgxJHDrW5oIGvDqG0KCiAgICAgIG1lLmxpc3RTb3VyY2VEaXNjaXBsaW5lRGV0YWlsLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBkZWxldGUgaXRlbS5BdHRhY2htZW50Q2hhbmdlczsKICAgICAgICBkZWxldGUgaXRlbS5GaWxlVHlwZTsKICAgICAgfSk7CiAgICAgIGRhdGEuRGlzY2lwbGluZURldGFpbCA9IEpTT04uc3RyaW5naWZ5KG1lLmxpc3RTb3VyY2VEaXNjaXBsaW5lRGV0YWlsKTsgLy8gVGjDtG5nIHRpbiDEkcOhbmggZ2nDoQoKICAgICAgZGF0YS5FdmFsdWF0aW9uRGV0YWlsID0gSlNPTi5zdHJpbmdpZnkobWUubGlzdFNvdXJjZUV2YWx1YXRpb25EZXRhaWwpOwogICAgICB2YXIgbmFtZUFyciA9IGRhdGEuRnVsbE5hbWUuc3BsaXQoIiAiKTsKICAgICAgZGF0YS5GaXJzdE5hbWUgPSBuYW1lQXJyWzBdOwogICAgICBkYXRhLkxhc3ROYW1lID0gbmFtZUFycltuYW1lQXJyLmxlbmd0aCAtIDFdOwoKICAgICAgaWYgKCFtZS5pc091dFNpZGVyKSB7CiAgICAgICAgZGF0YS5EZXBhcnRtZW50TmFtZSA9IG1lLiRyZWZzLmNib0RlcGFydG1lbnQuaW50ZXJuYWxUZXh0OwogICAgICB9CgogICAgICBkYXRhLkFjYWRlbWljVGl0bGVOYW1lID0gbWUuJHJlZnMuQWNhZGVtaWNUaXRsZUNiby5pbnRlcm5hbFRleHQ7CiAgICAgIGRhdGEuQWNhZGVtaWNSYW5rTmFtZSA9IG1lLiRyZWZzLkFjYWRlbWljUmFua0Niby5pbnRlcm5hbFRleHQ7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGN1c3RvbWUgbOG6oWkgcGF5bG9hZCBj4bunYSBjb21ibyBkZXBhcnRtZW50DQogICAgICogVEROR0hJQSAyOC8xMC8yMDIxDQogICAgICogdHlwZSB04buxIHThuqFvIHJhIMSR4buDIGNhc2UgY2hvIHThu6tuZyBjb21ibyB0cm9uZyBtw6BuIG7DoHkNCiAgICAgKi8KICAgIGN1c3RvbVBheWxvYWRDb21ibzogZnVuY3Rpb24gY3VzdG9tUGF5bG9hZENvbWJvKHBheWxvYWQsIHR5cGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmICghcGF5bG9hZC5maWx0ZXIpIHsKICAgICAgICBwYXlsb2FkLmZpbHRlciA9IFtdOwogICAgICB9CgogICAgICBpZiAobWUub3B0aW9ucy5jb250ZXh0Lk9yZ2FuaXphdGlvbi5BZG1pbmlzdHJhdGl2ZUxldmVsICE9IG1lLiRtcy5lbnVtLkFwcGx5TGV2ZWwuUHJvdmluY2VMZXZlbCkgewogICAgICAgIHBheWxvYWQuZmlsdGVyLnB1c2goewogICAgICAgICAgcHJvcGVydHk6ICJBcHBseUxldmVsSUQiLAogICAgICAgICAgdmFsdWU6IG1lLm9wdGlvbnMuY29udGV4dC5Pcmdhbml6YXRpb24uQWRtaW5pc3RyYXRpdmVMZXZlbC50b1N0cmluZygpLAogICAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5Db250YWlucywKICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHBheWxvYWQuZmlsdGVyLnB1c2goewogICAgICAgIHByb3BlcnR5OiAiSW5hY3RpdmUiLAogICAgICAgIHZhbHVlOiAiMCIsCiAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5FcXVhbHMsCiAgICAgICAgb3BlcmFuZDogImFuZCIKICAgICAgfSk7CiAgICAgIHBheWxvYWQuZmlsdGVyLnB1c2goewogICAgICAgIHByb3BlcnR5OiAiSm9iUG9zaXRpb25UeXBlIiwKICAgICAgICB2YWx1ZTogdHlwZSA9PSBtZS4kbXMuZW51bS5Kb2JQb3NpdGlvblR5cGUuUG9zaXRpb24gPyAiMCIgOiAiMSIsCiAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5FcXVhbHMsCiAgICAgICAgb3BlcmFuZDogImFuZCIKICAgICAgfSk7CiAgICAgIHBheWxvYWRbInNvcnQiXSA9ICJKb2JQb3NpdGlvbk5hbWUgQVNDIjsgLy9UaMOqbSBzb3J0IHbDoG8gcGF5bG9hZCDEkeG7gyBz4bqvcCB44bq/cCBs4bqhaSB0aOG7qSB04buxIGNvbWJvIE5URElFTSAzMS4wMy4yMDIyCgogICAgICBtZS5zdXBlcigiY3VzdG9tUGF5bG9hZENvbWJvIiwgcGF5bG9hZCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGN1c3RvbSB0aGFtIHPhu5EgbOG6pXkgZOG7ryBsaeG7h3Ugbmdo4buBIG5naGnhu4dwDQogICAgICogTlRUSEFOSDENCiAgICAgKi8KICAgIGN1c3RvbVBheWxvYWRQaWNrTGlzdDogZnVuY3Rpb24gY3VzdG9tUGF5bG9hZFBpY2tMaXN0KHBheWxvYWQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmICghcGF5bG9hZC5maWx0ZXIpIHsKICAgICAgICBwYXlsb2FkLmZpbHRlciA9IFtdOwogICAgICB9CgogICAgICBwYXlsb2FkLmZpbHRlci5wdXNoKHsKICAgICAgICBwcm9wZXJ0eTogIlBpY2tMaXN0VHlwZSIsCiAgICAgICAgdmFsdWU6IG1lLiRtcy5lbnVtLlBpY2tMaXN0VHlwZS5DYXJlZXJOYW1lLAogICAgICAgIG9wZXJhdG9yOiBtZS4kbXMuZW51bS5GaWx0ZXJIZWFkZXIuRXF1YWxzLAogICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgIH0sIHsKICAgICAgICBwcm9wZXJ0eTogIkluYWN0aXZlIiwKICAgICAgICB2YWx1ZTogZmFsc2UsCiAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5FcXVhbHMsCiAgICAgICAgb3BlcmFuZDogImFuZCIKICAgICAgfSk7CiAgICAgIHJldHVybiBwYXlsb2FkOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDb3B5IHRow7RuZyB0aW4gY8O0bmcgdmnhu4djIGfhuqduIG5o4bqldA0KICAgICAqIFRETkdISUEgMi8xMS8yMDIxDQogICAgICovCiAgICBnZXRDdXJyZW50V29ya2luZ0RldGFpbDogZnVuY3Rpb24gZ2V0Q3VycmVudFdvcmtpbmdEZXRhaWwoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUubGlzdFNvdXJjZVdvcmtpbmdEZXRhaWxbMF0pIHsKICAgICAgICB2YXIgaXRlbSA9IG1lLmxpc3RTb3VyY2VXb3JraW5nRGV0YWlsWzBdOwogICAgICAgIG1lLmN1cnJlbnRJdGVtLk9yZ2FuaXphdGlvbk5hbWUgPSBpdGVtLk9yZ2FuaXphdGlvbk5hbWU7CiAgICAgICAgbWUuY3VycmVudEl0ZW0uSm9iUG9zaXRpb25JRCA9IGl0ZW0uSm9iUG9zaXRpb25JRDsKICAgICAgICBtZS5jdXJyZW50SXRlbS5Kb2JQb3NpdGlvbk5hbWUgPSBpdGVtLkpvYlBvc2l0aW9uTmFtZTsKICAgICAgICBtZS5jdXJyZW50SXRlbS5Kb2JUaXRsZUlEID0gaXRlbS5Kb2JUaXRsZUlEOwogICAgICAgIG1lLmN1cnJlbnRJdGVtLkpvYlRpdGxlTmFtZSA9IGl0ZW0uSm9iVGl0bGVOYW1lOwogICAgICAgIG1lLmN1cnJlbnRJdGVtLldvcmtpbmdPbkRhdGUgPSBpdGVtLkZyb21EYXRlOwogICAgICAgIG1lLmN1cnJlbnRJdGVtLkRlcGFydG1lbnRJRCA9IG51bGw7CiAgICAgICAgbWUuY3VycmVudEl0ZW0uRGVwYXJ0bWVudE5hbWUgPSBpdGVtLkRlcGFydG1lbnROYW1lOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENoZWNrIGNoYW5nZSB0csaw4bubYyBraGkgdGhvw6F0IHJhDQogICAgICogVEROR0hJQSAxMS8xMS8yMDIxDQogICAgICovCiAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5jaGVja0NoYW5nZXMoKSkgewogICAgICAgIHZhciBtc2cgPSBtZS5nZXRDbG9zZUNvbmZpcm1NZXNzYWdlKCk7CiAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93Q29uZmlybShtc2csIG51bGwsIG51bGwsICJMxrB1IGjhu5Mgc8ahIHRow6BuaCB0w61jaCIpLnRoZW4oZnVuY3Rpb24gKGFuc3dlcikgewogICAgICAgICAgaWYgKGFuc3dlciA9PT0gIlllcyIpIHsKICAgICAgICAgICAgbWUuc2F2ZShfdGhpczQuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGFuc3dlciA9PSAiTm8iKSB7CiAgICAgICAgICAgIG1lLmhpZGUoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5oaWRlKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgbuG7mWkgZHVuZyB0aMO0bmcgYsOhbyB0aGVvIG3DoyB2YWxpZGF0ZQ0KICAgICAqIFRETkdISUEgb3ZlcnJpZGUgbOG6oWkgY3VzdG9tIGPDonUgZHVwbGljYXRlDQogICAgICovCiAgICBnZXRWYWxpZGF0ZU1lc3NhZ2U6IGZ1bmN0aW9uIGdldFZhbGlkYXRlTWVzc2FnZSh2YWxpZGF0ZUNvZGUsIGRhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG1zZyA9IHZhbGlkYXRlQ29kZTsKICAgICAgdmFyIHRpdGxlTmFtZSA9IG1lLmdldEZvcm1UaXRsZShtZS5lZGl0TW9kZSk7CiAgICAgIHZhciBmaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICBzd2l0Y2ggKHZhbGlkYXRlQ29kZSkgewogICAgICAgIGNhc2UgIkR1cGxpY2F0ZSI6CiAgICAgICAgICB2YXIgY29kZUR1cGxpY2F0ZSA9IG1lLmN1cnJlbnRJdGVtW2ZpZWxkLnVuaXF1ZV0gfHwgbWUuY3VycmVudEl0ZW1bZmllbGQuY29kZV0gfHwgbWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV07CiAgICAgICAgICB2YXIgbW9kdWxlTmFtZSA9IG1lLiR0KCJpMThuQ29tbW9uLm1vZHVsZS4iICsgbWUubW9kdWxlLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgbXNnID0gIlPhu5EgaGnhu4d1IGPDoW4gYuG7mSA8Yj57MH08L2I+IMSRw6MgdOG7k24gdOG6oWkgdHJvbmcgZGFuaCBzw6FjaC4gWGluIHZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpLiIuZm9ybWF0KGNvZGVEdXBsaWNhdGUpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBtc2cgPSBtZS5zdXBlcigiZ2V0VmFsaWRhdGVNZXNzYWdlIiwgdmFsaWRhdGVDb2RlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gbXNnOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBYw7NhIHThu4dwIMSRw61uaCBrw6htDQogICAgICogTlRESUVNIDIyLjExLjIwMjENCiAgICAgKiB1cGRhdGU6Q2jhu4kgeMOzYSBnaeG6oyB0csOqbiBi4bqjbmcgdGjDtGkuIEtoaSBuw6BvIOG6pW4gbMawdSBt4bubaSB4w7NhIHRyw6puIGRiDQogICAgICovCiAgICBkZWxldGVBdHRhY2htZW50RGV0YWlsOiBmdW5jdGlvbiBkZWxldGVBdHRhY2htZW50RGV0YWlsKHJlY29yZCkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL1jDs2EgdHJyZWVuIGxpc3QKCiAgICAgIG1lLmxpc3RTb3VyY2VBdHRhY2htZW50RGV0YWlsLnJlbW92ZShyZWNvcmQpOyAvL1Row6ptIHbDoG8gZGFuaCBzw6FjaCB4w7NhIMSR4buDIHjDs2EgdHJvbmcgREIKICAgICAgLy9UaMOqbSBTdGF0ZSB2w6BvIMSR4buDIGNo4bqheSBtYXN0ZXItZGV0YWlsIEJFIHThu7EgxJHhu5luZyB4w7NhCgogICAgICByZWNvcmQuRW50aXR5U3RhdGUgPSBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkRlbGV0ZTsKICAgICAgbWUubGlzdERlbGV0ZUF0dGFjaG1lbnQucHVzaChyZWNvcmQpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBjbGljayBi4bqjbiBnaGkgLT4gaGnhu4NuIHRo4buLIG1lbnUNCiAgICAgKi8KICAgIGdyaWRSb3dPdmVyOiBmdW5jdGlvbiBncmlkUm93T3ZlcihyZWNvcmQsIGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUucm93QWN0aW9ucyA9IG1lLmdldFJlY29yZEFjdGlvbnMocmVjb3JkKTsKICAgIH0sCgogICAgLyoqDQogICAgICogbOG6pXkgZGFuaCBzw6FjaCBhY3Rpb24gY+G7p2EgYuG6o24gZ2hpDQogICAgICovCiAgICBnZXRSZWNvcmRBY3Rpb25zOiBmdW5jdGlvbiBnZXRSZWNvcmRBY3Rpb25zKHJlY29yZCkgewogICAgICBpZiAodHlwZW9mIHJlY29yZC5DZXJ0aWZpY2F0ZUlEICE9PSAidW5kZWZpbmVkIikgewogICAgICAgIGlmIChyZWNvcmQuQ2VydGlmaWNhdGVJRCAhPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gW3sKICAgICAgICAgICAgY29tbWFuZDogIkVkaXQiLAogICAgICAgICAgICBpY29uOiAiZWRpdCIsCiAgICAgICAgICAgIHRleHQ6IHRoaXMuJHQoImkxOG5Db21tb24uY29tbWFuZC5lZGl0IikKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgY29tbWFuZDogIkRlbGV0ZSIsCiAgICAgICAgICAgIGljb246ICJkZWxldGUiLAogICAgICAgICAgICB0ZXh0OiB0aGlzLiR0KCJpMThuQ29tbW9uLmNvbW1hbmQuZGVsZXRlIikKICAgICAgICAgIH1dOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIFt7CiAgICAgICAgY29tbWFuZDogIkVkaXQiLAogICAgICAgIGljb246ICJlZGl0IiwKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJpMThuQ29tbW9uLmNvbW1hbmQuZWRpdCIpCiAgICAgIH0sIHsKICAgICAgICBjb21tYW5kOiAiRGVsZXRlIiwKICAgICAgICBpY29uOiAiZGVsZXRlIiwKICAgICAgICB0ZXh0OiB0aGlzLiR0KCJpMThuQ29tbW9uLmNvbW1hbmQuZGVsZXRlIikKICAgICAgfV07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEtoaSBjaOG7jW4gY2hlY2tib3ggxJDDoyBoaSBzaW5oL3Thu6sgdHLhuqduIHRow6wgbeG6t2MgxJHhu4tuaCBuxINtIGhpIHNpbmgvdOG7qyB0cuG6p24gbMOgIG7Eg20gaGnhu4duIHThuqFpDQogICAgICoNCiAgICAgKiBOTVRVQU4zIDIxLzEyLzIwMjENCiAgICAgKi8KICAgIHNldERhdGVPZkRlYXRoOiBmdW5jdGlvbiBzZXREYXRlT2ZEZWF0aCgpIHsKICAgICAgaWYgKHRoaXMuY3VycmVudEl0ZW0uSXNHb25lKSB7CiAgICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCk7CiAgICAgICAgdGhpcy5jdXJyZW50SXRlbS5EYXRlT2ZEZWF0aCA9IHRoaXMuY3VycmVudEl0ZW0uRGF0ZU9mRGVhdGggPyB0aGlzLmN1cnJlbnRJdGVtLkRhdGVPZkRlYXRoIDogbm93LmdldEZ1bGxZZWFyKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogU+G7sSBraeG7h24gY2xpY2sgY29tYm8gY2JvVGltZVR5cGVJblBlcmlvZA0KICAgICAqIERMSHV5IDI3LjEyLjIwMjENCiAgICAgKi8KICAgIHRpbWVUeXBlSW5QZXJpb2RfU2VsZWN0ZWQ6IGZ1bmN0aW9uIHRpbWVUeXBlSW5QZXJpb2RfU2VsZWN0ZWQobWV0YURhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuY3VycmVudEl0ZW0uRGF0ZU9mQmlydGggPSBudWxsOwogICAgfSwKCiAgICAvKiogYuG6r3Qgc+G7sSBraeG7h24ga2hpIGNsaWNrIHJhIG5nb8OgaSBkYXRlcGlja2VyICovCiAgICBibHVyRGF0ZVBpY2tlcjogZnVuY3Rpb24gYmx1ckRhdGVQaWNrZXIoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLiRyZWZzLmNib0Zyb21EYXRlX1BlcmlvZF9EYXkubW9tZW50TWFzay5tYXNrID0gbWUuJHJlZnMuY2JvRnJvbURhdGVfUGVyaW9kX0RheS5yYXdWYWx1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogRW50ZXIgY8OhYyBsaW5rIHRleHQNCiAgICAgKiBURE5HSElBIDMvMy8yMDIxDQogICAgICovCiAgICBsaW5rVGV4dE9uRW50ZXI6IGZ1bmN0aW9uIGxpbmtUZXh0T25FbnRlcih0eXBlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAxMykgewogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICBtZS5jb3B5QWRkcmVzcygxKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBtZS5jb3B5QWRkcmVzcygyKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBtZS5nZXRDdXJyZW50V29ya2luZ0RldGFpbCgpOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBtZS50ZXh0TGlua09uQ2xpY2soZXZlbnQpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogU2V0IGF2YXRhciBs4bqleSB04burIHN0b3JhZ2UNCiAgICAgKiBOVERJRU0gMTcvMDMvMjAyMg0KICAgICAqLwogICAgc2V0QXZhdGFyOiBmdW5jdGlvbiBzZXRBdmF0YXIodmFsdWUsIGNoYW5nZSwgYXZhdGFyRmlsZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgcGFyYW0gPSB7CiAgICAgICAgdXNlcklEOiBtZS5jdXJyZW50SXRlbS5FbXBsb3llZUlELAogICAgICAgIGZ1bGxOYW1lOiBtZS5jdXJyZW50SXRlbS5GdWxsTmFtZSwKICAgICAgICB0ZW5hbnRJRDogbWUuY29udGV4dC5Db250ZXh0LlRlbmFudElELAogICAgICAgIG9yZ2FuaXphdGlvbklEOiBtZS5jb250ZXh0Lk9yZ2FuaXphdGlvbi5Pcmdhbml6YXRpb25JRAogICAgICB9LAogICAgICAgICAgdGltZSA9ICImIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpLnRvU3RyaW5nKCk7IC8vTOG6pXkgdGjDqm0gdGjhu51pIGdpYW4gdsOgbyB1cmwgxJHhu4Mga2jDtG5nIGLhu4sgY2FjaGUgTlRESUVNIDE3LzAzLzIwMjIKCiAgICAgIG1lLmF2YXRhclVybCA9IEltYWdlQVBJLmdldEF2YXRhckxpbmsocGFyYW0udXNlcklELCBwYXJhbS5mdWxsTmFtZSwgcGFyYW0udGVuYW50SUQsIHBhcmFtLm9yZ2FuaXphdGlvbklEKTsKICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZW1wb3llZS1hdmF0YXIiKVswXS5zZXRBdHRyaWJ1dGUoInNyYyIsIG1lLmF2YXRhclVybCArIHRpbWUpOwogICAgICBtZS5hdmF0YXJGaWxlID0gYXZhdGFyRmlsZTsKICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gc2F1IGtoaSBj4bqldA0KICAgICAqIFRETkdISUEgMTgvMy8yMDIxDQogICAgICogT3ZlcnJpZGUgbOG6oWkgxJHhu4MgZ+G7jWkgbMawdSBhdnQgZG8gY8OzIGNhc2UgbMawdSB2w6AgdGjDqm0gbeG7m2kgbsOqbiBwaOG6o2kgb3ZlcnJpZGUNCiAgICAgKiBPdmVycmlkZSBs4bqhaSDEkeG7gyB44butIGzDvSBsxrB1IEF2YXRhciBjw7MgdHLGsOG7nW5nIGjhu6NwIHRow6ptIG3hu5tpIE5URElFTSAxOC8wMy8yMDIyDQogICAgICogKi8KICAgIGFmdGVyU3VibWl0OiBmdW5jdGlvbiBhZnRlclN1Ym1pdChyZXN1bHQsIHBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9ETEh1eSAwNi4xMS4yMDIxIHRow6ptIGjDoG0gbsOgeSDEkeG7gyBjdXN0b20gbOG6oWkgY8OidSB0aMO0bmcgYsOhbwoKICAgICAgbWUuZ2V0Tm90aVN1Y2Nlc3MoKTsKCiAgICAgIGlmIChtZS5vcHRpb25zICYmIG1lLm9wdGlvbnMuc3VibWl0KSB7CiAgICAgICAgbWUub3B0aW9ucy5zdWJtaXQocmVzdWx0LCBwYXJhbSwgYWN0aW9uKTsKICAgICAgfQoKICAgICAgbWUuaXNDaGFuZ2VEYXRhID0gdHJ1ZTsKCiAgICAgIHN3aXRjaCAocGFyYW0uTW9kZSkgewogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZToKICAgICAgICAgIG1lLnNhdmVBdmF0YXIocmVzdWx0LkRhdGEuRW1wbG95ZWVJRCk7CiAgICAgICAgICBtZS5hZnRlclN1Ym1pdE1vZGVTYXZlKHJlc3VsdCwgcGFyYW0pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZU5ldzoKICAgICAgICAgIG1lLnNhdmVBdmF0YXIocmVzdWx0LkRhdGEuRW1wbG95ZWVJRCk7CiAgICAgICAgICBtZS5hZGQoe30pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgLy8gcHZkdXkgMDQvMDMvMjAyMSBj4bqldCB0aMOgbmggY8O0bmcgdOG6oWkgbW9kZSB2aWV3CgogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZVZpZXc6CiAgICAgICAgICBtZS5hZnRlclN1Ym1pdE1vZGVWaWV3KCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBtZS4kbXMuZW51bS5TYXZlTW9kZS5TYXZlQW5kQ29uZmlnOgogICAgICAgICAgbWUuYWZ0ZXJTdWJtaXRNb2RlU2F2ZUFuZENvbmZpZyhyZXN1bHQsIHBhcmFtLCBhY3Rpb24pOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBtZS5oaWRlKCk7CiAgICAgICAgICBicmVhazsKICAgICAgfSAvLyBOTVRVQU4zIDcvMy8yMDIyOiBU4bqhbyB0aMO0bmcgYsOhbyBzYXUga2hpIHN1Ym1pdAoKCiAgICAgIG1lLmNyZWF0ZU5vdGlmaWNhdGlvbihyZXN1bHQuRGF0YSwgcGFyYW0sIGFjdGlvbik7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzGsHUgbOG6oWkgYXZhdGFyIHRoZW8gRW1wbG95ZWVJRCBraGkgdGjDqm0gbeG7m2kgaOG7kyBzxqENCiAgICAgKiBOVERJRU0gMTgvMDMvMjAyMg0KICAgICAqLwogICAgc2F2ZUF2YXRhcjogZnVuY3Rpb24gc2F2ZUF2YXRhcih1c2VySUQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHBhcmFtID0gewogICAgICAgIHVzZXJJRDogbWUuY3VycmVudEl0ZW0uRW1wbG95ZWVJRCwKICAgICAgICBmdWxsTmFtZTogbWUuY3VycmVudEl0ZW0uRnVsbE5hbWUsCiAgICAgICAgdGVuYW50SUQ6IG1lLmNvbnRleHQuQ29udGV4dC5UZW5hbnRJRCwKICAgICAgICBvcmdhbml6YXRpb25JRDogbWUuY29udGV4dC5Pcmdhbml6YXRpb24uT3JnYW5pemF0aW9uSUQKICAgICAgfTsKCiAgICAgIGlmIChtZS5hdmF0YXJGaWxlKSB7CiAgICAgICAgbWUuYXZhdGFyRmlsZS5GaWxlTmFtZSA9IHVzZXJJRC50b1N0cmluZygpOyAvL1jDs2EgYXZhdGFyIGzDoCBjaHXhu5dpIGd1aWQgdHLhu5FuZyB0csOqbiBzdG9yYWdlCgogICAgICAgIG1lLmRlbGV0ZVRlbXBBdmF0YXIocGFyYW0udXNlcklELCBwYXJhbS50ZW5hbnRJRCwgcGFyYW0ub3JnYW5pemF0aW9uSUQpOyAvL0zGsHUgbOG6oWkgYXZhdGFyIG5nxrDhu51pIGTDuW5nIGPDsyB0w6puIGLhurFuZyBFbXBsb3llZUlECgogICAgICAgIGZpbGVBcGkudXBsb2FkcyhbbWUuYXZhdGFyRmlsZV0sIG1lLiRtcy5lbnVtLlN0b3JhZ2VGaWxlVHlwZS5BdmF0YXIpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjDs2EgYXZhdGFyIGPDsyB0w6puIGzDoCBjaHXhu5dpIGd1aWQgcuG7l25nIHRyw6puIHN0b3JhZ2UNCiAgICAgKiBOVERJRU0gMzEvMDMvMjAyMg0KICAgICAqLwogICAgZGVsZXRlVGVtcEF2YXRhcjogZnVuY3Rpb24gZGVsZXRlVGVtcEF2YXRhcih1c2VySUQsIHRlbmFuSUQsIG9yZ2FuaXphdGlvbklEKSB7CiAgICAgIHZhciBfdGhpczUgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgdmFyIG1lOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzNTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiBmaWxlQXBpLmRlbGV0ZUZpbGUodXNlcklELCBtZS4kbXMuZW51bS5TdG9yYWdlRmlsZVR5cGUuQXZhdGFyLCB0ZW5hbklELCBvcmdhbml6YXRpb25JRCk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBAb3ZlcnJpZGUNCiAgICAgKiBLaeG7g20gdHJhIHbDoCB4w7NhIGF2YXRhciBraGkgxJHDs25nIGjhu5Mgc8ahIGPDoSBuaMOibg0KICAgICAqIE5URElFTSAzMS8wMy8yMDIyDQogICAgICovCiAgICBoaWRlOiBmdW5jdGlvbiBoaWRlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL07hur91IG5nxrDhu51pIGTDuW5nIHRow6ptIGF2YXRhciAtPiDEkcOzbmcgaOG7kyBzxqEgLT4geMOzYSBmaWxlIOG6o25oIGPDsyBVc2VySWQgPSBndWlkIHRy4buRbmcgdHLDqm4gc3RvcmFnZSDEkWkKCiAgICAgIGlmIChtZS5hdmF0YXJGaWxlICYmIG1lLmN1cnJlbnRJdGVtLkVtcGxveWVlSUQgPT0gIjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCIpIHsKICAgICAgICBtZS5kZWxldGVUZW1wQXZhdGFyKG1lLmN1cnJlbnRJdGVtLkVtcGxveWVlSUQsIG1lLmNvbnRleHQuQ29udGV4dC5UZW5hbnRJRCwgbWUuY29udGV4dC5Pcmdhbml6YXRpb24uT3JnYW5pemF0aW9uSUQpOwogICAgICB9CgogICAgICBtZS5zdXBlcigiaGlkZSIpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiDhuqhuIGhp4buHbiBjaGkgdGnhur90IGPDoWMgdGjDtG5nIHRpbg0KICAgICAqIERIUGhpIDI4LzAzLzIwMjINCiAgICAgKi8KICAgIGhpZGVJbmZvcm1hdGlvbjogZnVuY3Rpb24gaGlkZUluZm9ybWF0aW9uKHZhbHVlKSB7CiAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICBjYXNlICJoaWRlSW5mb3IiOgogICAgICAgICAgdGhpcy5oaWRlSW5mb3IgPSAhdGhpcy5oaWRlSW5mb3I7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiaGlkZUVtdWxhdGlvblJld2FyZCI6CiAgICAgICAgICB0aGlzLmhpZGVFbXVsYXRpb25SZXdhcmQgPSAhdGhpcy5oaWRlRW11bGF0aW9uUmV3YXJkOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImhpZGVFdmFsdWF0aW9uIjoKICAgICAgICAgIHRoaXMuaGlkZUV2YWx1YXRpb24gPSAhdGhpcy5oaWRlRXZhbHVhdGlvbjsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJoaWRlQWNoaWV2ZW1lbnRJZGVhIjoKICAgICAgICAgIHRoaXMuaGlkZUFjaGlldmVtZW50SWRlYSA9ICF0aGlzLmhpZGVBY2hpZXZlbWVudElkZWE7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiaGlkZUF0dGFjaG1lbnQiOgogICAgICAgICAgdGhpcy5oaWRlQXR0YWNobWVudCA9ICF0aGlzLmhpZGVBdHRhY2htZW50OwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUw61uaCB04buVbmcgZHVuZyBsxrDhu6NuZyBmaWxlDQogICAgICogTlRESUVNIDA3LzA0LzIwMjINCiAgICAgKi8KICAgIGNhY3VsYXRlRmlsZVNpemU6IGZ1bmN0aW9uIGNhY3VsYXRlRmlsZVNpemUoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLmZpbGVTaXplU3VtYXJ5ID0gMDsgLy9Hw6FuIGLhurFuZyAwIMSR4buDIHTDrW5oIGzhuqFpIGtoaSBjw7Mgc+G7sSB0aGF5IMSR4buVaSB04buHcCDEkcOtbmgga8OobQoKICAgICAgdmFyIHR5cGUgPSAiIjsKCiAgICAgIGlmIChtZS5saXN0U291cmNlQXR0YWNobWVudERldGFpbCkgewogICAgICAgIG1lLmxpc3RTb3VyY2VBdHRhY2htZW50RGV0YWlsLmZvckVhY2goZnVuY3Rpb24gKGF0dGFjaG1lbnQpIHsKICAgICAgICAgIHR5cGUgPSBhdHRhY2htZW50LkZpbGVTaXplLnNsaWNlKGF0dGFjaG1lbnQuRmlsZVNpemUubGVuZ3RoIC0gMiwgYXR0YWNobWVudC5GaWxlU2l6ZS5sZW5ndGgpOwoKICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlICJNQiI6CiAgICAgICAgICAgICAgbWUuZmlsZVNpemVTdW1hcnkgKz0gcGFyc2VGbG9hdChhdHRhY2htZW50LkZpbGVTaXplLnNsaWNlKDAsIGF0dGFjaG1lbnQuRmlsZVNpemUubGVuZ3RoIC0gMykpICogMTA0ODU3NjsKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgIktCIjoKICAgICAgICAgICAgICBtZS5maWxlU2l6ZVN1bWFyeSArPSBwYXJzZUZsb2F0KGF0dGFjaG1lbnQuRmlsZVNpemUuc2xpY2UoMCwgYXR0YWNobWVudC5GaWxlU2l6ZS5sZW5ndGggLSAzKSkgKiAxMDI0OwogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0KfTs="},null]}
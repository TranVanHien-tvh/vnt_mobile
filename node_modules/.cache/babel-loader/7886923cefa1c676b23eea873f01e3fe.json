{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\VNT_vue\\src\\components\\msgridviewer\\msGridViewer.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\VNT_vue\\src\\components\\msgridviewer\\msGridViewer.vue","mtime":1670055812039},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90eXBlb2YgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3Rvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2guanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLWluZGV4LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaW5jbHVkZXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNvcnQuanMiOwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwovLwoKLyogZXNsaW50LWRpc2FibGUgKi8KaW1wb3J0IG1zVHIgZnJvbSAiLi9tc1RyIjsKaW1wb3J0IG1zVGggZnJvbSAiLi9tc1RoIjsKaW1wb3J0IG1zUGFnaW5hdGlvbiBmcm9tICIuL21zUGFnaW5hdGlvbiI7CmltcG9ydCBjb21tb25GbiBmcm9tICJAL2NvbW1vbnMvY29tbW9uRnVuY3Rpb24uanMiOwppbXBvcnQgeyBNU0V2ZW50TmFtZSB9IGZyb20gIkAvY29tbW9ucy9ldmVudE5hbWUiOwppbXBvcnQgRXZlbnRCdXNHbG9iYWwsIHsgR2xvYmFsRXZlbnROYW1lIH0gZnJvbSAiQC9jb21tb25zL2V2ZW50QnVzR2xvYmFsIjsKaW1wb3J0IHsgZ3JpZEdyb3VwRGF0YSB9IGZyb20gIkAvbWl4aW5zL2NvbXBvbmVudC9ncmlkR3JvdXBEYXRhIjsKaW1wb3J0IGRyYWdnYWJsZSBmcm9tICJ2dWVkcmFnZ2FibGUiOwppbXBvcnQgeyBNU0VudW0gfSBmcm9tICJAL2NvbW1vbnMvZW51bWVyYXRpb24iOwppbXBvcnQgbXNDb25maWdDb2x1bW4gZnJvbSAiLi9tc0NvbmZpZ0NvbHVtbiI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiTXNHcmlkVmlld2VyIiwKICBjb21wb25lbnRzOiB7CiAgICBtc1RyOiBtc1RyLAogICAgbXNUaDogbXNUaCwKICAgIG1zUGFnaW5hdGlvbjogbXNQYWdpbmF0aW9uLAogICAgZHJhZ2dhYmxlOiBkcmFnZ2FibGUsCiAgICBtc0NvbmZpZ0NvbHVtbjogbXNDb25maWdDb2x1bW4KICB9LAogIG1peGluczogW2dyaWRHcm91cERhdGFdLAogIHByb3BzOiB7CiAgICBmbGV4OiB7CiAgICAgIGRlZmF1bHQ6IHRydWUsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCgogICAgLyoqDQogICAgICogY8OzIHNob3cgdGV4dCBmaWx0ZXIga2hpIGzhu41jIHJhIGtow7RuZw0KICAgICAqLwogICAgaGFzQmluZGluZ0ZpbHRlckhlYWRlcjogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIC8vVmFsdWUgdGjhu7FjIGhp4buHbiBsxrB1IGdpw6EgdHLhu4sgY8OhYyBj4buZdCDEkcaw4bujYyBjaOG7jW4KICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6IEFycmF5LAogICAgICByZXR1cm46IGZ1bmN0aW9uIF9yZXR1cm4oKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICB9LAogICAgLy9EYXRhIGThu68gbGnhu4d1IGdyaWQgdOG7qyBuZ2/DoGkgdHJ1eeG7gW4gdsOgbwogICAgZGF0YTogewogICAgICB0eXBlOiBBcnJheSwKICAgICAgcmV0dXJuOiBmdW5jdGlvbiBfcmV0dXJuKCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUw6puIHRyxrDhu51uZyBraMOzYSBjaMOtbmgNCiAgICAgKi8KICAgIGlkRmllbGQ6IHsKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAoKICAgIC8qKg0KICAgICAqIG5ubGFtIDEzLzAzLzIwMjENCiAgICAgKiBj4bqldSBow6xuaCBjw6FjIHRyxrDhu51uZyBj4bqnbiBzb3J0IG3hurdjIMSR4buLbmgga2hpIGxvYWQgdHJhbmcNCiAgICAgKiBLaeG7g3UgZOG7ryBsaeG7h3UgQXJyYXkgY2jhu6lhIGRhbmggc8OhY2ggY8OhYyBvYmplY3QsIGPhuqV1IHRyw7pjIG9iamVjdCBjw7Mgw610IG5o4bqldCAyIHRyxrDhu51uZyBsw6Agc29ydEZpZWxkKHTDqm4gcHJvcGVydHkgY+G6p24gc29ydCkgdsOgIHNvcnRUeXBlIChsw6AgZGVzYyBoYXkgYXNjKQ0KICAgICAqIHbDrSBk4bulIDogW3tzb3J0RmllbGQ6ICdBc3NldENvZGUnLCBzb3J0VHlwZSA6IHRoaXMuJG1zLmVudW0uU29ydFN0YXR1cy5hc2N9XQ0KICAgICAqLwogICAgZGVmYXVsdFNvcnQ6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIHJldHVybjogZnVuY3Rpb24gX3JldHVybigpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0sCiAgICAvL0PhuqV1IGjDrG5oIGPDoWMgY+G7mXQgdHJ1eeG7gW4gdsOgbwoKICAgIC8qKg0KICAgICAqIEPDoWMgdGh14buZYyB0w61uaCB0cm9uZyBjb2x1bW5zDQogICAgICogQHBhcmFtcyBkYXRhRmllbGQgRmllbGQgZOG7ryBsaeG7h3UgZMO5bmcgxJHhu4Mgbmjhuq1uIGdpw6EgdHLhu4sgdGhheSDEkeG7lWkgdsOgIGhp4buHbiB0aOG7iy4NCiAgICAgKiBAcGFyYW1zIHRpdGxlOlRpw6p1IMSR4buBIGPhu6dhIGPhu5l0DQogICAgICogQHBhcmFtcyB3aWR0aDrEkeG7mSBy4buZbmcgY+G7p2EgY+G7mXQNCiAgICAgKiBAcGFyYW1zIGF1dG9SZXNpemU6Q+G7mXQgdOG7sSDEkeG7mW5nIHRvIHJhIGtoaSBtw6BuIGjDrG5oIGzhu5tuDQogICAgICogQHBhcmFtcyBmb3JtYXRUeXBlOkThu68gbGnhu4d1IGTDuW5nIMSR4buDIGZvcm1hdCBs4bqleSB04burIHRyb25nIGZpbGUgZW51bWVyYXRpb24uanMgRm9ybWF0VHlwZQ0KICAgICAqIEBwYXJhbXMgdGVtcGxhdGU6U+G7rSBk4bulbmcgMSBmaWxlIGtow6FjIOG7nyBuZ2/DoGkgdHJ1eeG7gW4gdsOgbyDEkeG7gyByZW5kZXINCiAgICAgKi8KICAgIGNvbHVtbnM6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIHJldHVybjogZnVuY3Rpb24gX3JldHVybigpIHsKICAgICAgICByZXR1cm4gW107CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQ+G6pXUgaMOsbmggY2hvIGPhu5l0IGNo4bupYyBuxINuZyBsw6AgMSDEkeG7kWkgdMaw4bujbmcgZ+G7k20gY8OzDQogICAgICogdGl0bGU6IHTDqm4gdGnDqnUgxJHhu4EgY+G7mXQgY2jhu6ljIG7Eg25nDQogICAgICogY29tcG9uZW50czonY29tcG9uZW50cyBpbXBvcnQgdsOgbycNCiAgICAgKiB3aWR0aDrEkOG7mSBy4buZbmcgY+G7p2EgY+G7mXQNCiAgICAgKi8KICAgIHdpZGdldE9wdGlvbnM6IHt9LAogICAgLy9TZXQgxJHhu5kgcuG7mW5nIGNobyBncmlkCiAgICBtYXhIZWlnaHQ6IHsKICAgICAgZGVmYXVsdDogbnVsbCwKICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXQogICAgfSwKICAgIC8vQ+G6pXUgaMOsbmggY8OzIHBow6JuIHRyYW5nIGhheSBraMO0bmcKICAgIHBhZ2luYXRpb246IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCgogICAgLyoNCiAgICBDaG8gcGjDqXAgaGnhu4NuIHRo4buLIGhlYWRlciBj4bunYSBsxrDhu5tpIGhheSBraMO0bmc/IG3hurdjIMSR4buLbmggY8OzDQogICAgQ3JlYXRlOiAxNC8wMS8yMDIwDQogICAgQXV0aG9yOiDEkFZUaGkgICAgDQogICAgKi8KICAgIGlzU2hvd0hlYWRlcjogewogICAgICBkZWZhdWx0OiB0cnVlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAoKICAgIC8qDQogICAgQ2hvIHBow6lwIGhp4buDbiB0aOG7iyBjb21ib3ggc+G7kSBkw7JuZyB0csOqbiBt4buZdCB0cmFuZyBoYXkga2jDtG5nPyBt4bq3YyDEkeG7i25oIGPDsw0KICAgIENyZWF0ZTogMTQvMDEvMjAyMA0KICAgIEF1dGhvcjogxJBWVGhpICAgIA0KICAgICovCiAgICBpc1Nob3dQYWdlU2l6ZUNvbWJveDogewogICAgICBkZWZhdWx0OiB0cnVlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAoKICAgIC8qDQogICAgQ2hvIHBow6lwIGhp4buDbiB0aOG7iyBjb21ib3ggc+G7kSBkw7JuZyB0csOqbiBt4buZdCB0cmFuZyBoYXkga2jDtG5nPw0KICAgIENyZWF0ZTogMTQvMDEvMjAyMA0KICAgIEF1dGhvcjogxJBWVGhpICAgIA0KICAgICovCiAgICBwYWdlVG90YWxDYXB0aW9uOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKCiAgICAvKioNCiAgICAgKiBUZXh0IGhp4buDbiB0aOG7iyBi4bqjbiBnaGkNCiAgICAgKi8KICAgIHBhZ2VGcm9tVG9DYXB0aW9uOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIC8vTmjhuq1uIDIgZ2nDoSB0cuG7iyByZW1vdGUvbG9jYWwgxJHhu4MgbOG6pXkgZ2nDoSB0cuG7iyDhu58gc2VydmVyIGhv4bq3YyBsb2NhbAogICAgcXVlcnlNb2RlOiB7CiAgICAgIGRlZmF1bHQ6ICJyZW1vdGUiLAogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICAvL1Phu5EgYuG6o24gZ2hpIHRyw6puIG3hu5tpIHRyYW5nIHRyxrDhu51uZyBo4bujcCBwaMOibiB0cmFuZyBsb2NhbAogICAgcGFnZVNpemU6IHsKICAgICAgZGVmYXVsdDogNTAsCiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIC8vQ+G7mXQgY2hvIHBow6lwIHTDrWNoIGNo4buNbiBuaGnhu4F1IGTDsm5nCiAgICBtdWx0aXBsZTogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIGluZGV4RmxleFJpZ2h0OiB7CiAgICAgIGRlZmF1bHQ6IDEsCiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIC8vVOG7lW5nIHPhu5EgYuG6o24gZ2hpCiAgICBwYWdlVG90YWw6IHsKICAgICAgZGVmYXVsdDogMCwKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAoKICAgIC8qKg0KICAgICAqIHRow7RuZyB0aW4gc3VtbWFyeQ0KICAgICAqIHRyb25nIG7DoHkgc+G6vSBjw7MgdG90YWwgbHXDtG4NCiAgICAgKi8KICAgIHN1bW1hcnk6IHt9LAogICAgLy9IaeG7h24gdGjhu4sgY+G7mXQgc+G7kSB0aOG7qSB04buxCiAgICBzZXJpYWw6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICAvL0NobyBwaMOpcCBkaSBjaHV54buDbiDEkeG7mSBy4buZbmcgY+G7p2EgY+G7mXQgaGF5IGtow7RuZwogICAgcmVzaXplQ29sOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgLy9Ucsaw4budbmcgxJHhu4Mga2nhu4NtIHRyYSBzb3J0IGTGsOG7m2kgY2xpZW50IGhheSB0csOqbiBzZXZlcgogICAgLy9Mb2NhbC9TZXJ2ZQogICAgcmVtb3RlU29ydDogewogICAgICBkZWZhdWx0OiAicmVtb3RlIiwKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgLy9EYXRhIGzDoCBk4bqhbmcgTWFzdGVyL0RldGFpbAogICAgaXNNYXN0ZXJEZXRhaWw6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICBkZXRhaWxGaWVsZDogewogICAgICBkZWZhdWx0OiAiRGV0YWlscyIsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKICAgIGhhc0ZpbHRlckVtcHR5OiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgbG9hZGluZzogewogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIGxvYWRpbmdTdW1tYXJ5OiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgY3VzdG9tQ2xhc3NSb3c6IHsKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKICAgIGxvYWRDaGlsZHJlbkRhdGE6IHsKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKCiAgICAvKioNCiAgICAgKiBBY3Rpb24gY+G7p2Egcm93DQogICAgICovCiAgICByb3dBY3Rpb25zOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFtPYmplY3QsIEFycmF5XQogICAgfSwKCiAgICAvKioNCiAgICAgKiBT4buRIGzGsOG7o25nIGl0ZW0gaGnhu4NuIHRo4buLIGlubGluZSBraGkgaG92ZXIgdsOgbyBkw7JuZw0KICAgICAqIG7hur91IHbGsOG7o3QgcXXDoSBz4buRIGzGsOG7o25nIG7DoHkgdGjDrCBz4bq9IMSR4bq3dCB0cm9uZyBtb3JlIC4uLg0KICAgICAqLwogICAgYWN0aW9uSW5saW5lQ291bnQ6IHsKICAgICAgZGVmYXVsdDogNSwKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAoKICAgIC8qKg0KICAgICAqIERpc2FibGUgY29udHJvbA0KICAgICAqLwogICAgZGlzYWJsZWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgLyoqDQogICAgICogU+G7kSBkw7JuZyBzaGltbWVyIGxvYWRpbmcNCiAgICAgKi8KICAgIHNoaW1tZXJSb3c6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiA1CiAgICB9LAoKICAgIC8qDQogICAgICogdGjDqm0gY+G6pXUgaMOsbmggbmjhu69uZyBj4buZdCBsdcO0biBs4bqleSBraGkgbG9hZCBncmlkDQogICAgICogcHZkdXkgMTkvMDEvMjAyMQ0KICAgICAqLwogICAgYWx3YXlUYWtlQ29sdW1uczogewogICAgICBkZWZhdWx0OiBudWxsLAogICAgICB0eXBlOiBBcnJheQogICAgfSwKCiAgICAvKioNCiAgICAgKiBjw7MgZmlsdGVyIGPhu5l0IGtow7RuZw0KICAgICAqLwogICAgZmlsdGVyYWJsZTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAoKICAgIC8qDQogICAgICogY+G7nSDEkcOhbmggZOG6pXUgbMOgIGdyaWQgc+G7rSBk4bulbmcgdHJvbmcgZm9ybSBjaGkgdGnhur90IC0tIGTDuW5nIMSR4buDIOG6qW4gaGnhu4duIHBow6JuIHRyYW5nDQogICAgICogcHZkdXkgMDMvMDEvMjAyMQ0KICAgICAqLwogICAgaXNHcmlkSW5WaWV3RGV0YWlsOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIENobyBwaMOpcCBz4bqvcCB44bq/cCBs4bqhaSBk4buvIGxp4buHdQ0KICAgICAqLwogICAgZGF0YURyYWdhYmxlOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAoKICAgIC8qDQogICAgICogcHZkdXkgMTkvMDMvMjAyMQ0KICAgICAqIGPhu50geMOhYyBuaOG6rW4geGVtIGPDsyBjaG8gaGnhu4duIOG6o25oIHRy4buRbmcga2hpIGdyaWQga28gY8OzIGThu68gbGnhu4d1IGhheSBraMO0bmc/ID09PiBz4butIGThu6VuZyB0cm9uZyBncmlkIGRldGFpbCBkw7kgdHLhu5FuZyB24bqrbiDhuqluIOG6o25oIMSRaS4NCiAgICAgKi8KICAgIGlzU2hvd0ltYWdlR3JpZEVtcHR5OiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgLy9Dw7MgZm9vdGVyIGhheSBraMO0bmcgPwogICAgZm9vdGVyOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAoKICAgIC8qDQogICAgICogbm5sYW0gMTQvMDQvMjAyMQ0KICAgICAqIGPDsyBjYWNoZSBj4bqldSBow6xuaCBj4buZdCBraMO0bmcsIGhp4buHbiB04bqhaSBu4bq/dSBsxrB1IGNhY2hlIHPhur0gbMawdSBraGkgcmVzaXplIGPhu5l0DQogICAgICovCiAgICBoYXNDYWNoZUNvbDogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKCiAgICAvKg0KICAgICAqIG5ubGFtIDE0LzA0LzIwMjENCiAgICAgKiBraGkgcXVlcnlNb2RlID0gJ2xvY2FsJyB0aMOsIGTDuW5nIGPDoWkgbsOgeSDEkeG7gyBmaWx0ZXINCiAgICAgKi8KICAgIGZpbHRlckZuOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBbQm9vbGVhbiwgRnVuY3Rpb25dCiAgICB9LAoKICAgIC8qDQogICAgICogbm5sYW0gMTQvMDQvMjAyMQ0KICAgICAqIGNobyBwaMOpcCBjaGVjayBkaXNhYmxlIMO0IGNoZWNrYm94IOG7nyByb3cNCiAgICAgKi8KICAgIGRpc2FibGVkQ2hlY2tlZE11bHRpcGxlVGJvZHk6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IFtCb29sZWFuLCBGdW5jdGlvbl0KICAgIH0sCiAgICAvL21vZHVsZSDEkeG7gyB0aOG7sWMgaGnhu4duIGF1dG9jb21wbGV0ZSBraGkgbOG7jWMgdHLDqm4gdGgKICAgIG1vZHVsZUF1dG9jb21wbGV0ZTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogROG7ryBsaeG7h3UgdOG7lW5nDQogICAgICogRMO5bmcgY2hvIHN1bSBs4bqleSB04burIHNlcnZlciB0cnV54buBbiB2w6BvIChraMO0bmcgcGjhu6UgdGh14buZYyB2w6BvIHRyYW5nIMSRYW5nIGhp4buDbiB0aOG7iykNCiAgICAgKi8KICAgIHN1bW1hcnlEYXRhOiB7CiAgICAgIHR5cGU6IE9iamVjdCwKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKCiAgICAvKioNCiAgICAgKiBj4budIHThu7EgxJHhu5luZyBjaOG7jW4gZMOybmcgxJHhuqd1IGdyaWQNCiAgICAgKi8KICAgIGlzQXV0b0ZvY3VzRmlyc3RSb3c6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIGlkUHJvcGVydHk6IHsKICAgICAgZGVmYXVsdDogbnVsbCwKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAoKICAgIC8qDQogICAgICogY+G7nSBjaOG7iSBoaeG7g24gdGjhu4sgdOG7lW5nIHPhu5EgdHJhbmcNCiAgICAgKiBOTVRVQU4yIDAxLjEwLjIwMjENCiAgICAgKi8KICAgIGlzT25seVNob3dQYWdlVG90YWw6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICBwYWdpbmdGcm9tVG9DYXB0aW9uOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKCiAgICAvKioNCiAgICAgKiBiaeG6v24gxJHDoW5oIGThuqV1IGdyaWQgY8OzIHRo4buDIGNobyB0byByb3cNCiAgICAgKiBURE5HSElBIDgvMTAvMjAyMQ0KICAgICAqLwogICAgZ3Jvd1RvSGVpZ2h0OiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAoKICAgIC8qKg0KICAgICAqIEPhu50gY2hvIHBow6lwIGhp4buDbiB0aOG7iyBkw7JuZyBk4buvIGxp4buHdSB0cuG7kW5nDQogICAgICogTk1UVUFOMiAyMy4wOS4yMDIxDQogICAgICovCiAgICBpc1Nob3dFbXB0eVRleHQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBO4buZaSBkdW5nIHR14buzIGNo4buNbiBjaG8gZMOybmcgZOG7ryBsaeG7h3UgdHLhu5FuZw0KICAgICAqIE5NVFVBTjIgMjMuMDkuMjAyMQ0KICAgICAqLwogICAgZW1wdHlUZXh0OiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gZ3JpZCBlbXB0eQ0KICAgICAqIE5UQkFPIDA1LjEwLjIwMjENCiAgICAgKi8KICAgIGN1c3RvbUdyaWRFbXB0eVRlbXBsYXRlOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogTcOjIGNvZGUgxJHhu4MgbeG7nyBtw6BuIGRldGFpbCBwaOG7pWMgduG7pSB0aMOqbS8gc+G7rWEgZOG7ryBsaeG7h3UgZ3JpZA0KICAgICAqIE5NVFVBTjIgMjMuMDkuMjAyMQ0KICAgICAqLwogICAgc3ViU3lzdGVtQ29kZTogewogICAgICBkZWZhdWx0OiBudWxsLAogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCgogICAgLyoqDQogICAgICogZ3JpZCBjw7MgY2hvIGNvbmZpZyBjb2x1bW5zIGtow7RuZw0KICAgICAqIFRETkdISUEgMS8xMC8yMDIxDQogICAgICovCiAgICBpc1Nob3dDb25maWdDb2x1bW46IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCgogICAgLyoqDQogICAgICogS2hv4bqjbmcgY8OhY2ggdOG7qyBjb250ZXh0IG1lbnUgxJHhur9uIG3DqXAgdHLDqm4gY+G7p2Egcm93DQogICAgICogTk1UVUFOMyAyNi8xMC8yMDIxDQogICAgICovCiAgICBoZWlnaHRPZmZzZXQ6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAtMgogICAgfSwKCiAgICAvKioNCiAgICAgKiBIaeG7g24gdGjhu4sgaWNvbiB0cm9uZyBjb250ZXh0IG1lbnUNCiAgICAgKiBOTVRVQU4zIDI2LzEwLzIwMjENCiAgICAgKi8KICAgIGhhc0ljb246IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKCiAgICAvKioNCiAgICAgKiB0cnVlOiBidWlsZCBj4bqjIGdyb3VwIGPDsyAxIHBo4bqnbiB04butDQogICAgICogZmFsc2U6IGtow7RuZyBidWlsZCBncm91cCBjw7MgMSBwaOG6p24gdOG7rQ0KICAgICAqIE5NVFVBTjMgMTcvMTEvMjAyMQ0KICAgICAqLwogICAgaXNBbHdheXNHcm91cDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGN1c3RvbSBkw7JuZyDEkcaw4bujYyBmb2N1cyDEkeG6p3UgdGnDqm4NCiAgICAgKi8KICAgIGdldFJvd0F1dG9Gb2N1czogewogICAgICB0eXBlOiBbRnVuY3Rpb24sIE9iamVjdF0sCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICAvL0RhdGEgdHJvbmcgZ3JpZCBkw7luZyDEkeG7gyByZW5kZXIKICAgICAgZGF0YXg6IG51bGwsCiAgICAgIC8vQ29sdW1ucyB0cm9uZyBncmlkIGTDuW5nIMSR4buDIHJlbmRlcgogICAgICBjb2x1bW54OiBbXSwKICAgICAgLy9Nb2RlIGNobyBwaMOpcCBjb3B5IGThu68gbGnhu4d1IGhheSBraMO0bmcgdGjhu7FjIGhp4buHbiB24bubaSBjw6FjIGV2ZW50IGvDqW8gdGjhuqMgY+G7mXQsxJHhu5kgcuG7mW5nLC4uLgogICAgICBzZWxlY3RlZFRleHRNb2RlOiBmYWxzZSwKICAgICAgLy9UcmFuZyBoaeG7h24gdOG6oWkKICAgICAgY3VycmVudFBhZ2U6IDEsCiAgICAgIC8vRMOybmcgxJFhbmcgxJHGsOG7o2MgY2jhu41uCiAgICAgIHJvd1NlbGVjdGVkOiB7fSwKICAgICAgLy9LaeG7g20gdHJhIGRhdGEgxJHDoyDEkcaw4bujYyBsb2FkIGhheSBjaMawYQogICAgICBkYXRhTG9hZGVkOiBmYWxzZSwKICAgICAgaGFzU2Nyb2xsOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogVuG7iyB0csOtIGhp4buDbiB0aOG7iyBj4bunYSBib3ggZW1wdHkNCiAgICAgICAqLwogICAgICBlbXB0eVN0eWxlOiB7CiAgICAgICAgdG9wOiAwLAogICAgICAgIGxlZnQ6IDAsCiAgICAgICAgZGlzcGxheTogIm5vbmUiCiAgICAgIH0sCiAgICAgIHBhZ2VUb3RhbENhcHRpb25EYXRhOiB0aGlzLnBhZ2VUb3RhbENhcHRpb24gfHwgdGhpcy4kdCgiaTE4bkNvbXBvbmVudC5QYWdpbmcuVG90YWwiKSwKCiAgICAgIC8qKg0KICAgICAgICogRmlsdGVyIHRyw6puIHRpw6p1IMSR4buBIGPhu5l0DQogICAgICAgKi8KICAgICAgZmlsdGVySGVhZGVyOiBbXSwKCiAgICAgIC8qKg0KICAgICAgICogw7Qgc2VhcmNoIHRleHQgdOG7qyBmb3JtIGLDqm4gbmdvw6BpDQogICAgICAgKi8KICAgICAgcGFyZW50U2VhcmNoVGV4dDogIiIsCgogICAgICAvKioNCiAgICAgICAqIGhlYWRlciByZW5kZXINCiAgICAgICAqLwogICAgICBoZWFkZXJzOiBbXSwKCiAgICAgIC8qDQogICAgICBDaG8gc2hvdyB04bqldCBj4bqjIGljb24gZmlsdGVyIGhlYWRlciBsw6puDQogICAgICBDcmVhdGU6IDIwLzA1LzIwMjANCiAgICAgIEF1dGhvcjogTk5MQU0gICAgDQogICAgICAqLwogICAgICBzaG93QWxsSWNvbkZpbHRlcjogZmFsc2UsCgogICAgICAvKioNCiAgICAgICAqIGZvb3RlciByZW5kZXINCiAgICAgICAqLwogICAgICBmb290ZXJzOiBbXSwKCiAgICAgIC8qKg0KICAgICAgICogaGVhZGVyIHJlbmRlcg0KICAgICAgICovCiAgICAgIGZpcnN0TG9hZDogdHJ1ZSwKICAgICAgLy904buVbmcgc+G7kSBi4bqjbiBnaGkgKCB0csaw4budbmcgaOG7o3AgcXVlcnkgbG9jYWwpCiAgICAgIHBhZ2VUb3RhbEZuOiBudWxsLAoKICAgICAgLyoqDQogICAgICAgKiBnacOhIHRy4buLIHN0eWxlIGxlZnQgY+G7p2EgY+G7mXQgc2VyaWFsDQogICAgICAgKi8KICAgICAgc2VyaWFsT2Zmc2V0TGVmdDogIjAiLAoKICAgICAgLyoqDQogICAgICAgKiBDw7MgY+G7mXQgbG9jaw0KICAgICAgICovCiAgICAgIGhhc0xvY2tDb2x1bW46IGZhbHNlLAoKICAgICAgLyoqDQogICAgICAgKiBDw7MgxJFhbmcgc+G7rSBk4bulbmcgcGjDrW0gdOG6r3QgxJHhu4MgY2jhu41uIG5oYW5oIGPDoWMgYuG6o24gZ2hpIGhheSBraMO0bmcNCiAgICAgICAqLwogICAgICBzaG9ydEtleUZvclF1aWNrU2VsZWN0OiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogTmjhu69uZyBi4bqjbiBnaGkgZGMgY2jhu41uIG5oYW5oIHThu6sgc2hvcnRrZXkNCiAgICAgICAqLwogICAgICBzaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhOiBbXSwKCiAgICAgIC8qKg0KICAgICAgICogxJDDoW5oIGThuqV1IGhp4buDbiB0aOG7iyBjb25maWcgY29sdW1uIGJveA0KICAgICAgICogVEROR0hJQSAxLzEwLzIwMjENCiAgICAgICAqLwogICAgICBzaG93aW5nQ29uZmlnQ29sdW1uQm94OiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogQ2FjaGUgY29uZmlnIGNvbHVtbiBiYW4gxJHhuqd1IGNobyBncmlkDQogICAgICAgKiBURE5HSElBIDEwLzQvMjAyMQ0KICAgICAgICovCiAgICAgIGNvbmZpZ0NvbHVtbk9yaWdpbmFsOiBbXSwKCiAgICAgIC8qKg0KICAgICAgICogxJDDoW5oIGThuqV1IGNoZWNrYm94YWxsIHRyw6puIGhlYWRlciDEkWFuZyB0cuG6oW5nIHRow6FpIHRydW5nIGdpYW4NCiAgICAgICAqIFRETkdISUEgOC8xMC8yMDIxDQogICAgICAgKi8KICAgICAgaXNUZW1wU3RhdGU6IGZhbHNlLAoKICAgICAgLyoqDQogICAgICAgKiBnacOhIHRy4buLIHN0eWxlIGxlZnQgY+G7p2EgY+G7mXQgY2hlY2tib3gNCiAgICAgICAqIE5NVFVBTjIgMjIuMDMuMjAyMg0KICAgICAgICovCiAgICAgIG11bHRpcGxlT2Zmc2V0TGVmdDogIjAiCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8qKg0KICAgICAqIFPhu5EgbMaw4bujbmcgY+G7mXQgc2hpbW1lcg0KICAgICAqLwogICAgc2hpbW1lckNvbHVtbjogZnVuY3Rpb24gc2hpbW1lckNvbHVtbigpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHJlcyA9IFtdOwoKICAgICAgaWYgKG1lLm11bHRpcGxlKSB7CiAgICAgICAgcmVzLnB1c2goewogICAgICAgICAgb2Zmc2V0OiAwLAogICAgICAgICAgbG9jazogbWUuaGFzTG9ja0NvbHVtbgogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAobWUuc2VyaWFsKSB7CiAgICAgICAgcmVzLnB1c2goewogICAgICAgICAgb2Zmc2V0OiBtZS5tdWx0aXBsZSA/IDYwIDogMCwKICAgICAgICAgIGxvY2s6IG1lLmhhc0xvY2tDb2x1bW4KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkobWUuY29sdW1ueCkpIHsKICAgICAgICBtZS5jb2x1bW54LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIHJlcy5wdXNoKHsKICAgICAgICAgICAgb2Zmc2V0OiBpdGVtLnN0aWNreU9mZnNldCwKICAgICAgICAgICAgbG9jazogaXRlbS5sb2NrCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlczsKICAgIH0sCiAgICAvL0tp4buDbSB0cmEgY8OzIGzhuq9uZyBuZ2hlIHjhu60gbMO9IHPhu7Ega2nhu4duIGRibGljayBoYXkga2jDtG5nPyBu4bq/dSBjw7MgdGjDrCDEkeG7lWkgaWNvbiB0aMOgbmggcG9pbnRlcgogICAgY2hlY2tMaXN0ZW5lckRiQ2xpY2s6IGZ1bmN0aW9uIGNoZWNrTGlzdGVuZXJEYkNsaWNrKCkgewogICAgICBpZiAodGhpcy5fZXZlbnRzLmRibGNsaWNrICYmIHRoaXMuX2V2ZW50cy5kYmxjbGljay5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0sCiAgICAvL0jDoG0ga2nhu4NtIHRyYSB4ZW0gY8OzIHNjcm9sbCBoYXkga2jDtG5nPwogICAgc2Nyb2xsVmlzaWFibGU6IGZ1bmN0aW9uIHNjcm9sbFZpc2lhYmxlKCkgewogICAgICBpZiAodGhpcy5oYXNTY3JvbGwpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfSwKICAgIC8vU+G7sSBraeG7h24gdOG7qyAxIGTDsm5nIGThu68gbGnhu4d1IGVtaXQgcmEgbmdvw6BpCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTguMDYuMjAyMCkKICAgIGxpc3RlbmVyczogZnVuY3Rpb24gbGlzdGVuZXJzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIHsKICAgICAgICBjbGljazogZnVuY3Rpb24gY2xpY2soZGF0YVJvdywgZXZlbnQpIHsKICAgICAgICAgIGlmIChtZS5yb3dTZWxlY3RlZCAmJiBtZS5yb3dTZWxlY3RlZC5kYXRhICE9IGRhdGFSb3cpIHsKICAgICAgICAgICAgdmFyIGluZGV4Um93ID0gbWUuZGF0YXguZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0gPT0gZGF0YVJvdzsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkID0gewogICAgICAgICAgICAgIGRhdGE6IGRhdGFSb3csCiAgICAgICAgICAgICAgaW5kZXg6IGluZGV4Um93CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpZiAoZXZlbnQgJiYgIW1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QpIHsKICAgICAgICAgICAgICBtZS5vbGRJbmRleE9mUm93Rm9jdXNlZCA9IG1lLmluZGV4T2ZSb3dGb2N1c2VkOwogICAgICAgICAgICAgIG1lLmluZGV4T2ZSb3dGb2N1c2VkID0gbWUuZGF0YXguZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbSA9PSBkYXRhUm93OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5mb2N1cygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIW1lLm11bHRpcGxlKSB7CiAgICAgICAgICAgICAgbWUuc2VsZWN0ZWQgPSBkYXRhUm93OwogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmRhdGEgPSBkYXRhUm93OwogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gbWUuZGF0YXguZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbSA9PSBkYXRhUm93OwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgbWUuJGVtaXQoImNsaWNrIiwgZGF0YVJvdyk7CiAgICAgICAgfSwKICAgICAgICBkcmlsbGRvd25DbGljazogZnVuY3Rpb24gZHJpbGxkb3duQ2xpY2sobWV0YURhdGEsIGV2ZW50KSB7CiAgICAgICAgICBpZiAoZXZlbnQpIHsKICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmZvY3VzKCk7CiAgICAgICAgICB9CgogICAgICAgICAgX3RoaXMuJGVtaXQoImRyaWxsZG93bkNsaWNrIiwgbWV0YURhdGEpOwogICAgICAgIH0sCiAgICAgICAgLy9UVkxPSSAyMi4wNS4yMDIxIEV2ZW50IENsaWNrIHbDoG8gY+G7mXTEkeG6oWkgZGnhu4duIGNobyBuaGnhu4F1IGTDsm5nIGNoaSB0aeG6v3QKICAgICAgICB2aWV3TW9yZURldGFpbHM6IGZ1bmN0aW9uIHZpZXdNb3JlRGV0YWlscyhtZXRhRGF0YSwgZXZlbnQpIHsKICAgICAgICAgIGlmIChldmVudCkgewogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBfdGhpcy4kZW1pdCgidmlld01vcmVEZXRhaWxzIiwgbWV0YURhdGEpOwogICAgICAgIH0sCiAgICAgICAgZm9jdXM6IGZ1bmN0aW9uIGZvY3VzKGRhdGFSb3csIGV2ZW50KSB7CiAgICAgICAgICBpZiAobWUucm93U2VsZWN0ZWQgJiYgbWUucm93U2VsZWN0ZWQuZGF0YSAhPSBkYXRhUm93ICYmICFtZS5zaG9ydEtleUZvclF1aWNrU2VsZWN0KSB7CiAgICAgICAgICAgIHZhciBpbmRleFJvdyA9IG1lLmRhdGF4LmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgIHJldHVybiBpdGVtID09IGRhdGFSb3c7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBtZS5yb3dTZWxlY3RlZCA9IHsKICAgICAgICAgICAgICBkYXRhOiBkYXRhUm93LAogICAgICAgICAgICAgIGluZGV4OiBpbmRleFJvdwogICAgICAgICAgICB9OwogICAgICAgICAgICBldmVudC50YXJnZXQuZm9jdXMoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBtZS4kZW1pdCgiZm9jdXMiLCBkYXRhUm93KTsKICAgICAgICB9LAogICAgICAgIG1vdXNlb3ZlcjogZnVuY3Rpb24gbW91c2VvdmVyKGRhdGFSb3csIGV2ZW50KSB7CiAgICAgICAgICBtZS4kZW1pdCgicm93bW91c2VvdmVyIiwgZGF0YVJvdywgZXZlbnQpOwogICAgICAgIH0sCiAgICAgICAgcm93YWN0aW9uY2xpY2s6IGZ1bmN0aW9uIHJvd2FjdGlvbmNsaWNrKGNvbW1hbmQsIGRhdGFSb3csIGV2ZW50KSB7CiAgICAgICAgICAvLyBOTVRVQU4yIDIzLjA5LjIwMjE6IGLhu5Ugc3VuZyDEkeG7gyBwaOG7pWMgduG7pSB0cnV54buBbiBrw6htIDEgc+G7kSB0aMO0bmcgdGluIHR14buzIGNo4buJbmgKICAgICAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgICAgICBTdWJTeXN0ZW1Db2RlOiBtZS5zdWJTeXN0ZW1Db2RlCiAgICAgICAgICB9OwogICAgICAgICAgbWUuJGVtaXQoInJvd2FjdGlvbmNsaWNrIiwgY29tbWFuZCwgZGF0YVJvdywgZXZlbnQsIG9wdGlvbnMpOwogICAgICAgIH0sCiAgICAgICAgZGJsY2xpY2s6IGZ1bmN0aW9uIGRibGNsaWNrKGRhdGFSb3csIGV2ZW50KSB7CiAgICAgICAgICBtZS4kZW1pdCgiZGJsY2xpY2siLCBkYXRhUm93LCBldmVudCk7CiAgICAgICAgfSwKICAgICAgICBrZXlkb3duOiBmdW5jdGlvbiBrZXlkb3duKGRhdGFSb3csIGV2ZW50KSB7CiAgICAgICAgICBtZS5yb3dfa2V5ZG93bihkYXRhUm93LCBldmVudCk7CiAgICAgICAgICBtZS4kZW1pdCgia2V5ZG93biIsIGRhdGFSb3csIGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIHdpZGdldEV2ZW50OiBmdW5jdGlvbiB3aWRnZXRFdmVudChkYXRhLCBldmVudCkgewogICAgICAgICAgbWUuJGVtaXQoIndpZGdldEV2ZW50IiwgZGF0YSwgZXZlbnQpOwogICAgICAgIH0sCiAgICAgICAgY2xpY2tNdWx0aXBsZTogZnVuY3Rpb24gY2xpY2tNdWx0aXBsZShkYXRhUm93LCBjaGVja2VkKSB7CiAgICAgICAgICBtZS5jbGlja011bHRpcGxlKGRhdGFSb3csIGNoZWNrZWQpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0sCiAgICAvLyAvL1NldCBzdHlsZSBjaG8gZ3JpZCDEkeG7mSBy4buZbmcsLi4uCiAgICBncmlkVmlld1N0eWxlOiBmdW5jdGlvbiBncmlkVmlld1N0eWxlKCkgewogICAgICBpZiAodGhpcy5tYXhIZWlnaHQpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgIm1heC1oZWlnaHQiOiB0aGlzLm1heEhlaWdodAogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0sCiAgICBkYXRhRW1wdHk6IGZ1bmN0aW9uIGRhdGFFbXB0eSgpIHsKICAgICAgLy8gcmV0dXJuIGZhbHNlOwogICAgICBpZiAodGhpcy5kYXRheCAmJiB0aGlzLmRhdGF4Lmxlbmd0aCA+IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogS2nhu4NtIHRyYSB4ZW0gdOG6pXQgY+G6oyBk4buvIGxp4buHdSBjw7MgxJFhbmcgxJHGsOG7o2MgY2hlY2sgaGF5IGtow7RuZw0KICAgICAqIEfhu41pIMSR4bq/biBt4buXaSBraGkgdGljayBjaOG7jW4gY2hlY2tib3gNCiAgICAgKiBURE5HSElBIDgvMTAvMjAyMTogVGjDqm0gbHXhu5NuZyBjaGVjayBu4bq/dSBtw6AgY2jGsGEgdGljayDEkeG7pyB0aMOsIHPhur0gYWRkIGNsYXNzIHRlbXANCiAgICAgKiB0cuG6oW5nIHRow6FpIGNoZWNrYm94IGhp4buHbiB04bqhaSBz4bq9IGzDoCB0cnVuZyBnaWFuIHPhu60gZOG7pW5nIMSR4buDIGLhu48gY2jhu41uDQogICAgICovCiAgICBpc0NoZWNrZWRNdWx0aXBsZTogZnVuY3Rpb24gaXNDaGVja2VkTXVsdGlwbGUoKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgaWYgKHRoaXMudmFsdWUpIHsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZGF0YXguZmlsdGVyKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICByZXR1cm4gIWkuaXNEaXNhYmxlZENoZWNrQm94OwogICAgICAgIH0pOyAvL3TDrG0gdOG6pXQgY+G6oyBi4bqjbiBnaGkgdHLDqm4gcGFnZSBtw6Agw7QgY2hlY2tib3ggayBi4buLIGRpc2FibGVkCiAgICAgICAgLy/EkFZUaGkgMTkvMDEvMjAyMTogc+G7rWEgbOG7l2kgVEEga2hpIG1lLmRhdGF4IG51bGwgdGjDrCDEkW/huqFuIGNvZGUgbsOgeSB2xINuZyBs4buXaSBUQQoKICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAvL1RyxrDhu51uZyBo4bujcCBjaOG7jW4gaOG6v3QgdGjDrCB0aWNrIHbDoG8gY2hlY2tib3hhbGwKICAgICAgICAgIGlmICh0aGlzLnZhbHVlLmxlbmd0aCA+PSBkYXRhLmxlbmd0aCAmJiBkYXRhLmV2ZXJ5KGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gX3RoaXMyLnZhbHVlLmluY2x1ZGVzKGl0ZW0pOwogICAgICAgICAgfSkpIHsKICAgICAgICAgICAgdGhpcy5pc1RlbXBTdGF0ZSA9IGZhbHNlOyAvL3Thuq90IHRy4bqhbmcgdGjDoWkgdHJ1bmcgZ2lhbiDEkWkKCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9O4bq/dSBjaMawYSBjaOG7jW4gaOG6v3QgdGjDrCBjaGVjayB4ZW0gY8OzIMSRYW5nIHRpY2sgZMOybmcgbsOgbyBraMO0bmcKICAgICAgICAgICAgLy9O4bq/dSBjw7MgdGljayB0aMOsIHRy4bqhbmcgdGjDoWkgbMOgIHRydW5nIGdpYW4KICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUubGVuZ3RoIDwgZGF0YS5sZW5ndGggJiYgdGhpcy52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgdGhpcy5pc1RlbXBTdGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuaXNUZW1wU3RhdGUgPSBmYWxzZTsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxvY2tDb3VudDogZnVuY3Rpb24gbG9ja0NvdW50KCkgewogICAgICAvLyBsZXQgY291bnQgPSB0aGlzLm11bHRpcGxlID8gMSA6IDA7CiAgICAgIHZhciBjb3VudCA9IDA7CgogICAgICBpZiAodGhpcy5jb2x1bW54KSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNvbHVtbngubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBjb2wgPSB0aGlzLmNvbHVtbnhbaV07CgogICAgICAgICAgaWYgKCFjb2wubG9jaykgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGNvdW50OwogICAgfSwKICAgIHN0aWNrZXlDb3VudENsYXNzOiBmdW5jdGlvbiBzdGlja2V5Q291bnRDbGFzcygpIHsKICAgICAgdmFyIGNvdW50ID0gdGhpcy5sb2NrQ291bnQ7CgogICAgICBpZiAoY291bnQgPiAwKSB7CiAgICAgICAgaWYgKHRoaXMuc2VyaWFsKSB7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIFsic3RpY2t5IiwgY291bnRdLmpvaW4oIi0iKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAogICAgLy9TdHlsZSB0w61uaCBs4bqhaSB04buNYSDEkeG7mSBjaG8gZm9vdGVyIGtoaSBjw7MgcGFnaW5hdGlvbgogICAgYm90dG9tRm9vdGVyOiBmdW5jdGlvbiBib3R0b21Gb290ZXIoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUucGFnaW5hdGlvbiAmJiBtZS5mb290ZXIpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgYm90dG9tOiAiNDZweCIKICAgICAgICB9OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBib3R0b206ICIwcHgiCiAgICAgICAgfTsKICAgICAgfQogICAgfQogIH0sCgogIC8qKg0KICAgKg0KICAgKi8KICB3YXRjaDogewogICAgZGF0YTogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIHRoaXMuY2hlY2tIYXNTY3JvbGwoKTsKCiAgICAgICAgaWYgKG1lLmRhdGF4ICE9IG1lLmRhdGEpIHsKICAgICAgICAgIG1lLmluaXREYXRhKG5ld1ZhbCk7CgogICAgICAgICAgaWYgKG1lLmZpcnN0TG9hZCAmJiBuZXdWYWwubGVuZ3RoID4gMCkgewogICAgICAgICAgICBtZS5maXJzdExvYWQgPSBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAobWUuZ3JvdXBGaWVsZCkgewogICAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIG1lLmRlZmF1bHRFeHBhbmQoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IC8vIGNoZWNrIHNlbGVjdGVkIGPDoWMgYuG6o24gZ2hpIGtoaSBtw6AgbG9hZCBs4bqhaSB0cmFuZyBob+G6t2Mgc2VhcmNoIGzDoG0gdGhheSDEkeG7lWkgZGF0YSBncmlkCgoKICAgICAgICAgIGlmIChtZS52YWx1ZSkgewogICAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBWTW9kZWwgPSBfdG9Db25zdW1hYmxlQXJyYXkobWUudmFsdWUpOwoKICAgICAgICAgICAgICBWTW9kZWwuZm9yRWFjaChmdW5jdGlvbiAoZGF0YVJvdykgewogICAgICAgICAgICAgICAgdmFyIG1hcCA9IG1lLmRhdGF4LmZpbmQoZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFbbWUuaWRGaWVsZF0gPT0gZGF0YVJvd1ttZS5pZEZpZWxkXTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChtYXApIHsKICAgICAgICAgICAgICAgICAgbWUudmFsdWUucmVtb3ZlKGRhdGFSb3cpOwogICAgICAgICAgICAgICAgICBtZS52YWx1ZS5wdXNoKG1hcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUudmFsdWUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IC8vbuG6v3Uga2jDtG5nIGPDsyBk4buvIGxp4buHdSB0w61uaCB0b8OhbiB24buLIHRyw60gaGnhu4NuIHRo4buLIGPhu6dhIGJveCBlbXB0eQogICAgICAgIC8vY29udHJvbCBjaMawYSByZW5kZXIgdGjDrCBjxaluZyBrIHjhu60gbMO9CgoKICAgICAgICBpZiAoKCFuZXdWYWwgfHwgbmV3VmFsLmxlbmd0aCA9PT0gMCkgJiYgbWUuJGVsKSB7CiAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgc2Nyb2xsID0gbWUuJHJlZnMuY29udGVudDsKCiAgICAgICAgICAgIGlmIChzY3JvbGwpIHsKICAgICAgICAgICAgICB2YXIgc2Nyb2xsUG9zID0gc2Nyb2xsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgIG1lLmVtcHR5U3R5bGUgPSB7CiAgICAgICAgICAgICAgICB0b3A6IFtzY3JvbGxQb3MudG9wICsgc2Nyb2xsUG9zLmhlaWdodCAvIDIgLSA5NSwgInB4Il0uam9pbigiIiksCiAgICAgICAgICAgICAgICBsZWZ0OiBbc2Nyb2xsUG9zLmxlZnQgKyBzY3JvbGxQb3Mud2lkdGggLyAyIC0gMTI1LCAicHgiXS5qb2luKCIiKQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGxvYWRpbmc6IGZ1bmN0aW9uIGxvYWRpbmcoaXNMb2FkaW5nKSB7CiAgICAgIGlmICghaXNMb2FkaW5nKSB7CiAgICAgICAgdGhpcy5hdXRvU2VsZWN0ZWRGaXJzdFJvdyhmYWxzZSk7CiAgICAgIH0KICAgIH0sCiAgICBwYWdlU2l6ZTogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHsKICAgICAgICB0aGlzLiRlbWl0KCJwYWdlU2l6ZSIsIG5ld1ZhbCk7CiAgICAgIH0KICAgIH0sCiAgICByb3dTZWxlY3RlZDogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXI6IGZ1bmN0aW9uIGhhbmRsZXIobmV3VmFsLCBvbGRWYWwpIHt9CiAgICB9CiAgfSwKICAvL07hur91IGThu68gbGnhu4d1IHRoYXkgxJHhu5VpIHRow6wgY2hlY2sgc2Nyb2xsCiAgdXBkYXRlZDogZnVuY3Rpb24gdXBkYXRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICBtZS51cGRhdGVTaXplKCk7CiAgfSwKCiAgLyoqDQogICAqIEjDoG0ga2jhu59pIHThuqFvIGdyaWQga2jhu59pIHThuqFvIGNvbHVtbiB2w6BvIGRhdGENCiAgICogQ3JlYXRlZCBieSBMVERBVCAxNi4wNi4yMDIwDQogICAqLwogIGNyZWF0ZWQ6IGZ1bmN0aW9uIGNyZWF0ZWQoKSB7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgbWUuaW5pdENvbHVtbnMoKTsKICAgIG1lLmluaXREYXRhKCk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrT3V0R3JpZCk7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgbWUudXBkYXRlU2l6ZSk7CiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkge30sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrT3V0R3JpZCk7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgbWUudXBkYXRlU2l6ZSk7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvKioNCiAgICAgKiBDaHV54buDbiB24buBIHRyYW5nIGNo4buJIMSR4buLbmgNCiAgICAgKi8KICAgIHNldFBhZ2U6IGZ1bmN0aW9uIHNldFBhZ2UocGFnZSkgewogICAgICB0aGlzLmN1cnJlbnRQYWdlID0gcGFnZTsKICAgIH0sCgogICAgLyoqDQogICAgICogSGnhu4NuIHRo4buLIHRleHQgdMOtbmggdOG7lW5nIHRoZW8gxJHhu4tuaCBk4bqhbmcgZm9ybWF0DQogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbCBj4bqldSBow6xuaCBj4buZdA0KICAgICAqIEBhdXRob3IgTlZMQU0gMTAuMTIuMjAyMA0KICAgICAqLwogICAgZ2V0U3VtbWFyeURpc3BsYXk6IGZ1bmN0aW9uIGdldFN1bW1hcnlEaXNwbGF5KGNvbCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZGF0YVJlbmRlciA9ICIiOwoKICAgICAgaWYgKG1lLnN1bW1hcnlEYXRhKSB7CiAgICAgICAgZGF0YVJlbmRlciA9IG1lLnN1bW1hcnlEYXRhW2NvbC5kYXRhRmllbGRdOwogICAgICB9IGVsc2UgewogICAgICAgIGRhdGFSZW5kZXIgPSBjb2wuZm9vdGVyQ29tbWFuZCA/IG1lLmRvRnVuY3Rpb24oY29sLmZvb3RlckNvbW1hbmQsIGNvbC5kYXRhRmllbGQsIGNvbC5kYXRhRm9ybWF0KSA6IGNvbC5mb290ZXJUZXh0OwogICAgICB9CgogICAgICB2YXIgdmFsdWUgPSBtZS4kb3B0aW9ucy5maWx0ZXJzLmZvcm1hdERhdGEoZGF0YVJlbmRlciwgewogICAgICAgIGZvcm1hdFR5cGU6IGNvbC5kYXRhRm9ybWF0IHx8IGNvbC5mb3JtYXRUeXBlLAogICAgICAgIGlzUmVwb3J0OiBtZS5pc1JlcG9ydFZpZXdlciwKICAgICAgICBvcHRpb25Gb3JtYXQ6IGNvbC5vcHRpb25Gb3JtYXQKICAgICAgfSk7CiAgICAgIHJldHVybiB2YWx1ZSA9PSAiLS0iIHx8IHZhbHVlID09ICItIiA/IG51bGwgOiB2YWx1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogVGjhu7FjIGhp4buHbiB0aGVvIGPDtG5nIHRo4bupYyDEkcaw4bujYyBj4bqldSBow6xuaCB04bqhaSBj4bqldSBow6xuaCBj4buZdA0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjb21tYW5kOiBjw7RuZyB0aOG7qWMNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gZmllbGQ6IGPhu5l0DQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGRhdGFGb3JtYXQ6IGtp4buDdSBk4buvIGxp4buHdSBj4bunYSBj4buZdA0KICAgICAqIEBhdXRob3IgTlZMQU0gMjQuMDkuMjAyMA0KICAgICAqLwogICAgZG9GdW5jdGlvbjogZnVuY3Rpb24gZG9GdW5jdGlvbihjb21tYW5kLCBmaWVsZCwgZGF0YUZvcm1hdCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgcmVzdWx0OwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSBNU0VudW0uRm9vdGVyQ29tbWFuZC5TdW06CiAgICAgICAgICByZXN1bHQgPSBtZS5zdW1GaWVsZChmaWVsZCwgZGF0YUZvcm1hdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBNU0VudW0uRm9vdGVyQ29tbWFuZC5TdW1BbGw6CiAgICAgICAgICByZXN1bHQgPSBtZS5zdW1BbGxGaWVsZChmaWVsZCwgZGF0YUZvcm1hdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKICAgIC8vIFRpbmhzIHRvbmcgdHJlbiBmaWVsZAogICAgc3VtRmllbGQ6IGZ1bmN0aW9uIHN1bUZpZWxkKGZpZWxkLCBkYXRhRm9ybWF0KSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBzdW0gPSAwOwogICAgICBtZS5kYXRheC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW1bZmllbGRdKSB7CiAgICAgICAgICBzdW0gKz0gcGFyc2VGbG9hdChpdGVtW2ZpZWxkXSk7IC8vLnRvRml4ZWQoRm9ybWF0VXRpbC5nZXREZWNpbWFsRGlnaXRCeUZvcm1hdFR5cGUoZGF0YUZvcm1hdCkpCiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHN1bTsKICAgIH0sCgogICAgLyoqDQogICAgICogVMOtbmggdOG7lW5nIHThuqV0IGPhuqMgY8OhYyBk4buvIGxp4buHdSB0aGVvIGZpZWxkDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGZpZWxkOiBj4buZdA0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBkYXRhRm9ybWF0OiBraeG7g3UgZOG7ryBsaeG7h3UgY+G7p2EgY+G7mXQNCiAgICAgKiBAYXV0aG9yIE5WTEFNIDI0LjA5LjIwMjANCiAgICAgKi8KICAgIHN1bUFsbEZpZWxkOiBmdW5jdGlvbiBzdW1BbGxGaWVsZChmaWVsZCwgZGF0YUZvcm1hdCkgewogICAgICB2YXIgc3VtID0gMCwKICAgICAgICAgIGRhdGEgPSBtZS5kYXRheDsKCiAgICAgIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCkgewogICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgaWYgKGl0ZW1bZmllbGRdKSB7CiAgICAgICAgICAgIHN1bSArPSBwYXJzZUZsb2F0KGl0ZW1bZmllbGRdKTsgLy8udG9GaXhlZChGb3JtYXRVdGlsLmdldERlY2ltYWxEaWdpdEJ5Rm9ybWF0VHlwZShkYXRhRm9ybWF0KSkKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc3VtOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gY2jhu41uIGTDsm5nIMSR4bqndSB0acOqbg0KICAgICAqIGlzY2hlY2tib3g6IGPDsyB0w61jaCBjaOG7jW4gdsOgbyDDtCBjaGVja2JveCBraMO0bmcsIG3hurdjIMSR4buLbmggbMOgIGtow7RuZyB2w6AgY2jhu4kgxJHGoW4gdGh14bqnbiBsw6AgY2xpY2sgdsOgbyBkw7JuZyDEkeG6p3UgdGnDqm4NCiAgICAgKiBjcmVhdGVkIGJ5IG5ubGFtIDA2LjAzLjIwMjENCiAgICAgKiBURE5HSElBIDIvMTIvMjAyMTogaXNDaGVja2JveCDEkWFuZyB0cnV54buBbiBldmVudCB2w6BvIG7Dqm4gbMO6YyBuw6BvIGPFqW5nIGNo4buNbiBkYyBraMO0bmcgcsO1IGzDvSBkbyA9PiBpc0NoZWNrYm94ICA9IGZhbHNlDQogICAgICovCiAgICBhdXRvU2VsZWN0ZWRGaXJzdFJvdzogZnVuY3Rpb24gYXV0b1NlbGVjdGVkRmlyc3RSb3coaXNjaGVja2JveCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChtZS5kYXRheC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBpZiAoaXNjaGVja2JveCkgewogICAgICAgICAgICAvL1RETkdISUEgMi8xMi8yMDIxOiBraMO0bmcgYmFvIGdp4budIHbDoG8gxJHDonkgbuG7r2EKICAgICAgICAgICAgbWUuaW5kZXhPZlJvd0ZvY3VzZWQgPSAwOwogICAgICAgICAgICBtZS5yb3dTZWxlY3RlZCA9IHsKICAgICAgICAgICAgICBkYXRhOiBtZS5kYXRheFswXSwKICAgICAgICAgICAgICBpbmRleDogMAogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdHJGaXJzdCA9IG1lLiRlbC5xdWVyeVNlbGVjdG9yKCIubXMtdGJvZHkuZGF0YSB0ciIpOyAvL05UQkFPOiAyNi4xMS4yMDIxIFThuqFvIHRow6ptIGjDoG0gbOG6pXkgZMOybmcgc2VsZXRlY3QgxJHhuqd1IHRpw6puIHThu7EgY2jhu41uCgogICAgICAgICAgICBpZiAodHlwZW9mIG1lLmdldFJvd0F1dG9Gb2N1cyA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgdHJGaXJzdCA9IG1lLmdldFJvd0F1dG9Gb2N1cygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodHJGaXJzdCkgewogICAgICAgICAgICAgIGlmICh0eXBlb2YgdHJGaXJzdC5nZXRWdWVJbnN0YW5jZSA9PSAiZnVuY3Rpb24iICYmIHRyRmlyc3QuZ2V0VnVlSW5zdGFuY2UoKSkgewogICAgICAgICAgICAgICAgdHJGaXJzdC5nZXRWdWVJbnN0YW5jZSgpLl9ldmVudHMuY2xpY2s7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZS4kZW1pdCgiZm9jdXMiLCBtZS5kYXRheFswXSk7CgogICAgICAgICAgICAgIGlmIChtZS5pc0F1dG9Gb2N1c0ZpcnN0Um93KSB7CiAgICAgICAgICAgICAgICB0ckZpcnN0LmZvY3VzKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBtZS4kZW1pdCgiZmlyc3RMb2FkIiwgbWUuZGF0YXhbMF0pOwogICAgICAgICAgfSwgMjAwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIEPhuq1wIG5o4bqtdCBs4bqhaSBnaWFvIGRp4buHbiBraGkgY8OzIHNjcm9sbCBoYXkga2hpIMSR4buZIHLhu5luZyBj4bunYSBkYXRhIGTDoGkgaMahbiDEkeG7mSBy4buZbmcgbeG6t2MgxJHhu4tuaCBj4bunYSBj4buZdA0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQNCiAgICAgKi8KICAgIHVwZGF0ZVNpemU6IGZ1bmN0aW9uIHVwZGF0ZVNpemUoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgLy8gbWUuY2hlY2tIYXNTY3JvbGwoKTsKICAgICAgICBpZiAobWUuJHJlZnMudHIgJiYgbWUuJHJlZnMudHIubGVuZ3RoID4gMCkgewogICAgICAgICAgbWUuY29sdW1ueC5mb3JFYWNoKGZ1bmN0aW9uIChjb2wsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBjaGFuZ2VNaW5XaWR0aCA9IGZhbHNlOwogICAgICAgICAgICBtZS4kcmVmcy50ci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW0uJHJlZnNbInRleHQtIi5jb25jYXQoY29sLmRhdGFGaWVsZCldICYmIGl0ZW0uJHJlZnNbInRleHQtIi5jb25jYXQoY29sLmRhdGFGaWVsZCldLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHZhciB0ZXh0U3BhbiA9IGl0ZW0uJHJlZnNbInRleHQtIi5jb25jYXQoY29sLmRhdGFGaWVsZCldWzBdLm9mZnNldFdpZHRoOwoKICAgICAgICAgICAgICAgIGlmIChjb2wuX3dpZHRoIDwgdGV4dFNwYW4gKyAyMCkgewogICAgICAgICAgICAgICAgICBjaGFuZ2VNaW5XaWR0aCA9IHRydWU7CgogICAgICAgICAgICAgICAgICBpZiAobWUuJHJlZnMudGhbaW5kZXhdLiRlbC5vZmZzZXRXaWR0aCAhPSBpdGVtLiRyZWZzWyJ0ZC0iLmNvbmNhdChjb2wuZGF0YUZpZWxkKV1bMF0ub2Zmc2V0V2lkdGgpIHsKICAgICAgICAgICAgICAgICAgICBtZS4kc2V0KGNvbCwgIl9taW5XaWR0aCIsIGl0ZW0uJHJlZnNbInRkLSIuY29uY2F0KGNvbC5kYXRhRmllbGQpXVswXS5vZmZzZXRXaWR0aCk7CiAgICAgICAgICAgICAgICAgICAgbWUuJHNldChjb2wsICJfd2lkdGgiLCBpdGVtLiRyZWZzWyJ0ZC0iLmNvbmNhdChjb2wuZGF0YUZpZWxkKV1bMF0ub2Zmc2V0V2lkdGgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChjaGFuZ2VNaW5XaWR0aCA9PSBmYWxzZSkgewogICAgICAgICAgICAgIG1lLiRzZXQoY29sLCAiX21pbldpZHRoIiwgY29sLl93aWR0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChtZS4kcmVmcy50ckdyb3VwKSB7CiAgICAgICAgICAgIG1lLiRyZWZzLnRyR3JvdXAuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgICB2YXIgdGRHcm91cCA9IGl0ZW0ucXVlcnlTZWxlY3RvcigiLnRkLWdyb3VwIik7CgogICAgICAgICAgICAgIGlmICh0ZEdyb3VwKSB7CiAgICAgICAgICAgICAgICB2YXIgY29sc3BhbiA9IHRkR3JvdXAuZ2V0QXR0cmlidXRlKCJjb2xzcGFuIik7CiAgICAgICAgICAgICAgICB2YXIgdGRHcm91cFdpZHRoID0gMDsKCiAgICAgICAgICAgICAgICBpZiAobWUuJHJlZnMudGggJiYgY29sc3BhbikgewogICAgICAgICAgICAgICAgICB2YXIgaSA9IG1lLm11bHRpcGxlID8gMCA6IDE7CgogICAgICAgICAgICAgICAgICBmb3IgKGk7IGkgPD0gY29sc3BhbjsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIHRoQ3VycmVudEVsZW1lbnQgPSBtZS4kcmVmcy50aFtpXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoQ3VycmVudEVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgICAgIHRkR3JvdXBXaWR0aCArPSB0aEN1cnJlbnRFbGVtZW50LiRlbC5vZmZzZXRXaWR0aDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZEdyb3VwLnN0eWxlLndpZHRoID0gdGRHcm91cFdpZHRoICsgInB4IjsKICAgICAgICAgICAgICAgIHRkR3JvdXAuc3R5bGUubWF4V2lkdGggPSB0ZEdyb3VwV2lkdGggKyAicHgiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0csaw4bubYyB0aOG7sWMgaGnhu4duIHRyYW5zaXRpb24gYuG6r3QgxJHhuqd1IHJlbmRlci4NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUDQogICAgICovCiAgICBiZWZvcmVSZW5kZXJDb250ZW50OiBmdW5jdGlvbiBiZWZvcmVSZW5kZXJDb250ZW50KCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS51cGRhdGVTaXplKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24ga2hpIOG6pW4gdsOgbyBuZ2/DoGkgZ3JpZCBsb+G6oWkgYuG7jyByb3cgxJFhbmcgY2jhu41uDQogICAgICogQ3JlYXRlZCBieSBMVERBVA0KICAgICAqICAqLwogICAgY2xpY2tPdXRHcmlkOiBmdW5jdGlvbiBjbGlja091dEdyaWQoZXZlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChldmVudC50YXJnZXQuY2xvc2VzdCgiLm1zLWdyaWQtdmlld2VyIikgIT0gbWUuJGVsKSB7Ly9tZS5yb3dTZWxlY3RlZCA9IHt9OyAgbm5sYW0gYuG7jyDEkWkgdsOsIGtoaSBjbGljayByYSBuZ2/DoGkgdGjDrCBuaOG7r25nIGTDsm5nIMSRxrDhu6NjIGNo4buNbiBtb25nIG114buRbiB24bqrbiBnaeG7ryBuZ3V5w6puIGZvY3VzCiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIHZp4buHYyBzb3J0IHRyw6puIGdyaWQNCiAgICAgKiBAcGFyYW1zIGNvbCBj4buZdCDEkcaw4bujYyB0aOG7sWMgaGnhu4duIHPhuq9wIHPhur9wDQogICAgICogQHBhcmFtcyBtb2RlIGfhu5NtIG51bGwsREVTQyxBU0MNCiAgICAgKiBjcmVhdGVkIGJ5IExUREFUDQogICAgICovCiAgICBzb3J0OiBmdW5jdGlvbiBzb3J0KGNvbCwgbW9kZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmRhdGF4ICYmIG1lLmRhdGF4Lmxlbmd0aCA+IDApIHsKICAgICAgICBpZiAobWUucmVtb3RlU29ydCA9PSAicmVtb3RlIikgewogICAgICAgICAgdmFyIHBheWxvYWQgPSB7CiAgICAgICAgICAgIHNraXA6IChtZS5jdXJyZW50UGFnZSAtIDEpICogbWUucGFnZVNpemUsCiAgICAgICAgICAgIHRha2U6IG1lLnBhZ2VTaXplCiAgICAgICAgICB9OwoKICAgICAgICAgIGlmIChtb2RlICE9IG1lLiRtcy5lbnVtLlNvcnRTdGF0dXMubm9uZSkgewogICAgICAgICAgICBwYXlsb2FkLlNvcnQgPSAiIi5jb25jYXQoY29sLmlzRXh0RGF0YSA/ICJKU09OX1VOUVVPVEUoSlNPTl9FWFRSQUNUKEV4dERhdGEsICckLiIuY29uY2F0KGNvbC5kYXRhRmllbGQsICInKSkiKSA6IGNvbC5kYXRhRmllbGQsICIgIikuY29uY2F0KG1vZGUgPT0gbWUuJG1zLmVudW0uU29ydFN0YXR1cy5kZXNjID8gIkRFU0MiIDogIkFTQyIpOwogICAgICAgICAgfQoKICAgICAgICAgIG1lLmxpc3RlbmVyc0xvYWREYXRhKHBheWxvYWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZGF0YSA9IG51bGw7CgogICAgICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PSAibG9jYWwiICYmIHR5cGVvZiBtZS5maWx0ZXJGbiA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGRhdGEgPSBtZS5maWx0ZXJGbigpOwogICAgICAgICAgICBtZS5wYWdlVG90YWxGbiA9IGRhdGEgPyBkYXRhLmxlbmd0aCA6IDA7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkYXRhID0gX3RvQ29uc3VtYWJsZUFycmF5KG1lLmludGVybmFsRGF0YVNvdXJjZSk7CiAgICAgICAgICB9IC8vaMOgbSBzb3J0CgoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmUoYSwgYikgewogICAgICAgICAgICBpZiAoYVtjb2wuZGF0YUZpZWxkXSA8IGJbY29sLmRhdGFGaWVsZF0pIHJldHVybiBtb2RlID09IG1lLiRtcy5lbnVtLlNvcnRTdGF0dXMuZGVzYyA/IDEgOiAtMTsKICAgICAgICAgICAgaWYgKGFbY29sLmRhdGFGaWVsZF0gPiBiW2NvbC5kYXRhRmllbGRdKSByZXR1cm4gbW9kZSA9PSBtZS4kbXMuZW51bS5Tb3J0U3RhdHVzLmFzYyA/IDEgOiAtMTsKICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICB9IC8vdGjhu7FjIGhp4buHbiBzb3J0CgoKICAgICAgICAgIGlmIChtb2RlICE9IG1lLiRtcy5lbnVtLlNvcnRTdGF0dXMubm9uZSkgewogICAgICAgICAgICBkYXRhID0gZGF0YS5zb3J0KGNvbXBhcmUpOwogICAgICAgICAgfSAvL27hur91IGPDsyBwaMOibiB0cmFuZyB0aMOsIHBow6JuIHRyYW5nCgoKICAgICAgICAgIGlmIChtZS5wYWdpbmF0aW9uKSB7CiAgICAgICAgICAgIHZhciBwYWdlU2l6ZSA9IG1lLnBhZ2VTaXplID8gbWUucGFnZVNpemUgOiAyMCwKICAgICAgICAgICAgICAgIG1pbiA9IE1hdGguY2VpbCgobWUuY3VycmVudFBhZ2UgLSAxKSAqIHBhZ2VTaXplKSwKICAgICAgICAgICAgICAgIG1heCA9IG1pbiArIHBhZ2VTaXplOwogICAgICAgICAgICBtZS5kYXRheCA9IGRhdGEuZmlsdGVyKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgICAgICAgIHJldHVybiBpbmRleCA+PSBtaW4gJiYgaW5kZXggPCBtYXg7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWUuZGF0YXggPSBkYXRhOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vS2nhu4NtIHRyYSB4ZW0gZ3JpZCBjw7Mgc2Nyb2xsIGhheSBraMO0bmcgxJHhu4MgY2jhu4luaCBs4bqhaSBzaXplIGPhu6dhIGdyaWQgY2hvIMSRw7puZwogICAgLy9DcmVhdGVkIGJ5IExUREFUICgyOS4wNy4yMDIwKQogICAgY2hlY2tIYXNTY3JvbGw6IGZ1bmN0aW9uIGNoZWNrSGFzU2Nyb2xsKCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMzLiRyZWZzLmNvbnRlbnQpIHsKICAgICAgICAgIGlmIChfdGhpczMuJHJlZnMuY29udGVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQgKyAyIDwgX3RoaXMzLiRyZWZzLmNvbnRlbnQuc2Nyb2xsSGVpZ2h0KSB7CiAgICAgICAgICAgIF90aGlzMy5oYXNTY3JvbGwgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMzLmhhc1Njcm9sbCA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gbOG6r25nIG5naGUgc+G7sSBraeG6v24gdGhheSDEkeG7lWkgdHJhbmcgbuG6v3UgdGhheSDEkeG7lWkgdGjDrCBlbWl0IHPhu7Ega2nhu4duIGxvYWQgZGF0YSBt4bubaSByYSBuZ2/DoGkNCiAgICAgKiBAcGFyYW0gcGF5bG9hZCBk4buvIGxp4buHdSB0aMO0bmcgdGluIHRyYW5nIGfhu61pIHJhIG5nb8OgaQ0KICAgICAqICAqLwogICAgLy9DcmVhdGVkIGJ5IExUREFUKDI3LjA3LjIwMjApCiAgICBsaXN0ZW5lcnNMb2FkRGF0YTogZnVuY3Rpb24gbGlzdGVuZXJzTG9hZERhdGEocGF5bG9hZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLnBhZ2luYXRpb24pIHsKICAgICAgICBtZS5jdXJyZW50UGFnZSA9IHBheWxvYWQuc2tpcCAvIHBheWxvYWQudGFrZSArIDE7IC8vTuG6v3UgdGjhu7FjIGhp4buHbiBs4bqleSBkYXRhIGTGsOG7m2kgbG9jYWwgdGjDrCB0aOG7qWMgaGnhu4duIGzGsHUgZOG7ryBsaeG7h3UgdsOgbyBpbnRlcm5hbERhdGFTb3VyY2UgdsOgIHBow6JuIHRyYW5nIGxvY2FsCgogICAgICAgIGlmIChtZS5xdWVyeU1vZGUgPT0gImxvY2FsIiAmJiBtZS5wYWdpbmF0aW9uKSB7CiAgICAgICAgICAvLyBjb21tb25Gbi5nZW5WS2V5VmFsdWUobWUuaW50ZXJuYWxEYXRhU291cmNlKTsKICAgICAgICAgIG1lLmRhdGF4ID0gbWUuZ2V0SXRlbVBhZ2luYXRpb24oKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1lLiRyZWZzLmNvbnRlbnQuc2Nyb2xsVG9wID0gMDsKICAgICAgbWUuJGVtaXQoImxvYWREYXRhIiwgcGF5bG9hZCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFPhu7Ega2nhu4duIHNjcm9sbCB0csOqbiBncmlkDQogICAgICogQ3JlYXRlZCBieSBMVERBVCgyNS4wNi4yMDIwKQ0KICAgICAqLwogICAgb25TY3JvbGw6IGZ1bmN0aW9uIG9uU2Nyb2xsKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuJGVtaXQoInNjcm9sbCIsIGUpOyAvL21lLiRyZWZzLmdyaWRDb250ZW50LgogICAgfSwKCiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIHhlbSBj4buZdCDEkcaw4bujYyBjaGVjayBoYXkga2jDtG5nID8NCiAgICAgKiBkdXnhu4d0IHRyb25nIGRhdGEgbuG6v3UgY8OzIGNoxrBhIGThu68gbGnhu4d1IGPhu6dhIGTDsm5nIHTGsMahbmcg4bupbmcgdGjDrCByZXR1cm4gdHJ1ZSBuZ8aw4bujYyBs4bqhaSBmYWxzZQ0KICAgICAqIEBwYXJhbSBkYXRhUm93IGThu68gbGnhu4d1IGPhu6dhIGTDsm5nIMSRxrDhu6NjIGNoZWNrDQogICAgICogQ3JlYXRlZCBieSBMVERBVCAyNC4wNi4yMDIwDQogICAgICogICovCiAgICBpc1NlbGVjdGVkOiBmdW5jdGlvbiBpc1NlbGVjdGVkKGRhdGFSb3cpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS52YWx1ZSAmJiBtZS52YWx1ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgcmV0dXJuIG1lLnZhbHVlLmluY2x1ZGVzKGRhdGFSb3cpOwogICAgICB9CgogICAgICByZXR1cm4gZmFsc2U7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgeGVtIHJvdyBjw7MgZGlzYWJsZSBjaGVja2JveCBrDQogICAgICogQHBhcmFtIGRhdGFSb3cgZOG7ryBsaeG7h3UgY+G7p2EgZMOybmcgxJHGsOG7o2MgY2hlY2sNCiAgICAgKiBDcmVhdGVkIGJ5IG5ubGFtIDI0LjA2LjIwMjANCiAgICAgKiAgKi8KICAgIGZ1bkRpc2FibGVkQ2hlY2tlZE11bHRpcGxlVGJvZHk6IGZ1bmN0aW9uIGZ1bkRpc2FibGVkQ2hlY2tlZE11bHRpcGxlVGJvZHkoZGF0YVJvdykgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKHR5cGVvZiBtZS5kaXNhYmxlZENoZWNrZWRNdWx0aXBsZVRib2R5ID09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXR1cm4gbWUuZGlzYWJsZWRDaGVja2VkTXVsdGlwbGVUYm9keShkYXRhUm93KTsKICAgICAgfQoKICAgICAgcmV0dXJuIG1lLmRpc2FibGVkQ2hlY2tlZE11bHRpcGxlVGJvZHk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0geOG7rSBsw70gc+G7sSBraeG7h24ga2hpIGNsaWNrIHbDoG8gw7QgY2hlY2sgbXVsdGlwbGUNCiAgICAgKiBAcGFyYW0gZGF0YVJvdyBk4buvIGxp4buHdSBj4bunYSBkw7JuZyDEkcaw4bujYyBjaOG7jW4NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUICgzMC4wNS4yMDIwKQ0KICAgICAqLwogICAgY2xpY2tNdWx0aXBsZTogZnVuY3Rpb24gY2xpY2tNdWx0aXBsZShkYXRhUm93LCBjaGVja2VkKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoIUFycmF5LmlzQXJyYXkobWUudmFsdWUpKSB7CiAgICAgICAgbWUudmFsdWUgPSBbXTsKICAgICAgfQoKICAgICAgaWYgKG1lLnZhbHVlLmluY2x1ZGVzKGRhdGFSb3cpKSB7CiAgICAgICAgbWUudmFsdWUucmVtb3ZlKGRhdGFSb3cpOwogICAgICB9IGVsc2UgewogICAgICAgIG1lLnZhbHVlLnB1c2goZGF0YVJvdyk7CiAgICAgIH0KCiAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLnZhbHVlKTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB44butIGzDvSBz4buxIGtp4buHbiBraGkgY2xpY2sgdsOgbyDDtCBjaGVjayBtdWx0aXBsZSBkw7luZyBwaMOtbSB04bqvdA0KICAgICAqIEBwYXJhbSBkYXRhUm93IGThu68gbGnhu4d1IGPhu6dhIGTDsm5nIMSRxrDhu6NjIGNo4buNbg0KICAgICAqIENyZWF0ZWQgYnkgTk5MQU0gKDMwLjA1LjIwMjApDQogICAgICovCiAgICBjbGlja011bHRpcGxlQnlTaG9yS2V5OiBmdW5jdGlvbiBjbGlja011bHRpcGxlQnlTaG9yS2V5KGxpc3QpIHt9LAogICAgLy9M4bqleSBk4buvIGxp4buHdSBj4bunYSAxIHRyYW5nIGtoaSBwaMOibiB0cmFuZyBsb2NhbAogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE4LjA2LjIwMjApCiAgICBnZXRJdGVtUGFnaW5hdGlvbjogZnVuY3Rpb24gZ2V0SXRlbVBhZ2luYXRpb24oKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBwYWdlU2l6ZSA9IG1lLnBhZ2VTaXplID8gbWUucGFnZVNpemUgOiAyMCwKICAgICAgICAgIG1pbiA9IE1hdGguY2VpbCgobWUuY3VycmVudFBhZ2UgLSAxKSAqIHBhZ2VTaXplKSwKICAgICAgICAgIG1heCA9IG1pbiArIHBhZ2VTaXplOwogICAgICB2YXIgZGF0YUZpbHRlciA9IG51bGw7CgogICAgICBpZiAobWUucXVlcnlNb2RlID09ICJsb2NhbCIgJiYgdHlwZW9mIG1lLmZpbHRlckZuID09ICJmdW5jdGlvbiIpIHsKICAgICAgICBkYXRhRmlsdGVyID0gbWUuZmlsdGVyRm4oKTsKICAgICAgICBtZS5wYWdlVG90YWxGbiA9IGRhdGFGaWx0ZXIgPyBkYXRhRmlsdGVyLmxlbmd0aCA6IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YUZpbHRlciA9IG1lLmludGVybmFsRGF0YVNvdXJjZTsKICAgICAgfQoKICAgICAgZGF0YUZpbHRlciA9IGRhdGFGaWx0ZXIgPyBkYXRhRmlsdGVyIDogW107IC8vIE5NVFVBTjMgMjEvMTIvMjAyMTogQ2FzZSBu4bq/dSBjaOG7iSBoaeG7g24gdGjhu4sgdOG7lW5nIHPhu5EgdHJhbmcgdGjDrCB0cuG6oyB24buBIGx1w7RuCgogICAgICBpZiAobWUuaXNPbmx5U2hvd1BhZ2VUb3RhbCkgewogICAgICAgIHJldHVybiBtZS5kYXRhOwogICAgICB9CgogICAgICB2YXIgZGF0YVBhZ2luYXRpb24gPSBkYXRhRmlsdGVyLmZpbHRlcihmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICByZXR1cm4gaW5kZXggPj0gbWluICYmIGluZGV4IDwgbWF4OwogICAgICB9KTsKICAgICAgcmV0dXJuIGRhdGFQYWdpbmF0aW9uOwogICAgfSwKICAgIC8vWOG7rSBsw70gc+G7sSBraeG7h24gcmVzaXplIGNvbCB0csOqbiBncmlkCiAgICAvL2NyZWF0ZWQgYnkgTFREQVQoMjkuMDUuMjAyMCkKICAgIC8vY210IGJ5OiBubmxhbSAyNC8wMi8yMDIxOiBi4buPIMSRaSB2w6wgdGjhu6thIGfDonkgeOG6pXUga2hpIG3DoCBjbGljayB2w6BvIHJlc2l6ZSB0aMOsIGzDoG0gY2hhbmdlIHdpZHRoIHRvw6BuIGLhu5kgY29sdW1uIGx1w7RuCiAgICByZXNpemVBY3RpdmU6IGZ1bmN0aW9uIHJlc2l6ZUFjdGl2ZSgpIHsvL0tow7RuZyBjaG8gcGjDqXAgYsO0aSDEkWVuIHRleHQKICAgICAgLy8gdGhpcy5zZWxlY3RlZFRleHRNb2RlID0gdHJ1ZTsKICAgICAgLy8gaWYgKHRoaXMuJHJlZnMudGgpIHsKICAgICAgLy8gICBsZXQgbGlzdFRoID0gdGhpcy4kcmVmcy50aDsKICAgICAgLy8gICBpZiAobGlzdFRoICYmIGxpc3RUaC5sZW5ndGggPiAwKSB7CiAgICAgIC8vICAgICBsaXN0VGguZm9yRWFjaChpdGVtID0+IHsKICAgICAgLy8gICAgICAgaWYgKGl0ZW0gPT0gbGlzdFRoW2xpc3RUaC5sZW5ndGggLSB0aGlzLmluZGV4RmxleFJpZ2h0XSkgewogICAgICAvLyAgICAgICAgIGl0ZW0udXBkYXRlQ29sV2lkdGgodHJ1ZSk7CiAgICAgIC8vICAgICAgIH0gZWxzZSB7CiAgICAgIC8vICAgICAgICAgaXRlbS51cGRhdGVDb2xXaWR0aChmYWxzZSk7CiAgICAgIC8vICAgICAgIH0KICAgICAgLy8gICAgIH0pOwogICAgICAvLyAgIH0KICAgICAgLy8gfQogICAgfSwKICAgIC8vxJDDs25nIHPhu7Ega2nhu4duIHJlc2l6ZSBj4buZdCB0csOqbiBncmlkCiAgICAvL2NyZWF0ZWQgYnkgTFREQVQoMjkuMDUuMjAyMCkKICAgIHJlc2l6ZUNsb3NlOiBmdW5jdGlvbiByZXNpemVDbG9zZShjb2wpIHsKICAgICAgLy9DaG8gcGjDqXAgYsO0aSDEkcOqbiB0ZXh0CiAgICAgIHRoaXMuc2VsZWN0ZWRUZXh0TW9kZSA9IGZhbHNlOwogICAgICBjb2wubmV3V2lkdGggPSBjb2wuX3dpZHRoOwogICAgICB0aGlzLiRlbWl0KCJyZXNpemVDb2wiLCBjb2wpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBTZXQgZ2nDoSB0cuG7iyBkZWZhdWx0IGNobyBj4bqldSBow6xuaCBj4buZdA0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQoMTcuMDcuMjAyMCkNCiAgICAgKi8KICAgIHNldERlZmF1bHRGaWVsZENvbHVtbjogZnVuY3Rpb24gc2V0RGVmYXVsdEZpZWxkQ29sdW1uKGNvbHVtbnMpIHsKICAgICAgLy9O4bq/dSBraMO0bmcgY+G6pXUgaMOsbmggZmllbGQgaGnhu4duIHRo4buLIHRow6wgbeG6t2MgxJHhu4tuaCBsw6AgdHJ1ZQogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICBpZiAoaXRlbS52aXNpYmxlICE9IGZhbHNlKSB7CiAgICAgICAgICBpdGVtLnZpc2libGUgPSB0cnVlOwogICAgICAgIH0gLy9zZXQgY29sdW1uVHlwZQoKCiAgICAgICAgaWYgKHR5cGVvZiBpdGVtLmNvbHVtblR5cGUgIT09ICJudW1iZXIiKSB7CiAgICAgICAgICBtZS5zZXREZWZhdWx0Q29sdW1uVHlwZShpdGVtKTsKICAgICAgICB9IC8vbuG6v3Uga2jDtG5nIGNo4buJbmggxJHhu4tuaCB0aMOsIMSR4buDIGFsaWduIG3hurdjIGThu4tuaCB0aGVvIGZvcm1hdCB0eXBlCgoKICAgICAgICBpZiAoIWl0ZW0uYWxpZ24pIHsKICAgICAgICAgIHN3aXRjaCAoaXRlbS5jb2x1bW5UeXBlKSB7CiAgICAgICAgICAgIGNhc2UgIkNvbHVtbk51bWJlciI6CiAgICAgICAgICAgICAgaXRlbS5hbGlnbiA9ICJyaWdodCI7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlICJDb2x1bW5Cb29sZWFuIjoKICAgICAgICAgICAgICBpdGVtLmFsaWduID0gImNlbnRlciI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBtZS4kc2V0KGl0ZW0sICJfd2lkdGgiLCBpdGVtLndpZHRoKTsgLy9kZWZhdWx0IGZpbHRlcgoKICAgICAgICBpZiAoIWl0ZW0uZmlsdGVyKSB7CiAgICAgICAgICBtZS5zZXREZWZhdWx0RmlsdGVyKGl0ZW0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKiBM4bqleSByYSBjw6FjIGNvbHVtbiBjw7MgdGh14buZYyB0w61uaCB2aXNpYmxlID0gdHJ1ZQ0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQgMTcuMDcuMjAyMA0KICAgICAqICovCiAgICBnZXRWaXNpYmxlQ29sdW1uOiBmdW5jdGlvbiBnZXRWaXNpYmxlQ29sdW1uKGNvbHVtbnMpIHsKICAgICAgcmV0dXJuIGNvbHVtbnMuZmlsdGVyKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcmV0dXJuIGl0ZW0udmlzaWJsZSA9PSB0cnVlOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogS2jhu59pIHThuqFvIGThu68gbGnhu4d1IGJhbiDEkeG6p3UgY2hvIGdyaWQNCiAgICAgKiBjb2x1bW5zIHRydXnhu4FuIHbDoG8gbeG6t2MgxJHhu4tuaCBsw6AgY29sdW1ucyB0cm9uZyBwcm9wcyBjw7MgdGjhu4MgdHJ1eeG7gW4gY+G6pXUgaMOsbmgga2jDoWMgdOG7qyBuZ2/DoGkgdsOgbw0KICAgICAqLwogICAgaW5pdENvbHVtbnM6IGZ1bmN0aW9uIGluaXRDb2x1bW5zKGNvbHVtbnMpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuY29sdW1ueCA9IFtdOwogICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIG1lLmNvbHVtbnggPSBjb2x1bW5zIHx8IG1lLmNvbHVtbnMgfHwgW107IC8vR8OhbiBjb2x1bW5zIGNobyBjb25maWctYm94CgogICAgICAgIGlmIChtZS4kcmVmcy5jb25maWdCb3ggJiYgdHlwZW9mIG1lLiRyZWZzLmNvbmZpZ0JveC51cGRhdGVEYXRhID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIG1lLiRyZWZzLmNvbmZpZ0JveC51cGRhdGVEYXRhKG1lLmNvbHVtbngpOwogICAgICAgIH0KCiAgICAgICAgbWUuc2V0RGVmYXVsdEZpZWxkQ29sdW1uKG1lLmNvbHVtbngpOwogICAgICAgIG1lLmNvbHVtbnggPSBtZS5nZXRWaXNpYmxlQ29sdW1uKG1lLmNvbHVtbngpOwoKICAgICAgICBpZiAoIW1lLmNvbHVtbngpIHsKICAgICAgICAgIG1lLmNvbHVtbnggPSBbXTsKICAgICAgICB9CgogICAgICAgIHZhciBoYXNGbGV4ID0gbWUuY29sdW1ueC5zb21lKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICByZXR1cm4gaXRlbS5hdXRvUmVzaXplOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoaGFzRmxleCA9PSBmYWxzZSAmJiBtZS5jb2x1bW54W21lLmNvbHVtbngubGVuZ3RoIC0gbWUuaW5kZXhGbGV4UmlnaHRdKSB7CiAgICAgICAgICAvLyBtZS5yZXNpemVBY3RpdmUoKTsKICAgICAgICAgIG1lLiRzZXQobWUuY29sdW1ueFttZS5jb2x1bW54Lmxlbmd0aCAtIG1lLmluZGV4RmxleFJpZ2h0XSwgImF1dG9SZXNpemUiLCB0cnVlKTsKICAgICAgICB9IGVsc2UgaWYgKGhhc0ZsZXggPT0gZmFsc2UgJiYgbWUuY29sdW1ueC5sZW5ndGggPT0gMSkgewogICAgICAgICAgbWUuJHNldChtZS5jb2x1bW54WzBdLCAiYXV0b1Jlc2l6ZSIsIHRydWUpOwogICAgICAgIH0gLy8gbWUuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAvLyAgIGxldCBoZWFkZXIgPSBtZS4kcmVmcy5oZWFkZXI7CiAgICAgICAgLy8gICB7CiAgICAgICAgLy8gICAgIGlmIChoZWFkZXIpIHsKICAgICAgICAvLyAgICAgICBoZWFkZXIuc3R5bGUubWluSGVpZ2h0ID0KICAgICAgICAvLyAgICAgICAgIGhlYWRlci5maXJzdEVsZW1lbnRDaGlsZC5vZmZzZXRIZWlnaHQgKyAxICsgInB4IjsKICAgICAgICAvLyAgICAgfQogICAgICAgIC8vICAgfQogICAgICAgIC8vIH0pOwogICAgICAgIC8veOG7rSBsw70gZ3JvdXAgaGVhZGVyCgoKICAgICAgICBtZS5pbml0SGVhZGVyKG1lLmNvbHVtbngpOyAvL27hur91IGPDsyBmb290ZXIgdGjDrCBz4butIGzDvQoKICAgICAgICBpZiAobWUuZm9vdGVyKSB7CiAgICAgICAgICBtZS5pbml0Rm9vdGVyKG1lLmNvbHVtbngpOwogICAgICAgIH0gLy9nw6FuIHN0aWNrdHkgbGVmdCBjaG8gY8OhYyBj4buZdCBzdGlja3kKCgogICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICBtZS51cGRhdGVTdGlja3lPZmZzZXQoKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHRpw6p1IMSR4buBIGPhu5l0DQogICAgICovCiAgICBpbml0SGVhZGVyOiBmdW5jdGlvbiBpbml0SGVhZGVyKGNvbHVtbnMpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGhlYWRlcnMgPSBbXSwKICAgICAgICAgIHN1YiA9IFtdOwogICAgICB2YXIgZ3JvdXA7CiAgICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaSkgewogICAgICAgIGlmIChpdGVtLmdyb3VwKSB7CiAgICAgICAgICBpZiAoIWdyb3VwIHx8IGdyb3VwLmNhcHRpb24gIT09IGl0ZW0uZ3JvdXApIHsKICAgICAgICAgICAgZ3JvdXAgPSB7CiAgICAgICAgICAgICAgaXNHcm91cDogdHJ1ZSwKICAgICAgICAgICAgICBjb2xzcGFuOiAxLAogICAgICAgICAgICAgIGNhcHRpb246IGl0ZW0uZ3JvdXAsCiAgICAgICAgICAgICAgY2hpbGRzOiBbXQogICAgICAgICAgICB9OwogICAgICAgICAgICBoZWFkZXJzLnB1c2goZ3JvdXApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ3JvdXAuY29sc3BhbisrOwogICAgICAgICAgfQoKICAgICAgICAgIGdyb3VwLmNoaWxkcy5wdXNoKGl0ZW0pOwogICAgICAgICAgc3ViLnB1c2goaXRlbSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhlYWRlcnMucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAvKioNCiAgICAgICAqIGNhc2UgxJHhu4MgY2hlY2sgbHXDtG4gYnVpbGQgZ3JvdXANCiAgICAgICAqIE5NVFVBTjMgMTcvMTEvMjAyMQ0KICAgICAgICovCgogICAgICBpZiAoIW1lLmlzQWx3YXlzR3JvdXApIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlYWRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBjb2wgPSBoZWFkZXJzW2ldOwoKICAgICAgICAgIGlmIChjb2wuY2hpbGRzKSB7CiAgICAgICAgICAgIGlmIChjb2wuY2hpbGRzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgICAgIHZhciBjaGlsZCA9IGNvbC5jaGlsZHNbMF07CiAgICAgICAgICAgICAgaGVhZGVyc1tpXSA9IGNoaWxkOwogICAgICAgICAgICAgIHN1Yi5yZW1vdmUoY2hpbGQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBkZWxldGUgY29sLmNoaWxkczsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChzdWIubGVuZ3RoID4gMCkgewogICAgICAgIG1lLmhlYWRlcnMgPSBbaGVhZGVycywgc3ViXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5oZWFkZXJzID0gW2hlYWRlcnNdOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHRpw6p1IMSR4buBIGPhu5l0DQogICAgICovCiAgICBpbml0Rm9vdGVyOiBmdW5jdGlvbiBpbml0Rm9vdGVyKGNvbHVtbnMpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGZvb3RlcnMgPSBbXSwKICAgICAgICAgIHN1YiA9IFtdOwogICAgICB2YXIgZ3JvdXA7CiAgICAgIHZhciBjb2x1bXggPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGNvbHVtbnMpKTsgLy8gTlRCQU86IFThuqFtIHRo4budaSBi4buPIMSRaSB0csOhbmggYnVpbGQgcmEgZMOybmcgZm9vdGVyIGtoaSBjw7MgY+G7mXQgY2hlY2sgY2jhu41uIG5oaeG7gXUKICAgICAgLy8gaWYgKG1lLm11bHRpcGxlKSB7CiAgICAgIC8vICAgY29sdW14LnVuc2hpZnQoe30pOwogICAgICAvLyB9CgogICAgICBjb2x1bXguZm9yRWFjaChmdW5jdGlvbiAoY29sLCBpKSB7CiAgICAgICAgdmFyIGl0ZW0gPSB7CiAgICAgICAgICBkYXRhRmllbGQ6IGNvbC5kYXRhRmllbGQsCiAgICAgICAgICBhbGlnbjogY29sLmFsaWduLAogICAgICAgICAgZm9ybWF0VHlwZTogY29sLmZvcm1hdFR5cGUsCiAgICAgICAgICBmb290ZXJUZXh0OiBjb2wuZm9vdGVyVGV4dCwKICAgICAgICAgIGxvY2s6IGNvbC5sb2NrID8gY29sLmxvY2sgOiBmYWxzZQogICAgICAgIH07CgogICAgICAgIGlmIChpdGVtLmdyb3VwRm9vdGVyIHx8IGkgPCBtZS5sb2NrQ291bnQpIHsKICAgICAgICAgIGlmICghZ3JvdXAgfHwgZ3JvdXAuY2FwdGlvbiAhPT0gaXRlbS5ncm91cEZvb3RlciB8fCBpID09PSBtZS5sb2NrQ291bnQpIHsKICAgICAgICAgICAgZ3JvdXAgPSB7CiAgICAgICAgICAgICAgaXNHcm91cDogdHJ1ZSwKICAgICAgICAgICAgICBjb2xzcGFuOiAxLAogICAgICAgICAgICAgIGNhcHRpb246IGl0ZW0uZ3JvdXBGb290ZXIsCiAgICAgICAgICAgICAgY2hpbGRzOiBbXQogICAgICAgICAgICB9OwogICAgICAgICAgICBmb290ZXJzLnB1c2goZ3JvdXApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ3JvdXAuY29sc3BhbisrOwogICAgICAgICAgfQoKICAgICAgICAgIGdyb3VwLmNoaWxkcy5wdXNoKGl0ZW0pOyAvL3N1Yi5wdXNoKGl0ZW0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmb290ZXJzLnB1c2goaXRlbSk7CiAgICAgICAgfQogICAgICB9KTsgLy9kdXnhu4d0IHjhu60gbMO9IGPDoWMgbmjDs20gY+G7mXQgY2jhu4kgY8OzIDEgcGjhuqduIHThu6sgLT4gYuG7jyBuaMOzbSDEkWkKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZm9vdGVycy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjb2wgPSBmb290ZXJzW2ldOwoKICAgICAgICBpZiAoY29sLmNoaWxkcykgewogICAgICAgICAgdmFyIGNoaWxkID0gY29sLmNoaWxkc1swXTsKICAgICAgICAgIGNoaWxkWyJjb2xzcGFuIl0gPSBjaGlsZFsiY29sc3BhbiJdID8gY2hpbGRbImNvbHNwYW4iXSA6IGNvbC5jb2xzcGFuOwogICAgICAgICAgZm9vdGVyc1tpXSA9IGNoaWxkOwogICAgICAgICAgc3ViLnJlbW92ZShjaGlsZCk7CiAgICAgICAgICBkZWxldGUgY29sLmNoaWxkczsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChmb290ZXJzWzBdKSB7CiAgICAgICAgdmFyIGZpcnN0ID0gZm9vdGVyc1swXTsKCiAgICAgICAgaWYgKG1lLnNlcmlhbCkgewogICAgICAgICAgZmlyc3QuY29sc3BhbiA9IChmaXJzdC5jb2xzcGFuIHx8IDEpICsgMTsKICAgICAgICB9CgogICAgICAgIGlmIChtZS5tdWx0aXBsZSkgewogICAgICAgICAgZmlyc3QuY29sc3BhbiA9IChmaXJzdC5jb2xzcGFuIHx8IDEpICsgMTsKICAgICAgICB9CgogICAgICAgIGlmICh0eXBlb2YgZmlyc3QuY2FwdGlvbiA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgIGZpcnN0LmNhcHRpb24gPSBtZS4kdCgiaTE4bkNvbXBvbmVudC5Gb290ZXIuU3VtbWFyeSIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHR5cGVvZiBmaXJzdC5mb290ZXJUZXh0ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgZmlyc3QuZm9vdGVyVGV4dCA9IG1lLiR0KCJpMThuQ29tcG9uZW50LkZvb3Rlci5TdW1tYXJ5Iik7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc3ViLmxlbmd0aCA+IDApIHsKICAgICAgICBtZS5mb290ZXJzID0gW2Zvb3RlcnMsIHN1Yl07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWUuZm9vdGVycyA9IFtmb290ZXJzXTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBD4bqtcCBuaOG6rXQgbGVmdCBjaG8gY8OhYyBj4buZdCBzdGlja2V5DQogICAgICovCiAgICB1cGRhdGVTdGlja3lPZmZzZXQ6IGZ1bmN0aW9uIHVwZGF0ZVN0aWNreU9mZnNldCgpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIHRocyA9IG1lLiRlbC5xdWVyeVNlbGVjdG9yQWxsKCIubXMtdGgiKSwKICAgICAgICAgIGNvbHVtbnMgPSBtZS5jb2x1bW54OwogICAgICB2YXIgdXNpbmdDb2x1bW5TZXR0aW5nID0gZmFsc2U7CiAgICAgIHZhciBvZmZzZXQgPSAwOwogICAgICB2YXIgZiA9IDA7CiAgICAgIHZhciB3aWR0aCA9IDA7CgogICAgICBpZiAobWUuaXNTaG93Q29uZmlnQ29sdW1uKSB7CiAgICAgICAgd2lkdGggPSB0aHNbZl0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggfHwgMDsKICAgICAgICBvZmZzZXQgKz0gd2lkdGg7CiAgICAgICAgZisrOwogICAgICB9CgogICAgICBpZiAobWUubXVsdGlwbGUpIHsKICAgICAgICBtZS5tdWx0aXBsZU9mZnNldExlZnQgPSBvZmZzZXQgKyAicHgiOwogICAgICAgIHdpZHRoID0gdGhzW2ZdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIHx8IDA7IC8vIHRyxrDhu51uZyBo4bujcCBncmlkIGLhu4sg4bqpbiDEkWkgLT4gb2Zmc2V0IGPhu6dhIMO0IGNoZWNrYm94IGLhu4sgPSAwOyAobMawdSDDvSB0csOqbiBmb3JtIGPDsyAyIGdyaWQgdHLDqm4gMiBtcy10YXAtaXRlbSBraMOhYyBuaGF1IHRow6wgZ3JpZCDhu58gdGFiIGtow7RuZyBhY3RpY2Ugc+G6vSBi4buLIGzhu5dpIGxlZnQgc3RpY2t5KQoKICAgICAgICBpZiAod2lkdGggPT09IDApIHsKICAgICAgICAgIHVzaW5nQ29sdW1uU2V0dGluZyA9IHRydWU7CiAgICAgICAgICB3aWR0aCA9IG1lLiRtcy5lbnVtLlN0eWxlQ2hlY2tCb3hNdWx0aS5XaWR0aDsKICAgICAgICB9CgogICAgICAgIG9mZnNldCArPSB3aWR0aDsKICAgICAgICBmKys7CiAgICAgIH0KCiAgICAgIGlmIChtZS5zZXJpYWwpIHsKICAgICAgICBtZS5zZXJpYWxPZmZzZXRMZWZ0ID0gb2Zmc2V0ICsgInB4IjsKICAgICAgICB3aWR0aCA9IHRoc1tmXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS53aWR0aCB8fCAwOyAvLyB0csaw4budbmcgaOG7o3AgZ3JpZCBi4buLIOG6qW4gxJFpIC0+IG9mZnNldCBj4bunYSDDtCBjaGVja2JveCBi4buLID0gMDsgKGzGsHUgw70gdHLDqm4gZm9ybSBjw7MgMiBncmlkIHRyw6puIDIgbXMtdGFwLWl0ZW0ga2jDoWMgbmhhdSB0aMOsIGdyaWQg4bufIHRhYiBraMO0bmcgYWN0aWNlIHPhur0gYuG7iyBs4buXaSBsZWZ0IHN0aWNreSkKCiAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7CiAgICAgICAgICB3aWR0aCA9IDYwOwogICAgICAgIH0KCiAgICAgICAgdXNpbmdDb2x1bW5TZXR0aW5nID0gdHJ1ZTsKICAgICAgICBvZmZzZXQgKz0gd2lkdGg7CiAgICAgICAgZisrOwogICAgICB9CgogICAgICBtZS5oYXNMb2NrQ29sdW1uID0gZmFsc2U7CgogICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcChpKSB7CiAgICAgICAgdmFyIGNvbCA9IG1lLmNvbHVtbnhbaV07CgogICAgICAgIGlmICghY29sLmxvY2spIHsKICAgICAgICAgIHJldHVybiAiYnJlYWsiOwogICAgICAgIH0KCiAgICAgICAgbWUuaGFzTG9ja0NvbHVtbiA9IHRydWU7CiAgICAgICAgbWUuJHNldChjb2wsICJzdGlja3lPZmZzZXQiLCBvZmZzZXQpOwogICAgICAgIC8qKg0KICAgICAgICAgKiBHw6FuIHRow6ptIG9mZnNldCBjaG8gZm9vdGVyIMSR4buDIGxvY2sgY+G7mXQNCiAgICAgICAgICogTlRCQU8gMTguMDEuMjAyMg0KICAgICAgICAgKi8KCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZS5mb290ZXJzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICB2YXIgZm9vdGVySXRlbSA9IG1lLmZvb3RlcnNbal07CiAgICAgICAgICB2YXIgaXRlbSA9IGZvb3Rlckl0ZW0uZmluZChmdW5jdGlvbiAoeCkgewogICAgICAgICAgICByZXR1cm4geC5kYXRhRmllbGQgPT0gY29sLmRhdGFGaWVsZDsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgIG1lLiRzZXQoaXRlbSwgInN0aWNreU9mZnNldCIsIG9mZnNldCk7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBUw61uaCBvZmZzZXQgdGnhur9wIHRoZW8KCgogICAgICAgIHZhciBwb3MgPSAwOwoKICAgICAgICBpZiAoIXVzaW5nQ29sdW1uU2V0dGluZykgewogICAgICAgICAgcG9zID0gdGhzW2kgKyBmXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcG9zID0gewogICAgICAgICAgICB3aWR0aDogY29sdW1uc1tpICsgZiAtIDFdLndpZHRoCiAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgb2Zmc2V0ICs9IHBvcy53aWR0aDsKICAgICAgfTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWUuY29sdW1ueC5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBfcmV0ID0gX2xvb3AoaSk7CgogICAgICAgIGlmIChfcmV0ID09PSAiYnJlYWsiKSBicmVhazsKICAgICAgfQogICAgfSwKICAgIC8vWMOzYSAxIHBo4bqnbiB04butIHRyb25nIGRhdGEgZ3JpZAogICAgcmVtb3ZlSXRlbTogZnVuY3Rpb24gcmVtb3ZlSXRlbShpdGVtKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLmRhdGF4ID0gXy5yZW1vdmUobWUuZGF0YXgsIGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmV0dXJuIGUgIT09IGl0ZW07CiAgICAgIH0pOwogICAgfSwKICAgIC8vR8OhbiBnacOhIHRy4buLIMSR4buDIHJlbmRlciBkYXRhIGPDsyB0aOG7gyB0cnV54buBbiB04burIG5nb8OgaSB2w6BvCiAgICBpbml0RGF0YTogZnVuY3Rpb24gaW5pdERhdGEoKSB7CiAgICAgIHZhciBfdGhpczQgPSB0aGlzOwoKICAgICAgdmFyIGRhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRoaXMuZGF0YTsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIHVwZGF0ZVNjcm9sbCA9ICFkYXRhICE9ICFtZS5kYXRheCB8fCBkYXRhICYmIG1lLmRhdGF4ICYmIGRhdGEubGVuZ3RoICE9IG1lLmRhdGF4Lmxlbmd0aDsKCiAgICAgIGlmIChtZS4kcGFyZW50LnNlYXJjaFRleHQgJiYgbWUuJHBhcmVudC5zZWFyY2hUZXh0Lmxlbmd0aCA+IDApIHsKICAgICAgICBtZS5wYXJlbnRTZWFyY2hUZXh0ID0gbWUuJHBhcmVudC5zZWFyY2hUZXh0OwogICAgICB9CgogICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBudWxsOwoKICAgICAgaWYgKGRhdGEpIHsKICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBfdG9Db25zdW1hYmxlQXJyYXkoZGF0YSk7CiAgICAgIH0gLy9O4bq/dSB0aOG7sWMgaGnhu4duIGzhuqV5IGRhdGEgZMaw4bubaSBsb2NhbCB0aMOsIHRo4bupYyBoaeG7h24gbMawdSBk4buvIGxp4buHdSB2w6BvIGludGVybmFsRGF0YVNvdXJjZSB2w6AgcGjDom4gdHJhbmcgbG9jYWwKCgogICAgICBpZiAobWUucXVlcnlNb2RlID09ICJsb2NhbCIgJiYgbWUucGFnaW5hdGlvbikgewogICAgICAgIC8vIGNvbW1vbkZuLmdlblZLZXlWYWx1ZShtZS5pbnRlcm5hbERhdGFTb3VyY2UpOwogICAgICAgIG1lLmRhdGF4ID0gbWUuZ2V0SXRlbVBhZ2luYXRpb24oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvL0zhuqV5IGThu68gbGnhu4d1IHThu6sgc2VydmVyCiAgICAgICAgLy9U4bqhbSBnw6FuID0gcHJvcHMgZGF0YSBzYXUgZ8OhbiA9IGfDrCBraMOhYyB0w61uaCBzYXUKICAgICAgICAvL8SQVlRoaSAxOS8wMS8yMDIxOiBz4butYSBs4buXaSBUQSBraGkgbWUuZGF0YXggbnVsbCB0aMOsIMSRb+G6oW4gY29kZSBuw6B5IHbEg25nIGzhu5dpIFRBCiAgICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZSkgewogICAgICAgICAgbWUuZGF0YXggPSBfdG9Db25zdW1hYmxlQXJyYXkobWUuaW50ZXJuYWxEYXRhU291cmNlKTsKICAgICAgICB9IC8vIGNvbW1vbkZuLmdlblZLZXlWYWx1ZShtZS5kYXRheCk7CgogICAgICB9CgogICAgICBpZiAobWUuaXNNYXN0ZXJEZXRhaWwpIHsKICAgICAgICBtZS5kYXRheCA9IG1lLiRtcy5jb21tb25Gbi5nZXRCb2R5RGF0YShtZS5kYXRheCwgdHJ1ZSwgMSwgbWUuZGV0YWlsRmllbGQpOwogICAgICB9CgogICAgICBpZiAodXBkYXRlU2Nyb2xsKSB7CiAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIF90aGlzNC5jaGVja0hhc1Njcm9sbCgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgLy9M4bqleSBk4buvIGxp4buHdSBj4bunYSBkw7JuZyDEkcaw4bujYyBjaOG7jW4KICAgIC8vQ3JlYXRlZCBieSBMVERBVCgxNi4wNi4yMDIwKQogICAgZ2V0Um93U2VsZWN0ZWQ6IGZ1bmN0aW9uIGdldFJvd1NlbGVjdGVkKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUucm93U2VsZWN0ZWQ7CiAgICB9LAogICAgLy9Y4butIGzDvSBz4buxIGtp4buHbiDhuqVuIHBow61tIHRyw6puIHJvdwogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE1LjA2LjIwMjApCiAgICByb3dfa2V5ZG93bjogZnVuY3Rpb24gcm93X2tleWRvd24oZGF0YVJvdywgZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgY3VycmVudEluZGV4ID0gbWUucm93U2VsZWN0ZWQuaW5kZXg7CiAgICAgIHZhciB0ciA9IG51bGw7CiAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDsKCiAgICAgIGlmIChlLmN0cmxLZXkgfHwgZS5zaGlmdEtleSkgewogICAgICAgIHN3aXRjaCAoZS53aGljaCkgewogICAgICAgICAgY2FzZSA0MDoKICAgICAgICAgICAgLy9kb3duCiAgICAgICAgICAgIGlmIChjdXJyZW50SW5kZXggPCBtZS5kYXRheC5sZW5ndGggLSAxICYmICFlLmFsdEtleSkgewogICAgICAgICAgICAgIG1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QgPSB0cnVlOwogICAgICAgICAgICAgIHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLm1zLXRib2R5LmRhdGEgdHJbaW5kZXhSb3c9JyIuY29uY2F0KGN1cnJlbnRJbmRleCwgIiddIikpOyAvLyBpZighbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFttZS5yb3dTZWxlY3RlZC5pbmRleF0pICYmIHRyLmNsYXNzTGlzdCAmJiB0ci5jbGFzc0xpc3QuY29udGFpbnMoJ3Jvdy1zZWxlY3RlZCcpICYmICF0ci5jbGFzc0xpc3QuY29udGFpbnMoJ211bHRpLXJvdy1zZWxlY3RlZCcpKXsKICAgICAgICAgICAgICAvLyAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEucHVzaChtZS5kYXRheFttZS5yb3dTZWxlY3RlZC5pbmRleF0pOwogICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgY3VycmVudEluZGV4Kys7CiAgICAgICAgICAgICAgbWUuaW5kZXhPZlJvd0ZvY3VzZWQgPSBjdXJyZW50SW5kZXg7IC8vZXZlbnQudGFyZ2V0LmZvY3VzKCk7CgogICAgICAgICAgICAgIGlmICghbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFtjdXJyZW50SW5kZXhdKSkgewogICAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5wdXNoKG1lLmRhdGF4W2N1cnJlbnRJbmRleF0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnJlbW92ZShtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmRhdGEgPSBtZS5kYXRheFtjdXJyZW50SW5kZXhdOwogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbChjdXJyZW50SW5kZXgsIHRyLCBmYWxzZSk7CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDM4OgogICAgICAgICAgICAvL3VwCiAgICAgICAgICAgIGlmIChjdXJyZW50SW5kZXggPiAwICYmICFlLmFsdEtleSkgewogICAgICAgICAgICAgIG1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QgPSB0cnVlOwogICAgICAgICAgICAgIHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLm1zLXRib2R5LmRhdGEgdHJbaW5kZXhSb3c9JyIuY29uY2F0KGN1cnJlbnRJbmRleCwgIiddIikpOyAvLyBpZighbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFttZS5yb3dTZWxlY3RlZC5pbmRleF0pICYmIHRyLmNsYXNzTGlzdCAmJiB0ci5jbGFzc0xpc3QuY29udGFpbnMoJ3Jvdy1zZWxlY3RlZCcpICYmICF0ci5jbGFzc0xpc3QuY29udGFpbnMoJ211bHRpLXJvdy1zZWxlY3RlZCcpKXsKICAgICAgICAgICAgICAvLyAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEucHVzaChtZS5kYXRheFttZS5yb3dTZWxlY3RlZC5pbmRleF0pOwogICAgICAgICAgICAgIC8vIH0KCiAgICAgICAgICAgICAgY3VycmVudEluZGV4LS07CiAgICAgICAgICAgICAgbWUuaW5kZXhPZlJvd0ZvY3VzZWQgPSBjdXJyZW50SW5kZXg7IC8vZXZlbnQudGFyZ2V0LmZvY3VzKCk7CgogICAgICAgICAgICAgIGlmICghbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFtjdXJyZW50SW5kZXhdKSkgewogICAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5wdXNoKG1lLmRhdGF4W2N1cnJlbnRJbmRleF0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLnJlbW92ZShtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmRhdGEgPSBtZS5kYXRheFtjdXJyZW50SW5kZXhdOwogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbChjdXJyZW50SW5kZXgsIHRyLCB0cnVlKTsKICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgIC8vc3BhY2UKICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmZvY3VzKCk7CgogICAgICAgICAgICBpZiAobWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSAmJiBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgIG1lLmNsaWNrTXVsdGlwbGUoaXRlbSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWUuY2xpY2tNdWx0aXBsZShtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dpdGNoIChlLndoaWNoKSB7CiAgICAgICAgICBjYXNlIDQwOgogICAgICAgICAgICAvL2Rvd24KICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA8IG1lLmRhdGF4Lmxlbmd0aCAtIDEgJiYgIWUuYWx0S2V5KSB7CiAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSA9IFtdOwogICAgICAgICAgICAgIHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLm1zLXRib2R5LmRhdGEgdHJbaW5kZXhSb3c9JyIuY29uY2F0KGN1cnJlbnRJbmRleCwgIiddIikpOwogICAgICAgICAgICAgIHRyLm5leHRFbGVtZW50U2libGluZy5xdWVyeVNlbGVjdG9yKCJ0ZCIpLmNsaWNrKCk7CiAgICAgICAgICAgICAgY3VycmVudEluZGV4Kys7CiAgICAgICAgICAgICAgbWUuaW5kZXhPZlJvd0ZvY3VzZWQgPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmZvY3VzKCk7CiAgICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQuZGF0YSA9IG1lLmRhdGF4W2N1cnJlbnRJbmRleF07CiAgICAgICAgICAgICAgbWUucm93U2VsZWN0ZWQuaW5kZXggPSBjdXJyZW50SW5kZXg7CiAgICAgICAgICAgICAgbWUuYWRqdXN0U2Nyb2xsKGN1cnJlbnRJbmRleCwgdHIsIGZhbHNlKTsKICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzg6CiAgICAgICAgICAgIC8vdXAKICAgICAgICAgICAgaWYgKGN1cnJlbnRJbmRleCA+IDAgJiYgIWUuYWx0S2V5KSB7CiAgICAgICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSA9IFtdOwogICAgICAgICAgICAgIHRyID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLm1zLXRib2R5LmRhdGEgdHJbaW5kZXhSb3c9JyIuY29uY2F0KGN1cnJlbnRJbmRleCwgIiddIikpOwogICAgICAgICAgICAgIHRyLnByZXZpb3VzRWxlbWVudFNpYmxpbmcucXVlcnlTZWxlY3RvcigidGQiKS5jbGljaygpOwogICAgICAgICAgICAgIGN1cnJlbnRJbmRleC0tOwogICAgICAgICAgICAgIG1lLmluZGV4T2ZSb3dGb2N1c2VkID0gY3VycmVudEluZGV4OwogICAgICAgICAgICAgIGV2ZW50LnRhcmdldC5mb2N1cygpOwogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmRhdGEgPSBtZS5kYXRheFtjdXJyZW50SW5kZXhdOwogICAgICAgICAgICAgIG1lLnJvd1NlbGVjdGVkLmluZGV4ID0gY3VycmVudEluZGV4OwogICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbChjdXJyZW50SW5kZXgsIHRyLCB0cnVlKTsKICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgMzI6CiAgICAgICAgICAgIC8vc3BhY2UKICAgICAgICAgICAgZXZlbnQudGFyZ2V0LmZvY3VzKCk7CgogICAgICAgICAgICBpZiAobWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YSAmJiBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB2YXIgY2hlY2tib3ggPSBtZS4kZWwucXVlcnlTZWxlY3RvckFsbCgnLm1zLXRyLm11bHRpLXJvdy1zZWxlY3RlZCAubXVsdGlwbGUtY2VsbCBpbnB1dFt0eXBlPSJjaGVja2JveCJdJyk7CiAgICAgICAgICAgICAgdmFyIGNoZWNrZWQgPSBtZS4kZWwucXVlcnlTZWxlY3RvckFsbCgnLm1zLXRyLm11bHRpLXJvdy1zZWxlY3RlZCAubXVsdGlwbGUtY2VsbCBpbnB1dFt0eXBlPSJjaGVja2JveCJdOmNoZWNrZWQnKTsKCiAgICAgICAgICAgICAgaWYgKGNoZWNrZWQubGVuZ3RoID09IDAgfHwgY2hlY2tlZC5sZW5ndGggPT0gY2hlY2tib3gubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBjaGVja2JveC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIGl0ZW0uY2xpY2soKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjaGVja2JveC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIGlmICghaXRlbS5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5jbGljaygpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWUuY2xpY2tNdWx0aXBsZShtZS5kYXRheFtjdXJyZW50SW5kZXhdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBxdWlja1NlbGVjdGVkOiBmdW5jdGlvbiBxdWlja1NlbGVjdGVkKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG9sZEluZGV4ID0gbWUub2xkSW5kZXhPZlJvd0ZvY3VzZWQgfHwgMDsKCiAgICAgIGlmIChlLnNoaWZ0S2V5KSB7CiAgICAgICAgbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCA9IHRydWU7CiAgICAgICAgdmFyIHRyRXZlbnQgPSBlLnRhcmdldC5jbG9zZXN0KCIubXMtdHIiKTsKICAgICAgICB2YXIgbmV3SW5kZXggPSB0ckV2ZW50LmdldEF0dHJpYnV0ZSgiaW5kZXhyb3ciKTsKICAgICAgICB2YXIgc3RhcnQgPSBvbGRJbmRleCA+PSBuZXdJbmRleCA/IG5ld0luZGV4IDogb2xkSW5kZXg7CiAgICAgICAgdmFyIGVuZCA9IG9sZEluZGV4ID49IG5ld0luZGV4ID8gb2xkSW5kZXggOiBuZXdJbmRleDsKICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhID0gW107CgogICAgICAgIGZvciAoc3RhcnQ7IHN0YXJ0IDw9IGVuZDsgc3RhcnQrKykgewogICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5wdXNoKG1lLmRhdGF4W3N0YXJ0XSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoZS5jdHJsS2V5KSB7CiAgICAgICAgbWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCA9IHRydWU7CgogICAgICAgIHZhciBfdHJFdmVudCA9IGUudGFyZ2V0LmNsb3Nlc3QoIi5tcy10ciIpOwoKICAgICAgICB2YXIgX25ld0luZGV4ID0gX3RyRXZlbnQuZ2V0QXR0cmlidXRlKCJpbmRleHJvdyIpOwoKICAgICAgICBpZiAoIW1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEuaW5jbHVkZXMobWUuZGF0YXhbb2xkSW5kZXhdKSkgewogICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5wdXNoKG1lLmRhdGF4W29sZEluZGV4XSk7CiAgICAgICAgfQoKICAgICAgICBpZiAobWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5pbmNsdWRlcyhtZS5kYXRheFtfbmV3SW5kZXhdKSkgewogICAgICAgICAgbWUuc2hvcnRrZXlRdWlja1NlbGVjdGVkRGF0YS5yZW1vdmUobWUuZGF0YXhbX25ld0luZGV4XSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLnNob3J0a2V5UXVpY2tTZWxlY3RlZERhdGEucHVzaChtZS5kYXRheFtfbmV3SW5kZXhdKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9IGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS4kZWwuY2xhc3NMaXN0LmFkZCgidXNlci1zZWxlY3RlZC1ub25lIik7CiAgICAgIH07CgogICAgICBkb2N1bWVudC5vbmtleXVwID0gZnVuY3Rpb24gKCkgewogICAgICAgIG1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QgPSBmYWxzZTsKICAgICAgICBtZS4kZWwuY2xhc3NMaXN0LnJlbW92ZSgidXNlci1zZWxlY3RlZC1ub25lIik7CiAgICAgIH07CgogICAgICBkb2N1bWVudC5vbm1vdXNldXAgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFtZS5zaG9ydEtleUZvclF1aWNrU2VsZWN0KSB7CiAgICAgICAgICBtZS5zaG9ydGtleVF1aWNrU2VsZWN0ZWREYXRhID0gW107CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIGRlc3Ryb3lRdWlja1NlbGVjdGVkOiBmdW5jdGlvbiBkZXN0cm95UXVpY2tTZWxlY3RlZChlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuc2hvcnRLZXlGb3JRdWlja1NlbGVjdCkgewogICAgICAgIG1lLnNob3J0S2V5Rm9yUXVpY2tTZWxlY3QgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIC8vU+G7sSBraeG7h24g4bqlbiB2w6BvIG7DunQgY2jhu41uIHThuqV0IGPhuqMgYsOqbiB0csOqbiBoZWFkZXIKICAgIC8vVEROR0hJQSA4LzEwLzIwMjEgY2xpY2sgdsOgbyBtdWx0aSBib3gKICAgIC8vTuG6v3UgxJFhbmcgbMOgIHRlbXAgdGjDrCBi4buPIHRpY2sgaOG6v3QsIG7hur91IMSRYW5nIGzDoCB0aWNrIHRow6wgY8WpbmcgYuG7jyB0aWNrIGjhur90LCBu4bq/dSDEkWFuZyB0cuG7kW5nIHRow6wgdGljayBo4bq/dAogICAgY2hhbmdlQ2hlY2tlZE11bHRpcGxlOiBmdW5jdGlvbiBjaGFuZ2VDaGVja2VkTXVsdGlwbGUoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBWTW9kZWwgPSBtZS52YWx1ZSA9PSBudWxsID8gW10gOiBfdG9Db25zdW1hYmxlQXJyYXkobWUudmFsdWUpOyAvL07hur91IMSRYW5nIGNoZWNrIHRow6wgYuG7jyB0aWNrIGjhur90CgogICAgICBpZiAobWUuaXNDaGVja2VkTXVsdGlwbGUgfHwgbWUuaXNUZW1wU3RhdGUpIHsKICAgICAgICB2YXIgZGF0YSA9IG1lLmRhdGF4LmZpbHRlcihmdW5jdGlvbiAoaSkgewogICAgICAgICAgcmV0dXJuICFpLmlzRGlzYWJsZWRDaGVja0JveDsKICAgICAgICB9KTsKICAgICAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGRhdGFSb3cpIHsKICAgICAgICAgIGlmIChWTW9kZWwuaW5jbHVkZXMoZGF0YVJvdykpIHsKICAgICAgICAgICAgVk1vZGVsLnJlbW92ZShkYXRhUm93KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvL07hur91IMSRYW5nIHLhu5duZyB0aMOsIMSRxrDhu6NjIHRpY2sgaOG6v3QKICAgICAgICB2YXIgX2RhdGEgPSBtZS5kYXRheC5maWx0ZXIoZnVuY3Rpb24gKGkpIHsKICAgICAgICAgIHJldHVybiAhaS5pc0Rpc2FibGVkQ2hlY2tCb3g7CiAgICAgICAgfSk7CgogICAgICAgIF9kYXRhLmZvckVhY2goZnVuY3Rpb24gKGRhdGFSb3cpIHsKICAgICAgICAgIGlmICghVk1vZGVsLmluY2x1ZGVzKGRhdGFSb3cpKSB7CiAgICAgICAgICAgIFZNb2RlbC5wdXNoKGRhdGFSb3cpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IC8vSMOgbSBuw6B5IGzDoCBi4bqvbiByYSBiYXNlbGlzdHBvcHVwIMSR4buDIOG6qW4gaGnhu4duIHRpY2sgY2jhu41uLC4uLihzZWxlY3Rpb25DaGFuZ2UpCgoKICAgICAgbWUuJGVtaXQoImlucHV0IiwgVk1vZGVsKTsgLy9O4bq/dSDEkWFuZyBsw6AgdHLhuqFuZyB0aMOhaSB0cnVuZyBnaWFuIHRow6wgcHJldmVudCDEkeG7gyBraMO0bmcgYuG7iyB0aWNrIHbDoG8gaW5wdXQKCiAgICAgIGlmIChtZS5pc1RlbXBTdGF0ZSkgewogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIH0KICAgIH0sCiAgICBjaGFuZ2VQYWdlU2l6ZTogZnVuY3Rpb24gY2hhbmdlUGFnZVNpemUodmFsdWUpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9O4bq/dSB0aOG7sWMgaGnhu4duIGzhuqV5IGRhdGEgZMaw4bubaSBsb2NhbCB0aMOsIHRo4bupYyBoaeG7h24gbMawdSBk4buvIGxp4buHdSB2w6BvIGludGVybmFsRGF0YVNvdXJjZSB2w6AgcGjDom4gdHJhbmcgbG9jYWwKCiAgICAgIGlmIChtZS5xdWVyeU1vZGUgPT0gImxvY2FsIiAmJiBtZS5wYWdpbmF0aW9uKSB7CiAgICAgICAgLy8gY29tbW9uRm4uZ2VuVktleVZhbHVlKG1lLmludGVybmFsRGF0YVNvdXJjZSk7CiAgICAgICAgbWUucGFnZVNpemUgPSB2YWx1ZTsKICAgICAgICBtZS5kYXRheCA9IG1lLmdldEl0ZW1QYWdpbmF0aW9uKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuJGVtaXQoImNoYW5nZXBhZ2VzaXplIiwgdmFsdWUpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBHw6FuIGZpbHRlciBt4bq3YyDEkeG7i25oIGNobyB04bqldCBj4bqjIGPDoWMgY+G7mXQgY29sdW1uDQogICAgICovCiAgICBzZXREZWZhdWx0RmlsdGVyQWxsQ29sdW1uOiBmdW5jdGlvbiBzZXREZWZhdWx0RmlsdGVyQWxsQ29sdW1uKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgY29sdW1ucyA9IG1lLmNvbHVtbng7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbHVtbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBtZS5zZXREZWZhdWx0RmlsdGVyKGNvbHVtbnNbaV0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEfDoW4gZmlsdGVyIG3hurdjIMSR4buLbmggY2hvIGNvbHVtbg0KICAgICAqLwogICAgc2V0RGVmYXVsdEZpbHRlcjogZnVuY3Rpb24gc2V0RGVmYXVsdEZpbHRlcihjb2x1bW4pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgY29sdW1uLmZpbHRlciA9IHsKICAgICAgICB2YWx1ZTogbnVsbCwKICAgICAgICBvcGVyYXRvcjogbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkVxdWFscwogICAgICB9OwoKICAgICAgc3dpdGNoIChjb2x1bW4uY29sdW1uVHlwZSkgewogICAgICAgIGNhc2UgIkNvbHVtblRleHQiOgogICAgICAgIGNhc2UgIkNvbHVtbkRyaWxsZG93biI6CiAgICAgICAgICBpZiAoIWNvbHVtbi5lbnVtTmFtZSB8fCBjb2x1bW4uZW51bSkgewogICAgICAgICAgICBjb2x1bW4uZmlsdGVyLm9wZXJhdG9yID0gbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkNvbnRhaW5zOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEfDoW4gZ2nDoSB0cuG7iyBt4bq3YyDEkeG7i25oIGNobyBjb2x1bW5UeXBlIGPhu6dhIGPhuqV1IGjDrG5oIGPhu5l0DQogICAgICogQHBhcmFtIHtPYmplY3R9IGNvbDogY+G6pXUgaMOsbmggY+G7mXQNCiAgICAgKiBAYXV0aG9yIE5WTEFNIDE4LjEyLjIwMjANCiAgICAgKi8KICAgIHNldERlZmF1bHRDb2x1bW5UeXBlOiBmdW5jdGlvbiBzZXREZWZhdWx0Q29sdW1uVHlwZShjb2wpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIEZvcm1hdFR5cGUgPSBtZS4kbXMuZW51bS5Gb3JtYXRUeXBlOwoKICAgICAgc3dpdGNoIChjb2wuZm9ybWF0VHlwZSkgewogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5MaXN0OgogICAgICAgICAgY29sLmNvbHVtblR5cGUgPSAiQ29sdW1uRHJvcGRvd24iOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5DaGVja2JveDoKICAgICAgICAgIGNvbC5jb2x1bW5UeXBlID0gIkNvbHVtbkJvb2xlYW4iOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5UZXh0OgogICAgICAgICAgaWYgKGNvbC5jb2x1bW5UeXBlICE9ICJDb2x1bW5Ecm9wZG93biIpIHsKICAgICAgICAgICAgY29sLmNvbHVtblR5cGUgPSAiQ29sdW1uVGV4dCI7CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5Qcm9ncmVzczoKICAgICAgICBjYXNlIEZvcm1hdFR5cGUuTnVtYmVyOgogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5RdWFudGl0eToKICAgICAgICBjYXNlIEZvcm1hdFR5cGUuUmF0ZToKICAgICAgICAgIGNvbC5jb2x1bW5UeXBlID0gIkNvbHVtbk51bWJlciI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBGb3JtYXRUeXBlLkRhdGU6CiAgICAgICAgICBjb2wuY29sdW1uVHlwZSA9ICJDb2x1bW5EYXRlVGltZSI7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBGb3JtYXRUeXBlLkRhdGVUaW1lOgogICAgICAgIGNhc2UgRm9ybWF0VHlwZS5UaW1lOgogICAgICAgICAgY29sLmNvbHVtblR5cGUgPSAiQ29sdW1uRGF0ZVRpbWUiOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBjb2wuY29sdW1uVHlwZSA9ICJDb2x1bW5UZXh0IjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIMSQ4buNYyDEkWnhu4F1IGtp4buHbiBmaWx0ZXIgaGVhZGVyDQogICAgICovCiAgICBnZXRGaWx0ZXJIZWFkZXI6IGZ1bmN0aW9uIGdldEZpbHRlckhlYWRlcihoYXNDb2x1bW4pIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIHJlc3VsdCA9IFtdLAogICAgICAgICAgZW51bUZpbHRlckhlYWRlciA9IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlciwKICAgICAgICAgIGNvbHVtbnMgPSBtZS5maWx0ZXJIZWFkZXI7IC8vbWUuY29sdW1ueDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29sdW1ucy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjb2x1bW4gPSBjb2x1bW5zW2ldOwoKICAgICAgICBpZiAoY29sdW1uLmZpbHRlciAmJiBjb2x1bW4uZmlsdGVyLnZhbHVlICE9PSBjb2x1bW4uZmlsdGVySWdub3JlVmFsdWUpIHsKICAgICAgICAgIHZhciBpdGVtID0gbnVsbCwKICAgICAgICAgICAgICBmaWx0ZXJWYWx1ZSA9IGNvbHVtbi5maWx0ZXIudmFsdWUsCiAgICAgICAgICAgICAgb3BlcmF0b3IgPSBjb2x1bW4uZmlsdGVyLm9wZXJhdG9yOwoKICAgICAgICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSBlbnVtRmlsdGVySGVhZGVyLkJldHdlZW46CiAgICAgICAgICAgICAgaXRlbSA9IHsKICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhID8gIkpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuIi5jb25jYXQoY29sdW1uLmRhdGFGaWVsZCwgIicpKSIpIDogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBtZS4kbXMuZW51bS5GaWx0ZXJIZWFkZXIuR3JlYXRlclRoYW5FcXVhbHMsCiAgICAgICAgICAgICAgICB2YWx1ZTogY29sdW1uLmZpbHRlci5mcm9tLAogICAgICAgICAgICAgICAgb3BlcmFuZDogImFuZCIsCiAgICAgICAgICAgICAgICBjaGlsZHJlbnM6IFt7CiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhID8gIkpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuIi5jb25jYXQoY29sdW1uLmRhdGFGaWVsZCwgIicpKSIpIDogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5MZXNzVGhhbkVxdWFscywKICAgICAgICAgICAgICAgICAgdmFsdWU6IGNvbHVtbi5maWx0ZXIudG8sCiAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgICAgICAgICAgICB9XQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIGVudW1GaWx0ZXJIZWFkZXIuTnVsbDoKICAgICAgICAgICAgY2FzZSBlbnVtRmlsdGVySGVhZGVyLk5vdE51bGw6CiAgICAgICAgICAgICAgaXRlbSA9IHsKICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhID8gIkpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuIi5jb25jYXQoY29sdW1uLmRhdGFGaWVsZCwgIicpKSIpIDogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvciwKICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgICAgICAgICAgfTsgLy924bubaSBj4buZdCB0ZXh0IHPhur0gZml4IGdpw6EgdHLhu4sgxJHhu4MgbMOqbiBzZXJ2ZXIgc+G6vSB44butIGzDvSB0aMOqbSBraeG7g20gdHJhIHbhu5tpIGdpw6EgdHLhu4sgdHLhu5FuZyAnJwoKICAgICAgICAgICAgICBzd2l0Y2ggKGNvbHVtbi5jb2x1bW5UeXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICJDb2x1bW5UZXh0IjoKICAgICAgICAgICAgICAgIGNhc2UgIkNvbHVtbkRyaWxsZG93biI6CiAgICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSAidGV4dCI7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIGVudW1GaWx0ZXJIZWFkZXIuQ29udGFpbnM6CiAgICAgICAgICAgIGNhc2UgZW51bUZpbHRlckhlYWRlci5Ob3Rjb250YWluczoKICAgICAgICAgICAgY2FzZSBlbnVtRmlsdGVySGVhZGVyLlN0YXJ0c1dpdGg6CiAgICAgICAgICAgIGNhc2UgZW51bUZpbHRlckhlYWRlci5FbmRzV2l0aDoKICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbHRlclZhbHVlICE9PSAidW5kZWZpbmVkIiAmJiBmaWx0ZXJWYWx1ZSAhPT0gbnVsbCAmJiBmaWx0ZXJWYWx1ZSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgIC8vIGxldCB3b3JkcyA9IG1lLiRtcy5jb21tb25Gbi5zcGxpdEtleVdvcmQoZmlsdGVyVmFsdWUpOwogICAgICAgICAgICAgICAgLy8gdmFyIGFkZENvbHVtbkZpbHRlciA9IGZ1bmN0aW9uKGZpbHRlcikgewogICAgICAgICAgICAgICAgLy8gICBpZiAoIWl0ZW0pIHsKICAgICAgICAgICAgICAgIC8vICAgICBpdGVtID0gZmlsdGVyOwogICAgICAgICAgICAgICAgLy8gICAgIGl0ZW0uY2hpbGRyZW5zID0gW107CiAgICAgICAgICAgICAgICAvLyAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyAgICAgaWYgKAogICAgICAgICAgICAgICAgLy8gICAgICAgb3BlcmF0b3IgPT09IGVudW1GaWx0ZXJIZWFkZXIuU3RhcnRzV2l0aCB8fAogICAgICAgICAgICAgICAgLy8gICAgICAgb3BlcmF0b3IgPT09IGVudW1GaWx0ZXJIZWFkZXIuRW5kc1dpdGgKICAgICAgICAgICAgICAgIC8vICAgICApIHsKICAgICAgICAgICAgICAgIC8vICAgICAgIGl0ZW0ub3BlcmFuZCA9ICJvciI7CiAgICAgICAgICAgICAgICAvLyAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vICAgICAgIGl0ZW0ub3BlcmFuZCA9ICJhbmQiOwogICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgIC8vICAgICBpdGVtLmNoaWxkcmVucy5wdXNoKGZpbHRlcik7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vIH07CiAgICAgICAgICAgICAgICAvLyBpZiAod29yZHMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmRzLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgICAvLyAgICAgbGV0IGZpbHRlckl0ZW0gPSB7CiAgICAgICAgICAgICAgICAvLyAgICAgICBwcm9wZXJ0eTogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgIC8vICAgICAgIHZhbHVlOiB3b3Jkc1tpXSwKICAgICAgICAgICAgICAgIC8vICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvciwKICAgICAgICAgICAgICAgIC8vICAgICAgIG9wZXJhbmQ6CiAgICAgICAgICAgICAgICAvLyAgICAgICAgIG9wZXJhdG9yID09PSBlbnVtRmlsdGVySGVhZGVyLlN0YXJ0c1dpdGggfHwKICAgICAgICAgICAgICAgIC8vICAgICAgICAgb3BlcmF0b3IgPT09IGVudW1GaWx0ZXJIZWFkZXIuRW5kc1dpdGgKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICA/ICJvciIKICAgICAgICAgICAgICAgIC8vICAgICAgICAgICA6ICJhbmQiCiAgICAgICAgICAgICAgICAvLyAgICAgfTsKICAgICAgICAgICAgICAgIC8vICAgICBhZGRDb2x1bW5GaWx0ZXIoZmlsdGVySXRlbSk7CiAgICAgICAgICAgICAgICAvLyAgIH0KICAgICAgICAgICAgICAgIC8vIH0KICAgICAgICAgICAgICAgIGl0ZW0gPSB7CiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhID8gIkpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuIi5jb25jYXQoY29sdW1uLmRhdGFGaWVsZCwgIicpKSIpIDogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IG9wZXJhdG9yLAogICAgICAgICAgICAgICAgICB2YWx1ZTogZmlsdGVyVmFsdWUsCiAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHN3aXRjaCAoY29sdW1uLmNvbHVtblR5cGUpIHsKICAgICAgICAgICAgICAgIGNhc2UgIkNvbHVtbkRhdGVUaW1lIjoKICAgICAgICAgICAgICAgICAgaWYgKGZpbHRlclZhbHVlKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHsKICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhID8gIkpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuIi5jb25jYXQoY29sdW1uLmRhdGFGaWVsZCwgIicpKSIpIDogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmaWx0ZXJWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgIC8vbW9tZW50KGZpbHRlclZhbHVlKS5mb3JtYXQoJ1lZWVktTU0tREQnKSwKICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWx0ZXJWYWx1ZSAhPT0gInVuZGVmaW5lZCIgJiYgZmlsdGVyVmFsdWUgIT09IG51bGwgJiYgZmlsdGVyVmFsdWUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICAgICAgaXRlbSA9IHsKICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBjb2x1bW4uaXNFeHREYXRhID8gIkpTT05fVU5RVU9URShKU09OX0VYVFJBQ1QoRXh0RGF0YSwgJyQuIi5jb25jYXQoY29sdW1uLmRhdGFGaWVsZCwgIicpKSIpIDogY29sdW1uLmRhdGFGaWVsZCwKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBmaWx0ZXJWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgIG9wZXJhdG9yOiBvcGVyYXRvciwKICAgICAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiCiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gLy944butIGzDvSB0w6xuaCBodeG7kW5nIGVudW0gY+G7p2EgY+G7mXQga2jDtG5nIGNo4bupYSBnacOhIHRy4buLIHRow6wga2jhu49pIGZpbHRlcgoKCiAgICAgICAgICBpZiAoaXRlbSAmJiAoY29sdW1uLmVudW1OYW1lIHx8IGNvbHVtbi5lbnVtKSkgewogICAgICAgICAgICB2YXIgZW51bU9iaiA9IG1lLiRtcy5lbnVtW2NvbHVtbi5lbnVtTmFtZSB8fCBjb2x1bW4uZW51bV0sCiAgICAgICAgICAgICAgICBoYXNWYWx1ZSA9IGZhbHNlOwoKICAgICAgICAgICAgZm9yICh2YXIgX2kgaW4gZW51bU9iaikgewogICAgICAgICAgICAgIGlmIChlbnVtT2JqW19pXSA9PT0gaXRlbS52YWx1ZSkgewogICAgICAgICAgICAgICAgaGFzVmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoIWhhc1ZhbHVlKSB7CiAgICAgICAgICAgICAgaXRlbSA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoaXRlbSkgewogICAgICAgICAgICBpZiAoaGFzQ29sdW1uKSB7CiAgICAgICAgICAgICAgaXRlbS5jb2x1bW4gPSBjb2x1bW47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjb2x1bW4ubnVsbFRvRmFpbCkgewogICAgICAgICAgICAgIGl0ZW0ubnVsbFRvRmFpbCA9IGNvbHVtbi5udWxsVG9GYWlsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXN1bHQucHVzaChpdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGzGsHUgdOG6pXQgY+G6oyBjw6FjIGPhu5l0IMSRw6MgxJHDoW5oIGThuqV1IGzDoCDEkWFuZyBmaWx0ZXINCiAgICAgKi8KICAgIGJ1aWxkRmlsdGVySGVhZGVyOiBmdW5jdGlvbiBidWlsZEZpbHRlckhlYWRlcihjb2wpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGNoZWNrID0gbWUuZmlsdGVySGVhZGVyLmZpbHRlcihmdW5jdGlvbiAoaSkgewogICAgICAgIHJldHVybiBpLmRhdGFGaWVsZCA9PSBjb2wuZGF0YUZpZWxkOwogICAgICB9KTsKCiAgICAgIGlmIChjaGVjay5sZW5ndGggPT0gMCkgewogICAgICAgIG1lLmZpbHRlckhlYWRlci5wdXNoKGNvbCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWUuZmlsdGVySGVhZGVyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgIGlmIChpdGVtLmRhdGFGaWVsZCA9PSBjb2wuZGF0YUZpZWxkKSB7CiAgICAgICAgICAgIGl0ZW0gPSBjb2w7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdmFyIHRoID0gbWUuJHJlZnMudGguZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgcmV0dXJuIHguY29sLmRhdGFGaWVsZCA9PSBjb2wuZGF0YUZpZWxkOwogICAgICB9KTsKCiAgICAgIGlmICh0aCAmJiB0aC5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhbMF0uY2hlY2tIaWRlTWVudUhlYWRlcigpOwogICAgICB9CiAgICB9LAogICAgc3R5bGVDb2x1bW46IGZ1bmN0aW9uIHN0eWxlQ29sdW1uKGNvbCwgZGF0YVJvdywgc3R5bGVPYmplY3QpIHsKICAgICAgdGhpcy4kZW1pdCgic3R5bGVDb2x1bW4iLCBjb2wsIGRhdGFSb3csIHN0eWxlT2JqZWN0KTsKICAgIH0sCgogICAgLyoqDQogICAgICogaMOgbSBjb252ZXIgdG/DoW4gdOG7rSB0aMOgbmggdGV4dDogdsOtIGThu6UgIkNvbnRhbnRzIiAtPiAiQ2jhu6lhIg0KICAgICAqLwogICAgYnVpbGRPcGVyYXRvclRleHQ6IGZ1bmN0aW9uIGJ1aWxkT3BlcmF0b3JUZXh0KG9wZXJhdG9yKSB7CiAgICAgIHZhciBvcGVyYXRvclRleHQgPSB0aGlzLiRtcy5jb21tb25Gbi5nZXRFbnVtUmVzb3VyY2Uob3BlcmF0b3IsICJGaWx0ZXJIZWFkZXIiKTsKCiAgICAgIGlmIChvcGVyYXRvclRleHQpIHsKICAgICAgICBvcGVyYXRvclRleHQgPSBvcGVyYXRvclRleHQudG9Mb2NhbGVMb3dlckNhc2UoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG9wZXJhdG9yVGV4dDsKICAgIH0sCgogICAgLyoqDQogICAgICogaMOgbSBidWlsZCB2YWx1ZSBmaWx0ZXINCiAgICAgKi8KICAgIGJ1aWxkVmFsdWU6IGZ1bmN0aW9uIGJ1aWxkVmFsdWUoaXRlbSkgewogICAgICBpZiAoaXRlbS5maWx0ZXIgJiYgKGl0ZW0uZmlsdGVyLm9wZXJhdG9yID09IHRoaXMuJG1zLmVudW0uRmlsdGVySGVhZGVyLk51bGwgfHwgaXRlbS5maWx0ZXIub3BlcmF0b3IgPT0gdGhpcy4kbXMuZW51bS5GaWx0ZXJIZWFkZXIuTm90TnVsbCkpIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KCiAgICAgIGlmIChpdGVtLmZpbHRlci52YWx1ZSA9PSAwICYmIGl0ZW0uZm9ybWF0VHlwZSAhPSB0aGlzLiRtcy5lbnVtLkZvcm1hdFR5cGUuRW51bSAmJiBpdGVtLmZvcm1hdFR5cGUgIT0gdGhpcy4kbXMuZW51bS5Gb3JtYXRUeXBlLkZpbHRlclN0YXRlR3JpZCAvL1RETkdISUEgY2FzZSB0aMOqbSB0csaw4budbmcgaOG7o3AgbsOgeSDEkeG7gyB24bq9IGZpbHRlciB0cuG6oW5nIHRow6FpIGdyaWQKICAgICAgKSB7CiAgICAgICAgcmV0dXJuICIwIjsKICAgICAgfQoKICAgICAgaWYgKGl0ZW0uZmlsdGVyLm9wZXJhdG9yID09IHRoaXMuJG1zLmVudW0uRmlsdGVySGVhZGVyLkJldHdlZW4pIHsKICAgICAgICB2YXIgdmFsdWVGcm9tID0gdGhpcy4kb3B0aW9ucy5maWx0ZXJzLmZvcm1hdERhdGEoaXRlbS5maWx0ZXIuZnJvbSwgewogICAgICAgICAgZm9ybWF0VHlwZTogaXRlbS5mb3JtYXRUeXBlLAogICAgICAgICAgZW51bU5hbWU6IGl0ZW0uZW51bSwKICAgICAgICAgIGRhdGFSb3c6IHt9CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHZhbHVlVG8gPSB0aGlzLiRvcHRpb25zLmZpbHRlcnMuZm9ybWF0RGF0YShpdGVtLmZpbHRlci50bywgewogICAgICAgICAgZm9ybWF0VHlwZTogaXRlbS5mb3JtYXRUeXBlLAogICAgICAgICAgZW51bU5hbWU6IGl0ZW0uZW51bSwKICAgICAgICAgIGRhdGFSb3c6IHt9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuJHQoImkxOG5CYXNlRm9ybS5GaWx0ZXIuT3BlcmF0b3JCZXR3ZWVuIikuZm9ybWF0KHZhbHVlRnJvbSwgdmFsdWVUbyk7CiAgICAgIH0KCiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuJG9wdGlvbnMuZmlsdGVycy5mb3JtYXREYXRhKGl0ZW0uZmlsdGVyLnZhbHVlLCB7CiAgICAgICAgZm9ybWF0VHlwZTogaXRlbS5mb3JtYXRUeXBlLAogICAgICAgIGVudW1OYW1lOiBpdGVtLmVudW0sCiAgICAgICAgZGF0YVJvdzoge30KICAgICAgfSk7CiAgICAgIHJldHVybiAiOiAiICsgdmFsdWU7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGjDoG0geMOzYSAxIGl0ZW0gZmlsdGVyDQogICAgICovCiAgICByZW1vdmVGaWx0ZXJJdGVtOiBmdW5jdGlvbiByZW1vdmVGaWx0ZXJJdGVtKGl0ZW0pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuZmlsdGVySGVhZGVyLnJlbW92ZShpdGVtKTsKCiAgICAgIGlmICghaXRlbS5mb3JtYXRUeXBlIHx8IGl0ZW0uZm9ybWF0VHlwZSA9PSBtZS4kbXMuZW51bS5Gb3JtYXRUeXBlLlRleHQgfHwgaXRlbS5mb3JtYXRUeXBlID09IG1lLiRtcy5lbnVtLkZvcm1hdFR5cGUuTm9uZSkgewogICAgICAgIGl0ZW0uZmlsdGVyLm9wZXJhdG9yID0gbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkNvbnRhaW5zOwogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0uZmlsdGVyLm9wZXJhdG9yID0gbWUuJG1zLmVudW0uRmlsdGVySGVhZGVyLkVxdWFsczsKICAgICAgfQoKICAgICAgaXRlbS5maWx0ZXIudmFsdWUgPSBudWxsOwogICAgICBpdGVtLmhhc0FjdGlvbkZpbHRlciA9IGZhbHNlOwogICAgICB2YXIgdGggPSBtZS4kcmVmcy50aC5maWx0ZXIoZnVuY3Rpb24gKHgpIHsKICAgICAgICByZXR1cm4geC5jb2wuZGF0YUZpZWxkID09IGl0ZW0uZGF0YUZpZWxkOwogICAgICB9KTsKCiAgICAgIGlmICh0aCAmJiB0aC5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhbMF0uY2hlY2tIaWRlTWVudUhlYWRlcigpOwogICAgICB9CgogICAgICBtZS4kZW1pdCgiZmlsdGVyIiwgaXRlbSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGjDoG0gYuG7jyBs4buNYw0KICAgICAqLwogICAgY2xlYXJBbGxGaWx0ZXI6IGZ1bmN0aW9uIGNsZWFyQWxsRmlsdGVyKCkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL21lLmZpbHRlckhlYWRlci5yZW1vdmVBbGwoKTsKCiAgICAgIG1lLmZpbHRlckhlYWRlci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgaWYgKCFpdGVtLmZvcm1hdFR5cGUgfHwgaXRlbS5mb3JtYXRUeXBlID09IG1lLiRtcy5lbnVtLkZvcm1hdFR5cGUuVGV4dCB8fCBpdGVtLmZvcm1hdFR5cGUgPT0gbWUuJG1zLmVudW0uRm9ybWF0VHlwZS5Ob25lKSB7CiAgICAgICAgICBpdGVtLmZpbHRlci5vcGVyYXRvciA9IG1lLiRtcy5lbnVtLkZpbHRlckhlYWRlci5Db250YWluczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaXRlbS5maWx0ZXIub3BlcmF0b3IgPSBtZS4kbXMuZW51bS5GaWx0ZXJIZWFkZXIuRXF1YWxzOwogICAgICAgIH0KCiAgICAgICAgaXRlbS5maWx0ZXIudmFsdWUgPSBudWxsOwogICAgICAgIGl0ZW0uaGFzQWN0aW9uRmlsdGVyID0gZmFsc2U7CiAgICAgICAgdmFyIHRoID0gbWUuJHJlZnMudGguZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICAgICAgICByZXR1cm4geC5jb2wuZGF0YUZpZWxkID09IGl0ZW0uZGF0YUZpZWxkOwogICAgICAgIH0pOwoKICAgICAgICBpZiAodGggJiYgdGgubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhbMF0uY2hlY2tIaWRlTWVudUhlYWRlcigpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIG1lLiRlbWl0KCJmaWx0ZXIiLCB7fSk7CiAgICAgIG1lLmZpbHRlckhlYWRlciA9IFtdOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBTaG93IGjhur90IGljb24gZmlsdGVyIGzDqm4NCiAgICAgKi8KICAgIGZ1blNob3dBbGxJY29uRmlsdGVyOiBmdW5jdGlvbiBmdW5TaG93QWxsSWNvbkZpbHRlcih2YWx1ZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5jb2x1bW54LmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICB2YXIgdGggPSBtZS4kcmVmcy50aC5maWx0ZXIoZnVuY3Rpb24gKHgpIHsKICAgICAgICAgIHJldHVybiB4LmNvbC5kYXRhRmllbGQgPT0gaXRlbS5kYXRhRmllbGQ7CiAgICAgICAgfSk7CgogICAgICAgIGlmICh0aCAmJiB0aC5sZW5ndGggPiAwKSB7CiAgICAgICAgICB0aFswXS5zaG93QWxsSWNvbkZpbHRlciA9IHZhbHVlOyAvL3RoWzBdLmNoZWNrSGlkZU1lbnVIZWFkZXIoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiB0aMOqbSBow6BtIHRoaeG6v3QgbOG6rXAgY+G7mXQg4bqpbiBoaeG7h24gY+G7mXQgdHLDqm4gZ3JpZCDEkeG7gyBjw7MgdGjhu4MgZ+G7jWkgdOG7qyBjb21wb25lbnQgc+G7rSBk4bulbmcgIGdyaWQNCiAgICAgKiBwdmR1eSAwMi8wNC8yMDIxDQogICAgICovCiAgICBzZXRDb2x1bW5WaXNpYmxlOiBmdW5jdGlvbiBzZXRDb2x1bW5WaXNpYmxlKGZpZWxkLCB2aXNpYmxlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBjb2x1bW4gPSBudWxsOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtZS5jb2x1bW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGNvbCA9IG1lLmNvbHVtbnNbaV07CgogICAgICAgIGlmIChjb2wuZGF0YUZpZWxkID09PSBmaWVsZCkgewogICAgICAgICAgY29sdW1uID0gY29sOwogICAgICAgICAgY29sdW1uLnZpc2libGUgPSB2aXNpYmxlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICBtZS5pbml0Q29sdW1ucyhtZS5jb2x1bW5zKTsKICAgIH0sCiAgICAvL0zhuqV5IGVsZW1lbnQgc2Nyb2xsCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApCiAgICBnZXRTY3JvbGxlcjogZnVuY3Rpb24gZ2V0U2Nyb2xsZXIoKSB7CiAgICAgIGlmICh0aGlzICYmIHRoaXMuJGVsICYmIHR5cGVvZiB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoIi5zY3JvbGxlciIpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogc2Nyb2xsIHRoZW8gcGjDrW0gdXAgL2Rvd24NCiAgICAgKiBAcGFyYW0ge0LhuqNuIGdoaSDEkWFuZyBzZWxlY3RlZH0gdHlwZUFoZWFkUG9pbnRlcg0KICAgICAqIEBwYXJhbSB7ZMOybmcgZm9jdXMgdHLGsOG7m2MgxJHDs30gdHJPbGQNCiAgICAgKiBAcGFyYW0ge1Njcm9sbCBMw6puIGhheSB4deG7kW5nfSBzY3JvbGxVcA0KICAgICAqIENyZWF0ZWRCeSBOTkxBTSAxNi4wNi4yMDIwDQogICAgICovCiAgICBhZGp1c3RTY3JvbGw6IGZ1bmN0aW9uIGFkanVzdFNjcm9sbCgpIHsKICAgICAgdmFyIHR5cGVBaGVhZFBvaW50ZXIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRoaXMudHlwZUFoZWFkUG9pbnRlcjsKICAgICAgdmFyIHRyT2xkID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgPyBhcmd1bWVudHNbMV0gOiB1bmRlZmluZWQ7CiAgICAgIHZhciBzY3JvbGxVcCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyID8gYXJndW1lbnRzWzJdIDogdW5kZWZpbmVkOwogICAgICB2YXIgc2Nyb2xsZXIgPSB0aGlzLmdldFNjcm9sbGVyKCk7CiAgICAgIHZhciB0ZEhlaWdodCA9IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoInRkIikub2Zmc2V0SGVpZ2h0OwogICAgICB2YXIgdHIgPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCIubXMtdGJvZHkuZGF0YSB0cltpbmRleFJvdz0nIi5jb25jYXQodHlwZUFoZWFkUG9pbnRlciwgIiddIikpOwogICAgICB2YXIgdGggPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCIubXMtdGhlYWQgdGgiKTsKCiAgICAgIGlmIChzY3JvbGxlciAmJiB0ciAmJiB0aCkgewogICAgICAgIGlmICghc2Nyb2xsVXApIHsKICAgICAgICAgIGlmICh0ci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgLSB0aC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgPj0gc2Nyb2xsZXIub2Zmc2V0SGVpZ2h0IC0gdGgub2Zmc2V0SGVpZ2h0KSB7CiAgICAgICAgICAgIHNjcm9sbGVyLnNjcm9sbFRvcCArPSB0ci5vZmZzZXRUb3AgLSB0ck9sZC5vZmZzZXRUb3A7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICh0ci5vZmZzZXRUb3AgPD0gdGgub2Zmc2V0VG9wICsgdGRIZWlnaHQgLyAyKSB7CiAgICAgICAgICAgIHNjcm9sbGVyLnNjcm9sbFRvcCAtPSB0ck9sZC5vZmZzZXRUb3AgLSB0ci5vZmZzZXRUb3A7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gdGjhu7FjIGhp4buHbiB44butIGzDvSBiaW5kaW5nIGThu68gbGnhu4d1IGNobyBjw6FjIGdyaWQgY8OzIGNoZWNrYm94IGNobyBwaMOpcCBjaOG7jW4gcm93ICh2LW1vZGVsKQ0KICAgICAqIEBwYXJhbSB7W09iamVjdC9TdHJpbmddfSBsaXN0SXRlbXMgRGFuaCBzw6FjaCBjw6FjIGl0ZW0gxJFhbmcgbuG6sW0gdHLDqm4gZ3JpZCBob+G6t2MgZGFuaCBzw6FjaCBJRCBj4bunYSBjw6FjIEl0ZW0gY+G6p24gY2hlY2sNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaWRGaWVsZCBQcmltYXJ5IGtleSBj4bunYSBtb2RlbC9vYmplY3QgdHJvbmcgc3RvcmUNCiAgICAgKi8KICAgIHNldE1vZGVsQnlJZDogZnVuY3Rpb24gc2V0TW9kZWxCeUlkKGxpc3RJdGVtcykgewogICAgICB2YXIgaWRGaWVsZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogbnVsbDsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbGlzdEl0ZW1zID0gbGlzdEl0ZW1zIHx8IFtdOyAvL1Ryb25nIHRyxrDhu51uZyBo4bujcCBraMO0bmcgcGjhuqNpIGdyaWQgYWxsb3cgY2hlY2sgdGjDrCBraMO0bmcgY+G6p24gbMOgbSBnw6wKCiAgICAgIGlmICghbWUubXVsdGlwbGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBpZFByb3BlcnR5ID0gbnVsbDsKCiAgICAgIGlmIChpZEZpZWxkKSB7CiAgICAgICAgaWRQcm9wZXJ0eSA9IGlkRmllbGQ7CiAgICAgIH0gZWxzZSBpZiAobWUuaWRQcm9wZXJ0eSkgewogICAgICAgIGlkUHJvcGVydHkgPSBtZS5pZFByb3BlcnR5OwogICAgICB9CgogICAgICBpZiAoaWRQcm9wZXJ0eSkgewogICAgICAgIHZhciBhcnJNb2RlbCA9IFtdOwogICAgICAgIGxpc3RJdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChpZCkgewogICAgICAgICAgbWUuZGF0YXguZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICBpZiAoX3R5cGVvZihpZCkgPT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICBpZiAoaXRlbVtpZFByb3BlcnR5XSA9PSBpZFtpZFByb3BlcnR5XSkgewogICAgICAgICAgICAgICAgYXJyTW9kZWwucHVzaChpdGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKGl0ZW1baWRQcm9wZXJ0eV0gPT0gaWQpIHsKICAgICAgICAgICAgICAgIGFyck1vZGVsLnB1c2goaXRlbSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBhcnJNb2RlbCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoNCiAgICAgKiBIw6BtIG3hu58gcG9wdXAgY29uZmlnY29sdW1uDQogICAgICogVEROR0hJQSAxLzEwLzIwMjENCiAgICAgKi8KICAgIG9wZW5Db25maWdDb2x1bUJveDogZnVuY3Rpb24gb3BlbkNvbmZpZ0NvbHVtQm94KCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5zaG93aW5nQ29uZmlnQ29sdW1uQm94ID0gIW1lLnNob3dpbmdDb25maWdDb2x1bW5Cb3g7CiAgICB9LAoKICAgIC8qKioNCiAgICAgKiBJbml0IGzhuqFpIGNvbHVtbiBncmlkDQogICAgICogVEROR0hJQSAxMC8zLzIwMjENCiAgICAgKi8KICAgIGxheW91dE9uQ2hhbmdlOiBmdW5jdGlvbiBsYXlvdXRPbkNoYW5nZShuZXdMYXlvdXQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuaW5pdENvbHVtbnMobmV3TGF5b3V0KTsKICAgIH0sCgogICAgLyoqDQogICAgICogxJDDs25nIGNvbmZpZ2JveCAoYuG6r3Qgc+G7sSBraeG7h24gdOG7qyBtcy1jb25maWctY29sdW1uKQ0KICAgICAqIFRETkdISUEgMTAvMy8yMDIxDQogICAgICovCiAgICBjbG9zZUNvbmZpZ0JveDogZnVuY3Rpb24gY2xvc2VDb25maWdCb3goKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLnNob3dpbmdDb25maWdDb2x1bW5Cb3ggPSBmYWxzZTsKICAgIH0sCiAgICBnZXRDb25maWdEZWZhdWx0OiBmdW5jdGlvbiBnZXRDb25maWdEZWZhdWx0KCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS4kZW1pdCgiZ2V0Q29uZmlnRGVmYXVsdCIpOwogICAgfQogIH0KfTs="},null]}
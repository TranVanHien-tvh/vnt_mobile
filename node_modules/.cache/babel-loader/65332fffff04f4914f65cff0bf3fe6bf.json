{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\VNT_vue\\src\\components\\mscombobox\\msCombobox.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\VNT_vue\\src\\components\\mscombobox\\msCombobox.vue","mtime":1653205086336},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMiI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5udW1iZXIuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLWluZGV4LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnN0YXJ0cy13aXRoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc3BsaWNlLmpzIjsKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IE1zQ29tYm9Cb3hEcm9wZG93biBmcm9tICIuL01zQ29tYm9Cb3hEcm9wZG93bi52dWUiOwppbXBvcnQgTXNDb21ib0JveEl0ZW0gZnJvbSAiLi9Nc0NvbWJvQm94SXRlbS52dWUiOwppbXBvcnQgY29tbW9uRm4gZnJvbSAiQC9jb21tb25zL2NvbW1vbkZ1bmN0aW9uLmpzIjsKaW1wb3J0IG1zQmFzZUNvbXBvbmVudCBmcm9tICJAL2NvbXBvbmVudHMvbXNiYXNlL21zQmFzZUNvbXBvbmVudC52dWUiOwppbXBvcnQgRXZlbnRCdXNHbG9iYWwsIHsgR2xvYmFsRXZlbnROYW1lIH0gZnJvbSAiQC9jb21tb25zL2V2ZW50QnVzR2xvYmFsIjsKaW1wb3J0IHBvcHVwVXRpbCBmcm9tICJAL2NvbW1vbnMvcG9wdXBVdGlsIjsKaW1wb3J0IGkxOG4gZnJvbSAiQC9pMThucy9pMThuIjsKaW1wb3J0IG1lc3NhZ2VCb3ggZnJvbSAiQC9jb21tb25zL21lc3NhZ2VCb3giOwppbXBvcnQgXyBmcm9tICJsb2Rhc2giOwppbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICJAL21peGlucy9jb21tb24vZmlsdGVyIjsKaW1wb3J0IHsgc2V0VGltZW91dCB9IGZyb20gInRpbWVycyI7CmltcG9ydCB7IHZhbGlkYXRlQ29tYm9ib3ggfSBmcm9tICJAL21peGlucy9jb21wb25lbnQvdmFsaWRhdGVDb21ib2JveCI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiTXNDb21ib2JveCIsCiAgY29tcG9uZW50czogewogICAgTXNDb21ib0JveERyb3Bkb3duOiBNc0NvbWJvQm94RHJvcGRvd24sCiAgICBNc0NvbWJvQm94SXRlbTogTXNDb21ib0JveEl0ZW0KICB9LAogIGV4dGVuZHM6IG1zQmFzZUNvbXBvbmVudCwKICBtaXhpbnM6IFtmaWx0ZXIsIHZhbGlkYXRlQ29tYm9ib3hdLAogIGluaGVyaXRBdHRyczogZmFsc2UsCiAgcHJvcHM6IHsKICAgIHZhbHVlOiB7fSwKICAgIGN1c3RvbVRvb2x0aXA6IHsKICAgICAgZGVmYXVsdDogbnVsbCwKICAgICAgdHlwZTogW09iamVjdF0KICAgIH0sCiAgICBwbGFjZWhvbGRlcjogewogICAgICBkZWZhdWx0OiBudWxsLAogICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddCiAgICB9LAogICAgbWF4SXRlbXNEaXNwbGF5OiB7CiAgICAgIGRlZmF1bHQ6IDUsCiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIGNvbHVtbnM6IHsKICAgICAgdHlwZTogQXJyYXksCiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uIF9kZWZhdWx0KCkgewogICAgICAgIHJldHVybiBbXTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUcsaw4budbmcgbMOgbSB2YWx1ZQ0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAxNS4wNi4yMDIwDQogICAgICovCiAgICB2YWx1ZUZpZWxkOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKCiAgICAvKioNCiAgICAgKiBUcsaw4budbmcgbMOgbSB0ZXh0IGRpc3BsYXkNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTUuMDYuMjAyMA0KICAgICAqLwogICAgZGlzcGxheUZpZWxkOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKICAgIC8vROG7ryBsaeG7h3UgY+G7p2EgY29tYm9ib3gKICAgIGRhdGE6IHsKICAgICAgZGVmYXVsdDogZnVuY3Rpb24gX2RlZmF1bHQoKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9LAogICAgICB0eXBlOiBBcnJheQogICAgfSwKICAgIC8vxJDhu5kgcuG7mW5nIGPhu6dhIDEgaXRlbQogICAgaXRlbVNpemU6IHsKICAgICAgZGVmYXVsdDogMzYsCiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIC8vQ2jhu4kgbmjhuq1uIGdpw6EgdHLhu4sgY8OzIHRyb25nIGRhbmggc8OhY2gKICAgIGZvcmNlU2VsZWN0aW9uOiB7CiAgICAgIGRlZmF1bHQ6IHRydWUsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICAvL0zDoCBjb21ib3RyZWUgaGF5IGtow7RuZwogICAgaXNUcmVlOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgLy9QYXJlbnQgRmllbGQKICAgIGlkUHJvcGVydHk6IHsKICAgICAgZGVmYXVsdDogbnVsbCwKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgLy9GaWVsZCBjaOG7qWEgcGFyZW50SUQKICAgIHBhcmVudElkUHJvcGVydHk6IHsKICAgICAgZGVmYXVsdDogIlBhcmVudElEIiwKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgLy9LaMO0bmcgY2hvIHBow6lwIGNo4buNbiB0csaw4budbmcgbMOgIGNoYQogICAgbm90U2VsZWN0aW9uUGFyZW50OiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgLy/EkOG7mSByw7RuZyBj4bunYSBkcm9wZG93biB0w61uaCBi4bqxbmcgcHgKICAgIGRyb3Bkb3duV2lkdGg6IHsKICAgICAgZGVmYXVsdDogbnVsbCwKICAgICAgdHlwZTogW1N0cmluZywgTnVtYmVyXQogICAgfSwKICAgIC8vTW9kZSBxdWVyeSBs4bqleSBk4buvIGxp4buHdSB04burIHNlcnZlciBoYXkgY2xpZW50CiAgICBxdWVyeU1vZGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAibG9jYWwiCiAgICB9LAogICAgcmVtb3RlRmlsdGVyOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgLy9Hw6FuIGdpw6EgdHLhu4sgdGV4dCBsw7pjIGJhbiDEkeG6p3UKICAgIGluaXRUZXh0OiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IFtOdW1iZXIsIFN0cmluZ10KICAgIH0sCiAgICAvLyAvL0NvbWJvIG3hurdjIMSR4buLbmggY2jhu41uIGLhuqNuIGdoaSB0aGVvIGluZGV4CiAgICAvLyBpbml0SW5kZXg6IHsKICAgIC8vICAgZGVmYXVsdDogMCwKICAgIC8vICAgdHlwZTogTnVtYmVyCiAgICAvLyB9LAogICAgZGlzYWJsZWQ6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICByZWFkT25seTogewogICAgICBkZWZhdWx0OiBmYWxzZSwKICAgICAgdHlwZTogQm9vbGVhbgogICAgfSwKICAgIC8vY2jhu4kgY2hvIHBow6lwIGNo4buNbiBraMO0bmcgY2hvIHBow6lwIG5o4bqtcCB0ZXh0CiAgICBzZWxlY3RPbmx5OiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgYXV0b0xvYWQ6IHsKICAgICAgZGVmYXVsdDogZmFsc2UsCiAgICAgIHR5cGU6IEJvb2xlYW4KICAgIH0sCiAgICBkaXNwbGF5OiB7fSwKICAgIG1hcHBpbmdGaWVsZDogewogICAgICBkZWZhdWx0OiBudWxsCiAgICB9LAogICAgZmlyc3RFeHBhbmRMb2FkOiB7CiAgICAgIGRlZmF1bHQ6IGZhbHNlLAogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAga2V5RmllbGQ6IHsKICAgICAgLy8gZGVmYXVsdDogJ19fdktleVZhbHVlJywKICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgbWF4TGVuZ3RoOiB7CiAgICAgIGRlZmF1bHQ6IG51bGwsCiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIGxlZnRJY29uOiB7CiAgICAgIHR5cGU6IFN0cmluZwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDw6J1IGjDrG5oIHF1aWNrc2VhcmNoDQogICAgICovCiAgICBxdWlja1NlYXJjaDogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCgogICAgLyoqDQogICAgICogROG7ryBsaeG7h3UgdHJ1eeG7gW4ga8OobSBxdWlja3NlYXJjaA0KICAgICAqLwogICAgcXVpY2tTZWFyY2hQYXJhbTogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogQ8OidSBow6xuaCBhZGQNCiAgICAgKi8KICAgIHF1aWNrQWRkOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKICAgIGlzU2hvd1RleHQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBjaGVjayBxdXnhu4FuIHbhu5tpIHF1aWNrYWRkDQogICAgICovCiAgICBpc1Blcm1pc3Npb246IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIC8vcHZkdXkgMTcvMDMvMjAyMTogdGjDqm0gcHJvcCBydWxlIMSR4buDIGPDsyB0aOG7gyBjdXN0b20g4bufIG5nb8OgaSBmb3JtCiAgICBydWxlczogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICIiCiAgICB9LAoKICAgIC8qDQogICAgICogSMOgbSBzaG93IHJhIGPDonUgdGjDtG5nIGLDoW8gcmnDqm5nIHRoZW8gdOG7q25nIHRyxrDhu51uZyBo4bujcA0KICAgICAqIHbDrSBk4bulOiBjdXN0b21XYXJyaW5nIHtydWxlczoncmVxdWlyZWQnLCBtZXM6ICdUw6BpIHPhuqNuIG7DoHkgbMOgIGPhu6dhIHB2ZHV5J30NCiAgICAgKi8KICAgIGN1c3RvbVdhcnJpbmc6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICBkZWZhdWx0OiBudWxsCiAgICB9LAoKICAgIC8qKg0KICAgICAqIERhbmggc8OhY2ggY8OhYyB0csaw4budbmcgZOG7ryBsaeG7h3UgbOG6pXkgduG7gQ0KICAgICAqLwogICAgcmVxdWVzdEZpZWxkOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKICAgIHNob3dUaXRsZTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBEYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIGThu68gbGnhu4d1IGzhuqV5IHbhu4ENCiAgICAgKi8KICAgIHRpdGxlOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKCiAgICAvKioNCiAgICAgKiBjdXN0b20gbOG6oWkgdGhhbSBz4buRIGZpbHRlcg0KICAgICAqLwogICAgYnVpbGRGaWx0ZXI6IHsKICAgICAgdHlwZTogRnVuY3Rpb24sCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCiAgICBpc1JlbG9hZDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBzaXplIHBhZ2luZw0KICAgICAqLwogICAgcGFnZVNpemU6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAxMAogICAgfSwKCiAgICAvKioNCiAgICAgKiBHacOhIHRy4buLIGLhuqNuIGdoaSB04bqldCBj4bqjDQogICAgICovCiAgICBzZWxlY3RBbGxWYWx1ZTogewogICAgICB0eXBlOiBbTnVtYmVyLCBTdHJpbmddLAogICAgICBkZWZhdWx0OiAtMQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUZXh0IGhp4buDbiB0aOG7iyB04bqldCBj4bqjDQogICAgICovCiAgICBzZWxlY3RBbGxUZXh0OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogbnVsbAogICAgfSwKCiAgICAvKioNCiAgICAgKiBDw7MgaGnhu4NuIHRo4buLIGLhuqNuIGdoaSB04bqldCBj4bqjIGtow7RuZw0KICAgICAqLwogICAgc2hvd1NlbGVjdEFsbDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBO4bq/dSBmb2N1cyB0aMOsIG3hu5tpIHZhbGlkYXRlDQogICAgICogQGF1dGhvciB2dmtpZXQgLSAxOC4wOC4yMDIxDQogICAgICovCiAgICB2YWxpZGF0ZU9uRm9jdXM6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgLyoqDQogICAgICogVmFsaWRhdGUga2hpIGJsdXINCiAgICAgKiBAYXV0aG9yIE5ESFVZIDA2LjAxLjIwMjENCiAgICAgKi8KICAgIHZhbGlkYXRlT25CbHVyOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCgogICAgLyoqDQogICAgICogR2nDoSB0cuG7iyB2YWx1ZSBjaG8gY+G7p2EgZ2nDoSB0cuG7iyAiVOG6pXQgY+G6oyINCiAgICAgKi8KICAgIHZhbHVlQWxsU2VsZWN0ZWQ6IHsKICAgICAgdHlwZTogW051bWJlciwgU3RyaW5nXSwKICAgICAgZGVmYXVsdDogLTEKICAgIH0sCgogICAgLyoqDQogICAgICogVMOqbiBlbnVtIGPhu6dhIGNvbWJvYm94DQogICAgICovCiAgICBuYW1lRW51bTogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6IG51bGwKICAgIH0sCgogICAgLyoqDQogICAgICogY+G7nSDhuqluIGhp4buHbiBuw7p0IHRow6ptIG5oYW5oIGLDqm4gbmdvw6BpIGNvbWJvDQogICAgICogTk1UVUFOMiAwMy4xMS4yMDIxDQogICAgICovCiAgICBpc0hhc0NvbWJvQWRkOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIGPhu50gxJHhur8gbuG6v3UgZ2nDoSB0cuG7iyBuaOG6rXAgdsOgbyBsw6AgdHLhu5FuZyB0aMOsIHPhur0gYuG7jyBjaOG7jW4NCiAgICAgKiBOTVRVQU4yIDMwLjEyLjIwMjENCiAgICAgKi8KICAgIGFsbG93RGVzZWxlY3RJdGVtOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIGPhu50gY2hvIHBow6lwIGx1w7RuIGdp4buvIGzhuqFpIGdpw6EgdHLhu4sgbmjhuq1wDQogICAgICogTk1UVUFOMiAwNC4wMS4yMDIyDQogICAgICovCiAgICBhbGxvd0ZyZWVUZXh0OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIHRydWU6IGLhu48gcXVhIGNo4buvIGhvYS8gdGjGsOG7nW5nDQogICAgICogTk1UVUFOMiAwNC4wMS4yMDIyDQogICAgICovCiAgICBpZ25vcmVDYXNlOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIHNldCB0eXBlQWhlYWRQb2ludGVyIHbhu4EgLTENCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqLwogICAgcmVzZXRUeXBlQWhlYWRQb2ludGVyOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAoKICAgIC8qKg0KICAgICAqIGPDsyBtdeG7kW4gc2hvdyBjaGVjayBib3ggaGF5IGtow7RuZw0KICAgICAqLwogICAgaXNTaG93Q2hlY2tCb3g6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKCiAgICAvKioNCiAgICAgKiBjw7MgbXXhu5FuIGRyb3Bkb3duIGPDsyDEkeG7mSBkw6BpIGZpdCB24bubaSBjb21ibyB0aMOsIGNobyBi4bqxbmcgdHJ1ZQ0KICAgICAqIFRETkdISUEgMy8zLzIwMjENCiAgICAgKi8KICAgIGZvcmNlTWF4V2lkdGg6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCgogICAgLyoqDQogICAgICogQ29tYm8gdHJvbmcgYuG7mSBs4buNYyB0aMOsIHBo4bqjaSBjw7MgdHLGsOG7nW5nIG7DoHkNCiAgICAgKiBOTVRVQU4zIDE0LzQvMjAyMg0KICAgICAqLwogICAgZmlsdGVyTmFtZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0KICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgbWUuaW5pdFN0YXRpY0RhdGEoKTsKICAgIHJldHVybiB7CiAgICAgIGludGVybmFsRGF0YVNvdXJjZTogW10sCiAgICAgIGludGVybmFsVGV4dDogbnVsbCwKICAgICAgZXhwYW5kZWQ6IGZhbHNlLAogICAgICBkcm9wZG93blRvcHg6IDAsCiAgICAgIGRyb3Bkb3duTGVmdHg6IDAsCiAgICAgIGludGVybmFsU2VsZWN0ZWRJdGVtOiBudWxsLAogICAgICB0eXBlQWhlYWRQb2ludGVyOiAtMSwKICAgICAgZm9jdXNlZDogZmFsc2UsCiAgICAgIC8vxJBWVGhpICAwMy8wMy8yMDIxCiAgICAgIC8va8OtY2ggdGjGsOG7m2MgbeG6t2MgxJHhu4tuaCBj4bunYSBpdGVtU2l6ZSBj4bunYSBjb21ib3gga2hpIMSRxrDhu6NjIGTDuW5nIHRyw6puIGzGsOG7m2kgRWRpdG9yCiAgICAgIGdyaWRJdGVtU2l6ZTogNDgsCiAgICAgIHRvb2x0aXBMZWZ0OiAwLAogICAgICBkcm9wZG93blNjcm9sbFRvcDogMCwKCiAgICAgIC8qKg0KICAgICAgICogxJBhbmcgbG9hZCBk4buvIGxp4buHdQ0KICAgICAgICovCiAgICAgIGxvYWRpbmc6IGZhbHNlLAoKICAgICAgLyoqDQogICAgICAgKiBUaGFtIHPhu5EgbG9hZCBk4buvIGxp4buHdSBs4bqnbiBn4bqnbiBuaOG6pXQNCiAgICAgICAqLwogICAgICBsYXN0UmVxdWVzdFBhcmFtOiBudWxsCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8qKg0KICAgICAqIGRhdGEgc291cmNlIGNobyB0b29sdGlwDQogICAgICogY3JlYXRlZCBieSBudHBob25nIDI5LzUvMjAyMQ0KICAgICAqLwogICAgdG9vbHRpcERhdGFTb3VyY2U6IGZ1bmN0aW9uIHRvb2x0aXBEYXRhU291cmNlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZGF0YVNvdXJjZSA9IG1lLmludGVybmFsRGF0YVNvdXJjZTsKCiAgICAgIGlmIChtZS5fYWxsRGF0YSAmJiBtZS5fYWxsRGF0YS5sZW5ndGggPiAwKSB7CiAgICAgICAgZGF0YVNvdXJjZSA9IG1lLl9hbGxEYXRhOwogICAgICB9CgogICAgICByZXR1cm4gZGF0YVNvdXJjZTsKICAgIH0sCiAgICBsaXN0ZW5lcnM6IGZ1bmN0aW9uIGxpc3RlbmVycygpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIHsKICAgICAgICBpbnB1dDogZnVuY3Rpb24gaW5wdXQoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBtZS5vbklucHV0KGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIGZvY3VzOiBmdW5jdGlvbiBmb2N1cyhldmVudCkgewogICAgICAgICAgcmV0dXJuIG1lLm9uRm9jdXMoZXZlbnQpOwogICAgICAgIH0sCiAgICAgICAgY2hhbmdlOiBmdW5jdGlvbiBjaGFuZ2UoZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBtZS5vbkNoYW5nZShldmVudCk7CiAgICAgICAgfSwKICAgICAgICBibHVyOiBmdW5jdGlvbiBibHVyKGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gbWUub25CbHVyKGV2ZW50KTsKICAgICAgICB9LAogICAgICAgIGtleWRvd246IGZ1bmN0aW9uIGtleWRvd24oZXZlbnQpIHsKICAgICAgICAgIHJldHVybiBtZS5vbktleWRvd24oZXZlbnQpOwogICAgICAgIH0sCiAgICAgICAgY2xpY2s6IGZ1bmN0aW9uIGNsaWNrKGV2ZW50KSB7CiAgICAgICAgICByZXR1cm4gbWUub25DbGljayhldmVudCk7CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIC8vVMOtbmggxJHhu5kgcuG7mW5nIGPhu6dhIGRyb3Bkb3duIGNvbWJvYm94IMSR4buDIHNjcm9sbAogICAgc3R5bGVTY3JvbGxlcjogZnVuY3Rpb24gc3R5bGVTY3JvbGxlcigpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIHsKICAgICAgICAibWF4LWhlaWdodCI6IG1lLm1heEl0ZW1zRGlzcGxheSAqIG1lLml0ZW1TaXplICsgInB4IgogICAgICB9OwogICAgfSwKCiAgICAvKioNCiAgICAgKiDEkFZUaGkgMDMvMDMvMjAyMSB0w7l5IGJp4bq/biBs4bqhaSDEkeG7mSBy4buZbmcgY+G7p2EgaXRlbSBTaXplIGtoaSBkw7luZyBjb21ib3ggdHLDqm4gbMaw4bubaSBFZGl0b3IgPTQ4cHgNCiAgICAgKi8KICAgIGl0ZW1TaXplQ29tcHV0ZTogZnVuY3Rpb24gaXRlbVNpemVDb21wdXRlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLiRlZGl0b3JDbGFzcykgewogICAgICAgIHJldHVybiBtZS5ncmlkSXRlbVNpemU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG1lLml0ZW1TaXplOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIMSQVlRoaSAwMy8wMy8yMDIxIG7hur91IGNvbWJveCBtw6AgxJHGsOG7o2MgZMO5bmcgdHLDqm4gbMaw4bubaSBFZGl0b3IgdGjDrCBhcHBseSB0aMOqbSBjbGFzcyDEkeG7gyB0w7l5IGJp4bq/biDEkeG7mSBy4buZbmcNCiAgICAgKi8KICAgIGRyb3Bkb3duQ2xhc3M6IGZ1bmN0aW9uIGRyb3Bkb3duQ2xhc3MoKSB7CiAgICAgIGlmICh0aGlzLiRlZGl0b3JDbGFzcykgewogICAgICAgIHJldHVybiB0aGlzLiRlZGl0b3JDbGFzczsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEPDsyBoaeG7g24gdGjhu4sgcXVpY2thZGQga2jDtG5nDQogICAgICovCiAgICBoYXNTaG93UXVpY2tBZGQ6IGZ1bmN0aW9uIGhhc1Nob3dRdWlja0FkZCgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHJlcyA9IGZhbHNlOwoKICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGggPT09IDAgJiYgbWUucXVpY2tBZGQpIHsKICAgICAgICBpZiAobWUuX2FsbERhdGEpIHsKICAgICAgICAgIHJlcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChtZS5sYXN0UmVxdWVzdFBhcmFtKSB7CiAgICAgICAgICByZXMgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlczsKICAgIH0KICB9LAogIHdhdGNoOiB7CiAgICBydWxlczogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICBtZS52YWxpZGF0ZShtZSk7CiAgICAgIH0KICAgIH0sCiAgICBkYXRhOiB7CiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICAgIGlmIChtZS5sb2FkaW5nKSB7CiAgICAgICAgICBtZS5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChuZXdWYWwgPT0gbnVsbCkgewogICAgICAgICAgLy90w6xuaCBodeG7kW5nIGPDsyB0aMOqbS9z4butYS94w7NhIGThu68gbGnhu4d1IGfhu5FjIC0+IHJlc2V0IMSR4buDIGtoaSBleHBhbmQgc+G6vSBsb2FkIGzhuqFpIGThu68gbGnhu4d1CiAgICAgICAgICBtZS5sYXN0UXVlcnlTdHJpbmcgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgICAgIG1lLl9hbGxEYXRhID0gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSAhPT0gInJlbW90ZSIpIHsKICAgICAgICAgICAgbWUuX2FsbERhdGEgPSBuZXdWYWw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZSAhPSBuZXdWYWwgJiYgIShtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAwICYmIG5ld1ZhbC5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgIG1lLmluaXREYXRhKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNldCBs4bqhaSBnacOhIHRy4buLIGhp4buDbiB0aOG7iyBraGkgZ2nDoSB0cuG7iyBj4bunYSBiaeG6v24gaW5pdFRleHQgdGhheSDEkeG7lWkNCiAgICAgKi8KICAgIGluaXRUZXh0OiB7CiAgICAgIGltbWVkaWF0ZTogdHJ1ZSwKICAgICAgaGFuZGxlcjogZnVuY3Rpb24gaGFuZGxlcihuZXdWYWwsIG9sZFZhbCkgewogICAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICAgIGlmIChuZXdWYWwgfHwgb2xkVmFsKSB7CiAgICAgICAgICB2YXIgdmFsID0gbmV3VmFsID8gbmV3VmFsIDogb2xkVmFsOyAvLyBOTVRVQU4yIDA0LjAxLjIwMjE6IGNobyBwaMOpcCBs4bqleSBnacOhIHRy4buLIG3hu5tpIG5o4bqldAoKICAgICAgICAgIGlmIChtZS5hbGxvd0ZyZWVUZXh0KSB7CiAgICAgICAgICAgIHZhbCA9IG5ld1ZhbCA/IG5ld1ZhbCA6ICIiOwogICAgICAgICAgfQoKICAgICAgICAgIG1lLnNldEluaXRUZXh0KHZhbCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgbuG6v3UgdGV4dCBoaeG7h24gdGjhu4sgdGhheSDEkeG7lWkgdGhpIHZhbGlkYXRlDQogICAgICogTW9kaWZ5IGJ5IMSQVlRoaSAwNS8wMi8yMDIwIHRydXnhu4FuIHRow6ptIG1lIHbDoG8gdmFsaWRhdGUgKG1lKSDEkeG7gyBraGkgbmfGsOG7nWkgZMO5bmcgY2jhu41uIGdpw6EgdHLhu4sgY2jGsGEgY8OzIHRyb25nIGRhbmggbeG7pWMNCiAgICAgICAgdGhpIGLDoW8gbOG7l2kNCiAgICAgKi8KICAgIGludGVybmFsVGV4dDogewogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgICBuZXdWYWwgPSBuZXdWYWwgPyBuZXdWYWwgOiAiIjsKICAgICAgICBvbGRWYWwgPSBvbGRWYWwgPyBvbGRWYWwgOiAiIjsgLy8gdnZraWV0IC0gMTguMDguMjAyMTogVGjDqm0gxJFp4buBdSBraeG7h24gcGjhu6VjIHbhu6UgY2hvIFRIIG7hur91IGZvY3VzIHbDoG8gY29udHJvbCB0aMOsIG3hu5tpIHZhbGlkYXRlCiAgICAgICAgLy8gVsOtIGThu6U6IFRIIEzGsHUgdsOgIFRow6ptIG3hu5tpLCBzYXUga2hpIGzGsHUgeG9uZyB0aMOsIHThu7EgxJHhu5luZyBiw6FvIGzhu5dpIGNvbnRyb2wga2jDtG5nIMSRxrDhu6NjIMSR4buDIHRy4buRbmcKCiAgICAgICAgaWYgKG5ld1ZhbCAhPSBvbGRWYWwgJiYgKCFtZS52YWxpZGF0ZU9uRm9jdXMgfHwgbWUuZm9jdXNlZCkpIHsKICAgICAgICAgIC8vQWRkIG1lIGJ5IMSQVlRoaSAwNS8wMi8yMDIxIHBo4bulYyB24bulIHZhbGlkYXRlIGdpw6EgdHLhu4sgbmfGsOG7nWkgZMO5bmcgbmjhuq1wIHNhaSBmb3JjZVNlbGVjdGlvbgogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIG1lLnZhbGlkYXRlKG1lKTsKICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfSAvLyBtZS4kZW1pdCgnaW5wdXQnLG5ld1ZhbCk7CgogICAgICB9CiAgICB9LAogICAgLy9LaGkgdGhheSDEkeG7lWkgc+G7kSBwaOG6p24gdOG7rSBj4bunYSBjb21ib3ggdGjDrCB0aGnhur90IGzhuq1wIGzhuqFpIHbhu4sgdHLDrSBj4bunYSBkcm9wZG93CiAgICBpbnRlcm5hbERhdGFTb3VyY2U6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsgLy/EkFZUaGkgc+G7rWEgbOG7l2kgOTA0OTEga2jDtG5nIHRoYXkgxJHhu5VpIHbhu4sgdHLDrSBraGkgZ8O1IHRleHQgxJHhu4Mgc2VhcmNoIHRyw6puIGNvbWJveAoKICAgICAgICBtZS5jaGFuZ2VEcm9wZG93blBvc2l0aW9uKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogTuG6v3UgZ2nDoSB0cuG7iyBWTW9kZWwgY+G7p2EgY29tYm8gdGhheSDEkeG7lWkgdGjDrCBnw6FuIGzhuqFpIGdpw6EgdHLhu4sgbeG7m2kgdsOgIHNlbGVjdCB2w6BvIGl0ZW0gdMawxqFuZyDhu6luZyBjw7MgdHJvbmcgZGF0YQ0KICAgICAqLwogICAgdmFsdWU6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyOiBmdW5jdGlvbiBoYW5kbGVyKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgICAgaWYgKG5ld1ZhbCAhPSBvbGRWYWwpIHsKICAgICAgICAgIGlmIChuZXdWYWwgIT0gbnVsbCAmJiBuZXdWYWwgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG1lLmludGVybmFsVmFsdWUgPSBuZXdWYWw7IC8veOG7rSBsw70gZ2nDoSB0cuG7iyB04bqldCBj4bqjCgogICAgICAgICAgICBpZiAobmV3VmFsID09PSBtZS5zZWxlY3RBbGxWYWx1ZSAmJiAhbWUuaW5pdFRleHQpIHsKICAgICAgICAgICAgICBtZS5pbnRlcm5hbFRleHQgPSBtZS5fc2VsZWN0QWxsVGV4dDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSB8fCBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbVttZS52YWx1ZUZpZWxkXSAhPT0gbmV3VmFsKSB7CiAgICAgICAgICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZSAhPSBtZS5kYXRhKSB7CiAgICAgICAgICAgICAgICBtZS5pbml0RGF0YSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWUuZG9IaWdodGxpZ2h0SXRlbSgpOwoKICAgICAgICAgICAgICBpZiAobWUucmVzZXRUeXBlQWhlYWRQb2ludGVyKSB7CiAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gLTE7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA+PSAwKSB7CiAgICAgICAgICAgICAgICBtZS5zZXRJbnRlcm5hbEl0ZW0obWUuaW50ZXJuYWxEYXRhU291cmNlW21lLnR5cGVBaGVhZFBvaW50ZXJdLCBmYWxzZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmICghbWUuZm9yY2VTZWxlY3Rpb24gJiYgbWUudmFsdWVGaWVsZCA9PSBtZS5kaXNwbGF5RmllbGQpIHsKICAgICAgICAgICAgICAgICAgbWUuc2V0SW50ZXJuYWxUZXh0KG1lLmludGVybmFsVmFsdWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gbuG6v3UgYuG6r3QgYnXhu5ljIHBo4bqjaSBjaOG7jW4gZ2nDoSB0cuG7iyB0aMOsIG3hu5tpIHJlc2V0CiAgICAgICAgICAgIGlmIChtZS5mb3JjZVNlbGVjdGlvbikgewogICAgICAgICAgICAgIG1lLnJlc2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LAogIC8vSMOgbSBraOG7n2kgdOG6oW8gZOG7ryBsaeG7h3UgaG9vayBmdW5jCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7IC8vIG1lLmluaXRJbmRleCA9IDA7CgogICAgbWUuaW5pdENvbWJvKCk7IC8vIG1lLnNldEluaXRJbmRleCgpOwoKICAgIG1lLmluaXREYXRhKCk7CgogICAgaWYgKG1lLmF1dG9Mb2FkKSB7CiAgICAgIG1lLmRvUXVlcnlJbnRlcm5hbChudWxsLCBmYWxzZSk7CiAgICB9CgogICAgRXZlbnRCdXNHbG9iYWwuJG9uKEdsb2JhbEV2ZW50TmFtZS5zY3JvbGxFdmVudCwgbWUuc2Nyb2xsRXZlbnQpOwoKICAgIGlmIChtZS5tYXBwaW5nRmllbGQpIHsKICAgICAgZm9yICh2YXIga2V5IGluIG1lLm1hcHBpbmdGaWVsZCkgewogICAgICAgIG1lLiRvcHRpb25zLnByb3BzRGF0YVtrZXldID0gbnVsbDsKICAgICAgfQogICAgfSAvLyBtZS5pbml0RGF0YSgpOwogICAgLy8gbWUuc2V0SW5pdFRleHQoKTsKCiAgfSwKICBtb3VudGVkOiBmdW5jdGlvbiBtb3VudGVkKCkgewogICAgdmFyIG1lID0gdGhpczsgLy9EZWJvdW5jZSBxdWVyeSDEkeG7gyBkZWxheSBsb2FkCgogICAgaWYgKG1lLnF1ZXJ5TW9kZSAhPSAicmVtb3RlIikgewogICAgICBtZS5pbnRlcm5hbFF1ZXJ5RGVsYXkgPSAyMDsKICAgIH0KCiAgICBtZS5kb1F1ZXJ5ID0gXy5kZWJvdW5jZShtZS5kb1F1ZXJ5SW50ZXJuYWwsIG1lLmludGVybmFsUXVlcnlEZWxheSk7CiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrX291dCk7IC8vaW5pdCBhbGx0ZXh0CgogICAgbWUuX3NlbGVjdEFsbFRleHQgPSBtZS5zZWxlY3RBbGxUZXh0IHx8IGkxOG4udCgiaTE4bkNvbXBvbmVudC5Db21ib2JveC5TZWxlY3RBbGxJdGVtVGV4dCIpOwogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICBtZS5jb2xsYXBzZSgpOwoKICAgIGlmIChtZS4kcmVmcy5kcm9wZG93blBhbmVsKSB7CiAgICAgIG1lLiRyZWZzLmRyb3Bkb3duUGFuZWwuJGVsLnJlbW92ZSgpOwogICAgfQoKICAgIEV2ZW50QnVzR2xvYmFsLiRvZmYoR2xvYmFsRXZlbnROYW1lLnNjcm9sbEV2ZW50LCBtZS5zY3JvbGxFdmVudCk7CiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIG1lLmNsaWNrX291dCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRUb29sdGlwQ2xhc3M6IGZ1bmN0aW9uIGdldFRvb2x0aXBDbGFzcygpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS4kZWwpIHsKICAgICAgICBtZS50b29sdGlwTGVmdCA9IC1tZS4kZWwub2Zmc2V0V2lkdGggLyAyOwogICAgICB9CgogICAgICBpZiAobWUuY3VzdG9tVG9vbHRpcCkgewogICAgICAgIHJldHVybiAidG9vbHRpcC0iICsgbWUuY3VzdG9tVG9vbHRpcC50eXBlLnRvTG93ZXJDYXNlKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuICIiOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGtp4buDbSB0cmEgeGVtIGThu68gbGnhu4d1IHRyw6puIGNvbWJvYm94IGPDsyB0cuG7kW5nIGhheSBraMO0bmcNCiAgICAgKiBAYXV0aG9yIHRtY2hpIDE2LjA0LjIwMjENCiAgICAgKi8KICAgIGlzTnVsbE9yRW1wdHl2YWx1ZTogZnVuY3Rpb24gaXNOdWxsT3JFbXB0eXZhbHVlKCkgewogICAgICBpZiAodGhpcy52YWx1ZSA9PSBudWxsIHx8IHRoaXMudmFsdWUgPT0ge30pIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQuG6r3Qgc+G7sSBraeG7h24ga2hpIHNjcm9sbCB0csOqbiBjaMawxqFuZyB0csOsbmggdGjDrCDEkcOzbmcgY29tYm9ib3ggbOG6oWkNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUDQogICAgICovCiAgICBzY3JvbGxFdmVudDogZnVuY3Rpb24gc2Nyb2xsRXZlbnQoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmV4cGFuZGVkKSB7CiAgICAgICAgbWUuY29sbGFwc2UoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBN4bq3YyDEkeG7i25oIGNo4buNbiBnacOhIHRy4buLIHRoZW8gaW5kZXggYmFuIMSR4bqndQ0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQNCiAgICAgKi8KICAgIHNldEluaXRJbmRleDogZnVuY3Rpb24gc2V0SW5pdEluZGV4KCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmluaXRJbmRleCA+PSAwICYmIG1lLmludGVybmFsRGF0YVNvdXJjZSAmJiBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID4gMCAmJiBtZS50eXBlQWhlYWRQb2ludGVyIDwgMCkgewogICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSBtZS5pbml0SW5kZXg7CiAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSwgZmFsc2UpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNldCBnacOhIHRy4buLIGhp4buHbiB0aOG7iyBiYW4gxJHhuqd1IGNobyBjb21ib2JveCBraGkgY29tYm8gY2jGsGEgY8OzIGThu68gbGnhu4d1DQogICAgICogQ3JlYXRlZCBieSBMVERBVCgyNS4wNi4yMDIwKQ0KICAgICAqLwogICAgc2V0SW5pdFRleHQ6IGZ1bmN0aW9uIHNldEluaXRUZXh0KHZhbCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5pbnRlcm5hbFRleHQgPSAodHlwZW9mIHZhbCA9PSAic3RyaW5nIiA/IHZhbCA6IG1lLmluaXRUZXh0KSB8fCAiIjsgLy9URE5HSElBIHThuqFvIHRow6ptIGjDoG0ga2nhu4NtIHRyYSBu4bq/dSB0ZXh0IGto4bubcCB24bubaSBkYXRhIHNvdXJjZSB0aMOsIGfDoW4gZ2nDoSB0cuG7iyBjb21ibyBi4bqxbmcgbHXDtG4KCiAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBzZWxlY3RlZCA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpZiAobWUuaWdub3JlQ2FzZSkgewogICAgICAgICAgICByZXR1cm4gaXRlbVttZS5kaXNwbGF5RmllbGRdLnRvTG93ZXJDYXNlKCkudHJpbSgpID09IG1lLmludGVybmFsVGV4dC50b0xvd2VyQ2FzZSgpLnRyaW0oKTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gaXRlbVttZS5kaXNwbGF5RmllbGRdID09IG1lLmludGVybmFsVGV4dDsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKG1lLmFsbG93RnJlZVRleHQpIHsKICAgICAgICAgIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtID0gbnVsbDsKICAgICAgICAgIG1lLmludGVybmFsVmFsdWUgPSBudWxsOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGVjdGVkICE9IG51bGwpIHsKICAgICAgICAgIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtID0gc2VsZWN0ZWQ7CiAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gc2VsZWN0ZWRbbWUudmFsdWVGaWVsZF07CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRo4buxYyBoaeG7h24gcXVlcnkgZOG7ryBsaeG7h3UsIGPDsyB0aOG7gyB04burIGxvY2FsIGhv4bq3YyByZW1vdGUgdMO5eSB0aGVvIGPhuqV1IGjDrG5oDQogICAgICogQ3JlYXRlZEJ5IExUREFUIDExLzEyLzIwMTkNCiAgICAgKi8KICAgIGRvUXVlcnlJbnRlcm5hbDogZnVuY3Rpb24gZG9RdWVyeUludGVybmFsKHNlYXJjaFN0cmluZywgZXhwYW5kKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBldmVudCA9IHsKICAgICAgICBwcmV2ZW50RGVmYXVsdDogZmFsc2UsCiAgICAgICAgc2VuZGVyOiBtZQogICAgICB9LAogICAgICAgICAgcXVlcnlTdHJpbmcgPSBzZWFyY2hTdHJpbmc7CiAgICAgIG1lLiRlbWl0KCJiZWZvcmVRdWVyeSIsIGV2ZW50KTsKCiAgICAgIGlmIChldmVudC5wcmV2ZW50RGVmYXVsdCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKG1lLmxhc3RRdWVyeVN0cmluZyA9PT0gcXVlcnlTdHJpbmcgJiYgIW1lLmlzUmVsb2FkKSB7CiAgICAgICAgaWYgKGV4cGFuZCkgewogICAgICAgICAgbWUuZXhwYW5kKCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG1lLmRyb3Bkb3duU2Nyb2xsVG9wID0gMDsKICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UgPSBbXTsKICAgICAgICBtZS5sYXN0UXVlcnlTdHJpbmcgPSBxdWVyeVN0cmluZzsKICAgICAgICBtZS5xdWVyeWluZyA9IHRydWU7IC8vIG1lLnR5cGVBaGVhZFBvaW50ZXIgPSAtMTsKCiAgICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PT0gInJlbW90ZSIgJiYgIW1lLl9hbGxEYXRhKSB7CiAgICAgICAgICBpZiAobWUuaXNUcmVlKSB7CiAgICAgICAgICAgIHF1ZXJ5U3RyaW5nID0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBtZS5kb1JlbW90ZVF1ZXJ5KHF1ZXJ5U3RyaW5nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbWUuZG9Mb2NhbFF1ZXJ5KHF1ZXJ5U3RyaW5nKTsKCiAgICAgICAgICAgIGlmIChleHBhbmQgJiYgIW1lLmV4cGFuZGVkKSB7CiAgICAgICAgICAgICAgbWUuZXhwYW5kKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWUuZG9IaWdodGxpZ2h0SXRlbSh0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSAvLyBtZS4kcHJvcHMuaXNSZWxvYWQgPSBmYWxzZTsKCiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gc2F1IGtoaSBxdWVyeSB4b25nIGThu68gbGnhu4d1DQogICAgICogQ3JlYXRlZEJ5IExUREFUIDI0LjA2LjIwMjANCiAgICAgKi8KICAgIGFmdGVyUXVlcnk6IGZ1bmN0aW9uIGFmdGVyUXVlcnkoZXhwYW5kKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoZXhwYW5kKSB7CiAgICAgICAgbWUuZXhwYW5kKCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogUXVlcnkgZOG7ryBsaeG7h3UgYXBpDQogICAgICogQ3JlYXRlZEJ5IExUREFUIDI0LjA2LjIwMjANCiAgICAgKi8KICAgIGRvUmVtb3RlUXVlcnk6IGZ1bmN0aW9uIGRvUmVtb3RlUXVlcnkocXVlcnlTdHJpbmcsIGV4cGFuZCkgewogICAgICAvL0J1aWxkIGZpbHRlciwKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGZpbHRlcnMgPSBbXSwKICAgICAgICAgIGZpbHRlckZpZWxkcyA9IG1lLmZpbHRlckZpZWxkczsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgICBpZiAocXVlcnlTdHJpbmcpIHsKICAgICAgICAgIHZhciBfZmlsdGVyID0gbnVsbDsKCiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gZmlsdGVyRmllbGRzKSB7CiAgICAgICAgICAgIGlmIChmaWx0ZXJGaWVsZHMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgIHZhciBmID0gZmlsdGVyRmllbGRzW2tleV07CgogICAgICAgICAgICAgIGlmIChfZmlsdGVyKSB7CiAgICAgICAgICAgICAgICBfZmlsdGVyLmNoaWxkcmVucy5wdXNoKHsKICAgICAgICAgICAgICAgICAgcHJvcGVydHk6IGtleSwKICAgICAgICAgICAgICAgICAgdmFsdWU6IHF1ZXJ5U3RyaW5nLAogICAgICAgICAgICAgICAgICBvcGVyYXRvcjogZiwKICAgICAgICAgICAgICAgICAgb3BlcmFuZDogIm9yIgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIF9maWx0ZXIgPSB7CiAgICAgICAgICAgICAgICAgIHByb3BlcnR5OiBrZXksCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBxdWVyeVN0cmluZywKICAgICAgICAgICAgICAgICAgb3BlcmF0b3I6IGYsCiAgICAgICAgICAgICAgICAgIG9wZXJhbmQ6ICJhbmQiLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbnM6IFtdCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChfZmlsdGVyKSB7CiAgICAgICAgICAgIGZpbHRlcnMucHVzaChfZmlsdGVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBwYXlsb2FkID0ge307CiAgICAgICAgcGF5bG9hZC5za2lwID0gMDsKICAgICAgICBwYXlsb2FkLnRha2UgPSBtZS5wYWdlU2l6ZTsKICAgICAgICBwYXlsb2FkLnBhZ2VBcHBlbmQgPSBmYWxzZTsKCiAgICAgICAgaWYgKGZpbHRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgcGF5bG9hZC5maWx0ZXIgPSBmaWx0ZXJzOwogICAgICAgIH0KCiAgICAgICAgdmFyIGNvbHVtbnMgPSBbbWUuZGlzcGxheUZpZWxkLCBtZS52YWx1ZUZpZWxkXTsKCiAgICAgICAgaWYgKG1lLmNvbHVtbnMgJiYgbWUuY29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBtZS5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKGl0ZW0uZGF0YUZpZWxkICYmIGNvbHVtbnMuaW5kZXhPZihpdGVtLmRhdGFGaWVsZCkpIHsKICAgICAgICAgICAgICBjb2x1bW5zLnB1c2goaXRlbS5kYXRhRmllbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmIChtZS5yZXF1ZXN0RmllbGQpIHsKICAgICAgICAgIG1lLnJlcXVlc3RGaWVsZC5zcGxpdCgiLCIpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKGl0ZW0gJiYgY29sdW1ucy5pbmRleE9mKGl0ZW0pKSB7CiAgICAgICAgICAgICAgY29sdW1ucy5wdXNoKGl0ZW0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHBheWxvYWQuY29sdW1ucyA9IGNvbHVtbnMuam9pbigiLCIpOwogICAgICAgIG1lLmxhc3RSZXF1ZXN0UGFyYW0gPSBwYXlsb2FkOwoKICAgICAgICBpZiAodHlwZW9mIG1lLmJ1aWxkRmlsdGVyID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIG1lLmJ1aWxkRmlsdGVyKHBheWxvYWQpOwogICAgICAgIH0KCiAgICAgICAgbWUubG9hZGluZyA9IHRydWU7CiAgICAgICAgbWUuJGVtaXQoImxvYWREYXRhIiwgcGF5bG9hZCk7IC8vVFZMb2kgMjguMDguMjAyMSBDaG8gdOG6r3QgbHXDtG4gY+G7nSDhu58gxJHDonkgbuG7r2EsIFBow7JuZyB0csaw4budbmcgaOG7o3AgeOG7lSBjb21ibyBuaMawbmcga28gZ+G7jWkgQVBJIHRow6wga28gdOG6r3QgxJHGsOG7o2MgY+G7nSBsb2FkaW5nLgoKICAgICAgICBtZS5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBRdWVyeSBk4buvIGxp4buHdSBsb2NhbA0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAyNC4wNi4yMDIwDQogICAgICovCiAgICBkb0xvY2FsUXVlcnk6IGZ1bmN0aW9uIGRvTG9jYWxRdWVyeShxdWVyeVN0cmluZykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZmlsdGVyRGF0YSA9IG1lLmZpbHRlckRhdGEocXVlcnlTdHJpbmcpOwoKICAgICAgaWYgKHF1ZXJ5U3RyaW5nICYmIG1lLmNvbWJvVHlwZSA9PT0gMykgewogICAgICAgIHZhciBmaXJzdEl0ZW0gPSBmaWx0ZXJEYXRhWzBdOyAvL3Row6ptIGNoYSB2w6BvIMSR4buDIGJ1aWxkIGPDonkKCiAgICAgICAgdmFyIHJvb3RzID0gW107CiAgICAgICAgdmFyIGkgPSAwOwoKICAgICAgICB3aGlsZSAoaSA8IGZpbHRlckRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgaXRlbSA9IGZpbHRlckRhdGFbaV0sCiAgICAgICAgICAgICAgcGFyZW50ID0gaXRlbS5wYXJlbnROb2RlOwoKICAgICAgICAgIGlmICghcGFyZW50IHx8IEFycmF5LmlzQXJyYXkocGFyZW50KSkgewogICAgICAgICAgICByb290cy5wdXNoKGl0ZW0pOwogICAgICAgICAgfSBlbHNlIGlmIChmaWx0ZXJEYXRhLmluZGV4T2YocGFyZW50KSA9PT0gLTEpIHsKICAgICAgICAgICAgZmlsdGVyRGF0YS5wdXNoKHBhcmVudCk7CiAgICAgICAgICB9CgogICAgICAgICAgaSsrOwogICAgICAgIH0gLy9z4bqvcCB44bq/cCByb290IHRoZW8gxJHDum5nIHRo4bupIHThu7EKCgogICAgICAgIGlmIChyb290cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICB2YXIgX3JzID0gW107CgogICAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IG1lLl9hbGxEYXRhLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICB2YXIgX2l0ZW0yID0gbWUuX2FsbERhdGFbX2ldOwoKICAgICAgICAgICAgaWYgKHJvb3RzLmluZGV4T2YoX2l0ZW0yKSA+IC0xKSB7CiAgICAgICAgICAgICAgX3JzLnB1c2goX2l0ZW0yKTsKCiAgICAgICAgICAgICAgaWYgKF9ycy5sZW5ndGggPT09IHJvb3RzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcm9vdHMgPSBfcnM7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IC8vYnVpbGQgY8OieQoKCiAgICAgICAgdmFyIHJzID0gW107CgogICAgICAgIHZhciBmblB1c2ggPSBmdW5jdGlvbiBmblB1c2goaXRlbSkgewogICAgICAgICAgcnMucHVzaChpdGVtKTsKCiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkTm9kZXMpKSB7CiAgICAgICAgICAgIGl0ZW0uY2hpbGROb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICAgICAgICAgIGlmIChmaWx0ZXJEYXRhLmluZGV4T2YoY2hpbGQpID4gLTEpIHsKICAgICAgICAgICAgICAgIGZuUHVzaChjaGlsZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICByb290cy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBmblB1c2goaXRlbSk7CiAgICAgICAgfSk7IC8vc+G6r3AgeOG6v3AgdGhlbyBtaXNhQ29kZQoKICAgICAgICBmaWx0ZXJEYXRhID0gcnM7CiAgICAgIH0KCiAgICAgIG1lLl9maWx0ZXJEYXRhID0gZmlsdGVyRGF0YTsKICAgICAgdmFyIGNvdW50ID0gTWF0aC5taW4obWUuX2ZpbHRlckRhdGEubGVuZ3RoLCBtZS5wYWdlU2l6ZSk7CiAgICAgIHZhciBkcyA9IFtdOwoKICAgICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgY291bnQ7IF9pMisrKSB7CiAgICAgICAgZHMucHVzaChtZS5fZmlsdGVyRGF0YVtfaTJdKTsKICAgICAgfQoKICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlID0gZHM7CiAgICB9LAogICAgZmlsdGVyRGF0YTogZnVuY3Rpb24gZmlsdGVyRGF0YShxdWVyeVN0cmluZykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgbWF0Y2hJdGVtID0gW107CgogICAgICBpZiAocXVlcnlTdHJpbmcpIHsKICAgICAgICBtZS5fYWxsRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICB2YXIgdmFsaWQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKHZhciBmIGluIG1lLmZpbHRlckZpZWxkcykgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBpdGVtW2ZdOwogICAgICAgICAgICB2YXIgdGVzdCA9IG1lLnRlc3RGaWx0ZXIobWUuZmlsdGVyRmllbGRzW2ZdLCB2YWx1ZSwgcXVlcnlTdHJpbmcpOwoKICAgICAgICAgICAgaWYgKHRlc3QpIHsKICAgICAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgICAgbWF0Y2hJdGVtLnB1c2goaXRlbSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWF0Y2hJdGVtID0gbWUuX2FsbERhdGE7CiAgICAgIH0KCiAgICAgIHJldHVybiBtYXRjaEl0ZW07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IGNodeG7l2kgY+G6p24gcXVlcnksIHRyxrDhu51uZyBo4bujcCBudW1iZXIgdGjDrCBs4bqleSB2YWx1ZSBi4buPIHF1YSBrw70gdOG7sSBwaMOibiBjw6FjaA0KICAgICAqIENyZWF0ZWRCeSBMVERBVCAxMS8xMi8yMDE5DQogICAgICovCiAgICBnZXRRdWVyeVN0cmluZzogZnVuY3Rpb24gZ2V0UXVlcnlTdHJpbmcoKSB7CiAgICAgIHJldHVybiAodGhpcy5pbnRlcm5hbFRleHQgfHwgIiIpLnRyaW0oKTsKICAgIH0sCiAgICAvL0NsaWNrIHJhIG5nb8OgaSBjb21ibyDEkcOzbmcgY29tYm8gbOG6oWkKICAgIC8vQ3JlYXRlZCBieSBMVERBVCAxOC4wNi4yMDIwCiAgICBjbGlja19vdXQ6IGZ1bmN0aW9uIGNsaWNrX291dChlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoIWNvbW1vbkZuLmhhc1BhcmVudChlLnRhcmdldCwgbWUuJGVsKSAmJiBtZS4kcmVmcy5kcm9wZG93blBhbmVsICYmIG1lLiRyZWZzLmRyb3Bkb3duUGFuZWwuJGVsICYmICFjb21tb25Gbi5oYXNQYXJlbnQoZS50YXJnZXQsIG1lLiRyZWZzLmRyb3Bkb3duUGFuZWwuJGVsKSkgewogICAgICAgIG1lLmNvbGxhcHNlKCk7CiAgICAgIH0KICAgIH0sCiAgICAvL1Jlc2V0IGzhuqFpIGPDoWMgZ2nDoSB0cuG7iyB0cm9uZyBjb21ib2JveAogICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5pbnRlcm5hbFRleHQgPSAiIjsKICAgICAgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0gPSBudWxsOwogICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gLTE7CiAgICAgIG1lLmludGVybmFsVmFsdWUgPSBudWxsOwogICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsKICAgIH0sCgogICAgLyoqDQogICAgICogU2V0IGdpw6EgdHLhu4sgaGnhu4NuIHRo4buLDQogICAgICogQHByYW0gdmFsdWUgZ2nDoSB0cuG7iyBoaeG7g24gdGjhu4sNCiAgICAgKi8KICAgIHNldEludGVybmFsVGV4dDogZnVuY3Rpb24gc2V0SW50ZXJuYWxUZXh0KHZhbHVlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLmludGVybmFsVGV4dCA9IHZhbHVlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBTZXQgdmFsdWUgY2hvIGNvbWJvDQogICAgICovCiAgICBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUodmFsdWUpIHsKICAgICAgdmFyIHVzZXJBY3Rpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IGZhbHNlOwogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5pbnRlcm5hbFZhbHVlID0gdmFsdWU7CiAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICBtZS5kb0hpZ2h0bGlnaHRJdGVtKCk7CgogICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA+PSAwKSB7CiAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSwgdXNlckFjdGlvbik7CiAgICAgIH0KICAgIH0sCiAgICAvL1Phu7Ega2nhu4duIG5o4bqtcCBsaeG7h3UgdHLDqm4gaW5wdXQKICAgIC8vQ3JlYXRlZCBieSBMVERBVCAoMTYuMDYuMjAyMCkKICAgIG9uSW5wdXQ6IGZ1bmN0aW9uIG9uSW5wdXQoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5fdHlwaW5nID0gdHJ1ZTsKCiAgICAgIGlmICghbWUuZXhwYW5kZWQpIHsKICAgICAgICBtZS5leHBhbmQoKTsgLy8gbWUuZG9RdWVyeUludGVybmFsKG1lLmdldFF1ZXJ5U3RyaW5nKCksIHRydWUpOwogICAgICB9CgogICAgICBpZiAoIW1lLmludGVybmFsVGV4dCkgewogICAgICAgIC8vIGlmIChtZS5pbnRlcm5hbFZhbHVlKSB7CiAgICAgICAgLy8gICBsZXQgbWV0YURhdGEgPSB7CiAgICAgICAgLy8gICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLAogICAgICAgIC8vICAgICBuZXdEYXRhOiBudWxsLAogICAgICAgIC8vICAgfTsKICAgICAgICAvLyAgIG1lLiRlbWl0KCJzZWxlY3RlZCIsIG1ldGFEYXRhKTsKICAgICAgICAvLyB9CgogICAgICAgIC8qKg0KICAgICAgICAgKiByZXNldCBs4bqhaSBjb21ibyBraGkgaW50ZXJuYWxUZXh0IHLhu5duZw0KICAgICAgICAgKiBOTVRVQU4zIDE2LzExLzIwMjENCiAgICAgICAgICovCiAgICAgICAgbWUucmVzZXQoKTsKCiAgICAgICAgaWYgKCFtZS5mb3JjZVNlbGVjdGlvbikgewogICAgICAgICAgbWUucmVzZXQoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1lLmRvUXVlcnkobWUuaW50ZXJuYWxUZXh0LCB0cnVlKTsKICAgICAgbWUuX3R5cGluZyA9IGZhbHNlOwoKICAgICAgaWYgKCFtZS5mb3JjZVNlbGVjdGlvbiAmJiBtZS52YWx1ZUZpZWxkID09IG1lLmRpc3BsYXlGaWVsZCkgewogICAgICAgIG1lLmludGVybmFsVmFsdWUgPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAobWUuZm9yY2VTZWxlY3Rpb24gJiYgbWUuYWxsb3dEZXNlbGVjdEl0ZW0gJiYgbWUuaW50ZXJuYWxUZXh0ID09ICIiKSB7CiAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICB2YXIgZGF0YUVtcHR5ID0ge307CiAgICAgICAgZGF0YUVtcHR5W21lLnZhbHVlRmllbGRdID0gbnVsbDsKICAgICAgICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICB2YXIgbWV0YURhdGEgPSB7CiAgICAgICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAgIG5ld0RhdGE6IGRhdGFFbXB0eQogICAgICAgIH07CiAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOwogICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICB9IGVsc2UgaWYgKG1lLmFsbG93RnJlZVRleHQpIHsKICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsKICAgICAgICBtZS5zZXRJbml0VGV4dChtZS5pbnRlcm5hbFRleHQpOwogICAgICAgIHZhciBfZGF0YUVtcHR5ID0ge307CiAgICAgICAgX2RhdGFFbXB0eVttZS52YWx1ZUZpZWxkXSA9IG1lLmludGVybmFsVmFsdWU7CiAgICAgICAgX2RhdGFFbXB0eVttZS5kaXNwbGF5RmllbGRdID0gbWUuaW50ZXJuYWxUZXh0OwogICAgICAgIHZhciBfbWV0YURhdGEgPSB7CiAgICAgICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAgIG5ld0RhdGE6IF9kYXRhRW1wdHkKICAgICAgICB9OwogICAgICAgIG1lLiRlbWl0KCJzZWxlY3RlZCIsIF9tZXRhRGF0YSk7CiAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7CiAgICAgIH0KCiAgICAgIG1lLmRvSGlnaHRsaWdodEl0ZW0odHJ1ZSk7CiAgICAgIG1lLmFkanVzdFNjcm9sbCgpOwogICAgfSwKICAgIC8vU+G7sSBraeG7h24gY2xpY2sgdsOgbyBpbnB1dAogICAgLy9DcmVhdGVkIGJ5IE5OTEFNICgxOS8wNC8yMDIxKQogICAgb25DbGljazogZnVuY3Rpb24gb25DbGljayhlKSB7CiAgICAgIHRoaXMuJGVtaXQoImNsaWNrIiwgZSk7CiAgICB9LAogICAgLy9T4buxIGtp4buHbiBmb2N1cyB2w6BvIGlucHV0CiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApCiAgICBvbkZvY3VzOiBmdW5jdGlvbiBvbkZvY3VzKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuZm9jdXNlZCA9IHRydWU7CiAgICAgIG1lLiRlbWl0KCJmb2N1cyIsIGUpOwogICAgfSwKICAgIC8vU+G7sSBraeG7h24gY2hhbmdlIGlucHV0CiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApCiAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmZvY3VzZWQpIHsKICAgICAgICBpZiAobWUuZm9yY2VTZWxlY3Rpb24pIHsKICAgICAgICAgIGlmIChtZS50eXBlQWhlYWRQb2ludGVyIDwgMCkgewogICAgICAgICAgICAvL21lLnJlc2V0KCk7CiAgICAgICAgICAgIC8vIGxldCBkYXRhRW1wdHkgPSB7fTsKICAgICAgICAgICAgLy8gICBkYXRhRW1wdHlbbWUudmFsdWVGaWVsZF0gPSBudWxsOwogICAgICAgICAgICAvLyAgIGRhdGFFbXB0eVttZS5kaXNwbGF5RmllbGRdID0gbWUuaW50ZXJuYWxUZXh0OwogICAgICAgICAgICAvLyAgIGxldCBtZXRhRGF0YSA9IHsKICAgICAgICAgICAgLy8gICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLAogICAgICAgICAgICAvLyAgICAgbmV3RGF0YTogZGF0YUVtcHR5LAogICAgICAgICAgICAvLyAgICAgdXNlckFjdGlvbjogZmFsc2UKICAgICAgICAgICAgLy8gICB9OwogICAgICAgICAgICAvL1RPRE8gYm5kdWMgOS43LjIwMjE6IELhu48gcmFpc2Ugc2VsZWN0ZCBldmVudCDEkWkgdsOsIGPDoWMgZm9ybSDEkWFuZyBoYW5kbGUgxJHhu4MgZ8OhbiBs4bqhaSBpbml0VGV4dCAtPiBs4buXaSB2YWxpZGF0ZSBmb3JjZVNlbGVjdGlvbgogICAgICAgICAgICAvLyBtZS4kZW1pdCgic2VsZWN0ZWQiLCBtZXRhRGF0YSk7CiAgICAgICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICAgICAgfSBlbHNlIGlmIChtZS5hbGxvd0Rlc2VsZWN0SXRlbSAmJiBtZS5pbnRlcm5hbFRleHQgPT0gIiIpIHsKICAgICAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IC0xOwogICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsKICAgICAgICAgICAgdmFyIGRhdGFFbXB0eSA9IHt9OwogICAgICAgICAgICBkYXRhRW1wdHlbbWUudmFsdWVGaWVsZF0gPSBudWxsOwogICAgICAgICAgICBkYXRhRW1wdHlbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICAgICAgdmFyIG1ldGFEYXRhID0gewogICAgICAgICAgICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLAogICAgICAgICAgICAgIG5ld0RhdGE6IGRhdGFFbXB0eSwKICAgICAgICAgICAgICB1c2VyQWN0aW9uOiBmYWxzZQogICAgICAgICAgICB9OwogICAgICAgICAgICBtZS4kZW1pdCgic2VsZWN0ZWQiLCBtZXRhRGF0YSk7CiAgICAgICAgICAgIG1lLiRlbWl0KCJpbnB1dCIsIG1lLmludGVybmFsVmFsdWUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IG1lLmZpbHRlckluZGV4SXRlbUJ5VGV4dCgpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAobWUudmFsdWVGaWVsZCA9PSBtZS5kaXNwbGF5RmllbGQpIHsKICAgICAgICAgICAgbWUuaW50ZXJuYWxWYWx1ZSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gbWUuZmlsdGVySW5kZXhJdGVtQnlUZXh0KCk7CgogICAgICAgICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA8IDApIHsKICAgICAgICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsKICAgICAgICAgICAgICB2YXIgX2RhdGFFbXB0eTIgPSB7fTsKICAgICAgICAgICAgICBfZGF0YUVtcHR5MlttZS52YWx1ZUZpZWxkXSA9IG51bGw7CiAgICAgICAgICAgICAgX2RhdGFFbXB0eTJbbWUuZGlzcGxheUZpZWxkXSA9IG1lLmludGVybmFsVGV4dDsKICAgICAgICAgICAgICB2YXIgX21ldGFEYXRhMiA9IHsKICAgICAgICAgICAgICAgIG9sZERhdGE6IG1lLmludGVybmFsU2VsZWN0ZWRJdGVtLAogICAgICAgICAgICAgICAgbmV3RGF0YTogX2RhdGFFbXB0eTIsCiAgICAgICAgICAgICAgICB1c2VyQWN0aW9uOiBmYWxzZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgX21ldGFEYXRhMik7CiAgICAgICAgICAgICAgbWUuJGVtaXQoImlucHV0IiwgbWUuaW50ZXJuYWxWYWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gLy9UT0RPIGJuZHVjIDUuNS4yMDIxIGNo4buXIG7DoHkgZ+G7jWkgY2hhbmdlIGzDoG0gZ8OsIG5o4buJCiAgICAgIC8vIG1lLiRlbWl0KCJjaGFuZ2UiLCBtZS5pbnRlcm5hbFZhbHVlKTsKCiAgICB9LAogICAgLy9T4buxIGtp4buHbiBibHVyIGlucHV0CiAgICAvL0NyZWF0ZWQgYnkgTFREQVQgKDE2LjA2LjIwMjApCiAgICAvLyBwdmR1eSAwNy8wNS8yMDIxOiBz4butYSBs4bqhaSBjb21ib2JveCAoxJHDoyB0cmFvIMSR4buVaSB24bubaSBTQSBhbmggQk5EdWMpCiAgICBvbkJsdXI6IGZ1bmN0aW9uIG9uQmx1cihlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLmZvY3VzZWQgPSBmYWxzZTsgLy9u4bq/dSBraMO0bmcgY8OzIHZhbHVlIG3DoCBzb3VyY2UgY2jhu4kgY8OzIDEgYuG6o24gZ2hpICsgdGV4dCBoaeG7g24gdGjhu4sgxJFhbmcgbWFwIC0+IHNlbGVjdCBpdGVtIG7DoHkKCiAgICAgIGlmIChtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID09PSAxICYmIG1lLmludGVybmFsVGV4dCAmJiAhbWUuaW50ZXJuYWxWYWx1ZSkgewogICAgICAgIHZhciBmaXJzdEl0ZW0gPSBtZS5pbnRlcm5hbERhdGFTb3VyY2VbMF07CiAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKGZpcnN0SXRlbSk7CiAgICAgIH0gLy9tZS52YWxpZGF0ZShtZSk7CgoKICAgICAgaWYgKG1lLmludGVybmFsVGV4dCAhPSAiIikgewogICAgICAgIGlmIChtZS52YWxpZGF0ZU9uQmx1cikgewogICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgbWUudmFsaWRhdGVCbHVyKCk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gLy9URE5HSElBIDE2LzkvMjAyMSBu4bq/dSBmb3JjZSBzZWxlY3Rpb24gdGjDrCBvdXQgZm9jdXMgcmEgbcOgIHjDs2EgaOG6v3QgdGV4dCB0aMOsIHNldCBs4bqhaSBnacOhIHRy4buLIGPFqSBjaG8gY29tYm8KICAgICAgLy8gTk1UVUFOMiAxMy4wNC4yMDIyOiBu4bq/dSBraMO0bmcgY2hvIGLhu48gY2jhu41uIHRow6wgbeG7m2kgc2V0IGzhuqFpIGdpw6EgdHLhu4sgY8WpCgoKICAgICAgaWYgKG1lLmZvcmNlU2VsZWN0aW9uICYmICFtZS5hbGxvd0Rlc2VsZWN0SXRlbSAmJiBtZS5pbnRlcm5hbFRleHQgPT0gIiIgJiYgbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0pIHsKICAgICAgICBtZS5pbnRlcm5hbFRleHQgPSBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbVttZS5kaXNwbGF5RmllbGRdOwogICAgICB9IC8vVEROR0hJQSAxNC8xMS8yMDIxOiBoaeG7h24gdOG6oWkgbuG6v3UgeMOzYSBo4bq/dCB0ZXh0IMSRaSBjb21ibyB04buxIGNo4buNbiBs4bqhaSBnacOhIHRy4buLID0+IGNhc2UgbuG6v3UgeMOzYSBo4bq/dCB0aMOsIHJlc2V0IGx1w7RuCgoKICAgICAgaWYgKG1lLmludGVybmFsVGV4dCA9PSAiIiAmJiAhbWUuaW50ZXJuYWxTZWxlY3RlZEl0ZW0pIHsKICAgICAgICBtZS5yZXNldCgpOwogICAgICB9CgogICAgICBtZS4kZW1pdCgiYmx1ciIsIGUpOwogICAgfSwKICAgIC8vU+G7sSBraeG7h24ga2V5ZG93biBpbnB1dAogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQogICAgb25LZXlkb3duOiBmdW5jdGlvbiBvbktleWRvd24oZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChlLndoaWNoKSB7CiAgICAgICAgY2FzZSA0MDoKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKCFtZS5leHBhbmRlZCkgewogICAgICAgICAgICAgIG1lLmRvUXVlcnlJbnRlcm5hbChudWxsLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChtZS50eXBlQWhlYWRQb2ludGVyIDwgbWUuZ2V0VG90YWxEYXRhKCkgLSAxKSB7CiAgICAgICAgICAgICAgaWYgKG1lLm5vdFNlbGVjdGlvblBhcmVudCkgewogICAgICAgICAgICAgICAgdmFyIHR5cGVBaGVhZFBvaW50ZXJOZXh0ID0gbWUudHlwZUFoZWFkUG9pbnRlciArIDE7CgogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHR5cGVBaGVhZFBvaW50ZXJOZXh0OyBpIDwgbWUuZ2V0VG90YWxEYXRhKCk7IGkrKykgewogICAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyKys7CiAgICAgICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbCh0eXBlQWhlYWRQb2ludGVyTmV4dCk7CgogICAgICAgICAgICAgICAgICBpZiAoIW1lLmludGVybmFsRGF0YVNvdXJjZVtpXS5pc1BhcmVudCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXIrKzsKICAgICAgICAgICAgICAgIG1lLmFkanVzdFNjcm9sbCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgMzg6CiAgICAgICAgICB7CiAgICAgICAgICAgIGlmIChtZS5leHBhbmRlZCkgewogICAgICAgICAgICAgIGlmIChtZS50eXBlQWhlYWRQb2ludGVyID4gMCkgewogICAgICAgICAgICAgICAgaWYgKG1lLm5vdFNlbGVjdGlvblBhcmVudCkgewogICAgICAgICAgICAgICAgICB2YXIgdHlwZUFoZWFkUG9pbnRlclByZSA9IG1lLnR5cGVBaGVhZFBvaW50ZXIgLSAxOwoKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kzID0gdHlwZUFoZWFkUG9pbnRlclByZTsgX2kzID4gMDsgX2kzLS0pIHsKICAgICAgICAgICAgICAgICAgICBtZS50eXBlQWhlYWRQb2ludGVyLS07CiAgICAgICAgICAgICAgICAgICAgbWUuYWRqdXN0U2Nyb2xsKG1lLnR5cGVBaGVhZFBvaW50ZXIpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoIW1lLmludGVybmFsRGF0YVNvdXJjZVtfaTNdLmlzUGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG1lLnR5cGVBaGVhZFBvaW50ZXItLTsKICAgICAgICAgICAgICAgICAgbWUuYWRqdXN0U2Nyb2xsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxMzoKICAgICAgICAgIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgaWYgKG1lLnR5cGVBaGVhZFBvaW50ZXIgPj0gMCkgewogICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShtZS5pbnRlcm5hbERhdGFTb3VyY2VbbWUudHlwZUFoZWFkUG9pbnRlcl0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtZS5jb2xsYXBzZSgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgOToKICAgICAgICAgIHsKICAgICAgICAgICAgaWYgKG1lLmV4cGFuZGVkKSB7CiAgICAgICAgICAgICAgLy8gTk1UVUFOMyAxNi8xMS8yMDIxIFRow6ptIMSRaeG7gXUga2nhu4duIGtp4buDbSB0cmEgaW50ZXJuYWxUZXh0IGPDsyBy4buXbmcgaGF5IGtow7RuZwogICAgICAgICAgICAgIC8vVEROR0hJQSBjb21tZW50IGzhuqFpOiDEkW/huqFuIG7DoHkgbMOgIMSR4buDIG7hur91IOG6pW4gdGFiIG3DoCB0csOqbiBjb21ibyBjw7MgbWFwIMSRxrDhu6NjIGdpw6EgdHLhu4sgbsOgbyBy4buTaSB0aMOsIHPhur0gdOG7sSBjaOG7jW4gZ2nDoSB0cuG7iyDEkeG6pXkKICAgICAgICAgICAgICBpZiAobWUudHlwZUFoZWFkUG9pbnRlciA+PSAwICYmIG1lLmludGVybmFsVGV4dCkgewogICAgICAgICAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKG1lLmludGVybmFsRGF0YVNvdXJjZVttZS50eXBlQWhlYWRQb2ludGVyXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZS5jb2xsYXBzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQoKICAgICAgbWUuJGVtaXQoImtleWRvd24iLCBlKTsKICAgIH0sCiAgICAvL0zhuqV5IHThu5VuZyBz4buRIGzGsOG7o25nIGThu68gbGnhu4d1IHRyb25nIGRhdGEKICAgIGdldFRvdGFsRGF0YTogZnVuY3Rpb24gZ2V0VG90YWxEYXRhKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsKICAgIH0sCiAgICAvL0LDtGkgbcOgdSBoaWdodGxpZ2h0IGNobyBpdGVtCiAgICBkb0hpZ2h0bGlnaHRJdGVtOiBmdW5jdGlvbiBkb0hpZ2h0bGlnaHRJdGVtKGlnbm9yZVZhbHVlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBpbmRleCA9IC0xOwoKICAgICAgaWYgKG1lLmludGVybmFsRGF0YVNvdXJjZSAmJiBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoID4gMCkgewogICAgICAgIGluZGV4ID0gLTE7CgogICAgICAgIGlmICghaWdub3JlVmFsdWUgJiYgbWUuaW50ZXJuYWxWYWx1ZSAhPSBudWxsICYmIG1lLmludGVybmFsVmFsdWUgIT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICB2YXIgc291cmNlcyA9IG1lLl9hbGxEYXRhIHx8IG1lLmludGVybmFsRGF0YVNvdXJjZTsgLy9Ucsaw4bubYyBraGkgbG9hZCB0w61uaCB0b8OhbiBs4bqhaSB0eXBlQWhlYWRQb2ludGVyIG7hur91IGPhuqduIHRoaeG6v3QgxJHhu4Mgc2Nyb2xsIGRpIGNodXnhu4NuIHbhu4EgZMO6bmcgduG7iyB0csOtIGtoaSBzaG93IHNjcm9sbGVyIGzDqm4KICAgICAgICAgIC8vVMOsbSB24buLIHRyw60gc2VsZWN0ZWRJdGVtIHRyb25nIHNvdXJjZSwga2jDtG5nIGzhuqV5IHNlbGVjdGVkSW5kZXggdsOsIGPDsyB0aOG7gyBraMO0bmcgY2jDrW5oIHjDoWMga2hpIHNvdXJjZSB0aGF5IMSR4buVaQoKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgaXRlbSA9IHNvdXJjZXNbaV07CgogICAgICAgICAgICBpZiAoaXRlbVttZS52YWx1ZUZpZWxkXSA9PT0gbWUuaW50ZXJuYWxWYWx1ZSkgewogICAgICAgICAgICAgIGluZGV4ID0gaTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpbmRleCA+PSBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoKSB7CiAgICAgICAgICAgIGZvciAodmFyIF9pNCA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGg7IF9pNCA8PSBpbmRleDsgX2k0KyspIHsKICAgICAgICAgICAgICBtZS5pbnRlcm5hbERhdGFTb3VyY2UucHVzaChzb3VyY2VzW19pNF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5kZXggPT09IC0xICYmIG1lLmludGVybmFsVGV4dCkgewogICAgICAgICAgdmFyIGxvd2VyVGV4dCA9IG1lLmludGVybmFsVGV4dC50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgIGlmIChtZS5jb2x1bW5zICYmIG1lLmNvbHVtbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICBmb3IgKHZhciBfaTUgPSAwOyBfaTUgPCBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoOyBfaTUrKykgewogICAgICAgICAgICAgIHZhciBfaXRlbTMgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2VbX2k1XTsKCiAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtZS5jb2x1bW5zLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICB2YXIgZmllbGQgPSBtZS5jb2x1bW5zW2pdLmRhdGFGaWVsZDsKICAgICAgICAgICAgICAgIHZhciBpdGVtVmFsdWUgPSBfaXRlbTNbZmllbGRdOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbVZhbHVlID09PSAic3RyaW5nIiAmJiBpdGVtVmFsdWUudG9Mb3dlckNhc2UoKS5pbmRleE9mKGxvd2VyVGV4dCkgPiAtMSkgewogICAgICAgICAgICAgICAgICBpbmRleCA9IF9pNTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKHZhciBfaTYgPSAwOyBfaTYgPCBtZS5pbnRlcm5hbERhdGFTb3VyY2UubGVuZ3RoOyBfaTYrKykgewogICAgICAgICAgICAgIHZhciBfaXRlbVZhbHVlID0gbWUuaW50ZXJuYWxEYXRhU291cmNlW19pNl1bbWUuZGlzcGxheUZpZWxkXTsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfaXRlbVZhbHVlID09PSAic3RyaW5nIiAmJiBfaXRlbVZhbHVlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihsb3dlclRleHQpID4gLTEpIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gX2k2OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoaW5kZXggPT09IC0xKSB7CiAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgfQogICAgICB9CgogICAgICBtZS50eXBlQWhlYWRQb2ludGVyID0gaW5kZXg7CiAgICB9LAogICAgLy9Uw6xtIGtp4bq/bSBpdGVtIHRyb25nIGxpc3QKICAgIC8vQ3JlYXRlZCBieSBMVERBVCgxNi4wNi4yMDIwKQogICAgZmlsdGVySW5kZXhJdGVtQnlUZXh0OiBmdW5jdGlvbiBmaWx0ZXJJbmRleEl0ZW1CeVRleHQocXVlcnlUZXh0KSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBmaWx0ZXJzID0gbWUuZmlsdGVyRmllbGRzLAogICAgICAgICAgdmFsdWUgPSBxdWVyeVRleHQgfHwgbWUuaW50ZXJuYWxUZXh0LAogICAgICAgICAgaW5kZXggPSAtMTsKCiAgICAgIGlmIChmaWx0ZXJzICYmIHZhbHVlKSB7CiAgICAgICAgdmFsdWUgPSB2YWx1ZS50b1N0cmluZygpOwogICAgICAgIGluZGV4ID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSwgX2luZGV4KSB7CiAgICAgICAgICB2YXIgcmV0ID0gZmFsc2U7CgogICAgICAgICAgZm9yICh2YXIga2V5IGluIGZpbHRlcnMpIHsKICAgICAgICAgICAgaWYgKGZpbHRlcnMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgIHZhciBzID0gZmlsdGVyc1trZXldOwoKICAgICAgICAgICAgICBpZiAocyA9PSAiY29udGFpbnMiKSB7CiAgICAgICAgICAgICAgICByZXQgPSBpdGVtW2tleV0gJiYgaXRlbVtrZXldLnRvU3RyaW5nKCkgJiYgaXRlbVtrZXldLnRvU3RyaW5nKCkudG9Mb3dlckNhc2UoKS5jb250YWlucyh2YWx1ZS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0ID0gaXRlbVtrZXldICYmIGl0ZW1ba2V5XS50b1N0cmluZygpICYmIGl0ZW1ba2V5XS50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCh2YWx1ZS50b0xvd2VyQ2FzZSgpKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChyZXQpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHJldHVybiByZXQ7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiBpbmRleDsKICAgIH0sCiAgICAvL0zhuqV5IGPhu5l0IGZpbHRlciDEkeG7gyB0w6xtIGtp4bq/bSBsb2NhbAogICAgLy9DcmVhdGVkIGJ5IExUREFUIDE2LjA2LjIwMjAKICAgIGdldEZpbHRlckZpZWxkczogZnVuY3Rpb24gZ2V0RmlsdGVyRmllbGRzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGZpbHRlciA9IHt9OwoKICAgICAgaWYgKHRoaXMuY29sdW1ucyAmJiB0aGlzLmNvbHVtbnMubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKGkpIHsKICAgICAgICAgIHZhciBjb2wgPSBfdGhpcy5jb2x1bW5zW2ldOwoKICAgICAgICAgIGlmICghY29sLmZpbHRlck9wZXJhdG9yKSB7CiAgICAgICAgICAgIGNvbC5maWx0ZXJPcGVyYXRvciA9ICJjb250YWlucyI7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGNvbC5kYXRhRmllbGQgJiYgY29sLmZpbHRlck9wZXJhdG9yKSB7CiAgICAgICAgICAgIGlmIChfdGhpcy5maWx0ZXJDb2x1bW5zICYmIF90aGlzLmZpbHRlckNvbHVtbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIF90aGlzLmZpbHRlckNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgaWYgKCFmaWx0ZXIuaGFzT3duUHJvcGVydHkoZSkpIHsKICAgICAgICAgICAgICAgICAgZmlsdGVyW2VdID0gY29sLmZpbHRlck9wZXJhdG9yOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGZpbHRlcltjb2wuZGF0YUZpZWxkXSA9IGNvbC5maWx0ZXJPcGVyYXRvcjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jb2x1bW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBfbG9vcChpKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZmlsdGVyW3RoaXMuZGlzcGxheUZpZWxkXSA9ICJjb250YWlucyI7CiAgICAgIH0KCiAgICAgIHJldHVybiBmaWx0ZXI7CiAgICB9LAogICAgLy9M4bqleSBlbGVtZW50IHNjcm9sbAogICAgLy9DcmVhdGVkIGJ5IExUREFUICgxNi4wNi4yMDIwKQogICAgZ2V0U2Nyb2xsZXI6IGZ1bmN0aW9uIGdldFNjcm9sbGVyKCkgewogICAgICBpZiAodGhpcy5leHBhbmRlZCkgewogICAgICAgIC8vIHJldHVybiB0aGlzLiRyZWZzWyJzY3JvbGxlciJdOwogICAgICAgIHZhciBkZCA9IHRoaXMuJHJlZnNbImRyb3Bkb3duUGFuZWwiXTsKCiAgICAgICAgaWYgKGRkICYmIGRkLiRlbCAmJiB0eXBlb2YgZGQuJGVsLnF1ZXJ5U2VsZWN0b3IgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIHJldHVybiBkZC4kZWwucXVlcnlTZWxlY3RvcigiLnNjcm9sbGVyIik7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogRGkgY2h1eeG7g24gdmlldyDEkeG6v24gYuG6o24gZ2hpIG7hur91IGPhuqduDQogICAgICogQHBhcmFtIHtC4bqjbiBnaGkgY+G6p24gdmlld30gaW5kZXgNCiAgICAgKiBDcmVhdGVkQnkgTFREQVQgMTYuMDYuMjAyMA0KICAgICAqLwogICAgYWRqdXN0U2Nyb2xsOiBmdW5jdGlvbiBhZGp1c3RTY3JvbGwoKSB7CiAgICAgIHZhciB0eXBlQWhlYWRQb2ludGVyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0aGlzLnR5cGVBaGVhZFBvaW50ZXI7CiAgICAgIHZhciBzY3JvbGxlciA9IHRoaXMuZ2V0U2Nyb2xsZXIoKTsKCiAgICAgIGlmIChzY3JvbGxlcikgewogICAgICAgIC8vIHNjcm9sbGVyLnNjcm9sbFRvSXRlbSh0eXBlQWhlYWRQb2ludGVyLCB0cnVlKTsKICAgICAgICBzY3JvbGxlci5zY3JvbGxUb3AgPSAzNSAqIHR5cGVBaGVhZFBvaW50ZXI7CiAgICAgIH0KICAgIH0sCiAgICBvblNjcm9sbGVyVmlzaWJsZTogZnVuY3Rpb24gb25TY3JvbGxlclZpc2libGUoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLmFkanVzdFNjcm9sbCgpOwogICAgfSwKICAgIC8vSMOgbSB44butIGzDvSBraGkgY2jhu41uIGl0ZW0gdHLDqm4gZHJvcGRvd24KICAgIC8vQ3JlYXRlZCBieSBMVERBVCgxNi4wNi4yMDIwKQogICAgb25JdGVtQ2xpY2s6IGZ1bmN0aW9uIG9uSXRlbUNsaWNrKGl0ZW0sIGV2ZW50KSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgIG1lLnNldEludGVybmFsSXRlbShpdGVtKTsKICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgIH0sCiAgICAvL1NldCBnacOhIHRy4buLIMSRxrDhu6NjIGNo4buNbgogICAgc2V0SW50ZXJuYWxJdGVtOiBmdW5jdGlvbiBzZXRJbnRlcm5hbEl0ZW0oaXRlbSkgewogICAgICB2YXIgdXNlckFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdHJ1ZTsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgaWYgKG1lLm5vdFNlbGVjdGlvblBhcmVudCAmJiBpdGVtLmlzUGFyZW50KSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICB2YXIgbWV0YURhdGEgPSB7CiAgICAgICAgICBvbGREYXRhOiBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSwKICAgICAgICAgIG5ld0RhdGE6IGl0ZW0KICAgICAgICB9OwogICAgICAgIG1lLmludGVybmFsU2VsZWN0ZWRJdGVtID0gaXRlbTsKICAgICAgICBtZS5pbnRlcm5hbFZhbHVlID0gaXRlbVttZS52YWx1ZUZpZWxkXTsKICAgICAgICBtZS4kZW1pdCgiaW5wdXQiLCBtZS5pbnRlcm5hbFZhbHVlKTsKICAgICAgICBtZS5pbnRlcm5hbFRleHQgPSBpdGVtW21lLmRpc3BsYXlGaWVsZF07CiAgICAgICAgbWUudHlwZUFoZWFkUG9pbnRlciA9IG1lLmZpbmRJbmRleEl0ZW0oaXRlbSk7CiAgICAgICAgbWUuY29sbGFwc2UoKTsKICAgICAgICBtZS4kZW1pdCgidXBkYXRlOmRpc3BsYXkiLCBtZS5pbnRlcm5hbFRleHQpOwoKICAgICAgICBpZiAobWUubWFwcGluZ0ZpZWxkKSB7CiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gbWUubWFwcGluZ0ZpZWxkKSB7CiAgICAgICAgICAgIHZhciBlbWl0U3RyVXBkYXRlID0gInVwZGF0ZToiICsga2V5OwogICAgICAgICAgICBtZS4kZW1pdChlbWl0U3RyVXBkYXRlLCBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbVttZS5tYXBwaW5nRmllbGRba2V5XV0pOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHVzZXJBY3Rpb24gPT0gdHJ1ZSkgewogICAgICAgICAgbWUuJGVtaXQoInNlbGVjdGVkIiwgbWV0YURhdGEpOwoKICAgICAgICAgIGlmIChtZXRhRGF0YS5vbGREYXRhICE9PSBtZXRhRGF0YS5uZXdEYXRhKSB7CiAgICAgICAgICAgIG1lLiRlbWl0KCJjaGFuZ2UiLCBtZS5pbnRlcm5hbFZhbHVlLCBtZXRhRGF0YS5uZXdEYXRhLCBtZXRhRGF0YS5vbGREYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWUuJGVtaXQoImF1dG9TZWxlY3RlZCIsIG1ldGFEYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvL1TDrG0gduG7iyB0cuG7iyBj4bunYSBpdGVtIHRyb25nIGRhdGEKICAgIGZpbmRJbmRleEl0ZW06IGZ1bmN0aW9uIGZpbmRJbmRleEl0ZW0oaXRlbSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuaW50ZXJuYWxEYXRhU291cmNlLmZpbmRJbmRleChmdW5jdGlvbiAoX2l0ZW0pIHsKICAgICAgICByZXR1cm4gX2l0ZW0gPT0gaXRlbTsKICAgICAgfSk7CiAgICB9LAogICAgLy9LaOG7n2kgdOG6oW8gZOG7ryBsaeG7h3UgdMSpbmggbeG6t2MgxJHhu4tuaAogICAgaW5pdFN0YXRpY0RhdGE6IGZ1bmN0aW9uIGluaXRTdGF0aWNEYXRhKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5jb21ib1R5cGUgPSAxOwogICAgICBtZS5pbnRlcm5hbFF1ZXJ5RGVsYXkgPSAyMDA7CiAgICAgIG1lLmZpbHRlckZpZWxkcyA9IG1lLmdldEZpbHRlckZpZWxkcygpOwogICAgICBtZS5pbnRlcm5hbFZhbHVlID0gbnVsbDsKICAgICAgbWUuZmlyc3RFeHBhbmQgPSB0cnVlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiB0aMOqbSBi4bqjbiBnaGkgY2jhu41uIHThuqV0IGPhuqMgdsOgbyBzb3VyY2UNCiAgICAgKi8KICAgIGFwcGVuZFNlbGVjdEFsbEl0ZW06IGZ1bmN0aW9uIGFwcGVuZFNlbGVjdEFsbEl0ZW0oKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoIW1lLnNob3dTZWxlY3RBbGwpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBmaXJzdEl0ZW0gPSBtZS5pbnRlcm5hbERhdGFTb3VyY2VbMF07CgogICAgICBpZiAoZmlyc3RJdGVtICYmIGZpcnN0SXRlbVttZS52YWx1ZUZpZWxkXSAhPT0gbWUuc2VsZWN0QWxsVmFsdWUpIHsKICAgICAgICB2YXIgYWxsSXRlbSA9IHt9OwogICAgICAgIGFsbEl0ZW1bbWUudmFsdWVGaWVsZF0gPSBtZS5zZWxlY3RBbGxWYWx1ZTsKICAgICAgICBhbGxJdGVtW21lLmRpc3BsYXlGaWVsZF0gPSBtZS5fc2VsZWN0QWxsVGV4dDsgLy8gdnZraWV0IC0gMjQuMDYuMjAyMTogQuG7lSBzdW5nIHRleHQgVOG6pXQgY+G6oyBjaG8gdOG6pXQgY+G6oyBjw6FjIGPhu5l0CgogICAgICAgIG1lLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgICBhbGxJdGVtW2NvbHVtbi5kYXRhRmllbGRdID0gbWUuX3NlbGVjdEFsbFRleHQ7CiAgICAgICAgfSk7CiAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlLnVuc2hpZnQoYWxsSXRlbSk7CiAgICAgIH0KICAgIH0sCiAgICAvL0to4bufaSB04bqhbyBk4buvIGxp4buHdQogICAgaW5pdERhdGE6IGZ1bmN0aW9uIGluaXREYXRhKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmxhc3RSZXF1ZXN0UGFyYW0gJiYgbWUubGFzdFJlcXVlc3RQYXJhbS5wYWdlQXBwZW5kICYmIG1lLnNjcm9sbERvaW5nKSB7CiAgICAgICAgLy8gaWYobWUuaW50ZXJuYWxEYXRhU291cmNlLmZpbHRlcihpPT5pPT0pKQogICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5hcHBlbmQobWUuZGF0YSk7CiAgICAgICAgbWUuc2Nyb2xsRG9pbmcgPSBmYWxzZTsgLy9u4bq/dSBk4buvIGxp4buHdSB0cuG6oyB24buBIMOtdCBoxqFuIG1vbmcgxJHhu6NpIC0+IMSRw6FuaCBk4bqldSBr4bq/dCB0aMO6YyDEkeG7gyBraGkgc2Nyb2xsIHh14buRbmcgayBsb2FkIHRow6ptIG7hu69hCgogICAgICAgIGlmIChtZS5kYXRhLmxlbmd0aCA8IG1lLnBhZ2VTaXplKSB7CiAgICAgICAgICBtZS5sYXN0UmVxdWVzdFBhcmFtLmVuZCA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1lLmxhc3RSZXF1ZXN0UGFyYW0uZW5kID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZSA9IF90b0NvbnN1bWFibGVBcnJheShtZS5kYXRhKTsKICAgICAgICBtZS5hcHBlbmRTZWxlY3RBbGxJdGVtKCk7CiAgICAgIH0KCiAgICAgIGlmIChtZS5rZXlGaWVsZCAmJiBtZS5rZXlGaWVsZCAhPT0gbWUudmFsdWVGaWVsZCkgewogICAgICAgIGNvbW1vbkZuLmdlblZLZXlWYWx1ZShtZS5pbnRlcm5hbERhdGFTb3VyY2UsIG1lLmtleUZpZWxkKTsKICAgICAgfSAvL07hur91IGzDoCBjb21ibyBk4bqhbmcgdHJlZQoKCiAgICAgIGlmIChtZS5jb21ib1R5cGUgPT0gMykgewogICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShtZS5pbnRlcm5hbERhdGFTb3VyY2UpKTsKICAgICAgICB2YXIgZGF0YVRyZWUgPSBjb21tb25Gbi5ub21hbGl6ZURhdGFUcmVlKGRhdGEsIG1lLmlkUHJvcGVydHkgfHwgbWUudmFsdWVGaWVsZCwgbWUucGFyZW50SWRQcm9wZXJ0eSk7CiAgICAgICAgdmFyIHRyZWVEYXRhID0gY29tbW9uRm4uZ2V0Qm9keURhdGEoZGF0YVRyZWUsIHRydWUpOwoKICAgICAgICBpZiAodHJlZURhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgbWUuX2FsbERhdGEgPSB0cmVlRGF0YTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlID0gW107CiAgICAgICAgICBtZS5fYWxsRGF0YSA9IG51bGw7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAobWUuX2FsbERhdGEpIHsKICAgICAgICBtZS5kb0xvY2FsUXVlcnkobWUubGFzdFF1ZXJ5U3RyaW5nKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBLaOG7n2kgdOG6oW8gY29tYm8NCiAgICAgKg0KICAgICAqIEBhdXRob3IgaG5naWFwIC0gMDEuMDkuMjAxOQ0KICAgICAqIDEgbMOgIGNvbWJvIGtow7RuZyBjw7MgY29sdW1ucyAoQ29tYm9FZGl0b3IpDQogICAgICogMiBsw6AgY29tYm8gY8OzIGNvbHVtbnMNCiAgICAgKiAzIGzDoCBjb21ibyB0cmVlDQogICAgICovCiAgICBpbml0Q29tYm86IGZ1bmN0aW9uIGluaXRDb21ibygpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5pc1RyZWUpIHsKICAgICAgICBtZS5jb21ib1R5cGUgPSAzOwogICAgICB9IGVsc2UgaWYgKG1lLmNvbHVtbnMgJiYgbWUuY29sdW1ucy5sZW5ndGggIT09IDApIHsKICAgICAgICBtZS5jb21ib1R5cGUgPSAyOwogICAgICB9IGVsc2UgewogICAgICAgIG1lLmNvbWJvVHlwZSA9IDE7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogY2xpY2sgdsOgbyBpY29uIGRyb3Bkb3duDQogICAgICovCiAgICB0cmlnZ2VyQ2xpY2s6IGZ1bmN0aW9uIHRyaWdnZXJDbGljayhlKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBleHBhbmRlZCA9IG1lLmV4cGFuZGVkOyAvL2Rpc2FibGUgdGjDrCBraMO0bmcgbMOgbSBnw6wKCiAgICAgIGlmIChtZS5kaXNhYmxlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKCFleHBhbmRlZCkgewogICAgICAgIC8vIGlmIChtZS5wYWdpbmF0aW9uKSB7CiAgICAgICAgbWUuZG9RdWVyeUludGVybmFsKG51bGwsIHRydWUpOyAvLyB9IGVsc2UgaWYgKG1lLmZpcnN0RXhwYW5kKSB7CiAgICAgICAgLy8gICBtZS5maXJzdEV4cGFuZCA9IGZhbHNlOwogICAgICAgIC8vICAgbWUuZG9RdWVyeUludGVybmFsKG51bGwsIHRydWUpOwogICAgICAgIC8vIH0KCiAgICAgICAgbWUuJGVtaXQoImJlZm9yZUV4cGFuZCIpOyAvLyB2dmtlaXQgLSAwNi4wNC4yMDIxOiA4OTgyMyAtIEzhu5dpIGNodW5nOiBM4buXaSB0csOqbiBmb3JtIMSRaeG7gXUgY2h1eeG7g24gaMOgbmcgbG/huqF0IGTGsOG7m2kgYuG6o25nIGNoaSB0aeG6v3Qga2hpIMSRw6MgY2jhu41uIHTDoGkgc+G6o24gdGjDrCDEkWFuZyBraMO0bmcgeOG7lSBjb21ibyDEkeG7gyBjaOG7jW4gdGnhur9wCiAgICAgICAgLy8gbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsKCiAgICAgICAgbWUuY2hhbmdlRHJvcGRvd25Qb3NpdGlvbigpOwogICAgICAgIG1lLmRvSGlnaHRsaWdodEl0ZW0oKTsKICAgICAgfSAvL8SR4bq3dCBuZXh0aWNrIMSR4buDIHRyw6FuaCBs4buXaSByZW5kZXIgZG9tIGPhu6dhIGNvbWJvYm94IHRyZWUga2hpIGNo4buNbiBpdGVtIHThu6sgZHJvcGRvd24KCgogICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIG1lLmV4cGFuZGVkID0gIWV4cGFuZGVkOwogICAgICB9KTsgLy9mb2N1cyBpbnB1dAoKICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogaGnhu4NuIHRo4buLIGRyb3Bkb3duDQogICAgICovCiAgICBleHBhbmQ6IGZ1bmN0aW9uIGV4cGFuZCgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuJGVtaXQoImJlZm9yZUV4cGFuZCIpOyAvLyB2dmtlaXQgLSAwNi4wNC4yMDIxOiA4OTgyMyAtIEzhu5dpIGNodW5nOiBM4buXaSB0csOqbiBmb3JtIMSRaeG7gXUgY2h1eeG7g24gaMOgbmcgbG/huqF0IGTGsOG7m2kgYuG6o25nIGNoaSB0aeG6v3Qga2hpIMSRw6MgY2jhu41uIHTDoGkgc+G6o24gdGjDrCDEkWFuZyBraMO0bmcgeOG7lSBjb21ibyDEkeG7gyBjaOG7jW4gdGnhur9wCiAgICAgIC8vIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CgogICAgICBtZS5jaGFuZ2VEcm9wZG93blBvc2l0aW9uKCk7CiAgICAgIG1lLmRvSGlnaHRsaWdodEl0ZW0oKTsgLy/EkeG6t3QgbmV4dGljayDEkeG7gyB0csOhbmggbOG7l2kgcmVuZGVyIGRvbSBj4bunYSBjb21ib2JveCB0cmVlIGtoaSBjaOG7jW4gaXRlbSB04burIGRyb3Bkb3duCgogICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIG1lLmV4cGFuZGVkID0gdHJ1ZTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIOG6qW4gZHJvcGRvd24NCiAgICAgKi8KICAgIGNvbGxhcHNlOiBmdW5jdGlvbiBjb2xsYXBzZSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBtZS5leHBhbmRlZCA9IGZhbHNlOwogICAgICB9KTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBzZXQgduG7iyB0csOtIGNobyBkcm9wZG93biBtZW51IGtoaSBleHBhbmQNCiAgICAgKiBUT0RPOiBDaMawYSB44butIGzDvSBraGkgY8OzIHNjcm9sbA0KICAgICAqLwogICAgY2hhbmdlRHJvcGRvd25Qb3NpdGlvbjogZnVuY3Rpb24gY2hhbmdlRHJvcGRvd25Qb3NpdGlvbigpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGNvbWJvRWwgPSBtZS4kZWw7CgogICAgICBpZiAoY29tYm9FbCkgewogICAgICAgIGNvbWJvRWwgPSBjb21ib0VsLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImNvbWJvLWJveC1pbnB1dCIpWzBdOwogICAgICB9CgogICAgICBpZiAoY29tYm9FbCkgewogICAgICAgIHZhciBjb21ib0VsUmVjdCA9IGNvbWJvRWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksCiAgICAgICAgICAgIGNvbWJvTWVudUVsID0gbWUuJGVsOwogICAgICAgIHZhciB3aW5kb3dXaWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoIHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoOwogICAgICAgIHZhciB3aW5kb3dIZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBkb2N1bWVudC5ib2R5LmNsaWVudEhlaWdodDsKICAgICAgICBtZS5kcm9wZG93bkxlZnR4ID0gY29tYm9FbFJlY3QubGVmdDsKICAgICAgICBtZS5kcm9wZG93blRvcHggPSBjb21ib0VsUmVjdC50b3AgKyBjb21ib0VsUmVjdC5oZWlnaHQgKyAyOwogICAgICAgIG1lLmRyb3Bkb3duTWF4V2lkdGh4ID0gbWUuZHJvcGRvd25NaW5XaWR0aHggPSBtZS5kcm9wZG93bldpZHRoID8gbWUuZHJvcGRvd25XaWR0aCA6IGNvbWJvRWxSZWN0LndpZHRoOyAvLyBO4bq/dSBjaOG6oW0gcGjhuqNpIHRow6wgYWxpZ24gc2FuZyB0csOhaQoKICAgICAgICBpZiAoY29tYm9FbFJlY3QubGVmdCArIGNvbWJvTWVudUVsLm9mZnNldFdpZHRoID4gd2luZG93V2lkdGgpIHsKICAgICAgICAgIG1lLmRyb3Bkb3duTGVmdHggPSBjb21ib0VsUmVjdC5yaWdodCAtIGNvbWJvTWVudUVsLm9mZnNldFdpZHRoOwogICAgICAgIH0gLy8gTuG6v3UgY2jhuqFtIGJvdHRvbSB0aMOsIGFsaWduIHRvcAoKCiAgICAgICAgdmFyIG1heEl0ZW1zRGlzcGxheSA9IG1lLm1heEl0ZW1zRGlzcGxheTsKCiAgICAgICAgaWYgKG1lLmNvbHVtbnMgJiYgbWUuY29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBtYXhJdGVtc0Rpc3BsYXkgKz0gMTsKICAgICAgICB9CgogICAgICAgIGlmIChjb21ib0VsUmVjdC5ib3R0b20gKyBtZS5pdGVtU2l6ZSAqIG1heEl0ZW1zRGlzcGxheSArIDIgPiB3aW5kb3dIZWlnaHQpIHsKICAgICAgICAgIG1lLmRyb3Bkb3duVG9weCA9IGNvbWJvRWxSZWN0LnRvcCAtIChtZS5pdGVtU2l6ZSAqIE1hdGgubWluKG1heEl0ZW1zRGlzcGxheSwgbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCkgKyA0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQ2xpY2sgdsOgbyBpY29uIHF1aWNrc2VhcmNoDQogICAgICovCiAgICBxdWlja1NlYXJjaENsaWNrOiBmdW5jdGlvbiBxdWlja1NlYXJjaENsaWNrKGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgaWYgKG1lLnF1aWNrU2VhcmNoKSB7CiAgICAgICAgaWYgKG1lLmRpc2FibGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtZS5leHBhbmRlZCA9IGZhbHNlOwoKICAgICAgICB2YXIgcGFyYW0gPSBfb2JqZWN0U3ByZWFkKHt9LCBtZS5xdWlja1NlYXJjaFBhcmFtIHx8IHt9KTsKCiAgICAgICAgcG9wdXBVdGlsLnNob3cobWUsIG1lLnF1aWNrU2VhcmNoLCBwYXJhbSwgewogICAgICAgICAgLyoqDQogICAgICAgICAgICogU+G7sSBraeG7h24gY2FsbGJhY2sga2hpIGNo4buNbiBpdGVtIHThu6sgZm9ybSB0w6xtIG5oYW5oDQogICAgICAgICAgICovCiAgICAgICAgICBzZWFyY2hTdWJtaXQ6IGZ1bmN0aW9uIHNlYXJjaFN1Ym1pdChyZWNvcmQpIHsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVjb3JkKSkgewogICAgICAgICAgICAgIC8vIGNo4buNbiB04burIGZvcm0gY2jhu41uIG5oYW5oIHh14buRbmcgY29tYm8gZG8gcnVsZSBj4bunYSBk4buxIMOhbiBsw6AgxJFrIGzhu41jIHRyw6puIGZvcm0gY2jhu41uIG5oYW5oIHbDoCBjb21ibyBuaMawIG5oYXUgbsOqbiBjw7MgdGjhu4MgYuG7jyBxdWEgdmFsaWRhdGUgayBjw7MgdHJvbmcgZG5haCBt4bulYwogICAgICAgICAgICAgIC8vdsOgIGLhu48gcXVhIHZhbGlkYXRlIGsgY8OzIHRyb25nIGRhbmggbeG7pWMgYuG6sW5nIGPDoWNoIGtp4buDbSB0cmEgc291cmNlIGTGsOG7m2kgY29tYm8gY8OzIGl0ZW0gZGMgY2jhu41uIHThu6sgZm9ybSBjaOG7jW4gbmhhbmggaywgbuG6v3UgayBjw7MgdGjDrCBhZGQgdsOgbwogICAgICAgICAgICAgIHZhciBjaGVjayA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5maWx0ZXIoZnVuY3Rpb24gKGkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpW21lLnZhbHVlRmllbGRdID09IHJlY29yZFswXVttZS52YWx1ZUZpZWxkXTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKCFjaGVjayB8fCBjaGVjay5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlLnB1c2gocmVjb3JkWzBdKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShyZWNvcmRbMF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8vIGNo4buNbiB04burIGZvcm0gY2jhu41uIG5oYW5oIHh14buRbmcgY29tYm8gZG8gcnVsZSBj4bunYSBk4buxIMOhbiBsw6AgxJFrIGzhu41jIHRyw6puIGZvcm0gY2jhu41uIG5oYW5oIHbDoCBjb21ibyBuaMawIG5oYXUgbsOqbiBjw7MgdGjhu4MgYuG7jyBxdWEgdmFsaWRhdGUgayBjw7MgdHJvbmcgZG5haCBt4bulYwogICAgICAgICAgICAgIC8vdsOgIGLhu48gcXVhIHZhbGlkYXRlIGsgY8OzIHRyb25nIGRhbmggbeG7pWMgYuG6sW5nIGPDoWNoIGtp4buDbSB0cmEgc291cmNlIGTGsOG7m2kgY29tYm8gY8OzIGl0ZW0gZGMgY2jhu41uIHThu6sgZm9ybSBjaOG7jW4gbmhhbmggaywgbuG6v3UgayBjw7MgdGjDrCBhZGQgdsOgbwogICAgICAgICAgICAgIHZhciBfY2hlY2sgPSBtZS5pbnRlcm5hbERhdGFTb3VyY2UuZmlsdGVyKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaVttZS52YWx1ZUZpZWxkXSA9PSByZWNvcmRbbWUudmFsdWVGaWVsZF07CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmICghX2NoZWNrIHx8IF9jaGVjay5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlLnB1c2gocmVjb3JkKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG1lLnNldEludGVybmFsSXRlbShyZWNvcmQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIG1lLnZhbGlkYXRlKG1lKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CiAgICAgICAgICB9LAogICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uIGNsb3NlKCkgewogICAgICAgICAgICBtZS4kcmVmcy5pbnB1dC5mb2N1cygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFZhbGlkYXRlIGtoaSBibHVyDQogICAgICogbnRuZ2hpYSAtIDExLzAzLzIwMjENCiAgICAgKiBibmR1YyAyMS42LjIwMjE6IMSQ4buVaSBs4bqhaSB0aMOgbmggZ+G7jWkgaMOgbSB2YWxpZGF0ZSBj4bunYSBjb250cm9sIHRoYXkgdsOsIHZp4bq/dCBzY3VzdG9tIG5oxrAgbsOgeQ0KICAgICAqLwogICAgdmFsaWRhdGVCbHVyOiBmdW5jdGlvbiB2YWxpZGF0ZUJsdXIoKSB7CiAgICAgIHRoaXMudmFsaWRhdGUodGhpcyk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHNjcm9sbCB4deG7kW5nIGN14buRaSBkcm93bmRvd24gLT4gbG9hZCB0aMOqbSBk4buvIGxp4buHdQ0KICAgICAqLwogICAgZHJvcGRvd25TY3JvbGxFbmQ6IGZ1bmN0aW9uIGRyb3Bkb3duU2Nyb2xsRW5kKCkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvLyBpZiAobWUucGFnaW5hdGlvbikgewoKICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PT0gInJlbW90ZSIgJiYgIW1lLl9hbGxEYXRhKSB7CiAgICAgICAgbWUuc2Nyb2xsRG9pbmcgPSB0cnVlOyAvL3JlbW90ZQoKICAgICAgICBpZiAobWUubGFzdFJlcXVlc3RQYXJhbSAmJiAhbWUubGFzdFJlcXVlc3RQYXJhbS5lbmQpIHsKICAgICAgICAgIC8vVE9ETyBibmR1YyAyMS42LjIwMjE6IGdoaSBuaOG6rW4gdMOtbmggaHXhu5FuZyBn4buNaSB2w6BvIMSRw6J5IDIgbOG6p24gdHLDqm4gbcOheSBxYyAtPiB0aMOqbSBraeG7g20gdHJhIG7DoHkgxJHhu4MgayBs4buXaQogICAgICAgICAgaWYgKG1lLmxhc3RSZXF1ZXN0UGFyYW0uc2tpcCAmJiBtZS5sYXN0UmVxdWVzdFBhcmFtLnNraXAgPT09IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwYXlsb2FkID0gbWUubGFzdFJlcXVlc3RQYXJhbTsKICAgICAgICAgIHBheWxvYWQuc2tpcCA9IG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGg7CiAgICAgICAgICBwYXlsb2FkLnBhZ2VBcHBlbmQgPSB0cnVlOwogICAgICAgICAgbWUuJGVtaXQoImxvYWREYXRhIiwgcGF5bG9hZCk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vbG9jYWwKICAgICAgICB2YXIgZGF0YSA9IG1lLl9maWx0ZXJEYXRhIHx8IG1lLl9hbGxEYXRhOwoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgbWUuaW50ZXJuYWxEYXRhU291cmNlID0gbWUuaW50ZXJuYWxEYXRhU291cmNlIHx8IFtdOwogICAgICAgICAgdmFyIHN0YXJ0ID0gbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aDsKICAgICAgICAgIHZhciBjb3VudCA9IE1hdGgubWluKGRhdGEubGVuZ3RoLCBtZS5wYWdlU2l6ZSArIHN0YXJ0KTsKCiAgICAgICAgICBmb3IgKHZhciBpID0gc3RhcnQ7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5wdXNoKGRhdGFbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyB9CgogICAgfSwKCiAgICAvKioNCiAgICAgKiB44butIGzDvSBwaMOtbSBlc2MNCiAgICAgKi8KICAgIG9uRXNjOiBmdW5jdGlvbiBvbkVzYyhlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7IC8v4bqpbiBkcm9wZG93biB2w6Agc3RvcCBldmVudCBu4bq/dSDEkWFuZyBleHBhbmQKCiAgICAgIGlmIChtZS5leHBhbmRlZCkgewogICAgICAgIG1lLmNvbGxhcHNlKCk7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGUuY2FuY2VsID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiB44butIGzDvSBwaMOtbSBlbnRlcg0KICAgICAqLwogICAgb25FbnRlcjogZnVuY3Rpb24gb25FbnRlcihlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuZXhwYW5kZWQgJiYgIW1lLmxvYWRpbmcgJiYgbWUuaW50ZXJuYWxEYXRhU291cmNlLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgIG1lLnNob3dRdWlja0FkZCh0cnVlKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBN4bufIGZvcm0gdGjDqm0gbmhhbmgNCiAgICAgKi8KICAgIHNob3dRdWlja0FkZDogZnVuY3Rpb24gc2hvd1F1aWNrQWRkKGlzZnJvbUVudGVyLCBpc2Zyb21TaG9ydEtleSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmV4cGFuZGVkICYmICFtZS5sb2FkaW5nICYmIG1lLmludGVybmFsRGF0YVNvdXJjZS5sZW5ndGggPT09IDAgfHwgaXNmcm9tU2hvcnRLZXkpIHsKICAgICAgICBpZiAoIW1lLnF1aWNrQWRkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIW1lLmlzUGVybWlzc2lvbikgewogICAgICAgICAgaWYgKCFpc2Zyb21FbnRlcikgewogICAgICAgICAgICBtZS5jb2xsYXBzZSgpOwogICAgICAgICAgfQoKICAgICAgICAgIG1lc3NhZ2VCb3guc2hvd0Vycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuTm90UGVybWlzc2lvbiIpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG1lLmV4cGFuZGVkID0gZmFsc2U7CgogICAgICAgIHZhciBwYXJhbSA9IF9vYmplY3RTcHJlYWQoe30sIG1lLnF1aWNrU2VhcmNoUGFyYW0gfHwge30pOwoKICAgICAgICBpZiAobWUuaW50ZXJuYWxUZXh0KSB7CiAgICAgICAgICBwYXJhbS5xdWlja0FkZFRleHQgPSBtZS5pbnRlcm5hbFRleHQ7CiAgICAgICAgfQoKICAgICAgICBwb3B1cFV0aWwuc2hvdyhtZSwgbWUucXVpY2tBZGQsIHBhcmFtLCB7CiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBT4buxIGtp4buHbiBjYWxsYmFjayBraGkgc3VibWl0IHThu6sgZm9ybSB0aMOqbSBuaGFuaA0KICAgICAgICAgICAqLwogICAgICAgICAgc3VibWl0OiBmdW5jdGlvbiBzdWJtaXQocmVzdWx0LCBwYXJhbSwgYWN0aW9uKSB7CiAgICAgICAgICAgIC8vdG9kbwogICAgICAgICAgICB2YXIgcmVjb3JkID0gcmVzdWx0LkRhdGE7CgogICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgaWYgKG1lLnF1ZXJ5TW9kZSA9PT0gInJlbW90ZSIpIHsKICAgICAgICAgICAgICAgIC8vbG9hZCBs4bqhaSByYSDEkeG7gyBwdXNoIHRow6ptIGljb24gdsOgbyAoYnVnIDExNTg4NSApCiAgICAgICAgICAgICAgICBtZS5kb1F1ZXJ5SW50ZXJuYWwobnVsbCwgZmFsc2UpOyAvL2FwcGVuZCBkYXRhIHRvIHNvdXJjZQoKICAgICAgICAgICAgICAgIG1lLmludGVybmFsRGF0YVNvdXJjZS5wdXNoKHJlY29yZCk7IC8vbnRwaG9uZyAyOS81LzIwMjEgLSB0aMOqbSBi4bqjbiBnaGkgbeG7m2kgdsOgbyBzb3VyY2UobuG6v3UgbMOgIGtp4buDdSB0cmVlIHRow6wgdGjDqm0gxJHDum5nIHbhu4sgdHLDrSBjaGEgY29uKQogICAgICAgICAgICAgICAgLy9ubmxhbSAwNy8wNy8yMDIxOiBhIHBob25nIGEgayBjaGVjayB4ZW0gY29tYm8gY8OzIGzDoCBk4bqhbmcgdHJlZSBoYXkgayBtw6AgYSDEkcOjIGzDoG0gdGjhur8gbsOgeSByIMOgCgogICAgICAgICAgICAgICAgaWYgKG1lLmlzVHJlZSkgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmICghbWUuX2FsbERhdGEpIHsKICAgICAgICAgICAgICAgICAgICAgIG1lLl9hbGxEYXRhID0gW107CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB2YXIgaXNFeGlzdEl0ZW0gPSBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SXRlbSwKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUluZGV4ID0gbWUuX2FsbERhdGEubGVuZ3RoOwoKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1lLl9hbGxEYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG1lLl9hbGxEYXRhW2ldOwoKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpdGVtW21lLnZhbHVlRmllbGRdID09IHJlY29yZFttZS52YWx1ZUZpZWxkXSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIGlzRXhpc3RJdGVtID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlY29yZFttZS5wYXJlbnRJZFByb3BlcnR5XSAmJiBpdGVtW21lLnZhbHVlRmllbGRdID09IHJlY29yZFttZS5wYXJlbnRJZFByb3BlcnR5XSkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEl0ZW0gPSBpdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JbmRleCA9IGkgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAoIWlzRXhpc3RJdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVjb3JkW21lLnBhcmVudElkUHJvcGVydHldICYmIHBhcmVudEl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50SXRlbS5Jc1BhcmVudCA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWUuaXNUcmVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcmVudEl0ZW0ubGV2ZWwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlY29yZC5sZXZlbCA9IHBhcmVudEl0ZW0ubGV2ZWwgKyAxOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3JkLnBhcmVudE5vZGUgPSBwYXJlbnRJdGVtOwogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudEl0ZW0uY2hpbGROb2RlcyA9IFtyZWNvcmRdOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgbWUuX2FsbERhdGEuc3BsaWNlKGl0ZW1JbmRleCwgMCwgcmVjb3JkKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIG1lLl9hbGxEYXRhLnB1c2gocmVjb3JkKTsKICAgICAgICAgICAgICAgIG1lLmRvTG9jYWxRdWVyeShudWxsKTsKICAgICAgICAgICAgICB9IC8vdXBkYXRlIHZhbHVlIGFuZCBkaXNwbGF5CgoKICAgICAgICAgICAgICBtZS5pbnRlcm5hbFNlbGVjdGVkSXRlbSA9IG51bGw7CiAgICAgICAgICAgICAgbWUuc2V0SW50ZXJuYWxJdGVtKHJlY29yZCk7CiAgICAgICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIG1lLnZhbGlkYXRlKG1lKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWUuJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgIH0sCiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7CiAgICAgICAgICAgIG1lLiRyZWZzLmlucHV0LmZvY3VzKCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRlDQogICAgICovCiAgICBjdXN0b21SdWxlVmFsaWRhdGVSdWxlczogZnVuY3Rpb24gY3VzdG9tUnVsZVZhbGlkYXRlUnVsZXMocnVsZXMpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuc3VwZXIoImN1c3RvbVJ1bGVWYWxpZGF0ZVJ1bGVzIiwgcnVsZXMpOwoKICAgICAgaWYgKG1lLmZvcmNlU2VsZWN0aW9uICYmIHJ1bGVzLmluZGV4T2YoImZvcmNlU2VsZWN0aW9uIikpIHsKICAgICAgICBydWxlcy5wdXNoKCJmb3JjZVNlbGVjdGlvbiIpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGtoaSBjbGljayBuw7p0IHF1aWNrYWRkIG5nb8OgaSBjb21ibw0KICAgICAqIE5NVFVBTjIgMDMuMTEuMjAyMQ0KICAgICAqLwogICAgY29tYm9RdWlja0FkZDogZnVuY3Rpb24gY29tYm9RdWlja0FkZChldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS4kZW1pdCgiY29tYm9RdWlja0FkZCIpOwogICAgfQogIH0KfTs="},null]}
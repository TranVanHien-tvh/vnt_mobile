{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT_vue\\src\\views\\base\\BaseListPopup.js","dependencies":[{"path":"D:\\VNT_vue\\src\\views\\base\\BaseListPopup.js","mtime":1661569498026},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgQmFzZUxpc3QgZnJvbSAiQC92aWV3cy9iYXNlL0Jhc2VMaXN0IjsKaW1wb3J0IHsgcGVybWlzc2lvbiB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9wZXJtaXNzaW9uIjsKaW1wb3J0IHsgbWFwU3RhdGUsIG1hcEFjdGlvbnMsIG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IHsgTW9kdWxlTGF5b3V0VGVtcGxhdGUsIE1vZHVsZUNvbnRleHQsIE1vZHVsZU9yZ2FuaXphdGlvbiB9IGZyb20gIkAvc3RvcmVzL21vZHVsZS1jb25zdCI7IC8vIGltcG9ydCBleHBvcnRBcGkgZnJvbSAiQC9hcGlzL2V4cG9ydEFQSSI7CgppbXBvcnQgTVNKc29uIGZyb20gIkAvY29tbW9ucy9qc29uIjsKaW1wb3J0IHsgc2hvcnRrZXlTdGF0dXNiYXIgfSBmcm9tICJAL21peGlucy9jb21tb24vc2hvcnRrZXlTdGF0dXNiYXIiOwppbXBvcnQgcG9wdXBVdGlsIGZyb20gIkAvY29tbW9ucy9wb3B1cFV0aWwiOwppbXBvcnQgY29tbW9uRm4gZnJvbSAiQC9jb21tb25zL2NvbW1vbkZ1bmN0aW9uIjsKZXhwb3J0IGRlZmF1bHQgewogIGV4dGVuZHM6IEJhc2VMaXN0LAogIG5hbWU6ICJCYXNlTGlzdFBvcHVwIiwKICBtaXhpbnM6IFtwZXJtaXNzaW9uLCBzaG9ydGtleVN0YXR1c2Jhcl0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIC8qKg0KICAgICAgICogQWN0aW9uIGPhu6dhIHThu6tuZyBi4bqjbiBnaGkga2hpIGFjdGl2ZQ0KICAgICAgICovCiAgICAgIHJvd0FjdGlvbnM6IFtdLAoKICAgICAgLyoqDQogICAgICAgKiBUw6puIGtleSBt4bqrdQ0KICAgICAgICovCiAgICAgIGxheW91dFRhZzogbnVsbCwKCiAgICAgIC8qKg0KICAgICAgICogQ8OhYyBhY3Rpb24ga2hpIGNo4buNbiBuaGnhu4F1DQogICAgICAgKi8KICAgICAgYWN0aW9uTXVsdGk6IFtdLAoKICAgICAgLyoqDQogICAgICAgKiByZWZuYW1lIGNvbnRyb2wgaGnhu4NuIHRo4buLIGFjdGlvbiBraGkgY2jhu41uIG5oaeG7gXUgYuG6o24gZ2hpDQogICAgICAgKi8KICAgICAgYWN0aW9uTXV0aWxSZWY6ICJhY3Rpb25NdWx0aSIsCgogICAgICAvKioNCiAgICAgICAqIHJlZm5hbWUgY29udHJvbCBoaeG7g24gdGjhu4sgYWN0aW9uIGtoaSBjaOG7jW4gbmhp4buBdSBi4bqjbiBnaGkgKCBtw6BuIGjDrG5oIHRvIGjGoW4gMTIwMCkNCiAgICAgICAqLwogICAgICBhY3Rpb25NdXRpbFJlZkJpZ1NjcmVlbjogImFjdGlvbk11bHRpQmlnU2NyZWVuIiwKICAgICAgbGF5b3V0OiB7fSwKICAgICAgdGl0bGU6ICIiLAoKICAgICAgLyoqDQogICAgICAgKiBjw7Mgc2hvdyB04bqldCBj4bqjIGljb24gZmlsdGVyIGhlYWRlciBncmlkIGzDqm4gaw0KICAgICAgICovCiAgICAgIHNob3dBbGxJY29uRmlsdGVyOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogU2hvdyBmaWx0ZXIgYm94DQogICAgICAgKi8KICAgICAgaXNTaG93RmlsdGVyOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogU2hvdyBtb3JlIGFjdGlvbiBib3gNCiAgICAgICAqLwogICAgICBpc1Nob3dBY3Rpb25Hcm91cDogZmFsc2UKICAgIH07CiAgfSwKICBjb21wdXRlZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEdldHRlcnMoTW9kdWxlQ29udGV4dCwgWyJDb250ZXh0Il0pKSwgbWFwR2V0dGVycyh7CiAgICBvcmdzOiBNb2R1bGVPcmdhbml6YXRpb24gKyAiL3RyZWUiCiAgfSkpLCB7fSwgewogICAgLyoqDQogICAgICogxJDhu5FpIHTGsOG7o25nIHN0YXRlIGPhu6dhIHN0b3JlDQogICAgICovCiAgICBzdG9yZVN0YXRlOiBmdW5jdGlvbiBzdG9yZVN0YXRlKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGVbdGhpcy5tb2R1bGVdOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBLaMO0bmcgY8OzIGThu68gbGnhu4d1IHRyb25nIGLhuqNuZw0KICAgICAqIETDuW5nIGPhu50gbsOgeSDEkeG7gyBoaeG7g24gdGjhu4sgbeG6t2MgaMOsbmggdHLhu5FuZyB0csOqbiBkYW5oIHPDoWNoDQogICAgICovCiAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0b3JlU3RhdGUuZW1wdHk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEThu68gbGnhu4d1IGhp4buDbiB0aOG7iw0KICAgICAqLwogICAgaXRlbXM6IGZ1bmN0aW9uIGl0ZW1zKCkgewogICAgICByZXR1cm4gdGhpcy5zdG9yZVN0YXRlLml0ZW1zOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBU4buVbmcgc+G7kQ0KICAgICAqLwogICAgdG90YWw6IGZ1bmN0aW9uIHRvdGFsKCkgewogICAgICByZXR1cm4gdGhpcy5zdG9yZVN0YXRlLnRvdGFsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBTdW1tYXJ5IGPhu6dhIGdyaWQNCiAgICAgKi8KICAgIHN1bW1hcnk6IGZ1bmN0aW9uIHN1bW1hcnkoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0b3JlU3RhdGUuc3VtbWFyeTsKICAgIH0sCgogICAgLyoqDQogICAgICogbG9hZGluZw0KICAgICAqLwogICAgbG9hZGluZzogZnVuY3Rpb24gbG9hZGluZygpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RvcmVTdGF0ZS5sb2FkaW5nOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBsb2FkaW5nIHN1bW1hcnkNCiAgICAgKi8KICAgIGxvYWRpbmdTdW1tYXJ5OiBmdW5jdGlvbiBsb2FkaW5nU3VtbWFyeSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RvcmVTdGF0ZS5sb2FkaW5nU3VtbWFyeTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ+G7mXQgdGhlbyBj4bqldSBow6xuaCBj4bunYSBt4bqrdQ0KICAgICAqLwogICAgbGF5b3V0Q29sdW1uczogZnVuY3Rpb24gbGF5b3V0Q29sdW1ucygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlW01vZHVsZUxheW91dFRlbXBsYXRlXS5hcHBseTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ29udHJvbCBoaeG7g24gdGjhu4sgYWN0aW9uIGtoaSBjaOG7jW4gbmhp4buBdSBi4bqjbiBnaGkNCiAgICAgKi8KICAgIGFjdGlvbk11bHRpQ29tcG9uZW50OiBmdW5jdGlvbiBhY3Rpb25NdWx0aUNvbXBvbmVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJlZnNbdGhpcy5hY3Rpb25NdXRpbFJlZl07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENvbnRyb2wgaGnhu4NuIHRo4buLIGFjdGlvbiBraGkgY2jhu41uIG5oaeG7gXUgYuG6o24gZ2hpIChtw6BuIGjDrG5oIGzhu5tuKQ0KICAgICAqLwogICAgYWN0aW9uTXVsdGlCaWdTY3JlZW5Db21wb25lbnQ6IGZ1bmN0aW9uIGFjdGlvbk11bHRpQmlnU2NyZWVuQ29tcG9uZW50KCkgewogICAgICByZXR1cm4gdGhpcy4kcmVmc1t0aGlzLmFjdGlvbk11dGlsUmVmQmlnU2NyZWVuXTsKICAgIH0KICB9KSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICB3aW5kb3cuX3h4ID0gdGhpczsgLy9pbml0IGxheW91dAoKICAgIG1lLmluaXRMYXlvdXQoKTsgLy9pbml0IGV2ZW50CgogICAgbWUuaW5pdEV2ZW50KCk7CiAgfSwKICBtZXRob2RzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEFjdGlvbnMoewogICAgbG9hZEFwcGx5TGF5b3V0OiBNb2R1bGVMYXlvdXRUZW1wbGF0ZSArICIvbG9hZEFwcGx5IgogIH0pKSwge30sIHsKICAgIC8qKg0KICAgICAqIEzhuqV5IGPhuqV1IGjDrG5oIGPhu5l0IHRoZW8gbeG6q3Ugw6FwIGThu6VuZw0KICAgICAqLwogICAgZ2V0TGF5b3V0VGVtcGxhdGU6IGZ1bmN0aW9uIGdldExheW91dFRlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgbWUsIGNhY2hlTGF5b3V0VGVtcGxhdGU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmdldENhY2hlTGF5b3V0VGVtcGxhdGUoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgY2FjaGVMYXlvdXRUZW1wbGF0ZSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFjYWNoZUxheW91dFRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjYWNoZUxheW91dFRlbXBsYXRlKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX3RoaXMubGF5b3V0Q29sdW1uc1tfdGhpcy5sYXlvdXRUYWddKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBj4bqldSBow6xuaCBt4bqrdSBj4bunYSBmb3JtDQogICAgICovCiAgICBpbml0TGF5b3V0OiBmdW5jdGlvbiBpbml0TGF5b3V0KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBtZSwgbGF5b3V0LCBjb2x1bW5zOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzMjsKCiAgICAgICAgICAgICAgICBpZiAoIW1lLmxheW91dFRhZykgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuZ2V0TGF5b3V0VGVtcGxhdGUoKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgbGF5b3V0ID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoIWxheW91dCB8fCBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gImRldmVsb3BtZW50IikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDg7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUubG9hZEFwcGx5TGF5b3V0KG1lLmxheW91dFRhZyk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGxheW91dCA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBtZS5sYXlvdXQgPSBtZS5jb252ZXJ0VG9MYXlvdXRUZW1wbGV0ZShsYXlvdXQpOwogICAgICAgICAgICAgICAgY29sdW1ucyA9IG1lLmdldExheW91dENvbHVtbihsYXlvdXQpOwogICAgICAgICAgICAgICAgbWUuZ3JpZC5pbml0Q29sdW1ucyhjb2x1bW5zKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIC8vbG9hZCBk4buvIGxp4buHdSBs4bqnbiDEkeG6p3UKICAgICAgICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIG1lLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBjb252ZXJ0VG9MYXlvdXRUZW1wbGV0ZTogZnVuY3Rpb24gY29udmVydFRvTGF5b3V0VGVtcGxldGUobGF5b3V0KSB7CiAgICAgIHZhciBsYXlvdXRUZW1wbGV0ZSA9IHt9OwoKICAgICAgaWYgKGxheW91dCkgewogICAgICAgIGxheW91dFRlbXBsZXRlLkxheW91dFRlbXBsYXRlSUQgPSBsYXlvdXQuTGF5b3V0VGVtcGxhdGVJRDsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5MYXlvdXRUYWcgPSBsYXlvdXQuTGF5b3V0VGFnOwogICAgICAgIGxheW91dFRlbXBsZXRlLlVzZXJJRCA9IGxheW91dC5Vc2VySUQgfHwgdGhpcy5Db250ZXh0LlVzZXJJRDsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5Jc1N5c3RlbSA9IGxheW91dC5Jc1N5c3RlbTsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5MYXlvdXRDb25maWcgPSBsYXlvdXQuQ29sdW1uczsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5MYXlvdXRUZW1wbGF0ZU5hbWUgPSBsYXlvdXQuTGF5b3V0VGVtcGxhdGVOYW1lOwogICAgICB9CgogICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgbGF5b3V0VGVtcGxldGUpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0aMO0bmcgdGluIGNvbHVtbiByZW5kZXIgdOG7qyB0aMO0bmcgdGluIGPhu6dhIG3huqt1DQogICAgICovCiAgICBnZXRMYXlvdXRDb2x1bW46IGZ1bmN0aW9uIGdldExheW91dENvbHVtbihsYXlvdXQpIHsKICAgICAgaWYgKGxheW91dCAhPSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIHZhciBjb2x1bW5zID0gSlNPTi5wYXJzZShsYXlvdXQuQ29sdW1ucyk7IC8vbuG6v3UgbMOgIG3huqt1IG3hurdjIMSR4buLbmggdsOgIG5nw7RuIG5n4buvIGtow6FjIHRp4bq/bmcgdmnhu4d0IC0+IGPhuq1wIG5o4bqtdCBjYXB0aW9uL3RpdGxlIHRoZW8gbmfDtG4gbmfhu68KCiAgICAgICAgaWYgKGxheW91dC5Jc1N5c3RlbSkgewogICAgICAgICAgbWUubG9jYWxpemF0aW9uQ29sdW1uKGNvbHVtbnMpOwogICAgICAgIH0gLy9ubmxhbTogb3JkZXJieSBs4bqhaSB0aGVvIHNvcnRfb3JkZXIgdsOgIGxvY2suCgoKICAgICAgICBjb2x1bW5zID0gXyhjb2x1bW5zKS5jaGFpbigpLnNvcnRCeSgic29ydF9vcmRlciIpLnNvcnRCeShmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgICByZXR1cm4gIWNvbHVtbi5sb2NrOwogICAgICAgIH0pLnZhbHVlKCk7CiAgICAgICAgcmV0dXJuIGNvbHVtbnM7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogR+G7jWkgcmVxdWVzdCBsb2FkIGThu68gbGnhu4d1DQogICAgICogR+G7jWkgdsOgbyBjcnVkLWJhc2UNCiAgICAgKi8KICAgIHJlcXVlc3RMb2FkRGF0YTogZnVuY3Rpb24gcmVxdWVzdExvYWREYXRhKHBheWxvYWQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5ncmlkICYmIG1lLmdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQobWUubW9kdWxlLCAiL2xvYWRMaXN0VHJlZSIpLCBwYXlsb2FkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KG1lLm1vZHVsZSwgIi9sb2FkIiksIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgLyoqDQogICAgICAgICAgICogZGVsYXkgxJHhu4MgxJHhu6NpIGdyaWQgc2VsZWN0IGTDsm5nIMSR4bqndQ0KICAgICAgICAgICAqIE5NVFVBTjIgMDQuMTIuMjAyMQ0KICAgICAgICAgICAqLwogICAgICAgICAgaWYgKG1lLmlzU2VhcmNoaW5nKSB7CiAgICAgICAgICAgIG1lLmlzU2VhcmNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChtZS5zZWFyY2hCb3ggJiYgbWUuc2VhcmNoQm94LiRyZWZzLmlucHV0KSB7CiAgICAgICAgICAgICAgICBtZS5zZWFyY2hCb3guJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogR+G7jWkgcmVxdWVzdCBsb2FkIHN1bW1hcnkNCiAgICAgKi8KICAgIHJlcXVlc3RMb2FkRGF0YVN1bW1hcnk6IGZ1bmN0aW9uIHJlcXVlc3RMb2FkRGF0YVN1bW1hcnkocGF5bG9hZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmdyaWQgJiYgIW1lLmdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQobWUubW9kdWxlLCAiL2xvYWRTdW1tYXJ5IiksIHBheWxvYWQpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGRiY2xpY2sgYuG6o24gZ2hpIHRyw6puIGdyaWQNCiAgICAgKi8KICAgIGdyaWRSb3dEYkNsaWNrOiBmdW5jdGlvbiBncmlkUm93RGJDbGljayhyZWNvcmQsIGUpIHsKICAgICAgdGhpcy5lZGl0KHJlY29yZCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHPhu7Ega2nhu4duIOG6pW4gdsOgbyBjw6FjIGFjdGlvbiB0csOqbiBmb3JtDQogICAgICovCiAgICBidXR0b25DbGljazogZnVuY3Rpb24gYnV0dG9uQ2xpY2soY29tbWFuZCwgZSkge30sCgogICAgLyoqDQogICAgICogVGjDqm0NCiAgICAgKi8KICAgIGFkZDogZnVuY3Rpb24gYWRkKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFtZS5jaGVja0FjdGlvblBlcm1pc3Npb25BbGVydChtZS4kdCgiaTE4blBlcm1pc3Npb24uU3ViU3lzdGVtQ29kZS5Db2RlLkFERCIpKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhcmFtID0gbWUuZ2V0RGV0YWlsUGFyYW1ldGVyKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5BZGQpOwogICAgICBtZS5zaG93RGV0YWlsKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5BZGQsIHBhcmFtKTsKICAgIH0sCgogICAgLyoqDQogICAgICogU+G7rSBk4bulbmcgY2hvIHPhu7Ega2nhu4duIGRibGljayB2w6BvIGTDsm5nIHRyw6puIGdyaWQgxJHhu4Mgc2hvdyBmb3JtIHTGsMahbmcg4bupbmcNCiAgICAgKiAqLwogICAgZWRpdDogZnVuY3Rpb24gZWRpdChyZWNvcmQpIHsKICAgICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogIkVESVQiOwogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFtZS5jaGVja0FjdGlvblBlcm1pc3Npb25BbGVydChhY3Rpb24pKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGFyYW0gPSBtZS5nZXREZXRhaWxQYXJhbWV0ZXIobWUuZm9ybURldGFpbE5hbWUsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsIHJlY29yZCk7CiAgICAgIG1lLnNob3dEZXRhaWwobWUuZm9ybURldGFpbE5hbWUsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsIHBhcmFtLCB7CiAgICAgICAgc3VibWl0OiBmdW5jdGlvbiBzdWJtaXQoc2F2ZVJlc3VsdCwgc2F2ZVBhcmFtKSB7CiAgICAgICAgICBpZiAoc2F2ZVJlc3VsdC5TdWNjZXNzKSB7CiAgICAgICAgICAgIG1lLmFmdGVyU2F2ZUVkaXQocmVjb3JkLCBzYXZlUmVzdWx0LCBzYXZlUGFyYW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHB2ZHV5IDI3LzAyLzIwMjE6IHRow6ptIGThu68gbGnhu4d1IGNobyBtb2RlIHZpZXcNCiAgICAgKiAqLwogICAgdmlldzogZnVuY3Rpb24gdmlldyhyZWNvcmQpIHsKICAgICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogIldBVENIIjsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmICghbWUuY2hlY2tBY3Rpb25QZXJtaXNzaW9uQWxlcnQoYWN0aW9uKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhcmFtID0gbWUuZ2V0RGV0YWlsUGFyYW1ldGVyKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5WaWV3LCByZWNvcmQpOwogICAgICBtZS5zaG93RGV0YWlsKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5WaWV3LCBwYXJhbSwgewogICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gc3VibWl0KHNhdmVSZXN1bHQsIHNhdmVQYXJhbSkgewogICAgICAgICAgaWYgKHNhdmVSZXN1bHQuU3VjY2VzcykgewogICAgICAgICAgICBtZS5hZnRlclNhdmVWaWV3KHJlY29yZCwgc2F2ZVJlc3VsdCwgc2F2ZVBhcmFtKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBOaMOibiBi4bqjbiBi4bqjbiBnaGkNCiAgICAgKiAqLwogICAgZHVwbGljYXRlOiBmdW5jdGlvbiBkdXBsaWNhdGUocmVjb3JkKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoIW1lLmNoZWNrQWN0aW9uUGVybWlzc2lvbkFsZXJ0KG1lLiR0KCJpMThuUGVybWlzc2lvbi5TdWJTeXN0ZW1Db2RlLkNvZGUuQUREIikpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGFyYW0gPSBtZS5nZXREZXRhaWxQYXJhbWV0ZXIobWUuZm9ybURldGFpbE5hbWUsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkR1cGxpY2F0ZSwgcmVjb3JkKTsKICAgICAgbWUuc2hvd0RldGFpbChtZS5mb3JtRGV0YWlsTmFtZSwgdGhpcy4kbXMuZW51bS5Gb3JtU3RhdGUuRHVwbGljYXRlLCBwYXJhbSk7CiAgICB9LAogICAgcmVmcmVzaENsaWNrOiBmdW5jdGlvbiByZWZyZXNoQ2xpY2soKSB7CiAgICAgIHRoaXMucmVmcmVzaCgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBkcmlsbGRvd24ga2hpIGNsaWNrIHbDoG8gZ3JpZA0KICAgICAqICovCiAgICBkcmlsbGRvd25DbGljazogZnVuY3Rpb24gZHJpbGxkb3duQ2xpY2sobWV0YURhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZXRhRGF0YS5kYXRhUm93KSB7CiAgICAgICAgbWUuZWRpdChtZXRhRGF0YS5kYXRhUm93KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkVycm9yIikpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBhdXRob3IgVFZMT0kgMjAuMDUuMjAyMQ0KICAgICAqIGRyaWxsZG93biB2w6BvIGNoaSB0aeG6v3Qga2hpIOG6pW4gdsOgbyBjw6FjIGPhu5l0IGPDsyBk4bqhbmcgxJHhuqFpIGRp4buHbiBjaG8gc+G7kSBuaGnhu4F1KE5oaeG7gXUgZMOybmcgY2hpIHRp4bq/dCkNCiAgICAgKiAqLwogICAgdmlld01vcmVEZXRhaWxzOiBmdW5jdGlvbiB2aWV3TW9yZURldGFpbHMobWV0YURhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZXRhRGF0YS5kYXRhUm93KSB7CiAgICAgICAgbWUudmlldyhtZXRhRGF0YS5kYXRhUm93KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkVycm9yIikpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjDs2ENCiAgICAgKi8KICAgIGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShyZWNvcmQsIHN1YikgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBtZSwgY29uZmlnTWVzc2FnZSwgYW5zd2VyLCB0ZW1wLCBkcm9wZWRDb2x1bW5zLCBfbG9vcCwgaSwgYXVkaXRpbmdMb2csIHBhcmFtLCByZXN1bHQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzMzsKCiAgICAgICAgICAgICAgICBpZiAobWUuY2hlY2tBY3Rpb25QZXJtaXNzaW9uQWxlcnQoc3ViICE9PSBudWxsICYmIHN1YiAhPT0gdm9pZCAwID8gc3ViIDogbWUuJHQoImkxOG5QZXJtaXNzaW9uLlN1YlN5c3RlbUNvZGUuQ29kZS5ERUxFVEUiKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGlmIChtZS52YWxpZGF0ZUJlZm9yZURlbGV0ZShyZWNvcmQsIHN1YikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5nZXREZWxldGVDb25maXJtTWVzc2FnZShyZWNvcmQpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBjb25maWdNZXNzYWdlID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRtcy5tc2dCb3guc2hvd1F1ZXN0aW9uKGNvbmZpZ01lc3NhZ2UpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgYW5zd2VyID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoYW5zd2VyID09ICJZZXMiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wID0ge307IC8vQuG7jyBi4bubdCBjw6FjIHRow7RuZyB0aW4gZ+G7rWkgbMOqbiBzdi4KCiAgICAgICAgICAgICAgICBkcm9wZWRDb2x1bW5zID0gbWUuZ2V0SWdub3JlZENvbHVtbnMoKTsKCiAgICAgICAgICAgICAgICBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKGkpIHsKICAgICAgICAgICAgICAgICAgdmFyIGlzRHJvcGVkQ29sdW1uID0gZHJvcGVkQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChfKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8gPT0gaTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcGVkQ29sdW1uKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFtpXSA9IHJlY29yZFtpXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgaW4gcmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIF9sb29wKGkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGF1ZGl0aW5nTG9nID0gewogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTVNKc29uLnNlcmlhbGl6ZShtZS5nZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2cocmVjb3JkKSksCiAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UocmVjb3JkKSwKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBtZS5hY3Rpb25BdWRpdGluZ0xvZywKICAgICAgICAgICAgICAgICAgZW50aXR5OiBtZS5nZXRFbnRpdHlUeXBlKCkgfHwgbWUubW9kdWxlLAogICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogW3RlbXBdLAogICAgICAgICAgICAgICAgICBCeVBhc3NWYWxpZGF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgQXVkaXRpbmdMb2c6IE1TSnNvbi5zZXJpYWxpemUoYXVkaXRpbmdMb2cpLAogICAgICAgICAgICAgICAgICBUeXBlOiBtZS4kbXMuZW51bS5EZWxldGVUeXBlLlNpbmdsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHBhcmFtID0gbWUuY3VzdG9tRGVsZXRlUGFyYW0ocmVjb3JkLCBwYXJhbSk7CiAgICAgICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4ubWFzaygpOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5yZXF1ZXN0RGVsZXRlRGF0YShyZWNvcmQsIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLnVubWFzaygpOwogICAgICAgICAgICAgICAgbWUuYWZ0ZXJEZWxldGUocmVjb3JkLCByZXN1bHQpOyAvL0xvZyBmaXJlYmFzZQogICAgICAgICAgICAgICAgLy8gbWUubG9nRGF0YUZpcmVCYXNlKCk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGjDtG5nIHRpbiBsb2cgZmlyZWJhc2UNCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqLwogICAgbG9nRGF0YUZpcmVCYXNlOiBmdW5jdGlvbiBsb2dEYXRhRmlyZUJhc2UoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICB0cnkgewogICAgICAgIHZhciBtZW51TmFtZUN1cnJlbnQgPSBudWxsOwogICAgICAgIHZhciBwYXJlbnQgPSBtZS4kcGFyZW50OwoKICAgICAgICBpZiAobWUuJHJvdXRlciB8fCBtZS4kJHJvdXRlcikgewogICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gbWUuJHJvdXRlID8gbWUuJHJvdXRlLm5hbWUgOiBtZS4kJHJvdXRlLm5hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYXJlbnQgJiYgKHBhcmVudC4kcm91dGVyIHx8IHBhcmVudC4kJHJvdXRlcikpIHsKICAgICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gcGFyZW50LiRyb3V0ZXIgPyBwYXJlbnQuJHJvdXRlLm5hbWUgOiBwYXJlbnQuJCRyb3V0ZS5uYW1lOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1lbnVOYW1lQ3VycmVudCkgewogICAgICAgICAgY29tbW9uRm4ubG9nRGF0YUZpcmVCYXNlVXBkYXRlKG1lbnVOYW1lQ3VycmVudCwgbWUuY29udGV4dCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGNvbnNvbGUubG9nKGV4KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBH4buNaSByZXF1ZXN0IHjDs2ENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgcmVxdWVzdERlbGV0ZURhdGE6IGZ1bmN0aW9uIHJlcXVlc3REZWxldGVEYXRhKHJlY29yZCwgcGFyYW0pIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgbWU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM0OwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQoX3RoaXM0Lm1vZHVsZSwgIi9kZWxldGUiKSwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ0LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogb3ZlcnJpZGVhYmxlIMSR4buDIGNoZWNrIG3hu5l0IHbDoGkgY2FzZSB2YWxpZGF0ZSDEkcaw4bujYyBuZ2F5IHRyw6puIGNsaWVudA0KICAgICAqIEByZXR1cm5zDQogICAgICogVEROR0hJQSAyNy8xMC8yMDIxDQogICAgICovCiAgICB2YWxpZGF0ZUJlZm9yZURlbGV0ZTogZnVuY3Rpb24gdmFsaWRhdGVCZWZvcmVEZWxldGUocmVjb3JkcykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRhYmxlIFRy4bqjIHbhu4Egbmjhu69uZyB0csaw4budbmcga2jDtG5nIG114buRbiBn4butaSBsw6puIHNlcnZlIMSR4buDIHjDs2ENCiAgICAgKiBAYXV0aG9yIFRWTG9pIDE5LjA2LjIwMjENCiAgICAgKi8KICAgIGdldElnbm9yZWRDb2x1bW5zOiBmdW5jdGlvbiBnZXRJZ25vcmVkQ29sdW1ucygpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9kZWZhdWx0IDEgc+G7kSBj4buZdCBt4bq3YyDEkeG7i25oIGtow7RuZyBn4butaSBsw6puLgoKICAgICAgdmFyIGNvbHVtbnNJZ25vcmVkID0gWyJwYXJlbnROb2RlIiwgImlzSGlkZSIsICJpc1NlbGVjdGVkIiwgImxldmVsIiwgIl9fdktleVZhbHVlIiwgIl9pc1NlbGVjdGVkTXVsdGlwbGUiLCAiZXhwYW5kZWQiXTsKICAgICAgdmFyIGN1c3RvbUlnbm9yZWRDb2x1bW5zID0gbWUuZ2V0Q3VzdG9tSWdub3JlZENvbHVtbnNCZWZvcmVEZWxldGUoKTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KGN1c3RvbUlnbm9yZWRDb2x1bW5zKSAmJiBjdXN0b21JZ25vcmVkQ29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgY3VzdG9tSWdub3JlZENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgY29sdW1uc0lnbm9yZWQucHVzaChpdGVtKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbHVtbnNJZ25vcmVkOwogICAgfSwKICAgIC8vQ3VzdG9tQ29sdW1ucyBrbyBn4butaSBsw6puCiAgICBnZXRDdXN0b21JZ25vcmVkQ29sdW1uc0JlZm9yZURlbGV0ZTogZnVuY3Rpb24gZ2V0Q3VzdG9tSWdub3JlZENvbHVtbnNCZWZvcmVEZWxldGUoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCgogICAgLyoqDQogICAgICogdGhhbSBjaGnhur91IG5o4bqtdCBrw70gKGzGsHUgZOG6oW5nIGpzb24gOiB7a2V5OiBrZXksIGNvZGU6IGNvZGUsIG5hbWU6IG5hbWV9KQ0KICAgICAqIGtleToga2jDs2EgY2jDrW5oIGPhu6dhIGLhuqNuZyBtb2R1bGUsIGTDuW5nIMSR4buDIGRyaWxkb3duIGtoaSBjbGljayB2w6BvDQogICAgICogY29kZSwgbmFtZTogbcOjLCB0w6puIMSR4buDIGhp4buDdSB0aOG7iyDhu58gY+G7mXQgdGhhbSBjaGnhur91IGtoaSB4ZW0gbG9nOiB2w60gZOG7pTogUXXhuqF0IMSRaeG7h24gKFFEMDAwMDEpDQogICAgICovCiAgICBidWlsZFJlZmVyZW5jZTogZnVuY3Rpb24gYnVpbGRSZWZlcmVuY2UocmVjb3JkcykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZmllbGQgPSB0aGlzLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICBpZiAoZmllbGQpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZWNvcmRzKSkgewogICAgICAgICAgdmFyIHJlZmVyZW5jZSA9IFtdOwogICAgICAgICAgcmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgICAgICAgcmVmZXJlbmNlLnB1c2goewogICAgICAgICAgICAgIGtleTogcmVjb3JkW2ZpZWxkLmtleV0sCiAgICAgICAgICAgICAgY29kZTogcmVjb3JkW2ZpZWxkLmNvZGVdLAogICAgICAgICAgICAgIG5hbWU6IHJlY29yZFtmaWVsZC5uYW1lXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIE1TSnNvbi5zZXJpYWxpemUocmVmZXJlbmNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIE1TSnNvbi5zZXJpYWxpemUoewogICAgICAgICAgICBrZXk6IHJlY29yZHNbZmllbGQua2V5XSwKICAgICAgICAgICAgY29kZTogcmVjb3Jkc1tmaWVsZC5jb2RlXSwKICAgICAgICAgICAgbmFtZTogcmVjb3Jkc1tmaWVsZC5uYW1lXQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNpbmggbcO0IHThuqMgY+G7p2Egbmjhuq10IGvDvQ0KICAgICAqIENyZWF0ZWRCeTogbm5sYW0gMjQvMDMvMjAyMQ0KICAgICAqLwogICAgZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nOiBmdW5jdGlvbiBnZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2cocmVjb3JkcykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgbGlzdERlc2NyaXB0aW9uID0gewogICAgICAgIG1hc3RlcjogW10KICAgICAgfTsKICAgICAgdmFyIGZpZWxkID0gdGhpcy4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkOwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVjb3JkcykpIHsKICAgICAgICByZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCkgewogICAgICAgICAgdmFyIG9iakRlc2NyaXB0aW9uID0ge307CiAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5jb2RlXSA9IHJlY29yZFtmaWVsZC5jb2RlXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQuY29kZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLmNvZGVdfTsKCiAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5uYW1lXSA9IHJlY29yZFtmaWVsZC5uYW1lXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLm5hbWVdfTsKCiAgICAgICAgICBpZiAoZmllbGQucXVhbnRpdHkpIHsKICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25bZmllbGQucXVhbnRpdHldID0gcmVjb3JkW2ZpZWxkLnF1YW50aXR5XTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQucXVhbnRpdHldIHx8IDEsIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLnF1YW50aXR5XX07CiAgICAgICAgICB9CgogICAgICAgICAgbGlzdERlc2NyaXB0aW9uLm1hc3Rlci5wdXNoKG9iakRlc2NyaXB0aW9uKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgb2JqRGVzY3JpcHRpb24gPSB7fTsKICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5jb2RlXSA9IHJlY29yZHNbZmllbGQuY29kZV07IC8ve25ld1ZhbHVlOm1lLmN1cnJlbnRJdGVtW2ZpZWxkLmNvZGVdLCBzd2l0Y2hDYXB0aW9uOiBtZS5zd2l0Y2hDYXB0aW9uLm1hc3RlcltmaWVsZC5jb2RlXX07CgogICAgICAgIG9iakRlc2NyaXB0aW9uW2ZpZWxkLm5hbWVdID0gcmVjb3Jkc1tmaWVsZC5uYW1lXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLm5hbWVdfTsKCiAgICAgICAgaWYgKGZpZWxkLnF1YW50aXR5KSB7CiAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5xdWFudGl0eV0gPSByZWNvcmRzW2ZpZWxkLnF1YW50aXR5XTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQucXVhbnRpdHldIHx8IDEsIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLnF1YW50aXR5XX07CiAgICAgICAgfQoKICAgICAgICBsaXN0RGVzY3JpcHRpb24ubWFzdGVyLnB1c2gob2JqRGVzY3JpcHRpb24pOwogICAgICB9CgogICAgICByZXR1cm4gbGlzdERlc2NyaXB0aW9uOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBjw6J1IHRow7RuZyBiw6FvIGtoaSB4w7NhDQogICAgICovCiAgICBnZXREZWxldGVDb25maXJtTWVzc2FnZTogZnVuY3Rpb24gZ2V0RGVsZXRlQ29uZmlybU1lc3NhZ2UocmVjb3JkcykgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgIHZhciBtZSwgbW9kdWxlTmFtZSwgdGFyZ2V0TmFtZSwgbWVzLCBkZWxldGVNdWx0aU1zZywgcmVjb3JkLCBkZWxldGVNc2c7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM1OwogICAgICAgICAgICAgICAgbW9kdWxlTmFtZSA9IG1lLmdldE1vZHVsZU5hbWUoKSB8fCAiIjsKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSAiIjsKICAgICAgICAgICAgICAgIG1lcyA9ICIiOwoKICAgICAgICAgICAgICAgIGlmIChyZWNvcmRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlTXVsdGlNc2cgPSBtZS5nZXREZWxldGVNdWx0aU1zZygpOwogICAgICAgICAgICAgICAgICBtZXMgPSBkZWxldGVNdWx0aU1zZy5mb3JtYXQocmVjb3Jkcy5sZW5ndGggPiA5ID8gcmVjb3Jkcy5sZW5ndGggOiAiMCIgKyByZWNvcmRzLmxlbmd0aCwgbW9kdWxlTmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzOwoKICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVjb3JkcykpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzWzBdOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IG1lLmdldERlbGV0ZVNpbmdsZU1lc0NvbnRlbnQocmVjb3JkKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZGVsZXRlTXNnID0gbWUuZ2V0RGVsZXRlTXNnKHJlY29yZHMpOwogICAgICAgICAgICAgICAgICBtZXMgPSBkZWxldGVNc2cuZm9ybWF0KG1lLiRtcy5jb21tb25Gbi5lbmNvZGVIVE1MKHRhcmdldE5hbWUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICB0aXRsZTogbWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkNvbmZpcm1EZWxldGVUaXRsZSIpLmZvcm1hdChtb2R1bGVOYW1lKSwKICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSBjw6J1IG7hu5lpIGR1bmcgeMOzYSBuaGnhu4F1DQogICAgICogTlRCQU86IDI1LjExLjIwMjENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgZ2V0RGVsZXRlTXVsdGlNc2c6IGZ1bmN0aW9uIGdldERlbGV0ZU11bHRpTXNnKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkNvbmZpcm1EZWxldGVNdXRpVGl0bGVDZWdvdiIpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gY8OidSBu4buZaSBkdW5nIHjDs2EgxJHGoW4NCiAgICAgKiBOVEJBTzogMjUuMTEuMjAyMQ0KICAgICAqIEByZXR1cm5zDQogICAgICovCiAgICBnZXREZWxldGVNc2c6IGZ1bmN0aW9uIGdldERlbGV0ZU1zZyhyZWNvcmRzKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZVNob3J0Iik7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IG7hu5lpIGR1bmcgeMOzYQ0KICAgICAqLwogICAgZ2V0RGVsZXRlU2luZ2xlTWVzQ29udGVudDogZnVuY3Rpb24gZ2V0RGVsZXRlU2luZ2xlTWVzQ29udGVudChyZWNvcmQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIHJlY29yZFttZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLm5hbWVdIHx8IHJlY29yZFttZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLmNvZGVdOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0w6puIMSR4buRaSB0xrDhu6NuZyBj4bunYSBmb3JtDQogICAgICovCiAgICBnZXRNb2R1bGVOYW1lOiBmdW5jdGlvbiBnZXRNb2R1bGVOYW1lKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuJHQoImkxOG5Db21tb24ubW9kdWxlLiIgKyBtZS5tb2R1bGUudG9Mb3dlckNhc2UoKSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHNhdSBraGkgeMOzYQ0KICAgICAqLwogICAgYWZ0ZXJEZWxldGU6IGZ1bmN0aW9uIGFmdGVyRGVsZXRlKHJlY29yZCwgcmVzdWx0KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgdmFyIG1lLCBkZWxldGVSZWNvcmQsIF9tZSRnZXRGaWVsZHMsIENPREUsIG1vZHVsZU5hbWUsIGZpZWxkLCBsaXN0QXJpc2VuZCwgY29uZmlnTWVzc2FnZSwgYW5zd2VyLCBpc0FyaXNlTXVsdGksIG5hbWUsIG9iaiwgaW5hY3RpdmVBcmlzZSwgZGVsZXRlTm9BcmlzZSwgcmVjb3Jkc0luYWN0aXZlLCByZWNvcmRzRGVsZXRlLCBrZXlGaWVsZDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM2OwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LlN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBjbG9uZSBs4bqhaSBnacOhIHRy4buLIHjDs2EgZMO5bmcgY2hvIHZp4buHYyBjdXN0b20KICAgICAgICAgICAgICAgIC8vIE5UQkFPOiAwNy4xMS4yMDIxCiAgICAgICAgICAgICAgICBkZWxldGVSZWNvcmQgPSBfLmNsb25lKHJlY29yZCk7CiAgICAgICAgICAgICAgICBtZS4kdG9hc3Quc3VjY2VzcyhtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuRGVsZXRlU3VjY2VzcyIpKTsKICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIG7hur91IHhvw6EgYuG6o24gZ2hpIMSRxrDhu6NjIHTDrWNoIHRow6wgxJFhbmcga2jDtG5nIHThu7EgY+G6rXAgbmjhuq10IOG7nyBzZWxlY3RlZA0KICAgICAgICAgICAgICAgICAqIG7Dqm4gcGjhuqNpIHRo4buxYyBoaeG7h24geG/DoSBraOG7j2kgc2VsZWN0ZWQgKGNo4buJIHThu7EgxJHhu5luZyBraGkgeG/DoSB0csOqbiBkw7JuZyBj4bunYSBncmlkRWRpdG9yKQ0KICAgICAgICAgICAgICAgICAqIGLhuq10IGNoYW5nZSB2w6BvIGPDoWMgYuG6o24gZ2hpIGPDsm4gxJHGsOG7o2MgdMOtY2gNCiAgICAgICAgICAgICAgICAgKiBOTVRVQU4yIDI4LjExLjIwMjENCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBtZS5zZWxlY3RlZC5yZW1vdmUocmVjb3JkKTsKICAgICAgICAgICAgICAgIG1lLnNlbGVjdGlvbkNoYW5nZShtZS5zZWxlY3RlZCk7CiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBIw6BtIGN1c3RvbSB44butIGzDvSB0aMOqbQ0KICAgICAgICAgICAgICAgICAqIE5UQkFPIDAyLjExLjIwMjENCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBtZS5jdXN0b21BZnRlckRlbGV0ZShkZWxldGVSZWNvcmQsIHJlc3VsdCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDYxOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIFPhu61hIGzhu5dpIGtoaSB4w7NhIG5oaeG7gXUgYuG6o24gZ2hpDQogICAgICAgICAgICAgICAgICogTW9kaWZpeUJ5OiBOVEFuaCAoMDkvMDMvMjAyMSkNCiAgICAgICAgICAgICAgICAgKiBNb2RpZml5Qnk6IE5UVEhBTkgxICgyMC8xMS8yMDIxKQ0KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7CiAgICAgICAgICAgICAgICBtb2R1bGVOYW1lID0gbWUuZ2V0TW9kdWxlTmFtZSgpLCBmaWVsZCA9IChfbWUkZ2V0RmllbGRzID0gbWUuZ2V0RmllbGRzKCkpICE9PSBudWxsICYmIF9tZSRnZXRGaWVsZHMgIT09IHZvaWQgMCA/IF9tZSRnZXRGaWVsZHMgOiBfdGhpczYuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0uX2NvbmZpZy5maWVsZCwgbGlzdEFyaXNlbmQgPSBbXTsgLy9CaeG6v24gxJHDoW5oIGThuqV1IG5oaeG7gXUgYuG6o24gZ2hpIHBow6F0IHNpbmgKICAgICAgICAgICAgICAgIC8vIE5oaeG7gXUgYuG6o24gxJHDoyBjw7MgcGjDoXQgc2luaAoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuRGF0YSAmJiByZXN1bHQuRGF0YS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgIGlzQXJpc2VNdWx0aSA9IHRydWU7CgogICAgICAgICAgICAgICAgICBpZiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQuRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBs4bqleSB1bmlxdWUgaG/hurdjIG5hbWUKICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZmllbGQudW5pcXVlIHx8IGZpZWxkLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICBsaXN0QXJpc2VuZC5wdXNoKGVsZW1lbnQuRW50aXR5W25hbWVdKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAvLyAxIGLhuqNuIGdoaSBjw7MgcGjDoXQgc2luaDoKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpc0FyaXNlTXVsdGkgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgbmFtZSA9IGZpZWxkLnVuaXF1ZSB8fCBmaWVsZC5uYW1lOwogICAgICAgICAgICAgICAgICBvYmogPSByZXN1bHQuRGF0YVswXTsKICAgICAgICAgICAgICAgICAgbGlzdEFyaXNlbmQucHVzaChvYmouRW50aXR5W25hbWVdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSByZXN1bHQuQ29kZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gX2NvbnRleHQ2LnQwID09PSBDT0RFLkRlbGV0ZU11bHRpQXJpc2VuZWQgPyAxNSA6IF9jb250ZXh0Ni50MCA9PT0gQ09ERS5BcmlzZW5lZCA/IDM3IDogX2NvbnRleHQ2LnQwID09PSBDT0RFLlBhcnRJbnZhbGlkRGF0YSA/IDQ3IDogNTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIGlmICghZmllbGQuaXNJbmFjdGl2ZUFuZERlbGV0ZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0No4buJIHRow7RuZyBiw6FvIG5n4burbmcgc+G7rSBk4bulbmcgdsOgIHjDs2EgduG7m2kgY8OhYyBtw6BuIGRhbmggbeG7pWMKICAgICAgICAgICAgICAgIGNvbmZpZ01lc3NhZ2UgPSBtZS5nZXRBcmlzZUNvbmZpcm1NZXNhZ2UobW9kdWxlTmFtZSwgbGlzdEFyaXNlbmQsIENPREUuRGVsZXRlTXVsdGlBcmlzZW5lZCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRtcy5tc2dCb3guc2hvd1F1ZXN0aW9uKGNvbmZpZ01lc3NhZ2UpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgYW5zd2VyID0gX2NvbnRleHQ2LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoYW5zd2VyID09ICJZZXMiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDMzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBr4bq/dCBxdeG6oyB4w7NhCiAgICAgICAgICAgICAgICAvL05n4burbmcgc+G7rSBk4bulbmcgYuG6o24gZ2hpIHBow6F0IHNpbmgKICAgICAgICAgICAgICAgIHJlY29yZHNJbmFjdGl2ZSA9IFtdOyAvL23huqNuZyBi4bqjbiBnaGkgY+G6p24gbmfhu6tuZyBz4butIGThu6VuZwoKICAgICAgICAgICAgICAgIHJlc3VsdC5EYXRhLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgcmVjb3Jkc0luYWN0aXZlLnB1c2goZWxlbWVudC5FbnRpdHkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLnNldEluYWN0aXZlQXJpc2UocmVjb3Jkc0luYWN0aXZlKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIGluYWN0aXZlQXJpc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIC8vWMOzYSBi4bqjbiBnaGkga2jDtG5nIHBow6F0IHNpbmgKICAgICAgICAgICAgICAgIHJlY29yZHNEZWxldGUgPSBbXTsgLy9t4bqjbmcgYuG6o24gZ2hpIGPhuqduIHjDs2EKCiAgICAgICAgICAgICAgICBpZiAoIShyZWNvcmQubGVuZ3RoID4gcmVjb3Jkc0luYWN0aXZlLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9O4bq/dSBjw7MgYuG6o24gZ2hpIGtow7RuZyBwaMOhdCBzaW5oIHRow6wgbXMgeMOzYQogICAgICAgICAgICAgICAgcmVjb3JkLmZpbHRlcihmdW5jdGlvbiAoaXRlbVJlY29yZCkgewogICAgICAgICAgICAgICAgICB2YXIgcmVjb3JkRHVwbGljYXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJlY29yZHNJbmFjdGl2ZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW1SZWNvcmRzSW5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVJlY29yZHNJbmFjdGl2ZVtmaWVsZC5rZXldID09IGl0ZW1SZWNvcmRbZmllbGQua2V5XSkgewogICAgICAgICAgICAgICAgICAgICAgcmVjb3JkRHVwbGljYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgaWYgKCFyZWNvcmREdXBsaWNhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmRzRGVsZXRlLnB1c2goaXRlbVJlY29yZCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzMTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5kZWxldGVNdXRpUm93c05vQ29uZmlybShyZWNvcmRzRGVsZXRlKTsKCiAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgIGRlbGV0ZU5vQXJpc2UgPSBfY29udGV4dDYuc2VudDsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgIC8vU2hvdyB0b2FzdCB0aMO0bmcgYsOhbwogICAgICAgICAgICAgICAgaWYgKHJlY29yZHNEZWxldGUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAvL05n4burbmcgc+G7rSBk4bulbmcgdsOgIHjDs2EKICAgICAgICAgICAgICAgICAgaWYgKGluYWN0aXZlQXJpc2UuU3VjY2VzcyAmJiBkZWxldGVOb0FyaXNlLlN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBtZS4kdG9hc3Quc3VjY2VzcyhtZS4kdCgiaTE4bkJhc2VGb3JtLlNhdmVTdWNjZXNzTWVzc2FnZSIpKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5TYXZlRXJyb3JNZXNzYWdlIikpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvL0No4buJIG5n4burbmcgc+G7rSBk4bulbmcKICAgICAgICAgICAgICAgICAgaWYgKGluYWN0aXZlQXJpc2UuU3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIG1lLiR0b2FzdC5zdWNjZXNzKG1lLiR0KCJpMThuQmFzZUZvcm0uU2F2ZVN1Y2Nlc3NNZXNzYWdlIikpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLlNhdmVFcnJvck1lc3NhZ2UiKSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd1dhcm5pbmcobWUuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5DYW5Ob3REZWxldGVBcmlzZSIpKTsKCiAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJicmVhayIsIDU4KTsKCiAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgIGlmICghZmllbGQuaXNJbmFjdGl2ZUFuZERlbGV0ZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0No4buJIHRow7RuZyBiw6FvIG5n4burbmcgc+G7rSBk4bulbmcgdsOgIHjDs2EgduG7m2kgY8OhYyBtw6BuIGRhbmggbeG7pWMKICAgICAgICAgICAgICAgIGNvbmZpZ01lc3NhZ2UgPSBtZS5nZXRBcmlzZUNvbmZpcm1NZXNhZ2UobW9kdWxlTmFtZSwgbGlzdEFyaXNlbmQsIENPREUuQXJpc2VuZWQpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kbXMubXNnQm94LnNob3dRdWVzdGlvbihjb25maWdNZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSA0MToKICAgICAgICAgICAgICAgIGFuc3dlciA9IF9jb250ZXh0Ni5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIgPT0gIlllcyIpIHsKICAgICAgICAgICAgICAgICAgLy9OZ+G7q25nIHPhu60gZOG7pW5nIGLhuqNuIGdoaSBwaMOhdCBzaW5oCiAgICAgICAgICAgICAgICAgIG1lLnNldEFjdGl2ZU11dGlSb3dzKHJlc3VsdC5EYXRhWzBdLkVudGl0eSwgImluYWN0aXZlIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0NjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQ1OgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZyhtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkNhbk5vdERlbGV0ZUFyaXNlIikpOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoImJyZWFrIiwgNTgpOwoKICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgaWYgKCFpc0FyaXNlTXVsdGkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1MjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZyhtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkVycm9yRGVsZXRlTXVsdGkiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgiYnJlYWsiLCA1OCk7CgogICAgICAgICAgICAgIGNhc2UgNTI6CiAgICAgICAgICAgICAgICAvL21lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLk5ld01lc3NhZ2VEZWxldGUiKS5mb3JtYXQobW9kdWxlTmFtZSwgY29kZXMpKTsKICAgICAgICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd1dhcm5pbmcobWUuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5FcnJvckRlbGV0ZU11bHRpIikpOwoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuRGF0YSkgewogICAgICAgICAgICAgICAgICBrZXlGaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQua2V5OwogICAgICAgICAgICAgICAgICByZWNvcmQuZm9yRWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5EYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpW2tleUZpZWxkXSAhPSBpdGVtLkVudGl0eVtrZXlGaWVsZF0gJiYgaVtrZXlGaWVsZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWUuZ3JpZC5kYXRheC5yZW1vdmUoaSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSAvLyByZWNvcmQgPSBbXTsKICAgICAgICAgICAgICAgIC8vbWUuc2VsZWN0aW9uQ2hhbmdlKHJlY29yZCk7CiAgICAgICAgICAgICAgICAvLyBtZS5zZWxlY3RlZCA9IFtdOwogICAgICAgICAgICAgICAgLy9tZS5yZWxvYWQoKTsKCgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoImJyZWFrIiwgNTgpOwoKICAgICAgICAgICAgICBjYXNlIDU1OgogICAgICAgICAgICAgICAgaWYgKCFpc0FyaXNlTXVsdGkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1ODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZyhtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkVycm9yRGVsZXRlTXVsdGkiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgiYnJlYWsiLCA1OCk7CgogICAgICAgICAgICAgIGNhc2UgNTg6CiAgICAgICAgICAgICAgICByZWNvcmQgPSBbXTsKICAgICAgICAgICAgICAgIG1lLnNlbGVjdGVkID0gW107CiAgICAgICAgICAgICAgICBtZS5yZWxvYWQoKTsKCiAgICAgICAgICAgICAgY2FzZSA2MToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDw6J1IHRow7RuZyBiw6FvIGtoaSBjw7MgcGjDoXQgc2luaCBk4buvIGxp4buHdQ0KICAgICAqIE5UVEhBTkgxDQogICAgICovCiAgICBnZXRBcmlzZUNvbmZpcm1NZXNhZ2U6IGZ1bmN0aW9uIGdldEFyaXNlQ29uZmlybU1lc2FnZShtb2R1bGVOYW1lLCBsaXN0QXJpc2VuZCwgY29kZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7CiAgICAgIHZhciB0aXRsZU5hbWUgPSBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZVRpdGxlIikuZm9ybWF0KG1vZHVsZU5hbWUpLAogICAgICAgICAgbWVzLAogICAgICAgICAgbWVzTGlzdEFyaXNlOyAvL0J1aWxkIGPDonUgdGjDtG5nIGLDoW8KCiAgICAgIG1lc0xpc3RBcmlzZSA9IGxpc3RBcmlzZW5kLmxlbmd0aCA+IDIgPyAiPGI+Ii5jb25jYXQobGlzdEFyaXNlbmRbMF0sICI8L2I+LCA8Yj4iKS5jb25jYXQobGlzdEFyaXNlbmRbMV0sICI8L2I+IHZceEUwIDxiPiIpLmNvbmNhdChsaXN0QXJpc2VuZC5sZW5ndGggLSAyLCAiPC9iPiAiKS5jb25jYXQobW9kdWxlTmFtZSwgIiBraFx4RTFjIikgOiAiPGI+Ii5jb25jYXQobGlzdEFyaXNlbmQuam9pbigiPC9iPiwgPGI+IiksICI8L2I+Iik7CiAgICAgIG1lcyA9IG1lLmdldEFyaXNlTWVzc2FnZShjb2RlLCBsaXN0QXJpc2VuZCwgbWVzTGlzdEFyaXNlLCBtb2R1bGVOYW1lKTsgLy9Db25maWcgY8OhYyBidXR0b24KCiAgICAgIHZhciBidG5Db25maWcgPSBbewogICAgICAgIGtleTogIk5vIiwKICAgICAgICB0YXJnZXQ6ICJSaWdodCIsCiAgICAgICAgdGV4dDogIkjhu6d5IiwKICAgICAgICB0eXBlQnV0dG9uOiAic2Vjb25kYXJ5IgogICAgICB9LCB7CiAgICAgICAga2V5OiAiWWVzIiwKICAgICAgICB0YXJnZXQ6ICJSaWdodCIsCiAgICAgICAgdGV4dDogIsSQ4buTbmcgw70iLAogICAgICAgIGZvY3VzOiB0cnVlLAogICAgICAgIHR5cGVCdXR0b246ICJibHVlIgogICAgICB9XTsKICAgICAgcmV0dXJuIHsKICAgICAgICB0aXRsZTogdGl0bGVOYW1lLAogICAgICAgIG1lc3NhZ2U6IG1lcywKICAgICAgICBidG5Db25maWc6IGJ0bkNvbmZpZwogICAgICB9OwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBjw6J1IHRow7RuZyBiw6FvIGtoaSBwaMOhdCBzaW5oDQogICAgICogVmnhur90IHJpw6puZyByYSDEkeG7gyBvdmVycmlkZSBs4bqhaSB2w6wgbeG7mXQgc+G7kSBtw6BuIGPDsyBjw6J1IHRow7RuZyBiw6FvIGzDoCBOZ+G7q25nIHRoZW8gZMO1aSB0aGF5IHbDrCBOZ+G7q25nIHPhu60gZOG7pW5nDQogICAgICogQHBhcmFtIHsqfSBjb2RlDQogICAgICogTlRESUVNIDE1LjEyLjIwMjENCiAgICAgKi8KICAgIGdldEFyaXNlTWVzc2FnZTogZnVuY3Rpb24gZ2V0QXJpc2VNZXNzYWdlKGNvZGUsIGxpc3RBcmlzZW5kLCBtZXNMaXN0QXJpc2UsIG1vZHVsZU5hbWUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG1lcyA9ICIiOwogICAgICB2YXIgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7CgogICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICBjYXNlIENPREUuRGVsZXRlTXVsdGlBcmlzZW5lZDoKICAgICAgICAgIG1lcyA9IG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuRGVsZXRlTXVsdGlIYXNNdWx0aUFyaXNlbmVkIikuZm9ybWF0KG1vZHVsZU5hbWUsIG1lc0xpc3RBcmlzZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICAvLyB4w7NhIDEgYuG6o24gZ2hpIHbDoCBi4bqjbiBnaGkgxJHDsyBi4buLIGPDsyBwaMOhdCBzaW5oOgoKICAgICAgICBjYXNlIENPREUuQXJpc2VuZWQ6CiAgICAgICAgICBtZXMgPSBtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkRlbGV0ZUFyaXNlIikuZm9ybWF0KG1vZHVsZU5hbWUsIGxpc3RBcmlzZW5kWzBdKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gbWVzOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBOZ+G7q25nIHPhu60gZOG7pW5nIGLhuqNuIGdoaSBwaMOhdCBzaW5oIGThu68gbGnhu4d1DQogICAgICogTlRUSEFOSDENCiAgICAgKi8KICAgIHNldEluYWN0aXZlQXJpc2U6IGZ1bmN0aW9uIHNldEluYWN0aXZlQXJpc2UocmVjb3JkcykgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciBtZSwgaW5hY3RpdmUsIGZpZWxkLCBsaXN0SUQsIHBhcmFtOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzNzsKICAgICAgICAgICAgICAgIGluYWN0aXZlID0gMTsKCiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVjb3JkcykpIHsKICAgICAgICAgICAgICAgICAgcmVjb3JkcyA9IFtyZWNvcmRzXTsKICAgICAgICAgICAgICAgIH0gLy9zaG93IG1hc2sKICAgICAgICAgICAgICAgIC8vIG1lLmxvYWRpbmcgPSB0cnVlOwoKCiAgICAgICAgICAgICAgICBmaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CiAgICAgICAgICAgICAgICBsaXN0SUQgPSByZWNvcmRzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVtmaWVsZC5rZXldOwogICAgICAgICAgICAgICAgfSkuam9pbigiLCIpOwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIFRhYmxlTmFtZTogZmllbGQudGFibGUsCiAgICAgICAgICAgICAgICAgIEtleUZpZWxkOiBmaWVsZC5rZXksCiAgICAgICAgICAgICAgICAgIFZhbHVlOiBpbmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgTGlzdElEOiBsaXN0SUQsCiAgICAgICAgICAgICAgICAgIE9yZ2FuaXphdGlvbklEOiBtZS5nZXRPcmdhbml6YXRpb25GaWx0ZXIoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KF90aGlzNy5tb2R1bGUsICIvdXBkYXRlU3RhdHVzIiksIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0Ny5zZW50KTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjDs2Egbmhp4buBdSBi4bqjbiBnaGkga2jDtG5nIGPhuqduIHBvdXAgdGjDtG5nIGLDoW8NCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqLwogICAgZGVsZXRlTXV0aVJvd3NOb0NvbmZpcm06IGZ1bmN0aW9uIGRlbGV0ZU11dGlSb3dzTm9Db25maXJtKHJlY29yZHMpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICB2YXIgbWUsIHRlbXBzLCBhdWRpdGluZ0xvZywgcGFyYW07CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM4OwogICAgICAgICAgICAgICAgdGVtcHMgPSBbXTsKICAgICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0ge307IC8vQuG7jyBi4bubdCBjw6FjIHRow7RuZyB0aW4gZ+G7rWkgbMOqbiBzdi4KCiAgICAgICAgICAgICAgICAgIHZhciBkcm9wZWRDb2x1bW5zID0gbWUuZ2V0SWdub3JlZENvbHVtbnMoKTsKCiAgICAgICAgICAgICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoaSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0Ryb3BlZENvbHVtbiA9IGRyb3BlZENvbHVtbnMuZmluZChmdW5jdGlvbiAoXykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8gPT0gaTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3BlZENvbHVtbikgewogICAgICAgICAgICAgICAgICAgICAgdGVtcFtpXSA9IHJlY29yZFtpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlY29yZCkgewogICAgICAgICAgICAgICAgICAgIF9sb29wMihpKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGVtcHMucHVzaCh0ZW1wKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXVkaXRpbmdMb2cgPSB7CiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNU0pzb24uc2VyaWFsaXplKG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhyZWNvcmRzKSksCiAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UocmVjb3JkcyksCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogbWUuYWN0aW9uQXVkaXRpbmdMb2csCiAgICAgICAgICAgICAgICAgIGVudGl0eTogbWUubW9kdWxlLAogICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogdGVtcHMsCiAgICAgICAgICAgICAgICAgIEJ5UGFzc1ZhbGlkYXRlOiBudWxsLAogICAgICAgICAgICAgICAgICBBdWRpdGluZ0xvZzogTVNKc29uLnNlcmlhbGl6ZShhdWRpdGluZ0xvZyksCiAgICAgICAgICAgICAgICAgIFR5cGU6IG1lLiRtcy5lbnVtLkRlbGV0ZVR5cGUuTXVsdGkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuJHN0b3JlLmRpc3BhdGNoKCIiLmNvbmNhdChfdGhpczgubW9kdWxlLCAiL2RlbGV0ZSIpLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDguc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGN1c3RvbSBkw7luZyBjaG8geOG7rSBsw70gdGjDqm0gc2F1IGtoaSB4w7NhDQogICAgICogTlRCQU8gMDIuMTEuMjAyMQ0KICAgICAqLwogICAgY3VzdG9tQWZ0ZXJEZWxldGU6IGZ1bmN0aW9uIGN1c3RvbUFmdGVyRGVsZXRlKGRlbGV0ZVJlY29yZCwgcmVzdWx0KSB7fSwKICAgIGdldEZpZWxkczogZnVuY3Rpb24gZ2V0RmllbGRzKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGhhbSBz4buRIGtoaSBt4bufIGZvcm0gY2hpIHRp4bq/dA0KICAgICAqICovCiAgICBnZXREZXRhaWxQYXJhbWV0ZXI6IGZ1bmN0aW9uIGdldERldGFpbFBhcmFtZXRlcihmb3JtTmFtZSwgbW9kZSwgZGVmYXVsdERhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHBhcmFtID0gewogICAgICAgIGRhdGE6IGRlZmF1bHREYXRhIHx8IG51bGwKICAgICAgfTsKCiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uRm9ybVN0YXRlLkR1cGxpY2F0ZToKICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0OgogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uRm9ybVN0YXRlLlZpZXc6CiAgICAgICAgICB2YXIga2V5RmllbGQgPSBtZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLmtleTsKCiAgICAgICAgICBpZiAoa2V5RmllbGQpIHsKICAgICAgICAgICAgcGFyYW0uaWQgPSBkZWZhdWx0RGF0YVtrZXlGaWVsZF07CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHBhcmFtLm1vZGUgPSBtb2RlOwogICAgICBtZS5jdXN0b21EZXRhaWxQYXJhbShwYXJhbSk7CiAgICAgIHJldHVybiBwYXJhbTsKICAgIH0sCiAgICBjdXN0b21EZXRhaWxQYXJhbTogZnVuY3Rpb24gY3VzdG9tRGV0YWlsUGFyYW0ocGFyYW0pIHt9LAoKICAgIC8qKg0KICAgICAqIGhvdmVyIGLhuqNuIGdoaSAtPiBoaeG7g24gdGjhu4sgbWVudQ0KICAgICAqLwogICAgZ3JpZFJvd0hvdmVyOiBmdW5jdGlvbiBncmlkUm93SG92ZXIoKSB7fSwKCiAgICAvKioNCiAgICAgKiBjbGljayBi4bqjbiBnaGkgLT4gaGnhu4NuIHRo4buLIG1lbnUNCiAgICAgKi8KICAgIGdyaWRSb3dPdmVyOiBmdW5jdGlvbiBncmlkUm93T3ZlcihyZWNvcmQsIGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUucm93QWN0aW9ucyA9IG1lLmdldFJlY29yZEFjdGlvbnMocmVjb3JkKTsKICAgIH0sCgogICAgLyoqDQogICAgICogbOG6pXkgZGFuaCBzw6FjaCBhY3Rpb24gY+G7p2EgYuG6o24gZ2hpDQogICAgICovCiAgICBnZXRSZWNvcmRBY3Rpb25zOiBmdW5jdGlvbiBnZXRSZWNvcmRBY3Rpb25zKHJlY29yZCkgewogICAgICByZXR1cm4gW3sKICAgICAgICBjb21tYW5kOiAiRWRpdCIsCiAgICAgICAgaWNvbjogImVkaXQiLAogICAgICAgIHRleHQ6IHRoaXMuJHQoImkxOG5Db21tb24uY29tbWFuZC5lZGl0IikKICAgICAgfSwgewogICAgICAgIGNvbW1hbmQ6ICJEZWxldGUiLAogICAgICAgIGljb246ICJkZWxldGUiLAogICAgICAgIHRleHQ6IHRoaXMuJHQoImkxOG5Db21tb24uY29tbWFuZC5kZWxldGUiKQogICAgICB9XTsKICAgIH0sCgogICAgLyoqDQogICAgICogY2xpY2sgYWN0aW9uIHJvdw0KICAgICAqLwogICAgZ3JpZFJvd0FjdGlvbkNsaWNrOiBmdW5jdGlvbiBncmlkUm93QWN0aW9uQ2xpY2soY29tbWFuZCwgcmVjb3JkLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAiRWRpdCI6CiAgICAgICAgICBtZS5lZGl0KHJlY29yZCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiRGVsZXRlIjoKICAgICAgICAgIG1lLmRlbGV0ZShyZWNvcmQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkR1cGxpY2F0ZSI6CiAgICAgICAgICBtZS5kdXBsaWNhdGUocmVjb3JkKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJWaWV3IjoKICAgICAgICAgIG1lLnZpZXcocmVjb3JkKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJhY3RpdmUiOgogICAgICAgIGNhc2UgImluYWN0aXZlIjoKICAgICAgICAgIG1lLnNldEFjdGl2ZU11dGlSb3dzKHJlY29yZCwgY29tbWFuZCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0luZm8obWUuJHQoImkxOG5Db21tb24uRmVhdHVyZXNJc0RldmVsb3BpbmciKSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaGF5IMSR4buVaSBi4bqjbiBnaGkgY2jhu41uDQogICAgICovCiAgICBzZWxlY3Rpb25DaGFuZ2U6IGZ1bmN0aW9uIHNlbGVjdGlvbkNoYW5nZShyZWNvcmRzKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBhY3Rpb25zID0gW107CgogICAgICBpZiAocmVjb3Jkcy5sZW5ndGggPj0gMSkgewogICAgICAgIGFjdGlvbnMgPSBtZS5nZXRBY3Rpb25NdWx0aShyZWNvcmRzLCBtZS5zZWxlY3RBbGxQYWdlKTsKICAgICAgfQoKICAgICAgbWUuYWN0aW9uTXVsdGkgPSBhY3Rpb25zOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBkYW5oIHPDoWNoIGFjdGlvbiB44butIGzDvSBraGkgbmhp4buBdSBi4bqjbiBnaGkgxJHGsOG7o2MgY2jhu41uDQogICAgICogVEROR0hJQSAxMC8xMC8yMDIxDQogICAgICogbeG6t2MgxJHhu4tuaCBjaOG7iSBj4bqnbiB4w7NhIG5oaeG7gXUgdGjDtGksIG3DoG4gbsOgbyB0aMOqbSB0w61uaCBuxINuZyB0aMOsIHBo4bqjaSBvdmVycmlkZSBs4bqhaQ0KICAgICAqLwogICAgZ2V0QWN0aW9uTXVsdGk6IGZ1bmN0aW9uIGdldEFjdGlvbk11bHRpKHJlY29yZHMsIHNlbGVjdEFsbFBhZ2UpIHsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgY29tbWFuZDogImFjdGl2ZSIsCiAgICAgICAgdGV4dDogIlRoZW8gZMO1aSIsCiAgICAgICAgY2xzOiAic2Vjb25kYXJ5LW91dGxpbmUiCiAgICAgIH0sIHsKICAgICAgICBjb21tYW5kOiAiaW5hY3RpdmUiLAogICAgICAgIHRleHQ6ICJOZ+G7q25nIHRoZW8gZMO1aSIsCiAgICAgICAgY2xzOiAicHJpbWFyeS1vdXRsaW5lIgogICAgICB9LCB7CiAgICAgICAgY29tbWFuZDogImRlbGV0ZSIsCiAgICAgICAgdGV4dDogIljDs2EiLAogICAgICAgIGNsczogInNlY29uZGFyeS1vdXRsaW5lLXJlZCIKICAgICAgfV07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENsaWNrIHbDoG8gYWN0aW9uIGNo4buNbiBuaGnhu4F1IGLhuqNuIGdoaQ0KICAgICAqLwogICAgbXVsdGlTZWxlY3RBY3Rpb25DbGljazogZnVuY3Rpb24gbXVsdGlTZWxlY3RBY3Rpb25DbGljayhjb21tYW5kLCByZWNvcmRzLCBzZWxlY3RBbGxQYWdlLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAiZGVsZXRlIjoKICAgICAgICAgIG1lLmRlbGV0ZU11dGlSb3dzKHJlY29yZHMpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImFjdGl2ZSI6CiAgICAgICAgY2FzZSAiaW5hY3RpdmUiOgogICAgICAgICAgbWUuc2V0QWN0aXZlTXV0aVJvd3MocmVjb3JkcywgY29tbWFuZCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKg0KICAgICAqICBIw6BtIHjDs2Egbmhp4buBdSBi4bqjbiBnaGkuDQogICAgICogQG1vZGlmaWVkIGJ5IFRWTG9pIDIxLjA2LjIwMjEuIGzGsOG7o2MgYuG7jyAxIHPhu5EgdGjDtG5nIHRpbiB0csaw4bubYyBraGkgZ+G7rWkgYuG6o24gZ2hpIGzDqm4gc2VydmUNCiAgICAgKi8KICAgIGRlbGV0ZU11dGlSb3dzOiBmdW5jdGlvbiBkZWxldGVNdXRpUm93cyhyZWNvcmRzKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoKSB7CiAgICAgICAgdmFyIG1lLCBjb25maWdNZXNzYWdlLCBhbnN3ZXIsIHRlbXBzLCBhdWRpdGluZ0xvZywgcGFyYW0sIHJlc3VsdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczk7CgogICAgICAgICAgICAgICAgaWYgKG1lLmNoZWNrQWN0aW9uUGVybWlzc2lvbkFsZXJ0KG1lLiR0KCJpMThuUGVybWlzc2lvbi5TdWJTeXN0ZW1Db2RlLkNvZGUuREVMRVRFIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAobWUudmFsaWRhdGVCZWZvcmVEZWxldGUocmVjb3JkcykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5nZXREZWxldGVDb25maXJtTWVzc2FnZShyZWNvcmRzKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgY29uZmlnTWVzc2FnZSA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kbXMubXNnQm94LnNob3dRdWVzdGlvbihjb25maWdNZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIGFuc3dlciA9IF9jb250ZXh0OS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKGFuc3dlciA9PSAiWWVzIikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGVtcHMgPSBbXTsKICAgICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0ge307IC8vQuG7jyBi4bubdCBjw6FjIHRow7RuZyB0aW4gZ+G7rWkgbMOqbiBzdi4KCiAgICAgICAgICAgICAgICAgIHZhciBkcm9wZWRDb2x1bW5zID0gbWUuZ2V0SWdub3JlZENvbHVtbnMoKTsKCiAgICAgICAgICAgICAgICAgIHZhciBfbG9vcDMgPSBmdW5jdGlvbiBfbG9vcDMoaSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0Ryb3BlZENvbHVtbiA9IGRyb3BlZENvbHVtbnMuZmluZChmdW5jdGlvbiAoXykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8gPT0gaTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3BlZENvbHVtbikgewogICAgICAgICAgICAgICAgICAgICAgdGVtcFtpXSA9IHJlY29yZFtpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlY29yZCkgewogICAgICAgICAgICAgICAgICAgIF9sb29wMyhpKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGVtcHMucHVzaCh0ZW1wKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXVkaXRpbmdMb2cgPSB7CiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNU0pzb24uc2VyaWFsaXplKG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhyZWNvcmRzKSksCiAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UocmVjb3JkcyksCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogbWUuYWN0aW9uQXVkaXRpbmdMb2csCiAgICAgICAgICAgICAgICAgIGVudGl0eTogbWUubW9kdWxlLAogICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogdGVtcHMsCiAgICAgICAgICAgICAgICAgIEJ5UGFzc1ZhbGlkYXRlOiBudWxsLAogICAgICAgICAgICAgICAgICBBdWRpdGluZ0xvZzogTVNKc29uLnNlcmlhbGl6ZShhdWRpdGluZ0xvZyksCiAgICAgICAgICAgICAgICAgIFR5cGU6IG1lLiRtcy5lbnVtLkRlbGV0ZVR5cGUuTXVsdGkKICAgICAgICAgICAgICAgIH07IC8vIEN1c3RvbSBs4bqhaSBwYXJhbSB4w7NhCgogICAgICAgICAgICAgICAgcGFyYW0gPSBtZS5jdXN0b21EZWxldGVQYXJhbShyZWNvcmRzLCBwYXJhbSk7CiAgICAgICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4ubWFzaygpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyMDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5yZXF1ZXN0RGVsZXRlRGF0YShyZWNvcmRzLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIG1lLiRtcy5jb21tb25Gbi51bm1hc2soKTsKICAgICAgICAgICAgICAgIG1lLmFmdGVyRGVsZXRlKHJlY29yZHMsIHJlc3VsdCk7IC8vbG9nIGZpcmViYXNlCiAgICAgICAgICAgICAgICAvLyBtZS5sb2dEYXRhRmlyZUJhc2UoKQoKICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gY3VzdG9tIGRlbGV0ZSBwYXJhbQ0KICAgICAqIE5UQkFPOiAwNy4xMi4yMDIxDQogICAgICogQHBhcmFtIHsqfSBwYXJhbQ0KICAgICAqIEByZXR1cm5zDQogICAgICovCiAgICBjdXN0b21EZWxldGVQYXJhbTogZnVuY3Rpb24gY3VzdG9tRGVsZXRlUGFyYW0ocmVjb3JkLCBwYXJhbSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gcGFyYW07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENsaWNrIHbDoG8gYWN0aW9uIGNo4buNbiBuaGnhu4F1IGLhuqNuIGdoaTogQ2jhu41uIHThuqV0IGPhuqMNCiAgICAgKi8KICAgIG11bHRpU2VsZWN0QWxsQ2xpY2s6IGZ1bmN0aW9uIG11bHRpU2VsZWN0QWxsQ2xpY2soKSB7CiAgICAgIHRoaXMuc2VsZWN0QWxsUGFnZSA9ICF0aGlzLnNlbGVjdEFsbFBhZ2U7CgogICAgICBpZiAoIXRoaXMuc2VsZWN0QWxsUGFnZSkgewogICAgICAgIHRoaXMuc2VsZWN0ZWQgPSBbXTsKICAgICAgICB0aGlzLmdyaWQuY2hlY2thbGwgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmdyaWQuY2hlY2thbGwgPSB0cnVlOwogICAgICAgIHRoaXMuZ3JpZC4kZW1pdCgiaW5wdXQiLCB0aGlzLmdyaWQuZGF0YXgpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIELhu48gdMOtY2ggY2jhu41uIGPDoWMgYuG6o24gZ2hpDQogICAgICovCiAgICBtdWx0aVNlbGVjdFVuY2hlY2s6IGZ1bmN0aW9uIG11bHRpU2VsZWN0VW5jaGVjaygpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUuc2VsZWN0ZWQgPSBbXTsgLy8gTk1UVUFOMiAyOC4xMS4yMDIxOiBi4buPIHTDrWNoIGNo4buNbiB0csOqbiBncmlkRWRpdG9yCgogICAgICBpZiAoQXJyYXkuaXNBcnJheShtZS5ncmlkLmxpc3RSb3dTZWxlY3RlZCkpIHsKICAgICAgICBtZS5ncmlkLmxpc3RSb3dTZWxlY3RlZCA9IFtdOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEtoYWkgYsOhbyBz4buxIGtp4buHbiBj4bunYSBmb3JtDQogICAgICovCiAgICBpbml0RXZlbnQ6IGZ1bmN0aW9uIGluaXRFdmVudCgpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIGdyaWQgPSBtZS5ncmlkLAogICAgICAgICAgYWN0aW9uTXVsdGkgPSBtZS5hY3Rpb25NdWx0aUNvbXBvbmVudCwKICAgICAgICAgIGFjdGlvbk11bHRpQmlnU2NyZW5uID0gbWUuYWN0aW9uTXVsdGlCaWdTY3JlZW5Db21wb25lbnQ7CgogICAgICBpZiAoZ3JpZCkgewogICAgICAgIGdyaWQuJG9uKCJsb2FkRGF0YSIsIG1lLmxvYWREYXRhKTsKICAgICAgICBncmlkLiRvbigiZGJsY2xpY2siLCBtZS5ncmlkUm93RGJDbGljayk7CiAgICAgICAgZ3JpZC4kb24oInJvd21vdXNlb3ZlciIsIG1lLmdyaWRSb3dPdmVyKTsKICAgICAgICBncmlkLiRvbigicm93YWN0aW9uY2xpY2siLCBtZS5ncmlkUm93QWN0aW9uQ2xpY2spOwogICAgICAgIGdyaWQuJG9uKCJpbnB1dCIsIG1lLnNlbGVjdGlvbkNoYW5nZSk7CiAgICAgICAgZ3JpZC4kb24oImNoYW5nZXBhZ2VzaXplIiwgbWUuZ3JpZENoYW5nZVBhZ2VTaXplKTsKCiAgICAgICAgaWYgKCFncmlkLmlzR3JpZFRyZWUpIHsKICAgICAgICAgIGdyaWQuJG9uKCJmaWx0ZXIiLCBtZS5yZWxvYWQpOwogICAgICAgIH0KCiAgICAgICAgZ3JpZC4kb24oInJlc2l6ZUNvbCIsIG1lLmdyaWRSZXNpemVDb2wpOwogICAgICB9CgogICAgICBpZiAoYWN0aW9uTXVsdGkpIHsKICAgICAgICBhY3Rpb25NdWx0aS4kb24oImFjdGlvbmNsaWNrIiwgbWUubXVsdGlTZWxlY3RBY3Rpb25DbGljayk7CiAgICAgICAgYWN0aW9uTXVsdGkuJG9uKCJzZWxlY3RhbGwiLCBtZS5tdWx0aVNlbGVjdEFsbENsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aS4kb24oInVuY2hlY2siLCBtZS5tdWx0aVNlbGVjdFVuY2hlY2spOwogICAgICB9CgogICAgICBpZiAoYWN0aW9uTXVsdGlCaWdTY3Jlbm4pIHsKICAgICAgICBhY3Rpb25NdWx0aUJpZ1NjcmVubi4kb24oImFjdGlvbmNsaWNrIiwgbWUubXVsdGlTZWxlY3RBY3Rpb25DbGljayk7CiAgICAgICAgYWN0aW9uTXVsdGlCaWdTY3Jlbm4uJG9uKCJzZWxlY3RhbGwiLCBtZS5tdWx0aVNlbGVjdEFsbENsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aUJpZ1NjcmVubi4kb24oInVuY2hlY2siLCBtZS5tdWx0aVNlbGVjdFVuY2hlY2spOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHJlbW92ZSBldmVudCBhZGQgxJHhu5luZw0KICAgICAqLwogICAgcmVtb3ZlRXZlbnQ6IGZ1bmN0aW9uIHJlbW92ZUV2ZW50KCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgZ3JpZCA9IG1lLmdyaWQsCiAgICAgICAgICBhY3Rpb25NdWx0aSA9IG1lLmFjdGlvbk11bHRpQ29tcG9uZW50LAogICAgICAgICAgYWN0aW9uTXVsdGlCaWdTY3Jlbm4gPSBtZS5hY3Rpb25NdWx0aUJpZ1NjcmVlbkNvbXBvbmVudDsKCiAgICAgIGlmIChncmlkKSB7CiAgICAgICAgZ3JpZC4kb2ZmKCJsb2FkRGF0YSIsIG1lLmxvYWREYXRhKTsKICAgICAgICBncmlkLiRvZmYoImRibGNsaWNrIiwgbWUuZ3JpZFJvd0RiQ2xpY2spOwogICAgICAgIGdyaWQuJG9mZigicm93bW91c2VvdmVyIiwgbWUuZ3JpZFJvd0NsaWNrKTsKICAgICAgICBncmlkLiRvZmYoInJvd2FjdGlvbmNsaWNrIiwgbWUuZ3JpZFJvd0FjdGlvbkNsaWNrKTsKICAgICAgICBncmlkLiRvZmYoImlucHV0IiwgbWUuc2VsZWN0aW9uQ2hhbmdlKTsKICAgICAgICBncmlkLiRvZmYoImNoYW5nZXBhZ2VzaXplIiwgbWUuZ3JpZENoYW5nZVBhZ2VTaXplKTsKCiAgICAgICAgaWYgKCFncmlkLmlzR3JpZFRyZWUpIHsKICAgICAgICAgIGdyaWQuJG9mZigiZmlsdGVyIiwgbWUucmVsb2FkKTsKICAgICAgICB9CgogICAgICAgIGdyaWQuJG9mZigicmVzaXplQ29sIiwgbWUuZ3JpZFJlc2l6ZUNvbCk7CiAgICAgIH0KCiAgICAgIGlmIChhY3Rpb25NdWx0aSkgewogICAgICAgIGFjdGlvbk11bHRpLiRvZmYoImFjdGlvbmNsaWNrIiwgbWUubXVsdGlTZWxlY3RBY3Rpb25DbGljayk7CiAgICAgICAgYWN0aW9uTXVsdGkuJG9mZigic2VsZWN0YWxsIiwgbWUubXVsdGlTZWxlY3RBbGxDbGljayk7CiAgICAgICAgYWN0aW9uTXVsdGkuJG9mZigidW5jaGVjayIsIG1lLm11bHRpU2VsZWN0VW5jaGVjayk7CiAgICAgIH0KCiAgICAgIGlmIChhY3Rpb25NdWx0aUJpZ1NjcmVubikgewogICAgICAgIGFjdGlvbk11bHRpQmlnU2NyZW5uLiRvZmYoImFjdGlvbmNsaWNrIiwgbWUubXVsdGlTZWxlY3RBY3Rpb25DbGljayk7CiAgICAgICAgYWN0aW9uTXVsdGlCaWdTY3Jlbm4uJG9mZigic2VsZWN0YWxsIiwgbWUubXVsdGlTZWxlY3RBbGxDbGljayk7CiAgICAgICAgYWN0aW9uTXVsdGlCaWdTY3Jlbm4uJG9mZigidW5jaGVjayIsIG1lLm11bHRpU2VsZWN0VW5jaGVjayk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogWHXhuqV0IGto4bqpdSBleGNlbA0KICAgICAqLwogICAgZXhwb3J0RXhjZWw6IGZ1bmN0aW9uIGV4cG9ydEV4Y2VsKCkgewogICAgICB2YXIgX3RoaXMxMCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoKSB7CiAgICAgICAgdmFyIG1lLCBwYXJhbTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXMxMDsKCiAgICAgICAgICAgICAgICBpZiAoX3RoaXMxMC5jaGVja0FjdGlvblBlcm1pc3Npb25BbGVydChtZS4kdCgiaTE4blBlcm1pc3Npb24uU3ViU3lzdGVtQ29kZS5Db2RlLkVYUE9SVCIpKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfY29udGV4dDEwLm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTAuZ2V0RXhwb3J0RXhjZWxQYXJhbSgpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBwYXJhbSA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDg7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMC5jdXN0b21QYXJhbUJlZm9yZUV4cG9ydChwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IHRoYW0gc+G7kSB4deG6pXQga2jhuql1DQogICAgICovCiAgICBnZXRFeHBvcnRFeGNlbFBhcmFtOiBmdW5jdGlvbiBnZXRFeHBvcnRFeGNlbFBhcmFtKCkgewogICAgICB2YXIgX3RoaXMxMSA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEoKSB7CiAgICAgICAgdmFyIHBhcmFtLCBjb250cm9sbGVyOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcGFyYW0gPSBfdGhpczExLmdldEdyaWRFeHBvcnRQYXJhbWV0ZXIoX3RoaXMxMS5ncmlkKTsKICAgICAgICAgICAgICAgIHBhcmFtLkZpbGVUeXBlID0gInhsc3giOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczExLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQoX3RoaXMxMS5tb2R1bGUsICIvZ2V0Q29udHJvbGxlciIpKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgY29udHJvbGxlciA9IF9jb250ZXh0MTEuc2VudDsKICAgICAgICAgICAgICAgIHBhcmFtLkdldERhdGFVcmwgPSBbY29udHJvbGxlciwgImxpc3QiXS5qb2luKCIvIik7CiAgICAgICAgICAgICAgICBwYXJhbS5HZXREYXRhTWV0aG9kID0gIlBPU1QiOwogICAgICAgICAgICAgICAgcGFyYW0uUmVwb3J0VGl0bGUgPSBfdGhpczExLmdldFRpdGxlRXhwb3J0KCk7CiAgICAgICAgICAgICAgICBwYXJhbS5GaWxlTmFtZSA9IF90aGlzMTEuZ2V0RmlsZU5hbWUoKTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogbOG6pXkgdGnDqnUgxJHhu4EgZmlsZSBleGNlbA0KICAgICAqIEByZXR1cm5zIHRpw6p1IMSR4buBIGRhbmggc8OhY2gNCiAgICAgKi8KICAgIGdldFRpdGxlRXhwb3J0OiBmdW5jdGlvbiBnZXRUaXRsZUV4cG9ydCgpIHsKICAgICAgdmFyIHRpdGxlID0gIiI7CiAgICAgIHZhciBlbCA9IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoIi5saXN0LXRpdGxlIik7CgogICAgICBpZiAoZWwgJiYgdHlwZW9mIGVsLmlubmVySFRNTCA9PT0gInN0cmluZyIpIHsKICAgICAgICB0aXRsZSA9IGVsLmlubmVySFRNTC50cmltKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGl0bGUgPSB0aGlzLnRpdGxlID8gdGhpcy50aXRsZS50cmltKCkgOiAiIjsKICAgICAgfQoKICAgICAgcmV0dXJuIHRpdGxlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0w6puIGZpbGUga2hpIHh14bqldCBraOG6qXUNCiAgICAgKiBAcmV0dXJucyB0w6puIGZpbGUgOiBu4bq/dSDEkeG7gyB0cuG7kW5nIHRow6wgbeG6t2MgxJHhu4tuaCBs4bqleSB0acOqdSDEkeG7gQ0KICAgICAqLwogICAgZ2V0RmlsZU5hbWU6IGZ1bmN0aW9uIGdldEZpbGVOYW1lKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBt4bufIHBvcHVwIHPhu61hIG3huqt1DQogICAgICovCiAgICBvcGVuUHJvdG90eXBlOiBmdW5jdGlvbiBvcGVuUHJvdG90eXBlKCkgewogICAgICB0aGlzLnNob3dEZXRhaWwoIk1zQ29uZmlnTGlzdExheW91dCIsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkFkZCwgewogICAgICAgIGxheW91dDogdGhpcy5sYXlvdXQsCiAgICAgICAgcGFyZW50OiB0aGlzCiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDE4LjAzLjIwMjENCiAgICAgKiBIw6BtIGN1c3RvbSBs4bqhaSBwYXJhbSB0csaw4bubYyBraGkgeHXhuqV0IGV4Y2VsDQogICAgICovCiAgICBjdXN0b21QYXJhbUJlZm9yZUV4cG9ydDogZnVuY3Rpb24gY3VzdG9tUGFyYW1CZWZvcmVFeHBvcnQocGFyYW0pIHsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogQGF1dGhvciB2dmtpZXQgLSAxNC4wNC4yMDIxDQogICAgICogSMOgbSB44butIGzDvSBleHREYXRhDQogICAgICovCiAgICBkZWNvZGVFeHREYXRhOiBmdW5jdGlvbiBkZWNvZGVFeHREYXRhKGRhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy8gWOG7rSBsw70gZOG7ryBsaeG7h3UgbeG7nyBy4buZbmcKCiAgICAgIHZhciBvcmlnaW5GaWVsZHMgPSBbXTsKCiAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCJFeHREYXRhIikpIHsKICAgICAgICAvLyBEYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIGThu68gbGnhu4d1IGfhu5FjIGPhu6dhIGThu68gbGnhu4d1CiAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgICBvcmlnaW5GaWVsZHMucHVzaChpKTsKICAgICAgICB9IC8vIE1hcCBk4buvIGxp4buHdSBt4bufIHLhu5luZwoKCiAgICAgICAgaWYgKGRhdGEuRXh0RGF0YSAmJiB0eXBlb2YgZGF0YS5FeHREYXRhID09PSAic3RyaW5nIikgewogICAgICAgICAgdmFyIGV4dERhdGEgPSBKU09OLnBhcnNlKGRhdGEuRXh0RGF0YSk7CgogICAgICAgICAgaWYgKGV4dERhdGEpIHsKICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLnByb2Nlc3NTZXJ2ZXJSZXNwb25zZURhdGEoZXh0RGF0YSk7CgogICAgICAgICAgICBmb3IgKHZhciBtIGluIGV4dERhdGEpIHsKICAgICAgICAgICAgICAvLyBDaOG7iSBtYXAgY8OhYyB0csaw4budbmcga2jDtG5nIGPDsyB0cm9uZyBk4buvIGxp4buHdSBn4buRYwogICAgICAgICAgICAgIGlmIChkYXRhICYmIGRhdGFbbV0pIHsKICAgICAgICAgICAgICAgIGRhdGFbbV0gPSBleHREYXRhW21dOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBk4buvIGxp4buHdSBzYXUga2hpIHPhu61hDQogICAgICogQHBhcmFtIHsqfSByZWNvcmQgYuG6o24gZ2hpIGfhu5FjDQogICAgICogQHBhcmFtIHsqfSBzYXZlUmVzdWx0IGLhuqNuIGdoaSB0csOqbiBzZXJ2ZXIgdHLhuqMgduG7gQ0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgYWZ0ZXJTYXZlRWRpdDogZnVuY3Rpb24gYWZ0ZXJTYXZlRWRpdChyZWNvcmQsIHNhdmVSZXN1bHQpIHt9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGThu68gbGnhu4d1IHNhdSBraGkgc+G7rWEgdOG6oWkgbW9kZSB2aWV3DQogICAgICogQHBhcmFtIHsqfSByZWNvcmQgYuG6o24gZ2hpIGfhu5FjDQogICAgICogQHBhcmFtIHsqfSBzYXZlUmVzdWx0IGLhuqNuIGdoaSB0csOqbiBzZXJ2ZXIgdHLhuqMgduG7gQ0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgYWZ0ZXJTYXZlVmlldzogZnVuY3Rpb24gYWZ0ZXJTYXZlVmlldyhyZWNvcmQsIHNhdmVSZXN1bHQpIHt9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gc2hvdyBBbGwgaWNvbmZpbHRlcg0KICAgICAqIEBwYXJhbSB7Kn0gcmVjb3JkIGLhuqNuIGdoaSBn4buRYw0KICAgICAqIEBwYXJhbSB7Kn0gc2F2ZVJlc3VsdCBi4bqjbiBnaGkgdHLDqm4gc2VydmVyIHRy4bqjIHbhu4ENCiAgICAgKiBAb3ZlcnJpZGUNCiAgICAgKi8KICAgIGZ1blNob3dBbGxJY29uRmlsdGVyOiBmdW5jdGlvbiBmdW5TaG93QWxsSWNvbkZpbHRlcigpIHsKICAgICAgLy90aGlzLiRuZXh0VGljaygoKT0+ewogICAgICB0aGlzLnNob3dBbGxJY29uRmlsdGVyID0gIXRoaXMuc2hvd0FsbEljb25GaWx0ZXI7CiAgICAgIHRoaXMuJHJlZnNbdGhpcy52aWV3UmVmXS5mdW5TaG93QWxsSWNvbkZpbHRlcih0aGlzLnNob3dBbGxJY29uRmlsdGVyKTsgLy99KQogICAgfSwKCiAgICAvKioNCiAgICAgKiBjdXN0b20gxJFp4buBdSBraeG7h24gbOG7jWMvc2VhcmNoIG3DoG4gaMOsbmggZ3JpZCB0cmVlDQogICAgICogQHBhcmFtIHsqfSByZWNvcmQgYuG6o24gZ2hpIGNoZWNrDQogICAgICogQHBhcmFtIHByb3BlcnRpZXMgZGFuaCBzw6FjaCBmaWVsZCBj4bqnbiBjaGVjayDEkWsNCiAgICAgKiBAcGFyYW0gc2VhcmNoVGV4dCDEkW/huqFuIHRleHQgbmjhuq1wIOG7nyDDtCB0w6xtIGtp4bq/bQ0KICAgICAqIE3hurdjIMSR4buLbmggdHLhuqMgduG7gSB0cnVlDQogICAgICovCiAgICBjaGVja0ZpbHRlckdyaWRUcmVlQ3VzdG9tOiBmdW5jdGlvbiBjaGVja0ZpbHRlckdyaWRUcmVlQ3VzdG9tKHJlY29yZCwgcHJvcGVydGllcywgc2VhcmNoVGV4dCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBzaG93IGPDoWMgcG9wdXAgdGhlbyB0w6puIGzhuqV5IMSRxrDhu51uZyBk4bqrbiB04burIGjDoG0gZ2V0UG9wdXBvbXBvbmVudA0KICAgICAqIEBwYXJhbSBuYW1lIHTDqm4gY+G7p2EgY29tcG9uZW50DQogICAgICogQ3JlYXRlZCBieSBMVERBVCgxNy4wNi4yMDIwKQ0KICAgICAqLwogICAgc2hvd0RldGFpbDogZnVuY3Rpb24gc2hvd0RldGFpbChuYW1lLCBtb2RlLCBkYXRhLCBvcHRpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcG9wdXBVdGlsLnNob3cobWUsIG5hbWUsIGRhdGEsIG1lLmdldFBvcHVwT3B0aW9uKG5hbWUsIG9wdGlvbikpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBBdXRob3I6IMSQVlRoaQ0KICAgICAqIENyZWF0ZSBkYXRlOiAxMS8wMy8yMDIxDQogICAgICogQ2hvIHBow6lwIGRldGFpbCBn4buNaSB04bubaSBzdWJtaXREZXRhaWxDYWxsYmFjayBj4bunYSBkYW5oIHPDoWNoIHNhdSBraGkgY+G6pXQgeG9uZw0KICAgICAqLwogICAgZ2V0UG9wdXBPcHRpb246IGZ1bmN0aW9uIGdldFBvcHVwT3B0aW9uKG5hbWUsIG9wdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gewogICAgICAgIHN1Ym1pdDogbWUuc3VibWl0RGV0YWlsQ2FsbGJhY2ssCiAgICAgICAgc2luZ2xlOiB0cnVlCiAgICAgIH07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEF1dGhvcjogxJBWVGhpDQogICAgICogQ3JlYXRlIGRhdGU6IDExLzAzLzIwMjENCiAgICAgKiBDaG8gcGjDqXAgZGV0YWlsIGfhu41pIHThu5tpIHN1Ym1pdERldGFpbENhbGxiYWNrIGPhu6dhIGRhbmggc8OhY2ggc2F1IGtoaSBj4bqldCB4b25nDQogICAgICovCiAgICBzdWJtaXREZXRhaWxDYWxsYmFjazogZnVuY3Rpb24gc3VibWl0RGV0YWlsQ2FsbGJhY2socmVzdWx0LCBwYXJhbSwgYWN0aW9uKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgZ2V0Q29uZGl0aW9uUGFyYW1ldGVyOiBmdW5jdGlvbiBnZXRDb25kaXRpb25QYXJhbWV0ZXIoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciByZXN1bHQgPSBtZS5zdXBlcigiZ2V0Q29uZGl0aW9uUGFyYW1ldGVyIik7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gdGjhu7FjIGhp4buHbiBjdXN0b20gZW50aXR5IMSR4buRaSB24bubaSBuZ2hp4buHcCB24bulIMSR4bq3YyB0aMO5DQogICAgICogQGF1dGhvciB2dmtpZXQgLSAyNy4wNy4yMDIxDQogICAgICovCiAgICBnZXRFbnRpdHlUeXBlOiBmdW5jdGlvbiBnZXRFbnRpdHlUeXBlKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogc2hvdyBmaWx0ZXIgcG9wdXANCiAgICAgKi8KICAgIHNob3dBY3Rpb25Cb3g6IGZ1bmN0aW9uIHNob3dBY3Rpb25Cb3goKSB7CiAgICAgIGlmICh0aGlzLmlzU2hvd0FjdGlvbkdyb3VwID09IHRydWUpIHsKICAgICAgICB0aGlzLmlzU2hvd0FjdGlvbkdyb3VwID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5pc1Nob3dBY3Rpb25Hcm91cCA9IHRydWU7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogaGlkZSBmaWx0ZXIgcG9wdXANCiAgICAgKi8KICAgIGhpZGRlbkFjdGlvbkJveDogZnVuY3Rpb24gaGlkZGVuQWN0aW9uQm94KGV2ZW50KSB7CiAgICAgIHRoaXMuaXNTaG93QWN0aW9uR3JvdXAgPSBmYWxzZTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkgY8OhYyBi4bqjbiBnaGkgxJHGsOG7o2MgY2jhu41uDQogICAgICogVEROR0hJQSAxMi8xMS8yMDIxDQogICAgICogQHBhcmFtIHsqfSByZWNvcmRzDQogICAgICogQHBhcmFtIHsqfSBjb21tYW5kDQogICAgICovCiAgICBzZXRBY3RpdmVNdXRpUm93czogZnVuY3Rpb24gc2V0QWN0aXZlTXV0aVJvd3MocmVjb3JkcywgY29tbWFuZCkgewogICAgICB2YXIgX3RoaXMxMiA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMoKSB7CiAgICAgICAgdmFyIG1lLCBpbmFjdGl2ZSwgZmllbGQsIGxpc3RJRCwgcGFyYW0sIHJlc3VsdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXMxMjsKICAgICAgICAgICAgICAgIGluYWN0aXZlID0gY29tbWFuZCA9PSAiYWN0aXZlIiA/IDAgOiAxOwoKICAgICAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZWNvcmRzKSkgewogICAgICAgICAgICAgICAgICByZWNvcmRzID0gW3JlY29yZHNdOwogICAgICAgICAgICAgICAgfSAvL3Nob3cgbWFzawogICAgICAgICAgICAgICAgLy8gbWUubG9hZGluZyA9IHRydWU7CgoKICAgICAgICAgICAgICAgIGZpZWxkID0gbWUuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0uX2NvbmZpZy5maWVsZDsKICAgICAgICAgICAgICAgIGxpc3RJRCA9IHJlY29yZHMubWFwKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtW2ZpZWxkLmtleV07CiAgICAgICAgICAgICAgICB9KS5qb2luKCIsIik7CiAgICAgICAgICAgICAgICBwYXJhbSA9IHsKICAgICAgICAgICAgICAgICAgVGFibGVOYW1lOiBmaWVsZC50YWJsZSwKICAgICAgICAgICAgICAgICAgS2V5RmllbGQ6IGZpZWxkLmtleSwKICAgICAgICAgICAgICAgICAgVmFsdWU6IGluYWN0aXZlLAogICAgICAgICAgICAgICAgICBMaXN0SUQ6IGxpc3RJRCwKICAgICAgICAgICAgICAgICAgT3JnYW5pemF0aW9uSUQ6IG1lLmdldE9yZ2FuaXphdGlvbkZpbHRlcigpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMy5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KF90aGlzMTIubW9kdWxlLCAiL3VwZGF0ZVN0YXR1cyIpLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0MTMuc2VudDsKICAgICAgICAgICAgICAgIG1lLmFmdGVyVXBkYXRlU3RhdHVzKHJlY29yZHMsIHJlc3VsdCk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMyk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBj4bqtcCBuaOG6rXQgc2F1IGtoaSB1cGRhdGUgc3RhdHVzDQogICAgICogQHBhcmFtIHsqfSByZWNvcmQNCiAgICAgKiBAcGFyYW0geyp9IHJlc3VsdA0KICAgICAqLwogICAgYWZ0ZXJVcGRhdGVTdGF0dXM6IGZ1bmN0aW9uIGFmdGVyVXBkYXRlU3RhdHVzKHJlY29yZCwgcmVzdWx0KSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC5TdWNjZXNzKSB7CiAgICAgICAgbWUuJHRvYXN0LnN1Y2Nlc3MobWUuJHQoImkxOG5CYXNlRm9ybS5TYXZlU3VjY2Vzc01lc3NhZ2UiKSk7CiAgICAgICAgbWUuc2VsZWN0ZWQgPSBbXTsKICAgICAgICBtZS5yZWxvYWQoKTsKICAgICAgICBtZS5jdXN0b21BZnRlclVwZGF0ZShyZWNvcmQpOwogICAgICB9IGVsc2UgewogICAgICAgIG1lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuRXJyb3IiKSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgb3JnYW5pemF0aW9uSUQgxJHhu4MgdXBkYXRlIHN0YXR1cywuLi4NCiAgICAgKiBURE5HSElBIDE2LzExLzIwMjENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgZ2V0T3JnYW5pemF0aW9uRmlsdGVyOiBmdW5jdGlvbiBnZXRPcmdhbml6YXRpb25GaWx0ZXIoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGN1c3RvbSB44butIGzDvSBzYXUga2hpIGPhuq1wIG5o4bqtdCB0cuG6oW5nIHRow6FpDQogICAgICogTk1UVUFOMyAxNS8zLzIwMjINCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZCBi4bqjbiBnaGkgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkNCiAgICAgKi8KICAgIGN1c3RvbUFmdGVyVXBkYXRlOiBmdW5jdGlvbiBjdXN0b21BZnRlclVwZGF0ZShyZWNvcmQpIHt9CiAgfSksCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMucmVtb3ZlRXZlbnQoKTsKICB9Cn07"},null]}
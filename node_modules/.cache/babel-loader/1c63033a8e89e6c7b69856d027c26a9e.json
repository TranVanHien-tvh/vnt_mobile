{"remainingRequest":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT Mobile\\vnt_mobile\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT Mobile\\vnt_mobile\\src\\views\\base\\BaseDetail.js","dependencies":[{"path":"D:\\VNT Mobile\\vnt_mobile\\src\\views\\base\\BaseDetail.js","mtime":1676779201649},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT Mobile\\vnt_mobile\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiRDovVk5UIE1vYmlsZS92bnRfbW9iaWxlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiRDovVk5UIE1vYmlsZS92bnRfbW9iaWxlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2YiOwppbXBvcnQgX2FzeW5jVG9HZW5lcmF0b3IgZnJvbSAiRDovVk5UIE1vYmlsZS92bnRfbW9iaWxlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9hc3luY1RvR2VuZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3BsaXQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLWluZGV4LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnRyaW0uanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgeyBwZXJtaXNzaW9uIH0gZnJvbSAiQC9taXhpbnMvY29tbW9uL3Blcm1pc3Npb24iOwppbXBvcnQgeyBtaXhpblN1cGVyIH0gZnJvbSAiQC9taXhpbnMvY29tbW9uL21peGluU3VwZXIiOwppbXBvcnQgeyBtYXBTdGF0ZSwgbWFwQWN0aW9ucywgbWFwR2V0dGVycyB9IGZyb20gInZ1ZXgiOwppbXBvcnQgeyBNb2R1bGVDb250ZXh0IH0gZnJvbSAiQC9zdG9yZXMvbW9kdWxlLWNvbnN0IjsKaW1wb3J0IG1zVmFsaWRhdGUgZnJvbSAiQC9jb21wb25lbnRzL21zVmFsaWRhdGUvbXNWYWxpZGF0ZS52dWUiOwppbXBvcnQgY29tbW9uRm4gZnJvbSAiQC9jb21tb25zL2NvbW1vbkZ1bmN0aW9uIjsKaW1wb3J0IE1TSnNvbiBmcm9tICJAL2NvbW1vbnMvanNvbiI7CmltcG9ydCB7IGNvbWJvYm94Q29sdW1ucyB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9jb21ib2JveENvbHVtbnMiOwppbXBvcnQgeyBmaWx0ZXIgfSBmcm9tICJAL21peGlucy9jb21tb24vZmlsdGVyIjsKaW1wb3J0IHsgc2hvcnRrZXlTdGF0dXNiYXIgfSBmcm9tICJAL21peGlucy9jb21tb24vc2hvcnRrZXlTdGF0dXNiYXIiOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBGaXJlYmFzZSBmcm9tICJAL2ZpcmViYXNlL2ZpcmViYXNlIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJCYXNlRGV0YWlsIiwKICBtaXhpbnM6IFtmaWx0ZXIsIG1peGluU3VwZXIsIHBlcm1pc3Npb24sIGNvbWJvYm94Q29sdW1ucywgc2hvcnRrZXlTdGF0dXNiYXJdLAogIGNvbXBvbmVudHM6IHsKICAgIG1zVmFsaWRhdGU6IG1zVmFsaWRhdGUKICB9LAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICB3aW5kb3cuX3h4ID0gdGhpczsKICAgIHJldHVybiB7CiAgICAgIC8vbW9kdWxlIGNow61uaCBj4bunYSBmb3JtCiAgICAgIG1vZHVsZTogbnVsbCwKICAgICAgLy9t4bufIGZvcm0g4bufIG1vZGUgbsOgbzogdGjDqm0sIHPhu61hLCBuaMOibiBi4bqjbgogICAgICBlZGl0TW9kZTogdGhpcy4kbXMuZW51bS5Gb3JtU3RhdGUuQWRkLAogICAgICAvL3Rpw6p1IMSR4buBIGPhu6dhIGZvcm0KICAgICAgdGl0bGU6IG51bGwsCiAgICAgIC8vZOG7ryBsaeG7h3UgYmluZGluZwogICAgICBjdXJyZW50SXRlbToge30sCgogICAgICAvKioNCiAgICAgICAqIFRPRE8geGVtIHjDqXQgY8OzIGTDuW5nIG3Ds24gbsOgeSBraMO0bmcNCiAgICAgICAqLwogICAgICBzdG9yZURldGFpbDogbnVsbCwKCiAgICAgIC8qKg0KICAgICAgICogRGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyBk4buvIGxp4buHdSBn4buRYyBj4bunYSBk4buvIGxp4buHdQ0KICAgICAgICovCiAgICAgIG9yaWdpbkZpZWxkczogW10sCgogICAgICAvKioNCiAgICAgICAqIGJp4bq/biBjw7MgY2hvIG3hurdjIMSR4buLbmggZm9jdXMga28NCiAgICAgICAqLwogICAgICBpc0F1dG9Gb2N1czogdHJ1ZSwKCiAgICAgIC8qKg0KICAgICAgICogxJBhbmcgeOG7rSBsw70gduG7m2kgc2VydmVyDQogICAgICAgKi8KICAgICAgbG9hZGluZzogZmFsc2UsCgogICAgICAvKioNCiAgICAgICAqIGThu68gbGnhu4d1IGPFqQ0KICAgICAgICovCiAgICAgIG9sZERhdGFJdGVtOiB7fSwKCiAgICAgIC8qKg0KICAgICAgICogbcO0IHThuqMgbmjhuq10IGvDvQ0KICAgICAgICovCiAgICAgIGRlc2NyaXB0aW9uQXVkaXRpbmdMb2c6IHsKICAgICAgICBtYXN0ZXI6IHt9LAogICAgICAgIGRldGFpbDogW10KICAgICAgfSwKCiAgICAgIC8qKg0KICAgICAgICogaMOgbmggxJHhu5luZyB0aGFvIHTDoWMgY+G7p2Egbmjhuq10IGvDvQ0KICAgICAgICovCiAgICAgIGFjdGlvbkF1ZGl0aW5nTG9nOiBudWxsLAoKICAgICAgLyoqDQogICAgICAgKiBkYW5oIHPDoWNoIGPDoWMgZmllbGQgY8OzIG5oaeG7gXUgY2FwdGlvbiAodGl0bGUpIHbDoCB0aGF5IMSR4buVaSB0aGVvIMSRaeG7gXUga2nhu4duIG7DoG8gxJHDsw0KICAgICAgICogdsOtIGThu6U6IGFjY291bnRPYmplY3RDb2RlOiBtw6MgbmjDoCBjdW5nIGPhuqVwICgtbuG6v3UgbMOgIG5ow6AgY2MpLCBtw6Mga2jDoWNoIGjDoG5nICgtbuG6v3UgbMOgIGtow6FjaCBow6BuZykuLi4uDQogICAgICAgKiB0dXkgbmhpw6puIHRow6wgdOG6oWkgMSB0aOG7nWkgxJFp4buDbSBjw6FjIGZpZWxkIG7DoHkgY2jhu4kgY8OzIDEgdGl0bGUgZHV5IG5o4bqldCB2w6AgY+G6p24gbMawdSB0aXRsZSBj4bunYSBuw7MgdsOgbyBsaXN0IG7DoHkgxJHhu4Mgc2F1IGPDsyB0aOG7gyBzaG93IG3DtCB04bqjIGNow61uaCB4w6FjDQogICAgICAgKiBEZW1vOiB7bWFzdGVyOnthY2NvdW50T2JqZWN0Q29kZTogMX19OyBraGkgZ2VuIGxvZyBz4bq9IG1hcGluZyBsw6AgOiBpMThuQXVkaXRpbmdsb2cuYXNzZXQubWFzdGVyLmFjY291bnRPYmplY3RDb2RlXzEgaG/hurdjIGkxOG5BdWRpdGluZ2xvZy5hc3NldC5kZXRhaWwuYWNjb3VudE9iamVjdENvZGVfMQ0KICAgICAgICovCiAgICAgIHN3aXRjaENhcHRpb246IHsKICAgICAgICBtYXN0ZXI6IHt9LAogICAgICAgIGRldGFpbDoge30KICAgICAgfSwKICAgICAgZW50aXR5U3RhdGU6IG51bGwsCgogICAgICAvKioNCiAgICAgICAqIEdp4buvIHThuqFtIHRo4budaSBjw6FjIGZpbGUgZGMgdGjDtG5nIHF1YSBraGkgdXBsb2FkDQogICAgICAgKi8KICAgICAgZmlsZVRlbXBzOiBbXSwKCiAgICAgIC8qKg0KICAgICAgICogQ8OzIGTDuW5nIHNob3J0a2V5IGtow7RuZw0KICAgICAgICovCiAgICAgIGhhc1Nob3J0S2V5OiB0cnVlLAoKICAgICAgLyoqDQogICAgICAgKiBQYXJhbQ0KICAgICAgICovCiAgICAgIHBhcmFtOiBudWxsCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHt9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICB2YXIgbWUgPSB0aGlzOwogICAgbWUuYWRkSGFuZGxlcigpOyAvL2luaXQgY2hhIGPhu6dhIGZvcm0gc+G6vSDEg24gcGjDrW0gdOG6r3QKCiAgICBpZiAobWUuaGFzU2hvcnRLZXkpIHsKICAgICAgdGhpcy4kbXMuY29tbW9uRm4uc2hvcnRrZXlQdXNoVmlldyh0aGlzLiRlbCk7CiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgY29udGV4dDogZnVuY3Rpb24gY29udGV4dCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlW01vZHVsZUNvbnRleHRdOwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLyoqDQogICAgICogWOG7rSBsw70gdGjDqm0gbeG7m2kNCiAgICAgKiBAcGFyYW0gZGF0YQ0KICAgICAqLwogICAgYWRkOiBmdW5jdGlvbiBhZGQocGFyYW0pIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIG1lLCBkYXRhOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM7IC8vR8OhbiBmb3JtIG1vZGUKCiAgICAgICAgICAgICAgICBtZS5zZXRGb3JtTW9kZShtZS4kbXMuZW51bS5Gb3JtU3RhdGUuQWRkKTsKICAgICAgICAgICAgICAgIG1lLmVudGl0eVN0YXRlID0gbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5JbnNlcnQ7IC8vbOG6pXkgZOG7ryBsaeG7h3UKCiAgICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5sb2FkRGF0YSgiTmV3IiwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIC8vQ+G6rXAgbmjhuq10IGThu68gbGnhu4d1IHbDoG8gY3VycmVudEl0ZW0KICAgICAgICAgICAgICAgIG1lLmJpbmREYXRhKGRhdGEpOyAvL3Jlc2V0IHZhbGlkYXRlCgogICAgICAgICAgICAgICAgbWUuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgaWYgKG1lLmlzQXV0b0ZvY3VzKSB7CiAgICAgICAgICAgICAgICAgICAgLy9mb2N1cyBmaXJzdCBjb250cm9sCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4uZm9jdXNGaXJzdENvbnRyb2xJbnB1dChtZS4kZWwpOwogICAgICAgICAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIG1lLnJlc2V0VmFsaWRhdGUoKTsgLy9D4bqtcCBuaOG6rXQgT2xkRGF0YSDEkeG7gyB0cmFjayBjaGFuZ2UKCiAgICAgICAgICAgICAgICAgIG1lLnNldE9sZERhdGFJdGVtKCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBHw6FuIHN0YXRlIGNobyBmb3JtDQogICAgICovCiAgICBzZXRGb3JtTW9kZTogZnVuY3Rpb24gc2V0Rm9ybU1vZGUobW9kZSkgewogICAgICB0aGlzLmVkaXRNb2RlID0gbW9kZTsgLy9j4bqtcCBuaOG6rXQgdGnDqnUgxJHhu4EgY2hvIGZvcm0KCiAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmdldEZvcm1UaXRsZShtb2RlKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGnDqnUgxJHhu4EgZm9ybQ0KICAgICAqLwogICAgZ2V0Rm9ybVRpdGxlOiBmdW5jdGlvbiBnZXRGb3JtVGl0bGUobW9kZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgdGl0bGUgPSBbXTsKICAgICAgdGl0bGUucHVzaChtZS4kbXMuY29tbW9uRm4uZ2V0RW51bVJlc291cmNlKG1vZGUsICJGb3JtU3RhdGUiKSk7CiAgICAgIHRpdGxlLnB1c2goKG1lLmdldE1vZHVsZU5hbWUoKSB8fCAiIikudG9Mb3dlckNhc2UoKSk7CiAgICAgIHJldHVybiB0aXRsZS5qb2luKCIgIik7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IHTDqm4gxJHhu5FpIHTGsOG7o25nIGPhu6dhIGZvcm0NCiAgICAgKiBOTVRVQU4zIDIvMTEvMjAyMQ0KICAgICAqLwogICAgZ2V0TW9kdWxlTmFtZTogZnVuY3Rpb24gZ2V0TW9kdWxlTmFtZSgpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIG1lLiR0KCJpMThuQ29tbW9uLm1vZHVsZS4iICsgKG1lLm1vZHVsZSB8fCAiIikudG9Mb3dlckNhc2UoKSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEJpbmQgZOG7ryBsaeG7h3UgY2hvIGZvcm0NCiAgICAgKi8KICAgIGJpbmREYXRhOiBmdW5jdGlvbiBiaW5kRGF0YShkYXRhKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7IC8vZGV0YWlscwoKICAgICAgaWYgKG1lLnN0b3JlRGV0YWlsKSB7CiAgICAgICAgLy8gTOG6pXkgc3RhdGUgY2hvIGPDoWMgUm93IHRyw6puIGdyaWQKICAgICAgICAvLyBCVkhBVSAxOS4wNS4yMDIwOiDhu54gbW9kZSBUaMOqbSB0aMOsIG3hurdjIMSR4buLbmggZOG7ryBsaeG7h3UgxJFhbmcga2jhu59pIHThuqFvIGNo4buJIGzDoCBkw7JuZyB04bqhbShpc1RlbXApCiAgICAgICAgdmFyIG9iamVjdFN0YXRlID0gewogICAgICAgICAgYXBwZW5kOiBmYWxzZSwKICAgICAgICAgIGlzVGVtcDogdHJ1ZQogICAgICAgIH07CgogICAgICAgIGZvciAodmFyIGtleSBpbiBtZS5zdG9yZURldGFpbCkgewogICAgICAgICAgdmFyIHN0b3JlID0gbWUuc3RvcmVEZXRhaWxba2V5XSwKICAgICAgICAgICAgICBkZXRhaWxEYXRhID0gZGF0YVtrZXldOwogICAgICAgICAgZGVsZXRlIGRhdGFba2V5XTsKCiAgICAgICAgICBpZiAoZGV0YWlsRGF0YSAmJiBBcnJheS5pc0FycmF5KGRldGFpbERhdGEpICYmIGRldGFpbERhdGEubGVuZ3RoID4gMCkgewogICAgICAgICAgICBzdG9yZS5sb2FkRGF0YShkZXRhaWxEYXRhLCBvYmplY3RTdGF0ZS5hcHBlbmQsIG9iamVjdFN0YXRlLmlzVGVtcCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdG9yZS5vd25lci5hZGROZXcoe30sIG9iamVjdFN0YXRlLmlzVGVtcCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vbWFzdGVyCgoKICAgICAgbWUuY3VycmVudEl0ZW0gPSBkYXRhOwogICAgICBtZS5iZWZvcmVCaW5kRGF0YSgpOwogICAgfSwKICAgIGJlZm9yZUJpbmREYXRhOiBmdW5jdGlvbiBiZWZvcmVCaW5kRGF0YSgpIHsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBz4butYQ0KICAgICAqIEBwYXJhbSBkYXRhDQogICAgICovCiAgICBlZGl0OiBmdW5jdGlvbiBlZGl0KHBhcmFtKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoKSB7CiAgICAgICAgdmFyIG1lLCBkYXRhOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzMjsKICAgICAgICAgICAgICAgIG1lLmVudGl0eVN0YXRlID0gbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5VcGRhdGU7IC8vbuG6v3Ugc+G7rWEgY8OzIHRydXnhu4FuIGThu68gbGnhu4d1IC0+IGJpbmRpbmcgZOG7ryBsaeG7h3UgdHJ1eeG7gW4gbMOqbiB0csaw4bubYyB0cm9uZyBraGkgxJFhbmcgY2jhu50gbG9hZCBk4buvIGxp4buHdSB04burIHNlcnZlcgoKICAgICAgICAgICAgICAgIGlmIChfdHlwZW9mKHBhcmFtLmRhdGEpID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICBtZS5jdXJyZW50SXRlbSA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmFtLmRhdGEpOwogICAgICAgICAgICAgICAgfSAvL0fDoW4gZm9ybSBtb2RlCgoKICAgICAgICAgICAgICAgIG1lLnNldEZvcm1Nb2RlKG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0KTsgLy9s4bqleSBk4buvIGxp4buHdQoKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNjsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5sb2FkRGF0YSgiRWRpdCIsIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgZGF0YSA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgLy9D4bqtcCBuaOG6rXQgZOG7ryBsaeG7h3UgdsOgbyBjdXJyZW50SXRlbQogICAgICAgICAgICAgICAgbWUuYmluZERhdGEoZGF0YSk7IC8vcmVzZXQgdmFsaWRhdGUKCiAgICAgICAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAobWUuaXNBdXRvRm9jdXMpIHsKICAgICAgICAgICAgICAgICAgICAvL2ZvY3VzIGZpcnN0IGNvbnRyb2wKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIG1lLiRtcy5jb21tb25Gbi5mb2N1c0ZpcnN0Q29udHJvbElucHV0KG1lLiRlbCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgbWUucmVzZXRWYWxpZGF0ZSgpOyAvL0Phuq1wIG5o4bqtdCBPbGREYXRhIMSR4buDIHRyYWNrIGNoYW5nZQoKICAgICAgICAgICAgICAgICAgbWUuc2V0T2xkRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gdmlldw0KICAgICAqIHB2ZHV5IDI3LzAyLzIwMjENCiAgICAgKiBAcGFyYW0gZGF0YQ0KICAgICAqLwogICAgdmlldzogZnVuY3Rpb24gdmlldyhwYXJhbSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHZhciBtZSwgZGF0YTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDQucHJldiA9IF9jb250ZXh0NC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczM7IC8vbuG6v3Ugc+G7rWEgY8OzIHRydXnhu4FuIGThu68gbGnhu4d1IC0+IGJpbmRpbmcgZOG7ryBsaeG7h3UgdHJ1eeG7gW4gbMOqbiB0csaw4bubYyB0cm9uZyBraGkgxJFhbmcgY2jhu50gbG9hZCBk4buvIGxp4buHdSB04burIHNlcnZlcgoKICAgICAgICAgICAgICAgIGlmIChfdHlwZW9mKHBhcmFtLmRhdGEpID09PSAib2JqZWN0IikgewogICAgICAgICAgICAgICAgICBtZS5jdXJyZW50SXRlbSA9IF9vYmplY3RTcHJlYWQoe30sIHBhcmFtLmRhdGEpOwogICAgICAgICAgICAgICAgfSAvL2zhuqV5IGThu68gbGnhu4d1CgoKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5sb2FkRGF0YSgiRWRpdCIsIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgZGF0YSA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgLy9D4bqtcCBuaOG6rXQgZOG7ryBsaeG7h3UgdsOgbyBjdXJyZW50SXRlbQogICAgICAgICAgICAgICAgbWUuYmluZERhdGEoZGF0YSk7IC8vR8OhbiBmb3JtIG1vZGUKCiAgICAgICAgICAgICAgICBtZS5zZXRGb3JtTW9kZShtZS4kbXMuZW51bS5Gb3JtU3RhdGUuVmlldyk7IC8vcmVzZXQgdmFsaWRhdGUKCiAgICAgICAgICAgICAgICBtZS4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICBpZiAobWUuaXNBdXRvRm9jdXMpIHsKICAgICAgICAgICAgICAgICAgICAvL2ZvY3VzIGZpcnN0IGNvbnRyb2wKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIG1lLiRtcy5jb21tb25Gbi5mb2N1c0ZpcnN0Q29udHJvbElucHV0KG1lLiRlbCk7CiAgICAgICAgICAgICAgICAgICAgfSwgMjAwKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgbWUucmVzZXRWYWxpZGF0ZSgpOyAvL0Phuq1wIG5o4bqtdCBPbGREYXRhIMSR4buDIHRyYWNrIGNoYW5nZQoKICAgICAgICAgICAgICAgICAgbWUuc2V0T2xkRGF0YUl0ZW0oKTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTmjDom4gYuG6o24NCiAgICAgKiBAcGFyYW0gZGF0YQ0KICAgICAqLwogICAgZHVwbGljYXRlOiBmdW5jdGlvbiBkdXBsaWNhdGUocGFyYW0pIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNSgpIHsKICAgICAgICB2YXIgbWUsIGRhdGE7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM0OyAvL27hur91IHPhu61hIGPDsyB0cnV54buBbiBk4buvIGxp4buHdSAtPiBiaW5kaW5nIGThu68gbGnhu4d1IHRydXnhu4FuIGzDqm4gdHLGsOG7m2MgdHJvbmcga2hpIMSRYW5nIGNo4budIGxvYWQgZOG7ryBsaeG7h3UgdOG7qyBzZXJ2ZXIKCiAgICAgICAgICAgICAgICBpZiAoX3R5cGVvZihwYXJhbS5kYXRhKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgICAgICAgICAgbWUuY3VycmVudEl0ZW0gPSBfb2JqZWN0U3ByZWFkKHt9LCBwYXJhbS5kYXRhKTsKICAgICAgICAgICAgICAgIH0gLy9Hw6FuIGZvcm0gbW9kZQoKCiAgICAgICAgICAgICAgICBtZS5zZXRGb3JtTW9kZShtZS4kbXMuZW51bS5Gb3JtU3RhdGUuRHVwbGljYXRlKTsgLy9s4bqleSBk4buvIGxp4buHdQoKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5sb2FkRGF0YSgiRHVwbGljYXRlIiwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBkYXRhID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgICAgICAvL0Phuq1wIG5o4bqtdCBk4buvIGxp4buHdSB2w6BvIGN1cnJlbnRJdGVtCiAgICAgICAgICAgICAgICBtZS5iaW5kRGF0YShkYXRhKTsgLy9yZXNldCB2YWxpZGF0ZQoKICAgICAgICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtZS5pc0F1dG9Gb2N1cykgewogICAgICAgICAgICAgICAgICAgIC8vZm9jdXMgZmlyc3QgY29udHJvbAogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLmZvY3VzRmlyc3RDb250cm9sSW5wdXQobWUuJGVsKTsKICAgICAgICAgICAgICAgICAgICB9LCAyMDApOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBtZS5yZXNldFZhbGlkYXRlKCk7IC8vQ+G6rXAgbmjhuq10IE9sZERhdGEgxJHhu4MgdHJhY2sgY2hhbmdlCgogICAgICAgICAgICAgICAgICBtZS5zZXRPbGREYXRhSXRlbSgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBH4buNaSBhcGkgbG9hZCBk4buvIGxp4buHdQ0KICAgICAqLwogICAgbG9hZERhdGE6IGZ1bmN0aW9uIGxvYWREYXRhKGFjdGlvbiwgcGFyYW0pIHsKICAgICAgdmFyIF90aGlzNSA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNigpIHsKICAgICAgICB2YXIgbWUsIHJlc3VsdCwgZGVmYXVsdERhdGEsIHBhcmFtUmVxdWVzdCwgbG9hZFBhcmFtOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzNTsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICBtZS5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5wcmV2ID0gMzsKICAgICAgICAgICAgICAgIC8veOG7rSBsw70gZOG7ryBsaeG7h3UgdHJ1eeG7gW4gbMOqbiDEkeG7gyBraMO0bmcgdHJ1eeG7gW4gZ+G7jWkgbMOqbiBzZXJ2ZXIKICAgICAgICAgICAgICAgIGRlZmF1bHREYXRhID0gcGFyYW0uZGF0YSB8fCB7fTsKICAgICAgICAgICAgICAgIHBhcmFtUmVxdWVzdCA9IE9iamVjdC5hc3NpZ24oe30sIHBhcmFtKTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBwYXJhbVJlcXVlc3QuZGF0YTsKCiAgICAgICAgICAgICAgICBpZiAobWUuaXNMb2NhbExvYWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9hZFBhcmFtID0gbWUuZ2V0TG9hZERhdGFQYXJhbWV0ZXIoYWN0aW9uLCBwYXJhbVJlcXVlc3QpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KG1lLm1vZHVsZSwgIi9nZXQiKSwgbG9hZFBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0Ni5zZW50OwoKICAgICAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX29iamVjdFNwcmVhZCh7fSwgZGVmYXVsdERhdGEpOwogICAgICAgICAgICAgICAgfSAvL3jhu60gbMO9IHRyxrDhu5tjIGtoaSByZW5kZXIKCgogICAgICAgICAgICAgICAgbWUucHJvY2Vzc0xvYWREYXRhKHJlc3VsdCwgYWN0aW9uLCBwYXJhbSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTY6CiAgICAgICAgICAgICAgICBfY29udGV4dDYucHJldiA9IDE2OwogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnQwID0gX2NvbnRleHQ2WyJjYXRjaCJdKDMpOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihfY29udGV4dDYudDApOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgX2NvbnRleHQ2LnByZXYgPSAxOTsKICAgICAgICAgICAgICAgIG1lLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuZmluaXNoKDE5KTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLCByZXN1bHQpOwoKICAgICAgICAgICAgICBjYXNlIDIzOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU2LCBudWxsLCBbWzMsIDE2LCAxOSwgMjJdXSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIGdldEF1dG9JRDogZnVuY3Rpb24gZ2V0QXV0b0lEKCkgewogICAgICB2YXIgX3RoaXM2ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciByZXN1bHQsIG1lOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZXN1bHQgPSAiIiwgbWUgPSBfdGhpczY7CiAgICAgICAgICAgICAgICBfY29udGV4dDcucHJldiA9IDE7CiAgICAgICAgICAgICAgICBfY29udGV4dDcubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuJHN0b3JlLmRpc3BhdGNoKCIiLmNvbmNhdChtZS5tb2R1bGUsICIvZ2V0QXV0b0lEIikpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX2NvbnRleHQ3LnByZXYgPSA3OwogICAgICAgICAgICAgICAgX2NvbnRleHQ3LnQwID0gX2NvbnRleHQ3WyJjYXRjaCJdKDEpOwogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihfY29udGV4dDcudDApOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTcsIG51bGwsIFtbMSwgN11dKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGThu68gbGnhu4d1IGNsaWVudCBzYXUga2hpIGxvYWQgdOG7qyBzZXJ2ZXIgduG7gSB0csaw4bubYyBraGkgYmluZGluZw0KICAgICAqLwogICAgcHJvY2Vzc0xvYWREYXRhOiBmdW5jdGlvbiBwcm9jZXNzTG9hZERhdGEoZGF0YSwgYWN0aW9uLCBwYXJhbSkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL3jhu60gbMO9IGThu68gbGnhu4d1IG3hu58gcuG7mW5nCgogICAgICBtZS5vcmlnaW5GaWVsZHMgPSBbXTsKCiAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KCJFeHREYXRhIikpIHsKICAgICAgICAvL0Rhbmggc8OhY2ggY8OhYyB0csaw4budbmcgZOG7ryBsaeG7h3UgZ+G7kWMgY+G7p2EgZOG7ryBsaeG7h3UKICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHsKICAgICAgICAgIG1lLm9yaWdpbkZpZWxkcy5wdXNoKGkpOwogICAgICAgIH0gLy9tYXAgZOG7ryBsaeG7h3UgbeG7nyBy4buZbmcKCgogICAgICAgIGlmIChkYXRhLkV4dERhdGEgJiYgdHlwZW9mIGRhdGEuRXh0RGF0YSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIHZhciBleHREYXRhID0gSlNPTi5wYXJzZShkYXRhLkV4dERhdGEpOwoKICAgICAgICAgIGlmIChleHREYXRhKSB7CiAgICAgICAgICAgIG1lLiRtcy5jb21tb25Gbi5wcm9jZXNzU2VydmVyUmVzcG9uc2VEYXRhKGV4dERhdGEpOwoKICAgICAgICAgICAgZm9yICh2YXIgbSBpbiBleHREYXRhKSB7CiAgICAgICAgICAgICAgLy9jaOG7iSBtYXAgY8OhYyB0csaw4budbmcga2jDtG5nIGPDsyB0cm9uZyBk4buvIGxp4buHdSBn4buRYwogICAgICAgICAgICAgIGlmIChtZS5vcmlnaW5GaWVsZHMuaW5kZXhPZihtKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIGRhdGFbbV0gPSBleHREYXRhW21dOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvL3jhu60gbMO9IG3hurdjIMSR4buLbmggcXVpY2tBZGRUZXh0IHbDoG8gdHLGsOG7nW5nIHRleHQKCgogICAgICBpZiAocGFyYW0gJiYgcGFyYW0ucXVpY2tBZGRUZXh0KSB7CiAgICAgICAgdmFyIGZjZiA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICAgIGlmIChmY2YubmFtZSAmJiAhZGF0YVtmY2YubmFtZV0pIHsKICAgICAgICAgIGRhdGFbZmNmLm5hbWVdID0gcGFyYW0ucXVpY2tBZGRUZXh0OwogICAgICAgIH0KICAgICAgfSAvLyBOREhVWSAxMy4wOS4yMDIxIEPhuq1wIG5o4bqtdCBlbnRpdHkgc3RhdGUgY2hvIGVudGl0eQoKCiAgICAgIGRhdGEuRW50aXR5U3RhdGUgPSBtZS5lbnRpdHlTdGF0ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGhhbSBz4buRIGxvYWQgZOG7ryBsaeG7h3UgY2hvIGZvcm0NCiAgICAgKi8KICAgIGdldExvYWREYXRhUGFyYW1ldGVyOiBmdW5jdGlvbiBnZXRMb2FkRGF0YVBhcmFtZXRlcihhY3Rpb24sIHBhcmFtKSB7CiAgICAgIHZhciByZXN1bHQgPSB7CiAgICAgICAgYWN0aW9uOiBhY3Rpb24KICAgICAgfTsKCiAgICAgIHN3aXRjaCAoYWN0aW9uKSB7CiAgICAgICAgY2FzZSAiRWRpdCI6CiAgICAgICAgY2FzZSAiVmlldyI6CiAgICAgICAgY2FzZSAiRHVwbGljYXRlIjoKICAgICAgICAgIHJlc3VsdC5pZCA9IHBhcmFtLmlkOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gbOG6pXkgZ2nDoSB0cuG7iyBj4bunYSBjdXJyZW50SXRlbQ0KICAgICAqICAqLwogICAgZ2V0Q3VycmVudEl0ZW06IGZ1bmN0aW9uIGdldEN1cnJlbnRJdGVtKCkgewogICAgICByZXR1cm4gdGhpcy5jdXJyZW50SXRlbTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBs4bqleSBnacOhIHRy4buLIGPFqSBj4bunYSBmb3JtDQogICAgICogQ3JlYXRlZCBieSBMVERBVCgyMi4wNi4yMjAyMCkNCiAgICAgKi8KICAgIGdldE9sZERhdGFJdGVtOiBmdW5jdGlvbiBnZXRPbGREYXRhSXRlbSgpIHsKICAgICAgcmV0dXJuIHRoaXMub2xkRGF0YUl0ZW07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gdGjhu7FjIGhp4buHbiBzZXQgZ2nDoSB0cuG7iyBjaG8gb2xkRGF0YSBt4bq3YyDEkeG7i25oIGzDoCBnacOhIHRy4buLIGJhbiDEkeG6p3Uga2hpIG3hu58gZm9ybQ0KICAgICAqIEjDoG0gbsOgeSDEkcaw4bujYyBn4buNaSB0cm9uZyBow6BtIG3hu58gZm9ybSBzaG93UG9wdXAoKQ0KICAgICAqLwogICAgc2V0T2xkRGF0YUl0ZW06IGZ1bmN0aW9uIHNldE9sZERhdGFJdGVtKCkgewogICAgICB2YXIgY3VycmVudEl0ZW0gPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHRoaXMuY3VycmVudEl0ZW07CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG1lLm9sZERhdGFJdGVtID0gXy5jbG9uZURlZXAoY3VycmVudEl0ZW0pOwogICAgfSwKCiAgICAvKg0KICAgICAqIEjDoG0gcmVzZXQgbOG6oWkgZ2nDoSB0cuG7iw0KICAgICAqIHB2ZHV5IDAyLzA3LzIwMjE6IHBo4bulYyB24bulIG3hu6VjIMSRw61jaCBraGkgdMOtY2ggY2jhu6ljIG7Eg25nIHggdHLDqm4gY29udHJvbCBtc2NvbnRyb2wgZmllbGQNCiAgICAgKi8KICAgIHJlc2V0RGF0YTogZnVuY3Rpb24gcmVzZXREYXRhKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgZm9yICh2YXIgZmllbGQgaW4gbWUuY3VycmVudEl0ZW0pIHsKICAgICAgICBpZiAobWUuY3VycmVudEl0ZW0uaGFzT3duUHJvcGVydHkoZmllbGQpKSB7CiAgICAgICAgICBtZS5jdXJyZW50SXRlbVtmaWVsZF0gPSBtZS5vbGREYXRhSXRlbVtmaWVsZF07CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgZGF0YSA9IG1lLmN1cnJlbnRJdGVtOwoKICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoIkV4dERhdGEiKSkgewogICAgICAgIC8vRGFuaCBzw6FjaCBjw6FjIHRyxrDhu51uZyBk4buvIGxp4buHdSBn4buRYyBj4bunYSBk4buvIGxp4buHdQogICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkgewogICAgICAgICAgbWUub3JpZ2luRmllbGRzLnB1c2goaSk7CiAgICAgICAgfSAvL21hcCBk4buvIGxp4buHdSBt4bufIHLhu5luZwoKCiAgICAgICAgaWYgKGRhdGEuRXh0RGF0YSAmJiB0eXBlb2YgZGF0YS5FeHREYXRhID09PSAic3RyaW5nIikgewogICAgICAgICAgdmFyIGV4dERhdGEgPSBKU09OLnBhcnNlKGRhdGEuRXh0RGF0YSk7CgogICAgICAgICAgaWYgKGV4dERhdGEpIHsKICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLnByb2Nlc3NTZXJ2ZXJSZXNwb25zZURhdGEoZXh0RGF0YSk7CgogICAgICAgICAgICBmb3IgKHZhciBtIGluIGV4dERhdGEpIHsKICAgICAgICAgICAgICAvL2No4buJIG1hcCBjw6FjIHRyxrDhu51uZyBraMO0bmcgY8OzIHRyb25nIGThu68gbGnhu4d1IGfhu5FjCiAgICAgICAgICAgICAgaWYgKG1lLm9yaWdpbkZpZWxkcy5pbmRleE9mKG0pID09PSAtMSkgewogICAgICAgICAgICAgICAgZGF0YVttXSA9IGV4dERhdGFbbV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0geOG7rSBsw70gY8OhYyBz4buxIGtp4buHbiBj4bunYSBmb3JtDQogICAgICogQGNvbW1hbmQgOiBnacOhIHRy4buLIHTGsMahbmcg4bupbmcgduG7m2kgdOG7q25nIGFjdGlvbiBuaMawIDpTYXZlLENsb3NlLFNhdmVBbmRBZGQsLi4uDQogICAgICovCiAgICB0b29sYmFyQWN0aW9uOiBmdW5jdGlvbiB0b29sYmFyQWN0aW9uKGNvbW1hbmQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHN3aXRjaCAoY29tbWFuZCkgewogICAgICAgIGNhc2UgIlNhdmUiOgogICAgICAgICAgbWUuc2F2ZSh0aGlzLiRtcy5lbnVtLlNhdmVNb2RlLlNhdmUpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIlNhdmVBbmRBZGQiOgogICAgICAgICAgbWUuc2F2ZSh0aGlzLiRtcy5lbnVtLlNhdmVNb2RlLlNhdmVOZXcpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkNsb3NlIjoKICAgICAgICAgIHsKICAgICAgICAgICAgbWUuY2xvc2UoKTsKICAgICAgICAgIH0KICAgICAgfSAvL21lLmxvZ0RhdGFGaXJlQmFzZSgpOwoKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGjDtG5nIHRpbiBsb2cgZmlyZWJhc2UNCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqLwogICAgbG9nRGF0YUZpcmVCYXNlOiBmdW5jdGlvbiBsb2dEYXRhRmlyZUJhc2UoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICB0cnkgewogICAgICAgIHZhciBtZW51TmFtZUN1cnJlbnQgPSBudWxsOwogICAgICAgIHZhciBwYXJlbnQgPSBtZS4kcGFyZW50OwoKICAgICAgICBpZiAobWUuJHJvdXRlciB8fCBtZS4kJHJvdXRlcikgewogICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gbWUuJHJvdXRlID8gbWUuJHJvdXRlLm5hbWUgOiBtZS4kJHJvdXRlLm5hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYXJlbnQgJiYgKHBhcmVudC4kcm91dGVyIHx8IHBhcmVudC4kJHJvdXRlcikpIHsKICAgICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gcGFyZW50LiRyb3V0ZXIgPyBwYXJlbnQuJHJvdXRlLm5hbWUgOiBwYXJlbnQuJCRyb3V0ZS5uYW1lOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1lbnVOYW1lQ3VycmVudCkgewogICAgICAgICAgY29tbW9uRm4ubG9nRGF0YUZpcmVCYXNlVXBkYXRlKG1lbnVOYW1lQ3VycmVudCwgbWUuY29udGV4dCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGNvbnNvbGUubG9nKGV4KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBwaMOtbSB04bqvdA0KICAgICAqLwogICAgLy8gc2hvcnRrZXlBY3Rpb24oZSkgewogICAgLy8gICBsZXQgbWUgPSB0aGlzOwogICAgLy8gCXN3aXRjaCAoZS5zcmNLZXkpIHsKICAgIC8vIAkJY2FzZSAnU2F2ZSc6CiAgICAvLyAJCQltZS5zYXZlKHRoaXMuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZSk7CiAgICAvLyAgICAgICBicmVhazsKICAgIC8vICAgICBjYXNlICdTYXZlQW5kQWRkJzoKICAgIC8vICAgICAgIG1lLnNhdmUodGhpcy4kbXMuZW51bS5TYXZlTW9kZS5TYXZlTmV3KTsKICAgIC8vICAgICAgIGJyZWFrOwogICAgLy8gICAgIGNhc2UgJ1ByaW50JzoKICAgIC8vICAgICAgIG1lLnByaW50KCk7CiAgICAvLyAgICAgICBicmVhazsKICAgIC8vICAgICBkZWZhdWx0OgogICAgLy8gICAgICAgYnJlYWs7CiAgICAvLyAJfQogICAgLy8gfSwKICAgIC8vaW4KICAgIHByaW50OiBmdW5jdGlvbiBwcmludCgpIHt9LAoKICAgIC8qKg0KICAgICAqIHNldCBk4buvIGxp4buHdSBjaG8gY3VycmVudEl0ZW0NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDI1LjA2LjIwMjApDQogICAgICovCiAgICBzZXRDdXJyZW50SXRlbTogZnVuY3Rpb24gc2V0Q3VycmVudEl0ZW0oZGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5jdXJyZW50SXRlbSA9IGRhdGE7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gdmFsaWRhdGUNCiAgICAgKiBDaOG6oXkgcXVhIGjDoG0gdmFsaWRhdGUgY2hvIGNvbnRyb2wgdsOgIHZhbGlkYXRlIGNobyBuZ2hp4buHcCB24bulDQogICAgICogQHJldHVybiB0cuG6oyB24buBIHRydWUvZmFsc2UNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUICgyMi4wNi4yMDIwKQ0KICAgICAqLwogICAgdmFsaWRhdGU6IGZ1bmN0aW9uIHZhbGlkYXRlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUudmFsaWRhdGVDb21wb25lbnRzKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHZhbGlkYXRlIEZpbGUNCiAgICAgKi8KICAgIHZhbGlkYXRlRmlsZTogZnVuY3Rpb24gdmFsaWRhdGVGaWxlKGZpbGVzKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICB2YWxpZCA9IHRydWU7CiAgICAgIG1lLmZpbGVUZW1wcyA9IFtdOwogICAgICBmaWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7CiAgICAgICAgdmFyIGRhdGEgPSBmaWxlLm5hbWUuc3BsaXQoIi4iKTsgLy9O4bq/dSBraMO0bmcgY8OzIGV4dGVuc2lvbiAtPiBmYWlsCgogICAgICAgIGlmIChkYXRhLmxlbmd0aCA8IDIpIHsKICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dFcnJvcihtZS4kdCgiaTE4bkNvbXBvbmVudC5BdHRhY2htZW50LkZpbGVOYW1lSW52YWxpZCIpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHZhciBleHQgPSBkYXRhLmxhc3QoKS50b0xvd2VyQ2FzZSgpOwoKICAgICAgICBpZiAod2luZG93Ll9maWxlQ29uZmlnICYmICF3aW5kb3cuX2ZpbGVDb25maWcuVXBsb2FkQWxsb3dFeHRlbnNpb24uY29udGFpbnMoZXh0KSkgewogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0Vycm9yKG1lLiR0KCJpMThuQ29tcG9uZW50LkF0dGFjaG1lbnQuRmlsZUV4dGVuc2lvbkludmFsaWQiKSk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAod2luZG93Ll9maWxlQ29uZmlnICYmIGZpbGUuc2l6ZSA+IHdpbmRvdy5fZmlsZUNvbmZpZy5VcGxvYWRNYXhTaXplTUIgKiAxMDI0ICogMTAyNCkgewogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0Vycm9yKG1lLiR0KCJpMThuQ29tcG9uZW50LkF0dGFjaG1lbnQuRmlsZUxhcmdlcjVNQiIpKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh2YWxpZCkgewogICAgICAgICAgbWUuZmlsZVRlbXBzLnB1c2goZmlsZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIHZhbGlkOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIHZhbGlkYXRlIGPDoWMgY29udHJvbCBpbnB1dA0KICAgICAqIEjDoG0gbsOgeSBz4butIGThu6VuZyBjb21wb25lbnQgbXMtdmFsaWRhdGUNCiAgICAgKiDEkeG7gyBiYW8gbmdvw6BpIHbDuW5nIMSRxrDhu6NjIHZhbGlkYXRlDQogICAgICogQENow7ogw706cmVmIGPhu6dhIG1zLXZhbGlkYXRlIHBo4bqjaSBsw6AgdmFsaWRhdGVPYnNlcnZlcg0KICAgICAqIENyZWF0ZWQgYnkgTFREQVQoMTguMDYuMjAyMCkNCiAgICAgKi8KICAgIHZhbGlkYXRlQ29tcG9uZW50czogZnVuY3Rpb24gdmFsaWRhdGVDb21wb25lbnRzKCkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL3JlZnMgY+G7p2EgbXMtdmFsaWRhdGUKCiAgICAgIGlmIChtZS4kcmVmcy52YWxpZGF0ZU9ic2VydmVyKSB7CiAgICAgICAgcmV0dXJuIG1lLiRyZWZzLnZhbGlkYXRlT2JzZXJ2ZXIudmFsaWRhdGUoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gZMO5bmcgxJHhu4MgZm9jdXMgdsOgbyDDtCBs4buXaSDEkeG6p3UgdGnDqm4NCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDIyLjA2LjIwMjApDQogICAgICogTW9kaWZ5IGJ5IMSQVlRoaSAxOC8wMy8yMDIxOiBLaMO0bmcgdMOsbSDEkcaw4bujYyBjb250cm9sIGzhu5dpIHRow6wga2jDtG5nIGLhuq9uIGzhu5dpIFRBDQogICAgICogKi8KICAgIGZvY3VzRmlyc3RFcnJvcjogZnVuY3Rpb24gZm9jdXNGaXJzdEVycm9yKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLiRyZWZzLnZhbGlkYXRlT2JzZXJ2ZXIpIHsKICAgICAgICB2YXIgbGlzdEVycm9yID0gbWUuJHJlZnMudmFsaWRhdGVPYnNlcnZlci5nZXRMaXN0RXJyb3IoKTsKCiAgICAgICAgaWYgKGxpc3RFcnJvciAmJiBsaXN0RXJyb3IubGVuZ3RoID4gMCAmJiBsaXN0RXJyb3JbMF0uZWxlbWVudCkgewogICAgICAgICAgaWYgKHR5cGVvZiBsaXN0RXJyb3JbMF0uZWxlbWVudC5mb2N1c0VkaXRvciA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIGxpc3RFcnJvclswXS5lbGVtZW50LmNlbGxTZWxlY3RlZCgpOwogICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbGlzdEVycm9yWzBdLmVsZW1lbnQuZm9jdXMgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBsaXN0RXJyb3JbMF0uZWxlbWVudC5mb2N1cygpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBD4bqtcCBuaOG6rXQgbOG6oWkgdHLhuqFuZyB0aMOhaSB2YWxpZGF0ZSB24buBIGJhbiDEkeG6p3UNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDIzLjA2LjIwMjApDQogICAgICovCiAgICByZXNldFZhbGlkYXRlOiBmdW5jdGlvbiByZXNldFZhbGlkYXRlKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLiRyZWZzLnZhbGlkYXRlT2JzZXJ2ZXIpIHsKICAgICAgICBtZS4kcmVmcy52YWxpZGF0ZU9ic2VydmVyLnJlc2V0KCk7CiAgICAgIH0KICAgIH0sCiAgICAvL0jDoG0geOG7rSBsw70gc+G7sSBraeG7h24gbMawdSBmb3JtCiAgICAvL0NyZWF0ZWQgYnkgTFREQVQoMTguMDYuMjAyMCkKICAgIC8vUFZEVVkgMjcvMDIvMjAyMSA6IGzhuqV5IGThu68gbGnhu4d1IHRow6ptIGNobyBtb2RlIHZpZXcKICAgIHNhdmU6IGZ1bmN0aW9uIHNhdmUobW9kZSkgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICAgIHZhciBtZTsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczc7CiAgICAgICAgICAgICAgICBtZS5sb2FkaW5nID0gdHJ1ZTsgLy8gdnZraWV0IC0gMTIuMDQuMjAyMTogVGjhu7FjIGhp4buHbiBjw6FjIGPDtG5nIHZp4buHYyB0csaw4bubYyBraGkgc2F2ZQoKICAgICAgICAgICAgICAgIF9jb250ZXh0OC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5iZWZvcmVTYXZlKCk7CgogICAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmIChtZS52YWxpZGF0ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZU1vZGUgPSB0eXBlb2YgbW9kZSA9PT0gIm51bWJlciIgPyBtb2RlIDogbWUuJG1zLmVudW0uU2F2ZU1vZGUuU2F2ZTsgLy9O4bq/dSBlZGl0IGzDoCB1cGRhdGUsIG7hur91IGFkZCBob+G6t2MgZHVwbGljYXRlIGzDoCBpbnNlcnQKCiAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uID0gbWUuZWRpdE1vZGUgPT09IG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0IHx8IG1lLmVkaXRNb2RlID09PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuVmlldyA/ICJ1cGRhdGUiIDogImluc2VydCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZW50aXR5ID0gbWUuZ2V0U2F2ZURhdGEoc2F2ZU1vZGUsIG1lLmVudGl0eVN0YXRlIHx8IG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuSW5zZXJ0KTsKICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlUGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE1vZGU6IHNhdmVNb2RlLAogICAgICAgICAgICAgICAgICAgICAgICBFbnRpdHk6IGVudGl0eSwKICAgICAgICAgICAgICAgICAgICAgICAgQnlQYXNzVmFsaWRhdGU6IFtdCiAgICAgICAgICAgICAgICAgICAgICB9OyAvL3ZhbGlkYXRlIGFuZCBzdWJtaXQKCiAgICAgICAgICAgICAgICAgICAgICBtZS5zdWJtaXRBY3Rpb24oc2F2ZVBhcmFtLCBhY3Rpb24pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBtZS5mb2N1c0ZpcnN0RXJyb3IoKTsKICAgICAgICAgICAgICAgICAgICAgIG1lLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgICAgICBtZS5sb2FkaW5nID0gZmFsc2U7IC8vIH0gZmluYWxseXsKICAgICAgICAgICAgICAgICAgICAvLyAgVE9ETyBibmR1YzogYuG7jyBjaOG7lyBuw6B5IMSRaSB2w6wgbuG6v3UgZXhjZXB0aW9uIHRow6wgxJHDoyBn4buNaSB04bqvdCBjw7JuIHN1Y2Nlc3MgdGjDrCB0cm9uZyBow6BtIHN1Ym1pdEFjdGlvbiBz4bq9IHThuq90IGPhu50gbG9hZGluZwogICAgICAgICAgICAgICAgICAgIC8vICAgbWUubG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB3aW5kb3cuX2FwcENvbmZpZy5zYXZlVGltZW91dCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBH4buNaSB2YWxpZGF0ZSBjbGllbnQgdsOgIHN1Ym1pdCBk4buvIGxp4buHdSBsw6puIHNlcnZlcg0KICAgICAqIHTDoWNoIHJhIHBo4bulYyB24bulIGfhu41pIGzhuqFpIGNobyBsdeG7k25nIGjhu49pIG5nxrDhu51pIGTDuW5nIGtoaSBuaOG6pW4gc2F2ZQ0KICAgICAqLwogICAgc3VibWl0QWN0aW9uOiBmdW5jdGlvbiBzdWJtaXRBY3Rpb24oc2F2ZVBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHZhbGlkYXRlUmVzdWx0ID0gbWUudmFsaWRhdGVCdXNpbmVzcyhzYXZlUGFyYW0sIGFjdGlvbik7CgogICAgICBpZiAodmFsaWRhdGVSZXN1bHQpIHsKICAgICAgICBpZiAobWUuY2hlY2tFZGl0UGFyYW0oKSkgewogICAgICAgICAgLy8gR+G7jWkgxJHhur9uIHVwZGF0ZSB0csaw4budbmcgY+G7p2EgYuG6o25nIFVzYWdlSGlzdG9yeQogICAgICAgICAgbWUuc3VibWl0RWRpdEZvcm0oc2F2ZVBhcmFtLCBhY3Rpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvL3N1Ym1pdCBzZXJ2ZXIKICAgICAgICAgIG1lLnN1Ym1pdChzYXZlUGFyYW0sIGFjdGlvbik7CiAgICAgICAgfSAvL0xvZyBmaXJlYmFzZQogICAgICAgIC8vIG1lLmxvZ0RhdGFGaXJlQmFzZSgpOwoKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5sb2FkaW5nID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQ+G6pXQgayB2YWxpZGF0ZQ0KICAgICAqIE5OTEFNDQogICAgICovCiAgICBzYXZlTm90VmFsaWRhdGU6IGZ1bmN0aW9uIHNhdmVOb3RWYWxpZGF0ZShtb2RlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBzYXZlTW9kZSA9IHR5cGVvZiBtb2RlID09PSAibnVtYmVyIiA/IG1vZGUgOiBtZS4kbXMuZW51bS5TYXZlTW9kZS5TYXZlOyAvL07hur91IGVkaXQgbMOgIHVwZGF0ZSwgbuG6v3UgYWRkIGhv4bq3YyBkdXBsaWNhdGUgbMOgIGluc2VydAoKICAgICAgdmFyIGFjdGlvbiA9IG1lLmVkaXRNb2RlID09PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuRWRpdCB8fCBtZS5lZGl0TW9kZSA9PT0gbWUuJG1zLmVudW0uRm9ybVN0YXRlLlZpZXcgPyAidXBkYXRlIiA6ICJpbnNlcnQiLAogICAgICAgICAgZW50aXR5ID0gbWUuZ2V0U2F2ZURhdGEoc2F2ZU1vZGUsIG1lLmVudGl0eVN0YXRlIHx8IG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuSW5zZXJ0KTsKICAgICAgdmFyIHNhdmVQYXJhbSA9IHsKICAgICAgICBNb2RlOiBzYXZlTW9kZSwKICAgICAgICBFbnRpdHk6IGVudGl0eSwKICAgICAgICBCeVBhc3NWYWxpZGF0ZTogW10KICAgICAgfTsKCiAgICAgIGlmIChtZS5jaGVja0VkaXRQYXJhbSgpKSB7CiAgICAgICAgLy8gR+G7jWkgxJHhur9uIHVwZGF0ZSB0csaw4budbmcgY+G7p2EgYuG6o25nIFVzYWdlSGlzdG9yeQogICAgICAgIG1lLnN1Ym1pdEVkaXRGb3JtKHNhdmVQYXJhbSwgYWN0aW9uKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS5zdWJtaXQoc2F2ZVBhcmFtLCBhY3Rpb24pOwogICAgICB9CgogICAgICBtZS5oaWRlKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgY2hlY2tFZGl0UGFyYW06IGZ1bmN0aW9uIGNoZWNrRWRpdFBhcmFtKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuaXNVcGRhdGVOb3RlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBraGkgY+G6pXQgbOG7l2kNCiAgICAgKiAqLwogICAgcHJvY2Vzc1N1Ym1pdEVycm9yOiBmdW5jdGlvbiBwcm9jZXNzU3VibWl0RXJyb3Ioc2F2ZVJlc3VsdCwgcGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChzYXZlUmVzdWx0LkNvZGUpIHsKICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGUuSW52YWxpZERhdGE6CiAgICAgICAgICB2YXIgZXJyb3JzID0gc2F2ZVJlc3VsdC5EYXRhLAogICAgICAgICAgICAgIGFsZXJ0ID0gZmFsc2UsCiAgICAgICAgICAgICAgdW5jb25maXJtID0gZmFsc2UsCiAgICAgICAgICAgICAgc2hvd0Vycm9yID0gZnVuY3Rpb24gc2hvd0Vycm9yKGluZGV4KSB7CiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gZXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgICAgIGlmICghYWxlcnQgJiYgIXVuY29uZmlybSkgewogICAgICAgICAgICAgICAgLy9u4bq/dSBuZ8aw4budaSBkw7luZyB4w6FjIG5o4bqtbiB0b8OgbiBi4buZIGNvbmZpcm0gdGjDrCBz4bq9IHN1Ym1pdCBs4bqhaQogICAgICAgICAgICAgICAgbWUuc3VibWl0KHBhcmFtLCBhY3Rpb24pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgZXIgPSBlcnJvcnNbaW5kZXhdOwoKICAgICAgICAgICAgaWYgKCFlci5NZXNzYWdlICYmIGVyLkNvZGUpIHsKICAgICAgICAgICAgICBlci5NZXNzYWdlID0gbWUuZ2V0VmFsaWRhdGVNZXNzYWdlKGVyLkNvZGUsIGVyLkRhdGEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzd2l0Y2ggKGVyLlR5cGUpIHsKICAgICAgICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLlZhbGlkYXRlUmVzdWx0VHlwZS5JbmZvOgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93SW5mbyhlci5NZXNzYWdlKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgc2hvd0Vycm9yKGluZGV4ICsgMSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLlZhbGlkYXRlUmVzdWx0VHlwZS5XYXJuaW5nOgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93UXVlc3Rpb24oewogICAgICAgICAgICAgICAgICBtZXNzYWdlOiBlci5NZXNzYWdlCiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChhbnN3ZXIpIHsKICAgICAgICAgICAgICAgICAgaWYgKGFuc3dlciA9PT0gIlllcyIpIHsKICAgICAgICAgICAgICAgICAgICBwYXJhbS5CeVBhc3NWYWxpZGF0ZSA9IHBhcmFtLkJ5UGFzc1ZhbGlkYXRlIHx8IFtdOwogICAgICAgICAgICAgICAgICAgIHBhcmFtLkJ5UGFzc1ZhbGlkYXRlLnB1c2goZXIuQ29kZSk7IC8vIHZ2a2lldCAtIDI0LjA4LjIwMjE6IELhu5Ugc3VuZyBow6BtIMSR4buDIGN1c3RvbSBs4bqhaSBwYXJhbQoKICAgICAgICAgICAgICAgICAgICBtZS5jdXN0b21QYXJhbUJ5UGFzc1ZhbGlkYXRlKHBhcmFtLCBlci5EYXRhKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIHNob3dFcnJvcihpbmRleCArIDEpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHVuY29uZmlybSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgYWxlcnQgPSB0cnVlOwogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93RXJyb3IoZXIuTWVzc2FnZSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHNob3dFcnJvcihpbmRleCArIDEpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfTsgLy9T4bqvcCB44bq/cCDEkeG7gyBjb25maXJtIGN14buRaSBjw7luZwogICAgICAgICAgLy/EkFZUaGkgMDkvMDMvMjAyMQogICAgICAgICAgLy9z4butYSBs4buXaSBUQSBraMO0bmcgc+G6r3AgeOG6v3AgxJHGsOG7o2MgZG8gdHJ1eeG7gW4gc2FpIGtp4buDdSBj4bunYSB0aGFtIHPhu5EgY2hvIGjDoG0gc+G6r3AgeOG6v3AKICAgICAgICAgIC8vIGVycm9ycyA9IGVycm9ycy5zb3J0T2JqZWN0KFsiVHlwZSJdKTsKICAgICAgICAgIC8vSGnhu4NuIHRo4buLIHRow7RuZyBiw6FvCgoKICAgICAgICAgIHNob3dFcnJvcigwKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGUuRXhjZXB0aW9uOgogICAgICAgICAgaWYgKHNhdmVSZXN1bHQuU3lzdGVtTWVzc2FnZSkgewogICAgICAgICAgICBtZS4kbXMubXNnQm94LnNob3dFcnJvcihzYXZlUmVzdWx0LlN5c3RlbU1lc3NhZ2UpOwogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwogICAgICAgIC8vxJBWVGhpIDE5LzAzLzIwMjE6IFRow7RuZyBiw6FvIGzhu5dpIHbGsOG7o3QgcXXDoSBz4buRIGzGsOG7o25nIHThu5NuCgogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uU2VydmljZVJlc3BvbnNlQ29kZS5PdmVyUXVhbnRpdHk6CiAgICAgICAgICB2YXIgc3RyRXJyb3JPdmVyUXVhbnRpdHkgPSBtZS5nZXRWYWxpZGF0ZU1lc3NhZ2Uoc2F2ZVJlc3VsdC5TeXN0ZW1NZXNzYWdlKTsKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0Vycm9yKHN0ckVycm9yT3ZlclF1YW50aXR5KTsKICAgICAgICAgIG1lLnByb2Nlc3NNYXJrQ29udHJvbEZvck92ZXJRdWFudGl0eUVycm9yKHNhdmVSZXN1bHQuU3ViQ29kZSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChzYXZlUmVzdWx0Lk1lc3NhZ2UpIHsKICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93RXJyb3Ioc2F2ZVJlc3VsdC5NZXNzYWdlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lLnNob3dDdXN0b21FcnJvcihzYXZlUmVzdWx0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiDEkFZUaGkgMTkvMDMvMjAyMQ0KICAgICAqIFNhdSBraGkgdsaw4bujdCBxdWEgc+G7kSBsxrDhu6NuZyB04buTbiB0aMOsIGNobyBwaMOpcCBkZXYgdMO5eSBiaeG6v24gZm9jdXMgdsOgbyBjw6FjIGPhu5l0IHPhu5kgbMaw4bujbmcgYuG7iyBs4buXaQ0KICAgICAqLwogICAgcHJvY2Vzc01hcmtDb250cm9sRm9yT3ZlclF1YW50aXR5RXJyb3I6IGZ1bmN0aW9uIHByb2Nlc3NNYXJrQ29udHJvbEZvck92ZXJRdWFudGl0eUVycm9yKGVycm9yRGV0YWlsKSB7fSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBu4buZaSBkdW5nIHRow7RuZyBiw6FvIHRoZW8gbcOjIHZhbGlkYXRlDQogICAgICogTk1UVUFOMyAyOC8xMC8yMDIxDQogICAgICovCiAgICBnZXRWYWxpZGF0ZU1lc3NhZ2U6IGZ1bmN0aW9uIGdldFZhbGlkYXRlTWVzc2FnZSh2YWxpZGF0ZUNvZGUsIGRhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG1zZyA9IHZhbGlkYXRlQ29kZTsKICAgICAgdmFyIHRpdGxlTmFtZSA9IG1lLmdldEZvcm1UaXRsZShtZS5lZGl0TW9kZSk7CiAgICAgIHZhciBmaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICBzd2l0Y2ggKHZhbGlkYXRlQ29kZSkgewogICAgICAgIGNhc2UgIkR1cGxpY2F0ZSI6CiAgICAgICAgICB2YXIgY29kZUR1cGxpY2F0ZSA9IG1lLmN1cnJlbnRJdGVtW2ZpZWxkLnVuaXF1ZV0gfHwgbWUuY3VycmVudEl0ZW1bZmllbGQuY29kZV0gfHwgbWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV07CiAgICAgICAgICB2YXIgbW9kdWxlTmFtZSA9IG1lLiR0KCJpMThuQ29tbW9uLm1vZHVsZS4iICsgbWUubW9kdWxlLnRvTG93ZXJDYXNlKCkpOwogICAgICAgICAgbXNnID0gdGhpcy4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLiIgKyB2YWxpZGF0ZUNvZGUpLmZvcm1hdChtb2R1bGVOYW1lLnRvTG93ZXJDYXNlKCksIGNvZGVEdXBsaWNhdGUpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIk92ZXJRdWFudGl0eSI6CiAgICAgICAgICBtc2cgPSB0aGlzLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuIiArIHZhbGlkYXRlQ29kZSkuZm9ybWF0KHRpdGxlTmFtZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICAvL8SQVlRoaSAxOS8wMy8yMDIxIGNodXnhu4NuIHbhu4EgZGVmYXVsdCDEkeG7gyDEkcaw4bujYyBuaGnhu4F1IHRyxrDhu51uZyBo4bujcCB2w60gZOG7pSAgT3ZlclF1YW50aXR5CgogICAgICAgIGNhc2UgIlJlZk5vRHVwbGljYXRlIjoKICAgICAgICAgIG1zZyA9IHRoaXMuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5SZWZOb0R1cGxpY2F0ZSIpLmZvcm1hdChtZS5jdXN0b21SZWZOb0R1cGxpY2F0ZShkYXRhKSB8fCBtZS5jdXJyZW50SXRlbS5Qcm9jZXNzTm8gfHwgbWUuY3VycmVudEl0ZW0uUmVmTm8gfHwgbWUuY3VycmVudEl0ZW0uVHJhbnNmZXJObyk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIG1zZyA9IHRoaXMuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS4iICsgdmFsaWRhdGVDb2RlKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gbXNnOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBuaOG7r25nIGzhu5dpIGtow6FjDQogICAgICovCiAgICBzaG93Q3VzdG9tRXJyb3I6IGZ1bmN0aW9uIHNob3dDdXN0b21FcnJvcihyZXN1bHQpIHt9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGPhuqV0IHRyxrDhu51uZyBk4buvIGxp4buHdQ0KICAgICAqLwogICAgc3VibWl0RWRpdEZvcm06IGZ1bmN0aW9uIHN1Ym1pdEVkaXRGb3JtKHBhcmFtKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBhY3Rpb24gPSAidXBkYXRlRmllbGQiOwogICAgICB2YXIgbW9kdWxlID0gInVzYWdlSGlzdG9yeSI7CiAgICAgIG1lLnByZXBhcmVTdWJtaXRQYXJhbShwYXJhbSk7IC8vIE7hur91IHThu6sgxJFp4buBdSBjaHV54buDbiB2w6AgxJFp4buBdSBjaHV54buDbiBuaGnhu4F1IHRow6wgZ+G7jWkgc2FuZyBtb2R1bGUgY+G7p2EgdHJhbnNmZXIgxJHhu4MgxJHGsOG7o2MgY+G6rXAgbmjhuq10IGl0ZW0KCiAgICAgIGlmIChtZS5tb2R1bGUgPT0gInRyYW5zZmVyIiAmJiBwYXJhbS5PbGRFbnRpdHkpIHsKICAgICAgICBtb2R1bGUgPSBtZS5tb2R1bGU7CiAgICAgIH0gLy9zaG93IG1hc2sKCgogICAgICBtZS5sb2FkaW5nID0gdHJ1ZTsKICAgICAgbWUuJHN0b3JlLmRpc3BhdGNoKFttb2R1bGUsIGFjdGlvbl0uam9pbigiLyIpLCBwYXJhbSkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuU3VjY2VzcykgewogICAgICAgICAgLy944butIGzDvSBzYXUga2hpIGPhuqV0CiAgICAgICAgICBtZS5hZnRlclN1Ym1pdChyZXN1bHQsIHBhcmFtLCBhY3Rpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZS5wcm9jZXNzU3VibWl0RXJyb3IocmVzdWx0LCBwYXJhbSwgYWN0aW9uKTsKICAgICAgICB9CiAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgIG1lLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBvdmVycmlkYWJsZQ0KICAgICAqLwogICAgcHJlcGFyZVN1Ym1pdFBhcmFtOiBmdW5jdGlvbiBwcmVwYXJlU3VibWl0UGFyYW0ocGFyYW0pIHt9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGPhuqV0IGThu68gbGnhu4d1DQogICAgICogQ3JlYXRlZEJ5OiBQREtJRU4gMjcvMDcvMjAxOQ0KICAgICAqLwogICAgc3VibWl0OiBmdW5jdGlvbiBzdWJtaXQocGFyYW0sIGFjdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOyAvL3Nob3cgbWFzawoKICAgICAgbWUubG9hZGluZyA9IHRydWU7CiAgICAgIG1lLiRzdG9yZS5kaXNwYXRjaChbbWUubW9kdWxlLCBhY3Rpb25dLmpvaW4oIi8iKSwgcGFyYW0pLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LlN1Y2Nlc3MpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIG1lLmluc2VydEF1ZGl0aW5nTG9nKHJlc3VsdCwgcGFyYW0sIGFjdGlvbik7CiAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICB9IC8veOG7rSBsw70gc2F1IGtoaSBj4bqldAoKCiAgICAgICAgICBtZS5hZnRlclN1Ym1pdChyZXN1bHQsIHBhcmFtLCBhY3Rpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZS5wcm9jZXNzU3VibWl0RXJyb3IocmVzdWx0LCBwYXJhbSwgYWN0aW9uKTsKICAgICAgICB9CiAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgIG1lLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHRoYW0gY2hp4bq/dSBuaOG6rXQga8O9IChsxrB1IGThuqFuZyBqc29uIDoge2tleToga2V5LCBjb2RlOiBjb2RlLCBuYW1lOiBuYW1lfSkNCiAgICAgKiBrZXk6IGtow7NhIGNow61uaCBj4bunYSBi4bqjbmcgbW9kdWxlLCBkw7luZyDEkeG7gyBkcmlsZG93biBraGkgY2xpY2sgdsOgbw0KICAgICAqIGNvZGUsIG5hbWU6IG3DoywgdMOqbiDEkeG7gyBoaeG7g3UgdGjhu4sg4bufIGPhu5l0IHRoYW0gY2hp4bq/dSBraGkgeGVtIGxvZzogdsOtIGThu6U6IFF14bqhdCDEkWnhu4duIChRRDAwMDAxKQ0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgYnVpbGRSZWZlcmVuY2U6IGZ1bmN0aW9uIGJ1aWxkUmVmZXJlbmNlKCkgewogICAgICB2YXIgX21lJGdldEZpZWxkOwoKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGZpZWxkID0gKF9tZSRnZXRGaWVsZCA9IG1lLmdldEZpZWxkKCkpICE9PSBudWxsICYmIF9tZSRnZXRGaWVsZCAhPT0gdm9pZCAwID8gX21lJGdldEZpZWxkIDogdGhpcy4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkOwoKICAgICAgaWYgKGZpZWxkKSB7CiAgICAgICAgcmV0dXJuIE1TSnNvbi5zZXJpYWxpemUoewogICAgICAgICAga2V5OiBtZS5jdXJyZW50SXRlbVtmaWVsZC5rZXldLAogICAgICAgICAgY29kZTogbWUuY3VycmVudEl0ZW1bZmllbGQuY29kZV0sCiAgICAgICAgICBuYW1lOiBtZS5jdXJyZW50SXRlbVtmaWVsZC5uYW1lXQogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGN1c3RvbSBTaW5oIG3DtCB04bqjIGPhu6dhIG5o4bqtdCBrw70NCiAgICAgKiBDcmVhdGVkQnk6IG5ubGFtIDI0LzAzLzIwMjENCiAgICAgKi8KICAgIGN1c3RvbURlc2NyaXB0aW9uQXVkaXRpbmdMb2c6IGZ1bmN0aW9uIGN1c3RvbURlc2NyaXB0aW9uQXVkaXRpbmdMb2coZW50aXR5LCBvbGRFbnRpdHksIGFjdGlvbiwgaXNEZXRhaWwpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNpbmggbcO0IHThuqMgY+G7p2Egbmjhuq10IGvDvQ0KICAgICAqIENyZWF0ZWRCeTogbm5sYW0gMjQvMDMvMjAyMQ0KICAgICAqLwogICAgZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nOiBmdW5jdGlvbiBnZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2coZW50aXR5LCBvbGRFbnRpdHksIGFjdGlvbiwgaXNEZXRhaWwpIHsKICAgICAgdmFyIF9tZSRnZXRGaWVsZDI7CgogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgb2JqRGVzY3JpcHRpb24gPSB7fTsKICAgICAgdmFyIGZpZWxkID0gKF9tZSRnZXRGaWVsZDIgPSBtZS5nZXRGaWVsZCgpKSAhPT0gbnVsbCAmJiBfbWUkZ2V0RmllbGQyICE9PSB2b2lkIDAgPyBfbWUkZ2V0RmllbGQyIDogdGhpcy4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkOwoKICAgICAgaWYgKGlzRGV0YWlsKSB7CiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyhlbnRpdHkpOyBfaSA8IF9PYmplY3Qka2V5cy5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgIHZhciBpID0gX09iamVjdCRrZXlzW19pXTsKCiAgICAgICAgICBpZiAoZW50aXR5W2ldICE9IG9sZEVudGl0eVtpXSkgewogICAgICAgICAgICB2YXIgc3dpdGNoQ2FwID0gbWUuc3dpdGNoQ2FwdGlvbi5kZXRhaWxbaV07CgogICAgICAgICAgICBpZiAoc3dpdGNoQ2FwKSB7CiAgICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25baV0gPSB7CiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkRW50aXR5W2ldLAogICAgICAgICAgICAgICAgbmV3VmFsdWU6IGVudGl0eVtpXSwKICAgICAgICAgICAgICAgIHN3aXRjaENhcHRpb246IHN3aXRjaENhcAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25baV0gPSB7CiAgICAgICAgICAgICAgICBvbGRWYWx1ZTogb2xkRW50aXR5W2ldLAogICAgICAgICAgICAgICAgbmV3VmFsdWU6IGVudGl0eVtpXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3dpdGNoIChhY3Rpb24pIHsKICAgICAgICAgIGNhc2UgbWUuJG1zLmVudW0uTW9kZWxTdGF0ZS5JbnNlcnQ6CiAgICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuRHVwbGljYXRlOgogICAgICAgICAgY2FzZSBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkRlbGV0ZToKICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25bZmllbGQuY29kZV0gPSBtZS5jdXJyZW50SXRlbVtmaWVsZC5jb2RlXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQuY29kZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLmNvZGVdfTsKCiAgICAgICAgICAgIG9iakRlc2NyaXB0aW9uW2ZpZWxkLm5hbWVdID0gbWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV07IC8ve25ld1ZhbHVlOm1lLmN1cnJlbnRJdGVtW2ZpZWxkLm5hbWVdLCBzd2l0Y2hDYXB0aW9uOiBtZS5zd2l0Y2hDYXB0aW9uLm1hc3RlcltmaWVsZC5uYW1lXX07CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuVXBkYXRlOgogICAgICAgICAgY2FzZSAidXBkYXRlIjoKICAgICAgICAgICAgbWUuYnVpbGREZXNjcmlwdGlvbkxvZyhlbnRpdHksIG9sZEVudGl0eSwgb2JqRGVzY3JpcHRpb24pOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBvYmpEZXNjcmlwdGlvbjsKICAgIH0sCiAgICBnZXRGaWVsZDogZnVuY3Rpb24gZ2V0RmllbGQoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKICAgIGJ1aWxkRGVzY3JpcHRpb25Mb2c6IGZ1bmN0aW9uIGJ1aWxkRGVzY3JpcHRpb25Mb2cobmV3RW50aXR5LCBvbGRFbnRpdHksIG9iakRlc2NyaXB0aW9uKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIG9iakRlc2NyaXB0aW9uID0gb2JqRGVzY3JpcHRpb24gPyBvYmpEZXNjcmlwdGlvbiA6IHt9OwoKICAgICAgZm9yICh2YXIgX2kyID0gMCwgX09iamVjdCRrZXlzMiA9IE9iamVjdC5rZXlzKG5ld0VudGl0eSk7IF9pMiA8IF9PYmplY3Qka2V5czIubGVuZ3RoOyBfaTIrKykgewogICAgICAgIHZhciBqID0gX09iamVjdCRrZXlzMltfaTJdOwoKICAgICAgICBpZiAoaiAhPSAiRXh0RGF0YSIpIHsKICAgICAgICAgIHZhciB2YWx1ZU9sZEVudGl0eSA9IG9sZEVudGl0eVtqXSwKICAgICAgICAgICAgICB2YWx1ZU5ld0VudGl0eSA9IG5ld0VudGl0eVtqXTsgLy8gTuG6v3UgbMOgIG5nw6B5IHRow6FuZyB0aMOsIGZvcm1hdCBs4bqhaQoKICAgICAgICAgIHZhciBmaWVsZEZvcm1hdERhdGVJbmRleCA9IG1lLmZpZWxkRm9ybWF0RGF0ZSgpLmZpbmRJbmRleChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkID09IGo7CiAgICAgICAgICB9KSwKICAgICAgICAgICAgICByZW1vdmVBdWRpdExvZ0J5RmllbGRJbmRleCA9IG1lLnJlbW92ZUF1ZGl0TG9nQnlGaWVsZCgpLmZpbmRJbmRleChmdW5jdGlvbiAoZmllbGQpIHsKICAgICAgICAgICAgcmV0dXJuIGZpZWxkID09IGo7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoai5jb250YWlucygiRGF0ZSIpIHx8IGZpZWxkRm9ybWF0RGF0ZUluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgIHZhbHVlT2xkRW50aXR5ID0gbW9tZW50KHZhbHVlT2xkRW50aXR5KS5mb3JtYXQoIkREL01NL1lZWVkiKTsKICAgICAgICAgICAgdmFsdWVOZXdFbnRpdHkgPSBtb21lbnQodmFsdWVOZXdFbnRpdHkpLmZvcm1hdCgiREQvTU0vWVlZWSIpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICgodmFsdWVPbGRFbnRpdHkgfHwgdmFsdWVOZXdFbnRpdHkpICYmIHZhbHVlT2xkRW50aXR5ICE9IHZhbHVlTmV3RW50aXR5ICYmIHJlbW92ZUF1ZGl0TG9nQnlGaWVsZEluZGV4ID09IC0xKSB7CiAgICAgICAgICAgIHZhciBzd2l0Y2hDYXAgPSBtZS5zd2l0Y2hDYXB0aW9uLm1hc3RlcltqXTsKICAgICAgICAgICAgdmFyIGVudW1OYW1lID0gbWUuZW51bXMgPyBtZS5lbnVtcy5tYXN0ZXJbal0gOiBudWxsOwoKICAgICAgICAgICAgaWYgKHN3aXRjaENhcCkgewogICAgICAgICAgICAgIG9iakRlc2NyaXB0aW9uW2pdID0gewogICAgICAgICAgICAgICAgb2xkVmFsdWU6IHZhbHVlT2xkRW50aXR5LAogICAgICAgICAgICAgICAgbmV3VmFsdWU6IHZhbHVlTmV3RW50aXR5LAogICAgICAgICAgICAgICAgc3dpdGNoQ2FwdGlvbjogc3dpdGNoQ2FwLAogICAgICAgICAgICAgICAgZW51bTogZW51bU5hbWUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG9iakRlc2NyaXB0aW9uW2pdID0gewogICAgICAgICAgICAgICAgb2xkVmFsdWU6IHZhbHVlT2xkRW50aXR5LAogICAgICAgICAgICAgICAgbmV3VmFsdWU6IHZhbHVlTmV3RW50aXR5LAogICAgICAgICAgICAgICAgZW51bTogZW51bU5hbWUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBleHRPYmpOZXcgPSBKU09OLnBhcnNlKG5ld0VudGl0eVtqXSk7CiAgICAgICAgICB2YXIgZXh0T2JqT2xkID0gSlNPTi5wYXJzZShvbGRFbnRpdHlbal0pOwogICAgICAgICAgbWUuYnVpbGREZXNjcmlwdGlvbkxvZyhleHRPYmpOZXcsIGV4dE9iak9sZCk7CiAgICAgICAgfQoKICAgICAgICBtZS5jdXN0b21BdWRpdGluZ0xvZ0J5RmllbGQobmV3RW50aXR5LCBvbGRFbnRpdHksIG9iakRlc2NyaXB0aW9uLCBqKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG9iakRlc2NyaXB0aW9uOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDI1LjA2LjIwMjENCiAgICAgKiBUaMOqbSBow6BtIGN1c3RvbSBsb2cgdGhlbyBmaWVsZA0KICAgICAqLwogICAgY3VzdG9tQXVkaXRpbmdMb2dCeUZpZWxkOiBmdW5jdGlvbiBjdXN0b21BdWRpdGluZ0xvZ0J5RmllbGQobmV3RW50aXR5LCBvbGRFbnRpdHksIG9iakRlc2NyaXB0aW9uLCBrZXkpIHt9LAoKICAgIC8qKg0KICAgICAqIEBvdmVycmlkZSBDw6FjIHRyxrDhu51uZyBz4bq9IGtow7RuZyBnaGkgbG9nDQogICAgICogQHJldHVybnMNCiAgICAgKi8KICAgIHJlbW92ZUF1ZGl0TG9nQnlGaWVsZDogZnVuY3Rpb24gcmVtb3ZlQXVkaXRMb2dCeUZpZWxkKCkgewogICAgICByZXR1cm4gW107CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBvdmVycmlkZSBDw6FjIHRyxrDhu51uZyBz4bq9IGZvcm1hdCB0aGVvIG5nw6B5IHRow6FuZw0KICAgICAqIEByZXR1cm5zDQogICAgICovCiAgICBmaWVsZEZvcm1hdERhdGU6IGZ1bmN0aW9uIGZpZWxkRm9ybWF0RGF0ZSgpIHsKICAgICAgcmV0dXJuIFtdOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBHZXQgdGjDtG5nIHRpbiBleHQgKCBjw6FjIHRyxrDhu51uZyBi4buVIHN1bmcpDQogICAgICogQ3JlYXRlZEJ5OiBubmxhbSAyNC8wMy8yMDIxDQogICAgICovCiAgICBnZXRFeHREYXRhQXVkaXRpbmdMb2c6IGZ1bmN0aW9uIGdldEV4dERhdGFBdWRpdGluZ0xvZygpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGzhu5dpIGtoaSBj4bqldCBkYW5oIG3hu6VjDQogICAgICogQ3JlYXRlZEJ5OiBQREtJRU4gMjQvMDcvMjAxOQ0KICAgICAqLwogICAgaGFuZGxlU3VibWl0RXJyb3I6IGZ1bmN0aW9uIGhhbmRsZVN1Ym1pdEVycm9yKGVycikgewogICAgICB2YXIgbXNnID0gdGhpcy5nZXRFcnJvck1lc3NhZ2UoZXJyKTsgLy8gdGhpcy5zZXJ2ZXJFcnJvckxpc3QucHVzaChtc2cpOwoKICAgICAgaWYgKG1zZykgewogICAgICAgIHRoaXMuJG1zLmNvbW1vbkZuLnRvYXN0KHsKICAgICAgICAgIHR5cGU6ICJlcnJvciIsCiAgICAgICAgICB0ZXh0OiBtc2csCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgdGhpcy5hZnRlclN1Ym1pdEVycm9yKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEdldCBs4buXaSBraGkgY+G6pXQgZGFuaCBt4bulYw0KICAgICAqIENyZWF0ZWRCeTogTkNUaGFuaDEgMjQvMDcvMjAxOQ0KICAgICAqIE1vZGlmaWVkIEJ5OiBwdmR1b25nMSAtIDEyLzExLzIwMTkNCiAgICAgKiBNb2RpZmllZCBEZXNjcml0aW9uOiBUaGF5IMSR4buVaSBu4buZaSBkdW5nIG1lc2FnZSB0cuG6oyB24buBDQogICAgICovCiAgICBnZXRFcnJvck1lc3NhZ2U6IGZ1bmN0aW9uIGdldEVycm9yTWVzc2FnZShlcnIpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIG1zZyA9ICIiOwoKICAgICAgaWYgKE9iamVjdC5pc09iamVjdChlcnIpKSB7CiAgICAgICAgdmFyIHBhcmFtQ29kZSA9IHRoaXMuY3VycmVudEl0ZW0uZ2V0Q29kZUZpZWxkKCk7CgogICAgICAgIHN3aXRjaCAoZXJyLkNvZGUpIHsKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIC8vCW1zZyA9IGFwaVJlc3BvbnNlQ29kZS5nZXRNZXNzYWdlKGVyci5Db2RlKTsKICAgICAgICAgICAgaWYgKHRoaXMuZWRpdE1vZGUgPT0gdGhpcy4kbXMuZW51bS5Gb3JtU3RhdGUuRWRpdCkgewogICAgICAgICAgICAgIG1zZyA9IHRoaXMudGl0bGUgKyAiICIgKyB0aGlzLmN1cnJlbnRJdGVtW3BhcmFtQ29kZV0gKyAiIMSRw6MgY8OzIHBow6F0IHNpbmgga2jDtG5nIHRo4buDIHPhu61hIMSR4buVaS4iOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIG1zZyA9IHRoaXMudGl0bGUgKyAiICIgKyB0aGlzLmN1cnJlbnRJdGVtW3BhcmFtQ29kZV0gKyAiIMSRw6MgdOG7k24gdOG6oWkiOwogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgIG1zZyA9IFt0aGlzLnRpdGxlLCAiICIsIHRoaXMuY3VycmVudEl0ZW1bcGFyYW1Db2RlXSwgIiDEkcOjIGLhu4sgdGhheSDEkeG7lWkgYuG7n2kgbmfGsOG7nWkgZMO5bmcga2jDoWMsIHZ1aSBsw7JuZyBu4bqhcCBs4bqhaSB0csaw4bubYyBraGkgdGhheSDEkeG7lWkgZOG7ryBsaeG7h3UuIl0uam9pbigiIik7CiAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgIGNhc2UgNDAzOgogICAgICAgICAgICBtc2cgPSB0aGlzLiR0KCJpMThuUGVybWlzc2lvbi5BY3Rpb24uTWVzc2FnZUNvbW1vbiIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIFRyw7luZyBtw6MuIMOBcCBk4bulbmcgY2hvIFZUSEgsIEtIL05DQy9OVgoKICAgICAgICAgIGNhc2UgdGhpcy4kbXMuZW51bS5FbnVtRXJyb3JDb2RlLkludmFsaWRSZWZubzoKICAgICAgICAgICAgbXNnID0gbWUuaGFuZGxlRXJyb3JJbnZhbGlkUmVmbm8oZXJyLCBwYXJhbUNvZGUpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIC8vIHB2ZHVvbmcxIC0gMTYvMDQvMjAyMCAtIELhu5Ugc3VuZyBtw6MgbOG7l2kgOTkgPT4gVHLhuqMgduG7gSBtZXNhZ2UgdGjDtG5nIGLDoW8gxJHDoyBjw7MgbOG7l2kgeOG6o3kgcmEKCiAgICAgICAgICBjYXNlIHRoaXMuJG1zLmVudW0uRW51bUVycm9yQ29kZS5FcnJvcjoKICAgICAgICAgICAgewogICAgICAgICAgICAgIG1zZyA9ICLEkMOjIGPDsyBs4buXaSB44bqjeSByYSI7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAoZXJyLlN5c3RlbU1lc3NhZ2UuaW5kZXhPZigiZHVwbGljYXRlIGtleSIpID4gLTEpIHsKICAgICAgICAgICAgICBtc2cgPSB0aGlzLnRpdGxlICsgIiAiICsgdGhpcy5jdXJyZW50SXRlbVtwYXJhbUNvZGVdICsgIiDEkcOjIHThu5NuIHThuqFpIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHR5cGVvZiBlcnIgPT09ICJzdHJpbmciKSB7CiAgICAgICAgbXNnID0gZXJyOwogICAgICB9CgogICAgICByZXR1cm4gbXNnOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBk4buvIGxp4buHdSBu4bq/dSB0csaw4budbmcgaOG7o3Agc3VibWl0IGzhu5dpDQogICAgICogQ3JlYXRlZCBieTogcHZkdW9uZzEgLSAxNS8xMS8yMDE5DQogICAgICovCiAgICBhZnRlclN1Ym1pdEVycm9yOiBmdW5jdGlvbiBhZnRlclN1Ym1pdEVycm9yKCkge30sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gZOG7ryBsaeG7h3Ugc2F1IGtoaSBj4bqldCB0aMOgbmggY8O0bmcNCiAgICAgKiBjcmVhdGVkIGJuZHVjIDI3LjExLjIwMTkNCiAgICAgKi8KICAgIHByb2Nlc3NEYXRhQWZ0ZXJTdWJtaXQ6IGZ1bmN0aW9uIHByb2Nlc3NEYXRhQWZ0ZXJTdWJtaXQoZW50aXR5LCByZXN1bHREYXRhKSB7fSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBk4buvIGxp4buHdSBj4bqldA0KICAgICAqICovCiAgICBnZXRTYXZlRGF0YTogZnVuY3Rpb24gZ2V0U2F2ZURhdGEobW9kZSwgYWN0aW9uKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBkYXRhID0gbnVsbCwKICAgICAgICAgIGRlc2NyaXB0aW9uTG9nID0gbnVsbDsgLy9tYXN0ZXIKCiAgICAgIGlmICh0eXBlb2YgbWUuY3VycmVudEl0ZW0uZ2V0RGF0YSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgIGRhdGEgPSBfb2JqZWN0U3ByZWFkKHt9LCBtZS5jdXJyZW50SXRlbS5nZXREYXRhKCkpOwogICAgICB9IGVsc2UgewogICAgICAgIGRhdGEgPSBfb2JqZWN0U3ByZWFkKHt9LCBtZS5jdXJyZW50SXRlbSk7CiAgICAgIH0KCiAgICAgIGlmIChtZS5tb2R1bGUgJiYgbWUuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0pIHsKICAgICAgICB2YXIgZmllbGQgPSBtZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkOwoKICAgICAgICBpZiAoZmllbGQudW5pcXVlKSB7CiAgICAgICAgICBkYXRhW2ZpZWxkLnVuaXF1ZV0gPSBkYXRhW2ZpZWxkLnVuaXF1ZV0udHJpbSgpOwogICAgICAgIH0KICAgICAgfSAvL2R1eeG7h3QgeOG7rSBsw70gY8OhYyBk4buvIGxp4buHdSBt4bufIHLhu5luZwogICAgICAvL3B2ZHV5IDIzLzAzLzIwMjEgc+G7rWEgbOG7l2kgY+G6pXQgdW5pdCBkYXRhIHRyxrDhu51uZyBo4bujcCBudWxsIGLhu4sgbOG7l2kuLi4KCgogICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eSgiRXh0RGF0YSIpKSB7CiAgICAgICAgdmFyIGV4dERhdGEgPSB7fTsKCiAgICAgICAgZm9yICh2YXIgaSBpbiBkYXRhKSB7CiAgICAgICAgICBpZiAobWUub3JpZ2luRmllbGRzLmluZGV4T2YoaSkgPT09IC0xKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFbaV07IC8vdmFsdWUgY8OzIGdpw6EgdHLhu4sgdGjhu4kgbeG7m2kgYWRkIHbDoG8gZXh0RGF0YQoKICAgICAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSAiIikgewogICAgICAgICAgICAgIGV4dERhdGFbaV0gPSB2YWx1ZSArICIiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBkYXRhLkV4dERhdGEgPSBKU09OLnN0cmluZ2lmeShleHREYXRhKTsKICAgICAgfSAvL2RldGFpbAoKCiAgICAgIGlmIChtZS5zdG9yZURldGFpbCkgewogICAgICAgIGZvciAodmFyIGtleSBpbiBtZS5zdG9yZURldGFpbCkgewogICAgICAgICAgZGF0YVtrZXldID0gbWUuZ2V0RGV0YWlsU2F2ZURhdGEoa2V5LCBtZS5zdG9yZURldGFpbFtrZXldLCBpc2N1c3RvbUF1ZGl0aW5nbG9nKTsKICAgICAgICB9CiAgICAgIH0gLy9wdmR1eSAwOC8wMy8yMDIxIGtoaSBz4butYSBz4bq9IHRydXnhu4FuIG9sZERhdGEgxJHhu4MgeOG7rSBsw70gLSBnaGkgbmjhuq10IGvDvSB0cnV5IGPhuq1wLCBj4bqtcCBuaOG6rXQgY8OieS4uLi4KCgogICAgICBpZiAobW9kZSA9PT0gbWUuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQpIHsKICAgICAgICBkYXRhLk9sZERhdGEgPSBtZS5vbGREYXRhSXRlbTsKICAgICAgfSAvL2N1c3RvbSBk4buvIGxp4buHdSB0csaw4bubYyBraGkgY+G6pXQKCgogICAgICBtZS5jdXN0b21TYXZlRGF0YShtZS5lZGl0TW9kZSwgZGF0YSk7CiAgICAgIHJldHVybiBkYXRhOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBk4buvIGxp4buHdSBjaGkgdGnhur90IMSR4buDIGPhuqV0DQogICAgICovCiAgICBnZXREZXRhaWxTYXZlRGF0YTogZnVuY3Rpb24gZ2V0RGV0YWlsU2F2ZURhdGEoa2V5LCBzdG9yZSwgaXNjdXN0b21BdWRpdGluZ2xvZykgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgbmV3UmVjb3JkcyA9IHN0b3JlLmdldE5ld1JlY29yZHMoKSwKICAgICAgICAgIHVwZGF0ZWRSZWNvcmRzID0gc3RvcmUuZ2V0VXBkYXRlZFJlY29yZHMoKSwKICAgICAgICAgIHJlbW92ZWRSZWNvcmRzID0gc3RvcmUuZ2V0UmVtb3ZlZFJlY29yZHMoKSwKICAgICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB2YXIgY3VzdG9tRGVzY3JpcHRpb25Mb2cgPSB7CiAgICAgICAgaW5zZXJ0czogW10sCiAgICAgICAgdXBkYXRlczogW10sCiAgICAgICAgZGVsZXRlczogW10KICAgICAgfTsgLy9Y4butIGzDvSBjaG8gY8OhYyBi4bqjbiBnaGkgdGjDqm0gbeG7m2kKCiAgICAgIGlmIChuZXdSZWNvcmRzICYmIG5ld1JlY29yZHMubGVuZ3RoID4gMCkgewogICAgICAgIG5ld1JlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgICAgICByZWNvcmQuRW50aXR5U3RhdGUgPSB0aGlzLiRtcy5lbnVtLk1vZGVsU3RhdGUuSW5zZXJ0OwogICAgICAgICAgcmVzdWx0LmFkZChyZWNvcmQuZ2V0RGF0YSgpKTsKCiAgICAgICAgICBpZiAoaXNjdXN0b21BdWRpdGluZ2xvZykgewogICAgICAgICAgICBjdXN0b21EZXNjcmlwdGlvbkxvZy5pbnNlcnRzLnB1c2gobWUuZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nKHJlY29yZC5nZXREYXRhKCksIHt9LCBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkluc2VydCwgdHJ1ZSkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9IC8vWOG7rSBsw70gY2hvIGPDoWMgYuG6o24gZ2hpIHPhu61hCgoKICAgICAgaWYgKHVwZGF0ZWRSZWNvcmRzICYmIHVwZGF0ZWRSZWNvcmRzLmxlbmd0aCA+IDApIHsKICAgICAgICB1cGRhdGVkUmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgICAgIHZhciBkZXRhaWxEYXRhID0gcmVjb3JkLmdldERhdGEoKTsgLy8Jb2xkRGF0YSA9IG1lLmdldE9sZERhdGEocmVjb3JkKTsKICAgICAgICAgIC8vaWYgKG9sZERhdGEpIHsKICAgICAgICAgIC8vCWRldGFpbERhdGEub2xkX2RhdGEgPSBvbGREYXRhOwogICAgICAgICAgLy99CgogICAgICAgICAgZGV0YWlsRGF0YS5FbnRpdHlTdGF0ZSA9IHRoaXMuJG1zLmVudW0uTW9kZWxTdGF0ZS5VcGRhdGU7CiAgICAgICAgICByZXN1bHQuYWRkKGRldGFpbERhdGEpOwoKICAgICAgICAgIGlmIChpc2N1c3RvbUF1ZGl0aW5nbG9nKSB7CiAgICAgICAgICAgIGN1c3RvbURlc2NyaXB0aW9uTG9nLnVwZGF0ZXMucHVzaChtZS5nZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2coZGV0YWlsRGF0YSwgbWUub2xkRGF0YUl0ZW0sIG1lLiRtcy5lbnVtLk1vZGVsU3RhdGUuVXBkYXRlLCB0cnVlKSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0gLy9Y4butIGzDvSBjaG8gY8OhYyBi4bqjbiBnaGkgeMOzYQoKCiAgICAgIGlmIChyZW1vdmVkUmVjb3JkcyAmJiByZW1vdmVkUmVjb3Jkcy5sZW5ndGggPiAwKSB7CiAgICAgICAgcmVtb3ZlZFJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgICAgICByZWNvcmQuRW50aXR5U3RhdGUgPSB0aGlzLiRtcy5lbnVtLk1vZGVsU3RhdGUuRGVsZXRlOwogICAgICAgICAgcmVzdWx0LmFkZChyZWNvcmQuZ2V0RGF0YSgpKTsKCiAgICAgICAgICBpZiAoaXNjdXN0b21BdWRpdGluZ2xvZykgewogICAgICAgICAgICBjdXN0b21EZXNjcmlwdGlvbkxvZy5kZWxldGVzLnB1c2gobWUuZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nKHJlY29yZC5nZXREYXRhKCksIHt9LCBtZS4kbXMuZW51bS5Nb2RlbFN0YXRlLkRlbGV0ZSwgdHJ1ZSkpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAoaXNjdXN0b21BdWRpdGluZ2xvZykgewogICAgICAgIG1lLmRlc2NyaXB0aW9uQXVkaXRpbmdMb2cuZGV0YWlsLnB1c2goY3VzdG9tRGVzY3JpcHRpb25Mb2cpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gZOG7ryBsaeG7h3UgdGjhu7FjIGhp4buHbiBj4bqldA0KICAgICAqLwogICAgY3VzdG9tU2F2ZURhdGE6IGZ1bmN0aW9uIGN1c3RvbVNhdmVEYXRhKGVkaXRNb2RlLCBkYXRhKSB7fSwKCiAgICAvKioNCiAgICAgKiBWYWxpZGF0ZSBs4buXaSBuZ2hp4buHcCB24bulDQogICAgICogQ3JlYXRlZEJ5OiBQREtJRU4gMjUvMDcvMjAxOQ0KICAgICAqLwogICAgdmFsaWRhdGVCdXNpbmVzczogZnVuY3Rpb24gdmFsaWRhdGVCdXNpbmVzcyhzYXZlUGFyYW0sIGFjdGlvbikgewogICAgICByZXR1cm4gdHJ1ZTsgLy9yZXR1cm4gdGhpcy5idXNpbmVzc0Vycm9yTGlzdC5sZW5ndGggPT0gMDsKICAgIH0sCiAgICAvL0jDoG0geOG7rSBsw70gc+G7sSBraeG7h24gZMOzbmcgZm9ybQogICAgLy9DcmVhdGVkIGJ5IExUREFUKDE4LjA2LjIwMjApCiAgICBjbG9zZTogZnVuY3Rpb24gY2xvc2UoKSB7fSwKICAgIC8vS2nhu4NtIHRyYSBmb3JtIMSRw6MgYuG7iyB0aGF5IMSR4buVaSBoYXkgY2jGsGEKICAgIC8vQ3JlYXRlZCBieSBMVERBVCgxOC4wNi4yMDIwKQogICAgY2hlY2tDaGFuZ2VzOiBmdW5jdGlvbiBjaGVja0NoYW5nZXMoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBtZS4kbXMuY29tbW9uRm4uY2hlY2tEaWZmKG1lLmN1cnJlbnRJdGVtLCBtZS5vbGREYXRhSXRlbSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHPhu7Ega2nhu4duIHdpZGdldCBj4bunYSBncmlkDQogICAgICovCiAgICBncmlkV2lkZ2V0RXZlbnQ6IGZ1bmN0aW9uIGdyaWRXaWRnZXRFdmVudChncmlkLCB3aWRnZXREYXRhLCBlKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBzd2l0Y2ggKHdpZGdldERhdGEuY29tbWFuZCkgewogICAgICAgIGNhc2UgIkRlbGV0ZSI6CiAgICAgICAgICBtZS5yZW1vdmVEZXRhaWwod2lkZ2V0RGF0YS5kYXRhUm93LCBncmlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjDs2EgYuG6o24gZ2hpIGNoaSB0aeG6v3QNCiAgICAgKi8KICAgIHJlbW92ZURldGFpbDogZnVuY3Rpb24gcmVtb3ZlRGV0YWlsKHJlY29yZCwgZ3JpZCkgewogICAgICBncmlkLnN0b3JlLnJlbW92ZShyZWNvcmQpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaMOqbSBi4bqjbiBnaGkgY2hpIHRp4bq/dA0KICAgICAqLwogICAgYWRkRGV0YWlsOiBmdW5jdGlvbiBhZGREZXRhaWwoZ3JpZCkgewogICAgICBncmlkLmFkZE5ldyh7fSwgdHJ1ZSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEtoYWkgYsOhbyBoYW5kbGVyDQogICAgICogKi8KICAgIGFkZEhhbmRsZXI6IGZ1bmN0aW9uIGFkZEhhbmRsZXIoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAobWUuc3RvcmVEZXRhaWwpIHsKICAgICAgICBmb3IgKHZhciBrZXkgaW4gbWUuc3RvcmVEZXRhaWwpIHsKICAgICAgICAgIHZhciBncmlkID0gbWUuc3RvcmVEZXRhaWxba2V5XS5vd25lcjsKCiAgICAgICAgICBpZiAoZ3JpZCkgewogICAgICAgICAgICBncmlkLiRvbigiY3VzdG9tQWRkTmV3RGF0YSIsIG1lLmdyaWRDdXN0b21BZGROZXdEYXRhKTsKICAgICAgICAgICAgZ3JpZC4kb24oInJvd2FjdGlvbmNsaWNrIiwgbWUuZ3JpZFJvd0FjdGlvbkNsaWNrKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogWMOzYSBoYW5kbGVyIMSRw6Mga2hhaSBiw6FvIHRyb25nIGjDoG0gYWRkSGFuZGxlcg0KICAgICAqICovCiAgICByZW1vdmVIYW5kbGVyOiBmdW5jdGlvbiByZW1vdmVIYW5kbGVyKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLnN0b3JlRGV0YWlsKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIG1lLnN0b3JlRGV0YWlsKSB7CiAgICAgICAgICB2YXIgZ3JpZCA9IG1lLnN0b3JlRGV0YWlsW2tleV0ub3duZXI7CgogICAgICAgICAgaWYgKGdyaWQpIHsKICAgICAgICAgICAgZ3JpZC4kb2ZmKCJjdXN0b21BZGROZXdEYXRhIiwgbWUuZ3JpZEN1c3RvbUFkZE5ld0RhdGEpOwogICAgICAgICAgICBncmlkLiRvZmYoInJvd2FjdGlvbmNsaWNrIiwgbWUuZ3JpZFJvd0FjdGlvbkNsaWNrKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQ3VzdG9tIGThu68gbGnhu4d1IHRow6ptIG3hu5tpIHRyw6puIGdyaWQNCiAgICAgKi8KICAgIGdyaWRDdXN0b21BZGROZXdEYXRhOiBmdW5jdGlvbiBncmlkQ3VzdG9tQWRkTmV3RGF0YShncmlkLCBkYXRhKSB7fSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gbOG6oWkgc+G7sSBraeG7h24ga2hpIHRoYW8gdMOhYyB0csOqbiBncmlkDQogICAgICogQHBhcmFtIHsqfSBjb21tYW5kDQogICAgICogQHBhcmFtIHsqfSByZWNvcmQNCiAgICAgKiBAcGFyYW0geyp9IGV2ZW50DQogICAgICogQGF1dGhvciB2dmtpZXQgLSAzMC4wMy4yMDIxDQogICAgICovCiAgICBncmlkUm93QWN0aW9uQ2xpY2s6IGZ1bmN0aW9uIGdyaWRSb3dBY3Rpb25DbGljayhjb21tYW5kLCByZWNvcmQsIGV2ZW50KSB7fSwKCiAgICAvKioNCiAgICAgKiBLaOG7n2kgdOG6oW8gZOG7ryBsaeG7h3Uga2hpIHRow6ptIG3hu5tpIGTDsm5nIGNoIGl0aeG6v3QNCiAgICAgKiBAcGFyYW0gZGVmYXVsdERhdGENCiAgICAgKi8KICAgIGluaXROZXdEZXRhaWw6IGZ1bmN0aW9uIGluaXROZXdEZXRhaWwoZGVmYXVsdERhdGEpIHsKICAgICAgcmV0dXJuIGRlZmF1bHREYXRhOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBj4bqldSBow6xuaCBj4buZdCBj4bunYSBncmlkIGRldGFpbA0KICAgICAqICovCiAgICBnZXRHcmlkRGV0YWlsQ29sdW1uQ29uZmlnOiBmdW5jdGlvbiBnZXRHcmlkRGV0YWlsQ29sdW1uQ29uZmlnKCkgewogICAgICByZXR1cm4gdGhpcy5jb2x1bW5EZXRhaWw7CiAgICB9LAoKICAgIC8qDQogICAgICogcHZkdXkgMDUvMDQvMjAyMTogdGjDqm0gaMOgbSB4w7NhIHRyb25nIGJhc2UgZGV0YWlsIMSR4buDIGPDsyB0aOG7gyB4w7NhIHRyw6puIGZvcm0gY2hpIHRp4bq/dC4NCiAgICAgKi8KICAgIGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShyZWNvcmQpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOSgpIHsKICAgICAgICB2YXIgbWUsIGNvbmZpZ01lc3NhZ2UsIGFuc3dlciwgdGVtcCwgaSwgYXVkaXRpbmdMb2csIHBhcmFtLCByZXN1bHQ7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU5JChfY29udGV4dDkpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM4OwoKICAgICAgICAgICAgICAgIGlmIChtZS5jaGVja0FjdGlvblBlcm1pc3Npb24obWUuJHQoImkxOG5QZXJtaXNzaW9uLlN1YlN5c3RlbUNvZGUuQ29kZS5ERUxFVEUiKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5nZXREZWxldGVDb25maXJtTWVzc2FnZShyZWNvcmQpOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBjb25maWdNZXNzYWdlID0gX2NvbnRleHQ5LnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDg7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuJG1zLm1zZ0JveC5zaG93UXVlc3Rpb24oY29uZmlnTWVzc2FnZSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGFuc3dlciA9IF9jb250ZXh0OS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKGFuc3dlciA9PSAiWWVzIikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGVtcCA9IHt9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ5LnQwID0gcmVnZW5lcmF0b3JSdW50aW1lLmtleXMocmVjb3JkKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIGlmICgoX2NvbnRleHQ5LnQxID0gX2NvbnRleHQ5LnQwKCkpLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaSA9IF9jb250ZXh0OS50MS52YWx1ZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS50MiA9IGk7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IF9jb250ZXh0OS50MiA9PT0gInBhcmVudE5vZGUiID8gMTcgOiBfY29udGV4dDkudDIgPT09ICJpc0hpZGUiID8gMTcgOiBfY29udGV4dDkudDIgPT09ICJpc1NlbGVjdGVkIiA/IDE3IDogX2NvbnRleHQ5LnQyID09PSAibGV2ZWwiID8gMTcgOiBfY29udGV4dDkudDIgPT09ICJfX3ZLZXlWYWx1ZSIgPyAxNyA6IF9jb250ZXh0OS50MiA9PT0gIl9pc1NlbGVjdGVkTXVsdGlwbGUiID8gMTcgOiBfY29udGV4dDkudDIgPT09ICJleHBhbmRlZCIgPyAxNyA6IDE4OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMTc6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgiYnJlYWsiLCAyMCk7CgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICB0ZW1wW2ldID0gcmVjb3JkW2ldOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoImJyZWFrIiwgMjApOwoKICAgICAgICAgICAgICBjYXNlIDIwOgogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICAgICAgYXVkaXRpbmdMb2cgPSB7CiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNU0pzb24uc2VyaWFsaXplKG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhyZWNvcmQpKSwKICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlOiBtZS5idWlsZFJlZmVyZW5jZShyZWNvcmQpLAogICAgICAgICAgICAgICAgICBhY3Rpb246IG1lLmFjdGlvbkF1ZGl0aW5nTG9nLAogICAgICAgICAgICAgICAgICBlbnRpdHk6IG1lLm1vZHVsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHBhcmFtID0gewogICAgICAgICAgICAgICAgICBFbnRpdHk6IFt0ZW1wXSwKICAgICAgICAgICAgICAgICAgQnlQYXNzVmFsaWRhdGU6IG51bGwsCiAgICAgICAgICAgICAgICAgIEF1ZGl0aW5nTG9nOiBNU0pzb24uc2VyaWFsaXplKGF1ZGl0aW5nTG9nKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMjY7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuJHN0b3JlLmRpc3BhdGNoKCIiLmNvbmNhdChtZS5tb2R1bGUsICIvZGVsZXRlIiksIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSAyNjoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgbWUuYWZ0ZXJEZWxldGUocmVjb3JkLCByZXN1bHQpOwoKICAgICAgICAgICAgICBjYXNlIDI4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHNhdSBraGkgeMOzYQ0KICAgICAqIHB2ZHV5IDA1LzA0LzIwMjE6IHRow6ptIHRo4bqxbmcgeMOzYSB0cm9uZyBiYXNlIGRldGFpbA0KICAgICAqLwogICAgYWZ0ZXJEZWxldGU6IGZ1bmN0aW9uIGFmdGVyRGVsZXRlKHJlY29yZCwgcmVzdWx0KSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBtb2R1bGVOYW1lID0gbWUuZ2V0TW9kdWxlTmFtZSgpIHx8ICIiOwoKICAgICAgaWYgKHJlc3VsdC5TdWNjZXNzKSB7CiAgICAgICAgbWUuJHRvYXN0LnN1Y2Nlc3MobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkRlbGV0ZVN1Y2Nlc3MiKSk7CiAgICAgICAgcmVjb3JkID0gW107CiAgICAgICAgbWUuc2VsZWN0ZWQgPSBbXTsgLy8gcHZkdXkgMDUvMDUvMjAyMToga2hpIHjDs2EgdHLDqm4gZGFuaCBzw6FjaCB0aMOsIMSRw7NuZyBwb3B1cCDEkWkuCgogICAgICAgIG1lLmhpZGUoKTsgLy8gTk1UVUFOMyAzLzExLzIwMjE6IHNhdSBraGkgeMOzYSBwaOG6o2kgcmVsb2FkIGzhuqFpIHRyYW5nCgogICAgICAgIG1lLnJlbG9hZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIC8qKg0KICAgICAgICAgKiBT4butYSBs4buXaSBraGkgeMOzYSBuaGnhu4F1IGLhuqNuIGdoaQ0KICAgICAgICAgKiBNb2RpZml5Qnk6IE5UQW5oICgwOS8wMy8yMDIxKQ0KICAgICAgICAgKi8KICAgICAgICB2YXIgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7IC8vIE5oaeG7gXUgYuG6o24gZ2hpIG114buRbiB4w7NhIMSRw6MgY8OzIHBow6F0IHNpbmgKCiAgICAgICAgaWYgKHJlc3VsdC5EYXRhICYmIHJlc3VsdC5EYXRhLmxlbmd0aCA+IDEpIHsKICAgICAgICAgIC8vIGlmKHJlc3VsdC5EYXRhWzBdLkNvZGUgPT0gJ0FyaXNlJyl7CiAgICAgICAgICAvLyAgICAgbWUuJHRvYXN0LmVycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uTWVzc2FnZS5EZWxldGVBcmlzZW5lZCIpKTsKICAgICAgICAgIC8vIH0KICAgICAgICAgIHZhciBsaXN0QXJpc2VuZCA9IFtdOyAvL25ubGFtIHThuqFtIHRo4budaSB4w7NhIMSRb+G6oW4gbsOgeSDEkWkgc2F1IHPhur0gduG6vSBmb3JtIHBvcHVwIHNob3cgZMOhbmggc8OhY2ggcGjDoXQgc2luaCBzYXUKICAgICAgICAgIC8vIHJlc3VsdC5EYXRhLmZvckVhY2goZWxlbWVudCA9PiB7CiAgICAgICAgICAvLyAgIGxpc3RBcmlzZW5kLnB1c2goZWxlbWVudC5FbnRpdHkuQXNzZXRUeXBlQ29kZSk7CiAgICAgICAgICAvLyB9KTsKCiAgICAgICAgICBzd2l0Y2ggKHJlc3VsdC5Db2RlKSB7CiAgICAgICAgICAgIGNhc2UgQ09ERS5QYXJ0SW52YWxpZERhdGE6CiAgICAgICAgICAgICAgbWUuJHRvYXN0LmVycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuQ2FuTm90RGVsZXRlQXJpc2UiKSk7CiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIG1lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkNhbk5vdERlbGV0ZUFyaXNlIikpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfSAvL21lLnJlbG9hZCgpOwogICAgICAgICAgLy8gcmVjb3JkID0gW107CiAgICAgICAgICAvL21lLnNlbGVjdGlvbkNoYW5nZShyZWNvcmQpOwogICAgICAgICAgLy8gbWUuc2VsZWN0ZWQgPSBbXTsKCiAgICAgICAgfSAvLyBjw7MgMSBi4bqjbiBnaGkgY8OzIHBow6F0IHNpbmg6CiAgICAgICAgZWxzZSB7CiAgICAgICAgICBzd2l0Y2ggKHJlc3VsdC5Db2RlKSB7CiAgICAgICAgICAgIC8vIHjDs2EgMSBi4bqjbiBnaGkgdsOgIGLhuqNuIGdoaSDEkcOzIGLhu4sgY8OzIHBow6F0IHNpbmg6CiAgICAgICAgICAgIGNhc2UgQ09ERS5BcmlzZW5lZDoKICAgICAgICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkRlbGV0ZUFyaXNlbmVkIikuZm9ybWF0KG1vZHVsZU5hbWUpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgLy8geMOzYSBuaGnhu4F1IGLhuqNuIGdoaSB2w6AgY8OzIDEgYuG6o24gZ2hpIGLhu4sgY8OzIHBow6F0IHNpbmg6CgogICAgICAgICAgICBjYXNlIENPREUuUGFydEludmFsaWREYXRhOgogICAgICAgICAgICAgIC8vbm5sYW0gdOG6oW0gdGjhu51pIHjDs2EgxJFv4bqhbiBuw6B5IMSRaSBzYXUgc+G6vSB24bq9IGZvcm0gcG9wdXAgc2hvdyBkw6FuaCBzw6FjaCBwaMOhdCBzaW5oIHNhdQogICAgICAgICAgICAgIC8vIGxpc3RBcmlzZW5kID0gW107CiAgICAgICAgICAgICAgLy8gbGlzdEFyaXNlbmQucHVzaChyZXN1bHQuRGF0YVswXS5FbnRpdHkuQXNzZXRUeXBlQ29kZSk7CiAgICAgICAgICAgICAgbWUuJHRvYXN0LmVycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuRGVsZXRlTXVsdGlIYXNPbmVBcmlzZW5lZCIpKTsKCiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5EYXRhKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5RmllbGQgPSBtZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLmtleTsKICAgICAgICAgICAgICAgIHJlY29yZC5mb3JFYWNoKGZ1bmN0aW9uIChpKSB7CiAgICAgICAgICAgICAgICAgIHJlc3VsdC5EYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaVtrZXlGaWVsZF0gIT0gaXRlbS5FbnRpdHlba2V5RmllbGRdICYmIGlba2V5RmllbGRdKSB7CiAgICAgICAgICAgICAgICAgICAgICBtZS5ncmlkLmRhdGF4LnJlbW92ZShpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSAvLyByZWNvcmQgPSBbXTsKICAgICAgICAgICAgICAvL21lLnNlbGVjdGlvbkNoYW5nZShyZWNvcmQpOwogICAgICAgICAgICAgIC8vIG1lLnNlbGVjdGVkID0gW107CiAgICAgICAgICAgICAgLy9tZS5yZWxvYWQoKTsKCgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBjw6J1IHRow7RuZyBiw6FvIGtoaSB4w7NhDQogICAgICogcHZkdXkgMDUvMDQvMjAyMQ0KICAgICAqLwogICAgZ2V0RGVsZXRlQ29uZmlybU1lc3NhZ2U6IGZ1bmN0aW9uIGdldERlbGV0ZUNvbmZpcm1NZXNzYWdlKHJlY29yZHMpIHsKICAgICAgdmFyIF90aGlzOSA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoKSB7CiAgICAgICAgdmFyIG1lLCBtb2R1bGVOYW1lLCB0YXJnZXROYW1lLCBtZXM7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzOTsKICAgICAgICAgICAgICAgIG1vZHVsZU5hbWUgPSAobWUuZ2V0TW9kdWxlTmFtZSgpIHx8ICIiKS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9ICIiOwogICAgICAgICAgICAgICAgbWVzID0gIiI7CgogICAgICAgICAgICAgICAgaWYgKHJlY29yZHMubGVuZ3RoID4gMSkgewogICAgICAgICAgICAgICAgICBtZXMgPSBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZU11dGlUaXRsZSIpLmZvcm1hdChtb2R1bGVOYW1lKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSByZWNvcmRzW21lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQubmFtZV0gfHwgcmVjb3Jkc1ttZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLmNvZGVdOwogICAgICAgICAgICAgICAgICBtZXMgPSBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZSIpLmZvcm1hdChtb2R1bGVOYW1lLCBtZS4kbXMuY29tbW9uRm4uZW5jb2RlSFRNTCh0YXJnZXROYW1lKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLCB7CiAgICAgICAgICAgICAgICAgIHRpdGxlOiBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZVRpdGxlIikuZm9ybWF0KG1vZHVsZU5hbWUpLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOiBtZXMKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAqIEN1c3RvbSBmaWx0ZXIgKGPDsyB0aOG7gyB0w7l5IGTDuW5nIGNvbWJvYm94IGhheSBncmlkIC4uLi4uKQ0KICAgICogTeG6t2MgxJHhu4tuaCB0cnV54buBbiBJbmFjdGl2ZSB2w6BvIGzhuqV5IHJhIGPDoWMgYuG6o24gZ2hpIMSRYW5nIGhv4bqhdCDEkeG7mW5nDQogICAgKiBURE5HSElBIDI4LzEwLzIwMjENCiAgICAqIG92ZXJyaWRhYmxlDQogICAgKi8KICAgIGN1c3RvbVBheWxvYWRDb21ibzogZnVuY3Rpb24gY3VzdG9tUGF5bG9hZENvbWJvKHBheWxvYWQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmICghcGF5bG9hZC5maWx0ZXIpIHsKICAgICAgICBwYXlsb2FkLmZpbHRlciA9IFtdOwogICAgICB9CgogICAgICB2YXIgbWFwID0gbnVsbDsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF5bG9hZC5maWx0ZXIubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YXIgaXRlbSA9IHBheWxvYWQuZmlsdGVyW2ldOwoKICAgICAgICBpZiAoaXRlbS5wcm9wZXJ0eSA9PT0gIkluYWN0aXZlIikgewogICAgICAgICAgbWFwID0gaXRlbTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKCFtYXApIHsKICAgICAgICBwYXlsb2FkLmZpbHRlci5wdXNoKHsKICAgICAgICAgIHByb3BlcnR5OiAiSW5hY3RpdmUiLAogICAgICAgICAgdmFsdWU6IGZhbHNlLAogICAgICAgICAgb3BlcmF0b3I6ICI9IgogICAgICAgIH0pOwogICAgICB9CgogICAgICBpZiAocGF5bG9hZC5maWx0ZXIubGVuZ3RoID09IDApIHsKICAgICAgICBkZWxldGUgcGF5bG9hZC5maWx0ZXI7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogVGjhu7FjIGhp4buHbiBjw6FjIGPDtG5nIHZp4buHYyB0csaw4bubYyBraGkgc2F2ZQ0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTIuMDQuMjAyMQ0KICAgICAqLwogICAgYmVmb3JlU2F2ZTogZnVuY3Rpb24gYmVmb3JlU2F2ZSgpIHsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBnaGkgbmjhuq10IGvDvSB0cnV5IGPhuq1wDQogICAgICogQHBhcmFtIHsqfSByZXN1bHQNCiAgICAgKiBAcGFyYW0geyp9IHBhcmFtDQogICAgICogQHBhcmFtIHsqfSBhY3Rpb24NCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDE0LjA1LjIwMjENCiAgICAgKi8KICAgIGluc2VydEF1ZGl0aW5nTG9nOiBmdW5jdGlvbiBpbnNlcnRBdWRpdGluZ0xvZyhyZXN1bHQsIHBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGF1ZGl0aW5nTG9ncyA9IFtdOwogICAgICBhY3Rpb24gPSBtZS5lZGl0TW9kZTsgLy8gxJDhu5FpIHbhu5tpIHjhu60gbMO9IGjDoG5nIGxv4bqhdAoKICAgICAgaWYgKHJlc3VsdCAmJiByZXN1bHQuU3VjY2VzcyAmJiBwYXJhbSAmJiBwYXJhbS5FbnRpdHkpIHsKICAgICAgICBpZiAobWUuSXNBdWRpdGluZ0xvZ0JhdGNoKSB7CiAgICAgICAgICBhdWRpdGluZ0xvZ3MgPSBtZS5jdXN0b21BdWRpdGluZ0xvZ0JhdGNoKHBhcmFtLkVudGl0eSwgYWN0aW9uKTsKICAgICAgICB9IC8vIMSQ4buRaSB24bubaSB44butIGzDvSDEkcahbgogICAgICAgIGVsc2UgewogICAgICAgICAgLy8gdnZraWV0OiBDb2RlIGPhu6dhIG5nxrDhu51pIGzDoG0gdHLGsOG7m2MgxJHDsywga2jDtG5nIGTDoW0geMOzYQogICAgICAgICAgLy9tdeG7kW4gY3VzdG9tIG3DtCB04bqjIG5o4bqtdCBrw70gdGjDrCBkw7luZyBow6BtIG7DoHkKICAgICAgICAgIHZhciBkZXNjcmlwdGlvbkF1ZGl0aW5nTG9nID0gbWUuY3VzdG9tRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhwYXJhbS5FbnRpdHksIG1lLm9sZERhdGFJdGVtLCBhY3Rpb24sIGZhbHNlKTsKCiAgICAgICAgICBpZiAoZGVzY3JpcHRpb25BdWRpdGluZ0xvZyAmJiBPYmplY3Qua2V5cyhkZXNjcmlwdGlvbkF1ZGl0aW5nTG9nKS5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgbWUuZGVzY3JpcHRpb25BdWRpdGluZ0xvZyA9IGRlc2NyaXB0aW9uQXVkaXRpbmdMb2c7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBtZS5kZXNjcmlwdGlvbkF1ZGl0aW5nTG9nLm1hc3RlciA9IG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhwYXJhbS5FbnRpdHksIG1lLm9sZERhdGFJdGVtLCBhY3Rpb24sIGZhbHNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIW1lLmFjdGlvbkF1ZGl0aW5nTG9nKSB7CiAgICAgICAgICAgIC8vIG5tc2luaCA6IHjhu60gbMO9IG3hurdjIMSR4buLbmggbuG6v3UgZm9ybSBsw6AgdGjDqm0gaG/hurdjIHPhu61hIHRow6wgduG6q24gZ8OhbiBhY3Rpb25BdWRpdGluZ0xvZyDEkeG7gyB0csOhbmggdMOsbmggdHLhuqFuZyBraMO0bmcgZ2hpIE5LVEMKICAgICAgICAgICAgLy8gVE9ETyBjw7MgdGjhu4MgY8OzIHRyxrDhu51uZyBo4bujcCDEkeG6t2MgYmnhu4d0IG7DoG8gxJHDsyBtw6Agc2hvdyBmb3JtIHPhu61hIG5oxrBuZyBsw6BtIGjDoG5oIMSR4buZbmcga2jDoWMKICAgICAgICAgICAgbWUuYWN0aW9uQXVkaXRpbmdMb2cgPSBhY3Rpb24gPT0gbWUuJG1zLmVudW0uRm9ybVN0YXRlLkFkZCA/IG1lLiRtcy5lbnVtLkF1ZGl0aW5nTG9nQWN0aW9uLkluc2VydCA6IGFjdGlvbiA9PSBtZS4kbXMuZW51bS5Gb3JtU3RhdGUuRWRpdCA/IG1lLiRtcy5lbnVtLkF1ZGl0aW5nTG9nQWN0aW9uLkVkaXQgOiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChtZS5hY3Rpb25BdWRpdGluZ0xvZykgewogICAgICAgICAgICBhdWRpdGluZ0xvZ3MgPSBbewogICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNU0pzb24uc2VyaWFsaXplKG1lLmRlc2NyaXB0aW9uQXVkaXRpbmdMb2cpLAogICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UoKSwKICAgICAgICAgICAgICBhY3Rpb246IG1lLmFjdGlvbkF1ZGl0aW5nTG9nLAogICAgICAgICAgICAgIGVudGl0eTogbWUuZ2V0RW50aXR5VHlwZSgpIHx8IG1lLm1vZHVsZSwKICAgICAgICAgICAgICAvLyBjb21wYW55aWQ6IG1lLkNvbnRleHQuVGVuYW50SUQsCiAgICAgICAgICAgICAgLy8gdXNlcmlkOiBtZS5Db250ZXh0LlVzZXJJRCwKICAgICAgICAgICAgICB1c2VybmFtZTogbWUuQ29udGV4dC5Vc2VyTmFtZSwKICAgICAgICAgICAgICBkZXZpY2VuYW1lOiBuYXZpZ2F0b3IudXNlckFnZW50LAogICAgICAgICAgICAgIHRpbWU6IG5ldyBEYXRlKCksCiAgICAgICAgICAgICAgaWQ6IGNvbW1vbkZuLmdlbmVyYXRlVVVJRCgpCiAgICAgICAgICAgIH1dOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyB2dmtpZXQgLSBN4bq3YyDEkeG7i25oIGLhu48gcXVhIGtow7RuZyBnaGkgbG9nIG7hur91IGtow7RuZyBjw7MgbWFzdGVyIHbDoCBkZXRhaWwKCgogICAgICBpZiAoIWF1ZGl0aW5nTG9ncyAmJiBtZS5kZXNjcmlwdGlvbkF1ZGl0aW5nTG9nWyJtYXN0ZXIiXSAmJiBPYmplY3Qua2V5cyhtZS5kZXNjcmlwdGlvbkF1ZGl0aW5nTG9nWyJtYXN0ZXIiXSkubGVuZ3RoID09IDAgJiYgbWUuZGVzY3JpcHRpb25BdWRpdGluZ0xvZ1siZGV0YWlsIl0gJiYgbWUuZGVzY3JpcHRpb25BdWRpdGluZ0xvZ1siZGV0YWlsIl0ubGVuZ3RoID09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChhdWRpdGluZ0xvZ3MubGVuZ3RoID4gMCkgewogICAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgICAgYXVkaXRpbmdMb2dzOiBhdWRpdGluZ0xvZ3MKICAgICAgICB9OwoKICAgICAgICBpZiAoYXVkaXRpbmdMb2dzICYmIGF1ZGl0aW5nTG9ncy5sZW5ndGggPiAwKSB7fQogICAgICB9IGVsc2Ugey8vdOG6oW0gY29tbWVudCDEkeG7gyBraMO0bmcgaGnhu4duIHBvcHVwIHdhcm5pbmcga2hpIHNhbyBjaMOpcAogICAgICAgIC8vIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gImRldmVsb3BtZW50IikgewogICAgICAgIC8vICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZygiREVWIGNoxrBhIGPhuqV1IGjDrG5oIGF1ZGl0aW5nIGxvZyIpOwogICAgICAgIC8vIH0KICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIHRo4buxYyBoaeG7h24gY3VzdG9tIGzhuqFpIG5o4bqtdCBrw70gdHJ1eSBj4bqtcCBjaG8gY8OhYyBjaOG7qWMgbsSDbmcgaMOgbmcgbG/huqF0DQogICAgICogQHBhcmFtIHsqfSBlbnRpdHkNCiAgICAgKiBAcGFyYW0geyp9IGFjdGlvbg0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTQuMDUuMjAyMQ0KICAgICAqLwogICAgY3VzdG9tQXVkaXRpbmdMb2dCYXRjaDogZnVuY3Rpb24gY3VzdG9tQXVkaXRpbmdMb2dCYXRjaChlbnRpdHksIGFjdGlvbikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIGN1c3RvbSBlbnRpdHkgxJHhu5FpIHbhu5tpIG5naGnhu4dwIHbhu6UgxJHhurdjIHRow7kNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDE0LjA1LjIwMjENCiAgICAgKi8KICAgIGdldEVudGl0eVR5cGU6IGZ1bmN0aW9uIGdldEVudGl0eVR5cGUoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBz4buxIGtp4buHbiDhuqVuIHbDoG8gY8OhYyBhY3Rpb24gdHLDqm4gZm9ybQ0KICAgICAqLwogICAgYnV0dG9uQ2xpY2s6IGZ1bmN0aW9uIGJ1dHRvbkNsaWNrKGNvbW1hbmQsIGUpIHt9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSB0aGFtIHPhu5EgcGF5bG9hZCB0csaw4bubYyBraGkgY2FsbCBhcGkNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDIzLjA2LjIwMjENCiAgICAgKi8KICAgIGN1c3RvbVBheWxvYWQ6IGZ1bmN0aW9uIGN1c3RvbVBheWxvYWQocGF5bG9hZCkgewogICAgICByZXR1cm4gcGF5bG9hZDsKICAgIH0sCgogICAgLyoqDQogICAgICogQ3VzdG9tIGzhuqFpIHJlZm5vIGtoaSB0aMO0bmcgYsOhbyBs4buXaSBkdXBsaWNhdGUNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDIyLjA3LjIwMjENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgY3VzdG9tUmVmTm9EdXBsaWNhdGU6IGZ1bmN0aW9uIGN1c3RvbVJlZk5vRHVwbGljYXRlKGRhdGEpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFRow6ptIGjDoG0gY3VzdG9tIGzhuqFpIHBhcmFtIHbhu5tpIFRIIGPDsyBj4bqjbmggYsOhbw0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTQuMDg3LjIwMjENCiAgICAgKi8KICAgIGN1c3RvbVBhcmFtQnlQYXNzVmFsaWRhdGU6IGZ1bmN0aW9uIGN1c3RvbVBhcmFtQnlQYXNzVmFsaWRhdGUocGFyYW0sIGRhdGEpIHsKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIpOwogICAgICB9KSkoKTsKICAgIH0KICB9LAoKICAvKioNCiAgICogVHLGsOG7m2Mga2hpIGRlc3Ryb3kgZm9ybQ0KICAgKi8KICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgdmFyIG1lID0gdGhpczsgLy94w7NhIHRoYW0gY2hp4bq/dSDEkeG7gyB0csOhbmggbGVhawoKICAgIGRlbGV0ZSBtZS5wYXJhbTsKICAgIG1lLnJlbW92ZUhhbmRsZXIoKTsgLy9kZXN0cm95IGNoYSBj4bunYSBmb3JtIHPhur0gxINuIHBow61tIHThuq90CgogICAgaWYgKG1lLmhhc1Nob3J0S2V5KSB7CiAgICAgIHRoaXMuJG1zLmNvbW1vbkZuLnNob3J0a2V5UG9wVmlldyh0aGlzLiRlbCk7CiAgICB9CiAgfQp9Ow=="},null]}
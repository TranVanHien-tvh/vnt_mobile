{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT_vue\\src\\commons\\commonFunction.js","dependencies":[{"path":"D:\\VNT_vue\\src\\commons\\commonFunction.js","mtime":1666517008152},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL3RvQ29uc3VtYWJsZUFycmF5IjsKaW1wb3J0IF90eXBlb2YgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IF9jbGFzc0NhbGxDaGVjayBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiRDovVk5UX3Z1ZS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMucmVnZXhwLmV4ZWMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAudG8tc3RyaW5nLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLnRvLWZpeGVkLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnN0YXJ0cy13aXRoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmZpbmQuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmNvbmNhdC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuaXRlcmF0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIudXJsLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNwbGl0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucGFkLXN0YXJ0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgVnVlIGZyb20gInZ1ZSI7CmltcG9ydCBpMThuIGZyb20gIkAvaTE4bnMvaTE4biI7CmltcG9ydCB7IE1TRW51bSB9IGZyb20gIkAvY29tbW9ucy9lbnVtZXJhdGlvbiI7CmltcG9ydCBzdG9yZSBmcm9tICJAL3N0b3Jlcy9zdG9yZSI7CmltcG9ydCB7IE1vZHVsZUNvbnRleHQgfSBmcm9tICJAL3N0b3Jlcy9tb2R1bGUtY29uc3QiOwppbXBvcnQgXyBmcm9tICJsb2Rhc2giOwppbXBvcnQgbW9tZW50IGZyb20gIm1vbWVudCI7CmltcG9ydCBtZXNzYWdlQm94IGZyb20gIkAvY29tbW9ucy9tZXNzYWdlQm94IjsgLy8gaW1wb3J0IEZpcmViYXNlIGZyb20gIkAvZmlyZWJhc2UvZmlyZWJhc2UiOwoKaW1wb3J0IG5vdGlmaWNhdGlvbkFQSSBmcm9tICJAL2FwaXMvbm90aWZpY2F0aW9uL25vdGlmaWNhdGlvbkFQSS5qcyI7CnZhciBudW1iZXJGb3JtYXQgPSBzdG9yZS5zdGF0ZVtNb2R1bGVDb250ZXh0XS5OdW1iZXJGb3JtYXQ7Cgp2YXIgbnVtZXJhbCA9IHJlcXVpcmUoIm51bWVyYWwiKTsKLyoqDQogKiBDbGFzcyBjaOG7qWEgY8OhYyBmdW5jdGlvbiBkw7luZyBjaHVuZyBjaG8gaOG7hyB0aOG7kW5nIHBow61hIGNsaWVudA0KICovCgoKdmFyIENvbW1vbkZ1bmN0aW9uID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBDb21tb25GdW5jdGlvbigpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBDb21tb25GdW5jdGlvbik7CiAgfQoKICBfY3JlYXRlQ2xhc3MoQ29tbW9uRnVuY3Rpb24sIFt7CiAgICBrZXk6ICJnZXRNYWluTG9hZGluZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TWFpbkxvYWRpbmcoKSB7CiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmJvZHkucXVlcnlTZWxlY3RvcigiI21sb2FkaW5nIik7CiAgICAgIHJldHVybiBlbDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtYXNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtYXNrKCkgewogICAgICB2YXIgZWwgPSB0aGlzLmdldE1haW5Mb2FkaW5nKCk7CgogICAgICBpZiAoZWwpIHsKICAgICAgICBlbC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAidW5tYXNrIiwKICAgIHZhbHVlOiBmdW5jdGlvbiB1bm1hc2soKSB7CiAgICAgIHZhciBlbCA9IHRoaXMuZ2V0TWFpbkxvYWRpbmcoKTsKCiAgICAgIGlmIChlbCkgewogICAgICAgIGVsLnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJpbmZvTG9nZ2luZyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5mb0xvZ2dpbmcoKSB7fQogICAgLyoqDQogICAgICogTG9nIGVycm9yDQogICAgICogQHBhcmFtIHsqfSBlcnJvcg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJlcnJvckxvZ2dpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVycm9yTG9nZ2luZyhlcnJvcikgewogICAgICBjb25zb2xlLmVycm9yKGVycm9yKTsKICAgIH0KICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGV4Y2VwdGlvbg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVFeGNlcHRpb24iLAogICAgdmFsdWU6IGZ1bmN0aW9uIGhhbmRsZUV4Y2VwdGlvbihlcnJvciwgc2hvd0FsZXJ0KSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwoKICAgICAgaWYgKHNob3dBbGVydCkgewogICAgICAgIHZhciBtc2dCb3ggPSBtZXNzYWdlQm94LAogICAgICAgICAgICBsb2NhbGl6ZSA9IGkxOG47CiAgICAgICAgbXNnQm94LnNob3dFcnJvcihsb2NhbGl6ZS50KCJpMThuQ29tbW9uLkdsb2JhbEVycm9yTWVzc2FnZSIpKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70gaGnhu4NuIHRo4buLIGRpYWxvZw0KICAgICAqIEBhdXRob3IgRE5UaGFuZyAtIDMwLjEwLjIwMTkNCiAgICAgKiBETlRoYW5nIC0gMDYuMDUuMjAyMDogVHJvbmcgdHLGsOG7nW5nIGjhu6NwIG93bmVyIGzDoCBwb3B1cCB0aMOsIHPhur0gYXBwZW5kIHbDoG8gY29udGVudCDEkeG7gyBraMO0bmcgYuG7iyBjaMOsbSDhu58gZMaw4bubaQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwcmVwYXJlRm9yRGlhbG9nIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcmVwYXJlRm9yRGlhbG9nKGNvbXBvbmVudCwgb3duZXIsIG9wdGlvbnMpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChvd25lciAmJiBjb21wb25lbnQpIHsKICAgICAgICB2YXIgZnJtVHlwZSA9IFZ1ZS5leHRlbmQoY29tcG9uZW50KSwKICAgICAgICAgICAgZnJtID0gbmV3IGZybVR5cGUob3B0aW9ucyk7CiAgICAgICAgZnJtLiRtb3VudCgpOwoKICAgICAgICBpZiAob3duZXIuaXNNc1BvcHVwKSB7CiAgICAgICAgICB2YXIgY29udGVudEVsZW1lbnQgPSBvd25lci4kcmVmcy5wb3B1cHg7IC8vb3duZXIuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5tcy1wb3B1cC1jb250ZW50Lm1zLXBvcHVwJyk7CgogICAgICAgICAgY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChvd25lciBpbnN0YW5jZW9mIEVsZW1lbnQpIHsKICAgICAgICAgICAgb3duZXIuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvd25lci4kZWwuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZnJtOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CiAgICAvKioNCiAgICAgKiBCdWlsZCB2dWUga2V5IGNobyBkYXRhDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdlblZLZXlWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuVktleVZhbHVlKGRhdGEpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBmaWVsZCA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogIl9fdktleVZhbHVlIjsKCiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICBpdGVtW2ZpZWxkXSA9IF90aGlzLmdlbmVyYXRlVVVJRCgpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiAgVOG6oW8gdXVpZA0KICAgICAqICBDcmVhdGUgYnk6IHB2ZHVvbmcxIC0gMzAvMDgvMjAxOQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZW5lcmF0ZVVVSUQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlVVVJRCgpIHsKICAgICAgcmV0dXJuICJ4eHh4eHh4eC14eHh4LTR4eHgteXh4eC14eHh4eHh4eHh4eHgiLnJlcGxhY2UoL1t4eV0vZywgZnVuY3Rpb24gKGMpIHsKICAgICAgICB2YXIgZCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgICAgIGQgKz0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgICAgdmFyIHIgPSAoZCArIE1hdGgucmFuZG9tKCkgKiAxNikgJSAxNiB8IDA7CiAgICAgICAgZCA9IE1hdGguZmxvb3IoZCAvIDE2KTsKICAgICAgICByZXR1cm4gKGMgPT09ICJ4IiA/IHIgOiByICYgMHgzIHwgMHg4KS50b1N0cmluZygxNik7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICogR3VpbGQgZW1wdHkNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2VuZXJhdGVFbXB0eVVVSUQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdlbmVyYXRlRW1wdHlVVUlEKCkgewogICAgICByZXR1cm4gIjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMCI7CiAgICB9CiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIDIgxJHhu5FpIHTGsOG7o25nIGPDsyBwaOG6o2kgbMOgIGNoYSBjb24gY+G7p2EgbmhhdSBraMO0bmcNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFzUGFyZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNQYXJlbnQoY2hpbGQsIHBhcmVudCkgewogICAgICBpZiAoY2hpbGQucGFyZW50RWxlbWVudCkgewogICAgICAgIGlmIChjaGlsZC5wYXJlbnRFbGVtZW50ID09PSBwYXJlbnQpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5oYXNQYXJlbnQoY2hpbGQucGFyZW50RWxlbWVudCwgcGFyZW50KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgxJHhu5FpIHTGsOG7o25nIGPDsyBjbGFzcyBzdHlsZSBraMO0bmcNCiAgICAgKiBNb2RpZmllZCBubnRhbTogdGjDqm0gY2FzZSBj4buRaSB2w6BvIGNobyBraMO0bmcgY2jhur90DQogICAgICovCgogIH0sIHsKICAgIGtleTogImhhc0NsYXNzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoYXNDbGFzcyhlbGVtZW50LCBjbGFzc05hbWUpIHsKICAgICAgaWYgKGVsZW1lbnQgJiYgZWxlbWVudC5jbGFzc05hbWUpIHsKICAgICAgICByZXR1cm4gZWxlbWVudC5jbGFzc05hbWUuaW5kZXhPZihjbGFzc05hbWUpID4gLTE7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKg0KICAgICogVGjhu7FjIGhp4buHbiBmb3JtYXQgxJHhu4tuaCBk4bqhbmcgxJHGoW4gZ2nDoSBxdXkgxJHhu5VpDQogICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9ybWF0TnVtYmVyRGlzcGxheSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9ybWF0TnVtYmVyRGlzcGxheShudW0sIG9wdGlvbnMpIHsKICAgICAgdmFyIHJlc3VsdCA9IG51bTsKCiAgICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMub3B0aW9uRm9ybWF0ID09IE1TRW51bS5PcHRpb25Gb3JtYXQuWmVyb1RvRW1wdHkgJiYgbnVtID09PSAwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGlmICh0eXBlb2YgbnVtID09PSAndW5kZWZpbmVkJyB8fCBudW0gPT09IG51bGwpIHsKICAgICAgICByZXR1cm4gIi0iOwogICAgICB9CgogICAgICBpZiAobnVtICE9IHVuZGVmaW5lZCAmJiBudW0gIT0gbnVsbCkgewogICAgICAgIC8vICYmIHNlc3Npb24gICAgICAgICAgIAogICAgICAgIHZhciBkaWdpdHMgPSAwLAogICAgICAgICAgICAvL251bWJlckZvcm1hdC5Vbml0UHJpY2VEZWNpbWFsRGlnaXRzLAogICAgICAgIGJ1aWxkRGlnaXRzID0gMDsKICAgICAgICB0aGlzLmZvcm1hdFNlcGVyYXRvcihvcHRpb25zKTsKICAgICAgICByZXN1bHQgPSBudW1lcmFsKE51bWJlcihudW0pKS5mb3JtYXQoIjAsIiArIGJ1aWxkRGlnaXRzLnRvRml4ZWQoZGlnaXRzKSk7CiAgICAgICAgcmVzdWx0ID0gdGhpcy5mb3JtYXROZWdhdGl2ZShyZXN1bHQpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqDQogICAgKiBGb3JtYXQgxJHhu4tuaCBk4bqhbmcgc+G7kSB24bubaSBrw60gdOG7sSBuZ8SDbiBjw6FjaCB0csOqbiB0w7l5IGNo4buNbiB0aGVvIGLDoW8gY8OhbyBob+G6t2MgY8OhYyBmb3JtIHRoxrDhu51uZw0KICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgOiB0w7l5IGNo4buNbiBo4buHIHRo4buRbmcNCiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JtYXRTZXBlcmF0b3IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvcm1hdFNlcGVyYXRvcihvcHRpb25zKSB7CiAgICAgIHZhciBkZWNpbWFsQ2hhcmFjdGVyID0gbnVtYmVyRm9ybWF0LkdlbmVyYWxEZWNpbWFsU2VwYXJhdG9yLAogICAgICAgICAgZGlnaXRHcm91cFNlcGFyYXRvciA9IG51bWJlckZvcm1hdC5HZW5lcmFsR3JvdXBTZXBhcmF0b3I7CgogICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmlzUmVwb3J0KSB7CiAgICAgICAgZGVjaW1hbENoYXJhY3RlciA9IHNlc3Npb24uR2VuZXJhbERlY2ltYWxTZXBhcmF0b3JSZXBvcnQ7CiAgICAgICAgZGlnaXRHcm91cFNlcGFyYXRvciA9IHNlc3Npb24uR2VuZXJhbEdyb3VwU2VwYXJhdG9yUmVwb3J0OwogICAgICB9CgogICAgICBudW1lcmFsLmxvY2FsZURhdGEoKS5kZWxpbWl0ZXJzLmRlY2ltYWwgPSBkZWNpbWFsQ2hhcmFjdGVyOwogICAgICBudW1lcmFsLmxvY2FsZURhdGEoKS5kZWxpbWl0ZXJzLnRob3VzYW5kcyA9IGRpZ2l0R3JvdXBTZXBhcmF0b3I7CiAgICB9CiAgICAvKioNCiAgICAgKiBmb3JtYXQgc+G7kSDDom0gdGhlbyBj4bqldSBow6xuaA0KICAgICAqIEBwYXJhbSB7Kn0gdmFsdWUgDQogICAgICogQHJldHVybnMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZvcm1hdE5lZ2F0aXZlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb3JtYXROZWdhdGl2ZSh2YWx1ZSkgewogICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnLScpKSB7CiAgICAgICAgdmFyIEN1cnJlbmN5TmVnYXRpdmVQYXR0ZXJuID0gMDsKCiAgICAgICAgc3dpdGNoIChDdXJyZW5jeU5lZ2F0aXZlUGF0dGVybikgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICB2YWx1ZSA9IFsnKCcsIHZhbHVlLnN1YnN0cigxKSwgJyknXS5qb2luKCcnKTsKICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cigxKSArICctJzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvcnRrZXlQdXNoVmlldyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2hvcnRrZXlQdXNoVmlldyhlbCkgewogICAgICB3aW5kb3cuc2hvcnRrZXlWaWV3LnJlbW92ZShlbCk7CiAgICAgIHdpbmRvdy5zaG9ydGtleVZpZXcucHVzaChlbCk7CiAgICB9CiAgfSwgewogICAga2V5OiAic2hvcnRrZXlQb3BWaWV3IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzaG9ydGtleVBvcFZpZXcoZWwpIHsKICAgICAgd2luZG93LnNob3J0a2V5Vmlldy5yZW1vdmUoZWwpOwogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70gcmVuZGVyIGVsZW1lbnQgxJHhu5luZw0KICAgICAqIG1vZGlmaWVkIGJ5IG50cGhvbmcgMjgvNS8yMDIxIC0gaXNBcHBlbmRUYXJnZXQ6IG7hur91IGzDoCBhcHBlbmQgMSDEkW/huqFuIGNvZGUgaHRtbCB2w6BvIDEgdHJvbmcgdGFyZ2V0DQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbmRlckR5bmFtaWNFbGVtZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW5kZXJEeW5hbWljRWxlbWVudCh0YXJnZXQsIGNvbXBvbmVudCwgb3duZXIsIG9wdGlvbnMsIGlzQXBwZW5kVGFyZ2V0KSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoY29tcG9uZW50KSB7CiAgICAgICAgdmFyIGZybVR5cGUgPSBWdWUuZXh0ZW5kKGNvbXBvbmVudCksCiAgICAgICAgICAgIGZybSA9IG5ldyBmcm1UeXBlKG9wdGlvbnMpOwogICAgICAgIGZybS4kbW91bnQoKTsKCiAgICAgICAgaWYgKHRhcmdldCAmJiBpc0FwcGVuZFRhcmdldCAmJiBmcm0uJGVsKSB7CiAgICAgICAgICB0YXJnZXQuYXBwZW5kQ2hpbGQoZnJtLiRlbCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZnJtOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBmb2N1cyB2w6BvIGNvbnRyb2wgdHLGsOG7m2MgxJHDsw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1c1ByZXZpZXdDb250cm9sIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb2N1c1ByZXZpZXdDb250cm9sKGN1cmZvY3VzKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICB2YXIgZm4gPSBmdW5jdGlvbiBmbihwYXJlbnQpIHsKICAgICAgICB2YXIgaXRlbXMgPSBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgiaW5wdXQ6bm90KFtkaXNhYmxlZF0pLGJ1dHRvbjpub3QoW2Rpc2FibGVdKSxhIik7CgogICAgICAgIGlmIChpdGVtc1swXSAhPT0gY3VyZm9jdXMpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGl0ZW1zW2ldID09PSBjdXJmb2N1cykgewogICAgICAgICAgICAgIGZvciAodmFyIGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgICAgICAgIC8vY2hlY2sgaXRlbSB2aXNpYmxlCiAgICAgICAgICAgICAgICBpZiAobWUuaXNWaXNpYmxlKGl0ZW1zW2pdKSkgewogICAgICAgICAgICAgICAgICBpdGVtc1tqXS5mb2N1cygpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSAvL3Jlc2V0IGZvY3VzIHRvIHBhcmVudAoKCiAgICAgICAgICAgICAgY3VyZm9jdXMgPSBwYXJlbnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZuKHBhcmVudC5wYXJlbnRFbGVtZW50KTsKICAgICAgfTsKCiAgICAgIGZuKGN1cmZvY3VzLnBhcmVudEVsZW1lbnQpOwogICAgfQogICAgLyoqDQogICAgICAvKioNCiAgICAgKiBmb2N1cyB2w6BvIGNvbnRyb2wgdGnhur9wIHRoZW8NCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9jdXNOZXh0Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXNOZXh0Q29udHJvbChjdXJmb2N1cykgewogICAgICB2YXIgZWwgPSB0aGlzLmdldE5leHRJbnB1dENvbnRyb2woY3VyZm9jdXMpOwoKICAgICAgaWYgKGVsKSB7CiAgICAgICAgZWwuZm9jdXMoKTsKCiAgICAgICAgaWYgKHR5cGVvZiBlbC5zZWxlY3QgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIGVsLnNlbGVjdCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIEtp4buDbSB0cmEgZWxlbWVudCBjw7MgaGnhu4NuIHRo4buLIGtow7RuZw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJpc1Zpc2libGUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzVmlzaWJsZShlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50Lm9mZnNldFBhcmVudDsKICAgIH0KICAgIC8qDQogICAgICogTOG6pXkgY29udHJvbCBuaOG6rXAgbGnhu4d1IHRp4bq/cCB0aGVvDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldE5leHRJbnB1dENvbnRyb2wiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldE5leHRJbnB1dENvbnRyb2woY3VycmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgLy9pID0gYy5pbmRleCgpLAogICAgICBwID0gY3VycmVudC5wYXJlbnROb2RlOwoKICAgICAgaWYgKCFwKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIHZhciBjaCA9IHAuY2hpbGRyZW4sCiAgICAgICAgICByID0gbnVsbCwKICAgICAgICAgIG8sCiAgICAgICAgICBpID0gMDsKCiAgICAgIGZvciAoOyBpIDwgY2gubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoY2hbaV0gPT09IGN1cnJlbnQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZm9yICh2YXIgayA9IGkgKyAxOyBrIDwgY2gubGVuZ3RoOyBrKyspIHsKICAgICAgICBvID0gY2hba107CgogICAgICAgIGlmIChbIklOUFVUIiwgIlRFWFRBUkUiLCAiQlVUVE9OIiwgIkEiXS5pbmRleE9mKG8udGFnTmFtZSkgPiAtMSAmJiAhby5nZXRBdHRyaWJ1dGUoImRpc2FibGVkIikgJiYgIW8uZ2V0QXR0cmlidXRlKCJ0YWJpbmRleCIpICE9PSAtMSAmJiBtZS5pc1Zpc2libGUobykpIHsKICAgICAgICAgIHIgPSBvOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByID0gbWUuZ2V0Rmlyc3RDb250cm9sRm9jdXMobyk7CiAgICAgICAgfQoKICAgICAgICBpZiAocikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXIpIHsKICAgICAgICByID0gbWUuZ2V0TmV4dElucHV0Q29udHJvbChwKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHI7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSBjb250cm9sIG5o4bqtcCBsaeG7h3UgxJHhuqd1IHRpw6puDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEZpcnN0Q29udHJvbEZvY3VzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGaXJzdENvbnRyb2xGb2N1cyhwYXJlbnQpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIG9iaiA9IHBhcmVudCB8fCBkb2N1bWVudCwKICAgICAgICAgIHNlbGVjdG9yID0gWydpbnB1dDpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD0iLTEiXSknLCAndGV4dGFyZWE6bm90KFtkaXNhYmxlZF0pOm5vdChbdGFiaW5kZXg9Ii0xIl0pJywgJ3NlbGVjdDpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD0iLTEiXSknLCAnYnV0dG9uOm5vdChbZGlzYWJsZWRdKTpub3QoW3RhYmluZGV4PSItMSJdKTpub3QoLm1zLWNvbi1kcm9wZG93biknLCAnYTpub3QoW2Rpc2FibGVkXSk6bm90KFt0YWJpbmRleD0iLTEiXSk6bm90KC5tcy1jb2xsYXBzZS1pdGVtLS1oZWFkZXIpJ10uam9pbigiLCIpOwogICAgICB2YXIgaXRlbXMgPSBvYmoucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CgogICAgICBpZiAoaXRlbXMgIT0gbnVsbCAmJiBpdGVtcy5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tpXTsKCiAgICAgICAgICBpZiAobWUuaXNWaXNpYmxlKGl0ZW0pKSB7CiAgICAgICAgICAgIHJldHVybiBpdGVtOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioNCiAgICAgKiBUw6xtIHJhIGNvbnRyb2wgSW5wdXQgxJHhuqd1IHRpw6puIHRoZW8gc2NvcGUgdHJ1eeG7gW4gdsOgbyB2w6AgY2hvIHBow6lwIHPhu61hDQogICAgICogQHBhcmFtIHtFbGVtZW50fSBzY29wZSBQYXJlbnQgY+G6p24gdMOsbSBpbnB1dA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaW5kRmlyc3RDb250cm9sSW5wdXQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRGaXJzdENvbnRyb2xJbnB1dChzY29wZSkgewogICAgICBpZiAoc2NvcGUgJiYgc2NvcGUucXVlcnlTZWxlY3RvcikgewogICAgICAgIHZhciBpbnB1dCA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3IoImlucHV0Om5vdChbdHlwZT1idXR0b25dKTpub3QoW3R5cGU9cmFkaW9dKTpub3QoW3R5cGU9Y2hlY2tib3hdKTpub3QoW3JlYWRvbmx5XSk6bm90KFtkaXNhYmxlZF0pOm5vdChbY2xhc3M9J2hpZGRlbiddKSx0ZXh0YXJlYTpub3QoW3JlYWRvbmx5XSk6bm90KFtkaXNhYmxlZF0pOm5vdChbY2xhc3M9J2hpZGRlbiddKSIpOwogICAgICAgIHJldHVybiBpbnB1dDsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQogICAgLyoqDQogICAgICogVOG7sSDEkeG7mW5nIGZvY3VzIHbDoG8gY29udHJvbCBuaOG6rXAgbGnhu4d1IMSR4bqndSB0acOqbiB0aGVvIHNjb3BlIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcGFyYW0ge0VsZW1lbnR9IHNjb3BlIFBo4bqhbSB2aSBj4bqnbiB44butIGzDvSBmb2N1cw0KICAgICAqIEBhdXRob3IgRE5UaGFuZyAtIDMxLjEwLjIwMTkNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9jdXNGaXJzdENvbnRyb2xJbnB1dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXNGaXJzdENvbnRyb2xJbnB1dChzY29wZSkgewogICAgICB2YXIgc2VsZWN0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOwogICAgICB2YXIgbWUgPSB0aGlzOyAvLyBzZXRUaW1lb3V0KCgpID0+IHsKCiAgICAgIHZhciBpbnB1dCA9IG1lLmZpbmRGaXJzdENvbnRyb2xJbnB1dChzY29wZSk7CgogICAgICBpZiAoaW5wdXQpIHsKICAgICAgICBpbnB1dC5mb2N1cygpOwoKICAgICAgICBpZiAoc2VsZWN0ICYmIHR5cGVvZiBpbnB1dC5zZWxlY3QgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgIGlucHV0LnNlbGVjdCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL27hur91IGsgY8OzIGlucHV0IG7DoG8gxJHhu4MgZm9jdXMgdGjDrCBmb2N1cyB2w6BvIGTDsm5nIMSR4bqndSB0acOqbiBj4bunYSBncmlkKCBu4bq/dSBjw7MgKSDEkeG7gyBjw7MgdGjhu4MgdGjhu7FjIGhp4buHbiBwaMOtbSB04bqvdCBrZXlkb3duIHVwL2Rvd24gxJHhu4MgY2jhu41uIGTDsm5nCiAgICAgICAgbWUuZm9jdXNGaXJzdFJvd0dyaWQoc2NvcGUpOwogICAgICB9IC8vIH0pOwoKICAgIH0KICAgIC8qKg0KICAgICAqIFThu7EgxJHhu5luZyBmb2N1cyB2w6BvIGNvbnRyb2wgbmjhuq1wIGxp4buHdSDEkeG6p3UgdGnDqm4gdGhlbyBzY29wZSB0cnV54buBbiB2w6BvDQogICAgICogQHBhcmFtIHtFbGVtZW50fSBzY29wZSBQaOG6oW0gdmkgY+G6p24geOG7rSBsw70gZm9jdXMNCiAgICAgKiBAYXV0aG9yIGJuZHVjIC0gMTUuMTEuMjAxOQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb2N1c0ZpcnN0Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9jdXNGaXJzdENvbnRyb2woc2NvcGUpIHsKICAgICAgaWYgKHNjb3BlKSB7CiAgICAgICAgdmFyIG1lID0gdGhpczsgLy8gc2V0VGltZW91dCgoKSA9PiB7CgogICAgICAgIHZhciBpbnB1dDsKCiAgICAgICAgaWYgKHNjb3BlLnR5cGUgPT09ICJ0ZXh0IiB8fCBzY29wZS5oYXNBdHRyaWJ1dGUgJiYgc2NvcGUuaGFzQXR0cmlidXRlKCJ0eXBlIikgJiYgc2NvcGUuZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT09ICJ0ZXh0IikgewogICAgICAgICAgaW5wdXQgPSBzY29wZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW5wdXQgPSBtZS5maW5kRmlyc3RDb250cm9sRm9jdXMoc2NvcGUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGlucHV0KSB7CiAgICAgICAgICBpbnB1dC5mb2N1cygpOwogICAgICAgIH0gLy8gfSk7CgogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBU4buxIMSR4buZbmcgZm9jdXMgdsOgbyBjb250cm9sIG5o4bqtcCBsaeG7h3UgdsOgbyBkw7JuZyDEkeG6p3UgdGnDqm4gY+G7p2EgZ3JpZCggbuG6v3UgY8OzICkgxJHhu4MgY8OzIHRo4buDIHRo4buxYyBoaeG7h24gcGjDrW0gdOG6r3Qga2V5ZG93biB1cC9kb3duIMSR4buDIGNo4buNbiBkw7JuZw0KICAgICAqIEBwYXJhbSB7RWxlbWVudH0gc2NvcGUgUGjhuqFtIHZpIGPhuqduIHjhu60gbMO9IGZvY3VzDQogICAgICogQGF1dGhvciBubmxhbSAtIDE2LjA2LjIwMjENCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9jdXNGaXJzdFJvd0dyaWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZvY3VzRmlyc3RSb3dHcmlkKHNjb3BlKSB7CiAgICAgIGlmIChzY29wZSkgewogICAgICAgIHZhciBtZSA9IHRoaXM7IC8vIHNldFRpbWVvdXQoKCkgPT4gewoKICAgICAgICB2YXIgZ3JpZDsKCiAgICAgICAgaWYgKG1lLmdyaWQpIHsKICAgICAgICAgIGdyaWQgPSBtZS5ncmlkLiRlbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZ3JpZCA9IG1lLmZpbmRGaXJzdEdyaWQoc2NvcGUpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGdyaWQpIHsKICAgICAgICAgIC8vbWUuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIGlmIChncmlkICYmICFncmlkLmNsYXNzTGlzdC5jb250YWlucygnbm90QXV0b0ZvY3VzJykpIHsKICAgICAgICAgICAgdmFyIHRyRmlyc3QgPSBncmlkLnF1ZXJ5U2VsZWN0b3IoIi5tcy10Ym9keS5kYXRhIHRyIik7CgogICAgICAgICAgICBpZiAodHJGaXJzdCkgewogICAgICAgICAgICAgIHRyRmlyc3QuZm9jdXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogVMOsbSByYSBjb250cm9sIElucHV0IMSR4bqndSB0acOqbiB0aGVvIHNjb3BlIHRydXnhu4FuIHbDoG8gdsOgIGNobyBwaMOpcCBz4butYQ0KICAgICAqIEBwYXJhbSB7RWxlbWVudH0gc2NvcGUgUGFyZW50IGPhuqduIHTDrG0gaW5wdXQNCiAgICAgKiBAYXV0aG9yIGJuZHVjIC0gMTUuMTEuMjAxOQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaW5kRmlyc3RDb250cm9sRm9jdXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRGaXJzdENvbnRyb2xGb2N1cyhzY29wZSkgewogICAgICBpZiAoc2NvcGUgJiYgc2NvcGUucXVlcnlTZWxlY3RvcikgewogICAgICAgIHZhciBpbnB1dCA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3IoImlucHV0Om5vdChbcmVhZG9ubHldKTpub3QoW2Rpc2FibGVkXSksYnV0dG9uOm5vdChbZGlzYWJsZV0pLGEsdGV4dGFyZWEiKTsKICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgIH0KCiAgICAgIHJldHVybjsKICAgIH0KICAgIC8qKg0KICAgICAqIFTDrG0gcmEgZ3JpZCDEkeG6p3UgdGnDqm4gY+G7p2EgZm9ybQ0KICAgICAqIEBwYXJhbSB7RWxlbWVudH0gc2NvcGUgUGFyZW50IGPhuqduIHTDrG0gZ3JpZA0KICAgICAqIEBhdXRob3Igbm5sYW0gLSAxNi4wNi4yMDIxDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbmRGaXJzdEdyaWQiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbmRGaXJzdEdyaWQoc2NvcGUpIHsKICAgICAgaWYgKHNjb3BlICYmIHNjb3BlLnF1ZXJ5U2VsZWN0b3IpIHsKICAgICAgICB2YXIgZ3JpZCA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3IoIi5tcy1ncmlkLXZpZXdlciIpOwogICAgICAgIHJldHVybiBncmlkOwogICAgICB9CgogICAgICByZXR1cm47CiAgICB9CiAgICAvKioNCiAgICAgKiBY4butIGzDvSBraGkgZm9jdXMgY29udHJvbCBjdeG7kWkgY8O5bmcgdGjDrCBz4bq9IHRo4buxYyB0aGkgZm4NCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicHJvY2Vzc1VuZm9jdXNMYXN0Q29udHJvbCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzc1VuZm9jdXNMYXN0Q29udHJvbChlLCBmbikgewogICAgICBpZiAoZS53aGljaCA9PT0gOSAmJiAhZS5zaGlmdEtleSkgewogICAgICAgIC8vY29uc29sZS5sb2coZS50YXJnZXQuYXR0cmlidXRlcy5jbGFzcy52YWx1ZSk7CiAgICAgICAgdmFyIGN1ciA9IGUudGFyZ2V0OwogICAgICAgIHZhciBlbHMgPSBlLmN1cnJlbnRUYXJnZXQucXVlcnlTZWxlY3RvckFsbCgiKiIpOwogICAgICAgIHZhciBmbGFnID0gdHJ1ZTsKCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGlmIChlbHNbaV0gPT09IGN1cikgewogICAgICAgICAgICBmbGFnID0gZmFsc2U7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmbGFnKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGVsc1tpXS5mb2N1cygpOwoKICAgICAgICAgIGlmIChlbHNbaV0gPT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgfSAvL2ZvY3VzIGZpcnN0IGNvbnRyb2wKCgogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBmbigpOwogICAgICB9CiAgICB9CiAgICAvKioNCiAgICAgKiBLaeG7g20gdHJhIDIgxJHDtGkgdMaw4bujbmcgY8OzIGtow6FjIG5oYXUga2jDtG5nDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNoZWNrRGlmZiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tEaWZmKG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIHZhciByZXQgPSBmYWxzZTsKCiAgICAgIGlmIChfdHlwZW9mKG5ld1ZhbCkgPT0gIm9iamVjdCIgJiYgX3R5cGVvZihvbGRWYWwpID09ICJvYmplY3QiKSB7CiAgICAgICAgZm9yICh2YXIgZmllbGQgaW4gbmV3VmFsKSB7CiAgICAgICAgICBpZiAoX3R5cGVvZihuZXdWYWxbZmllbGRdKSAhPSAib2JqZWN0IiAmJiBuZXdWYWxbZmllbGRdICE9IG9sZFZhbFtmaWVsZF0pIHsKICAgICAgICAgICAgcmV0ID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfQogICAgLyoqDQogICAgICogcHZkdXkgMjgvMDYvMjAyMQ0KICAgICAqIGzhuql5IHJhIGRhbmggc8OhY2ggY8OhYyB0csaw4budbmcgdGhheSDEkeG7lWkgdsOgIGdpw6EgdHLhu4sgdGhheSDEkeG7lWkNCiAgICAgKiB0aMOqbSDEkW/huqFuIHjhu60gbMO9IHRyxrDhu51uZyBo4bujcCB0w6xtIHPhu7EgdGhheSDEkeG7lWkgY+G7rWEgZ2nDoSB0cuG7iyBkYXRldGltZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXREaWZmTGlzdFByb3BlcnR5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREaWZmTGlzdFByb3BlcnR5KG5ld1ZhbCwgb2xkVmFsKSB7CiAgICAgIHZhciBsaXN0RmllbGQgPSBbXTsKCiAgICAgIGlmIChfdHlwZW9mKG5ld1ZhbCkgPT0gIm9iamVjdCIgJiYgX3R5cGVvZihvbGRWYWwpID09ICJvYmplY3QiKSB7CiAgICAgICAgZm9yICh2YXIgZmllbGQgaW4gbmV3VmFsKSB7CiAgICAgICAgICBpZiAoX3R5cGVvZihuZXdWYWxbZmllbGRdKSAhPSAib2JqZWN0IiAmJiBuZXdWYWxbZmllbGRdICE9IG9sZFZhbFtmaWVsZF0pIHsKICAgICAgICAgICAgbGlzdEZpZWxkLnB1c2goZmllbGQpOwogICAgICAgICAgfSBlbHNlIGlmIChuZXdWYWxbZmllbGRdIGluc3RhbmNlb2YgRGF0ZSkgewogICAgICAgICAgICB2YXIgaXNDaGFuZ2UgPSBmYWxzZTsgLy8gbuG6v3UgMiBnacOhIHRy4buLIGtow6FjIG5oYXUgaG/hurdjIG3hu5l0IHRyb25nIDIgdGjhurFuZyBudWxsIHRow6wgeMOhYyBuaOG6rW4gc+G7sSB0aGF5IMSR4buVaS4KCiAgICAgICAgICAgIGlmIChuZXdWYWxbZmllbGRdICE9IG51bGwgJiYgb2xkVmFsW2ZpZWxkXSAhPSBudWxsICYmIHR5cGVvZiBuZXdWYWxbZmllbGRdLmdldFRpbWUgPT0gImZ1bmN0aW9uIiAmJiB0eXBlb2Ygb2xkVmFsW2ZpZWxkXS5nZXRUaW1lID09ICJmdW5jdGlvbiIgJiYgbmV3VmFsW2ZpZWxkXS5nZXRUaW1lKCkgIT0gb2xkVmFsW2ZpZWxkXS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgICBpc0NoYW5nZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3VmFsW2ZpZWxkXSA9PSBudWxsICYmIG9sZFZhbFtmaWVsZF0gIT0gbnVsbCB8fCBuZXdWYWxbZmllbGRdID09IG51bGwgJiYgb2xkVmFsW2ZpZWxkXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgaXNDaGFuZ2UgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaXNDaGFuZ2UpIHsKICAgICAgICAgICAgICBsaXN0RmllbGQucHVzaChmaWVsZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBsaXN0RmllbGQ7CiAgICB9IC8vQ2h1eeG7g24gZOG7ryBsaeG7h3UgdGjDoG5oIGThuqFuZyB0cmVlCiAgICAvLyBDcmVhdGVkIGJ5IExUREFUKDE2LjA2LjIwMjApCgogIH0sIHsKICAgIGtleTogIm5vbWFsaXplRGF0YVRyZWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIG5vbWFsaXplRGF0YVRyZWUoZGF0YSwgaWRGaWVsZCwgcGFyZW50RmllbGQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIHZhciBkYXRhVGVtcCA9IF90b0NvbnN1bWFibGVBcnJheShkYXRhKSwKICAgICAgICAgIHBhcmVudE5vZGVzID0gW107CgogICAgICBkYXRhVGVtcC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgIGlmICghaXRlbS5oYXNPd25Qcm9wZXJ0eSgicGFyZW50Tm9kZSIpKSB7CiAgICAgICAgICBpdGVtWyJwYXJlbnROb2RlIl0gPSBbXTsKICAgICAgICB9CgogICAgICAgIGlmIChpdGVtW3BhcmVudEZpZWxkXSkgewogICAgICAgICAgLy9Uw6xtIGNoYQogICAgICAgICAgdmFyIHBhcmVudCA9IF8uZmluZChkYXRhVGVtcCwgZnVuY3Rpb24gKG8pIHsKICAgICAgICAgICAgcmV0dXJuIG9baWRGaWVsZF0gPT09IGl0ZW1bcGFyZW50RmllbGRdOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKHBhcmVudCkgewogICAgICAgICAgICBpdGVtLnBhcmVudE5vZGUgPSBwYXJlbnQ7CgogICAgICAgICAgICBpZiAoIXBhcmVudC5oYXNPd25Qcm9wZXJ0eSgiY2hpbGROb2RlcyIpKSB7CiAgICAgICAgICAgICAgcGFyZW50WyJjaGlsZE5vZGVzIl0gPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFwYXJlbnQuaGFzT3duUHJvcGVydHkoImlzUGFyZW50IikpIHsKICAgICAgICAgICAgICBwYXJlbnRbImlzUGFyZW50Il0gPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwYXJlbnQuY2hpbGROb2Rlcy5wdXNoKGl0ZW0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGFyZW50Tm9kZXMucHVzaChpdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gTk1TSU5IOiB0aMOqbSBtw7NuIG7DoHkgdsOsIG7hur91IGNo4buNbiB0aOG6sW5nIGtvIGPDsyBDaGEgdHJvbmcgbGlzdCB0aMOsIG7DsyBjaMOtbmggbMOgIGNoYSBsdcO0bgogICAgICAgICAgcGFyZW50Tm9kZXMucHVzaChpdGVtKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gcGFyZW50Tm9kZXM7CiAgICB9CiAgICAvKioNCiAgICAgKiBUaOG7sWMgaGnhu4duIGdow6lwIGPDoWMgbm9kZSBjaGEgxJFpIGvDqG0gduG7m2kgY8OhYyBub2RlIGNvbiBsdcO0biDEkeG7gyB0aOG7sWMgaGnhu4duIHNob3cgcmEgbmdheSBiw6puIGTGsOG7m2kgbm9kZSBjaGENCiAgICAgKiBAcGFyYW0ge1tUcmVlTW9kZWxdfSBkYXRhUmVzb3VyZXMgRGFuaCBzw6FjaCBjw6FjIG5vZGUgY2hhIGPhuqduIHPhuq9wIHjhur9wDQogICAgICogQHBhcmFtIHsqfSBleHBhbmRlZCBDw7MgTeG7nyBy4buZbmcgcmEga2jDtG5nDQogICAgICogQHBhcmFtIHsqfSBsZXZlbA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRCb2R5RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Qm9keURhdGEoZGF0YVJlc291cmVzLCBleHBhbmRlZCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHZhciBsZXZlbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTsKICAgICAgdmFyIGNoaWxkTm9kZXMgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6ICJjaGlsZE5vZGVzIjsKCiAgICAgIGlmICghZGF0YVJlc291cmVzKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CgogICAgICB2YXIgZGF0YSA9IF90b0NvbnN1bWFibGVBcnJheShkYXRhUmVzb3VyZXMpOwoKICAgICAgdmFyIGJvZHlEYXRhID0gW107CiAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93LCBpbmRleCkgewogICAgICAgIHZhciBjaGlsZHJlbiA9IHJvd1tjaGlsZE5vZGVzXTsKICAgICAgICB2YXIgY2hpbGRyZW5MZW4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoY2hpbGRyZW4pLnNsaWNlKDgsIC0xKSA9PT0gIkFycmF5IiA/IGNoaWxkcmVuLmxlbmd0aCA6IDA7CiAgICAgICAgcm93LmxldmVsID0gbGV2ZWw7CiAgICAgICAgVnVlLnNldChyb3csICJpc0hpZGUiLCBmYWxzZSk7CiAgICAgICAgVnVlLnNldChyb3csICJleHBhbmRlZCIsIGV4cGFuZGVkKTsgLy8gcm93LmV4cGFuZGVkID0gZXhwYW5kZWQ7CgogICAgICAgIHJvdy5pc1NlbGVjdGVkID0gZmFsc2U7CiAgICAgICAgcm93Ll9pc1NlbGVjdGVkTXVsdGlwbGUgPSBmYWxzZTsKICAgICAgICBib2R5RGF0YS5wdXNoKHJvdyk7CgogICAgICAgIGlmIChjaGlsZHJlbkxlbiA+IDApIHsKICAgICAgICAgIHJvdy5fZXhwYW5kYWJsZSA9IHRydWU7CiAgICAgICAgICBib2R5RGF0YSA9IGJvZHlEYXRhLmNvbmNhdChfdGhpczIuZ2V0Qm9keURhdGEoY2hpbGRyZW4sIGV4cGFuZGVkLCBsZXZlbCArIDEpKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gYm9keURhdGE7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSBnacOhIHRy4buLIGVudW0gdGhlbyB0ZXh0DQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEVudW1WYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RW51bVZhbHVlKGVudW1OYW1lLCB0ZXh0KSB7CiAgICAgIHZhciBzb3VyY2UgPSB0aGlzLmdldEVudW1Tb3VyY2UoZW51bU5hbWUpOwogICAgICB2YXIgdGV4dFRyaW0gPSB0ZXh0LnRyaW0oKTsKCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc291cmNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFyIGl0ZW0gPSBzb3VyY2VbaV07CgogICAgICAgIGlmICh0ZXh0VHJpbSA9PT0gaXRlbS5lbnVtVGV4dCkgewogICAgICAgICAgcmV0dXJuIGl0ZW0uZW51bVZhbHVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSByYSBnacOhIHRy4buLIGtleSBj4bunYSBlbnVtIHRoZW8gdmFsdWUNCiAgICAgKiBAcGFyYW0ge051bWJlcn0gdmFsdWUgR2nDoSB0cuG7iyBj4bunYSBlbnVtIGPhuqduIGzhuqV5IHJhIGVudW0gdGV4dA0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBlbnVtTmFtZSBFbnVtTmFtZSDEkeG7gyBnZXQgdGV4dA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRFbnVtVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RW51bVRleHQodmFsdWUsIGVudW1OYW1lKSB7CiAgICAgIHZhciBlID0gTVNFbnVtW2VudW1OYW1lXSwKICAgICAgICAgIGxvY2FsaXplID0gaTE4bjsKCiAgICAgIGlmIChlKSB7CiAgICAgICAgZm9yICh2YXIga2V5IGluIGUpIHsKICAgICAgICAgIGlmIChlLmhhc093blByb3BlcnR5KGtleSkgJiYgZVtrZXldID09PSB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4ga2V5OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgcmEgcmVzb3VyY2UgdGhlbyBlbnVtDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIEdpw6EgdHLhu4sgY+G7p2EgZW51bSBj4bqnbiBs4bqleSByYSBlbnVtIHJlc291cmNlDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGVudW1OYW1lIEVudW1OYW1lIMSR4buDIGdldCB0ZXh0DQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEVudW1SZXNvdXJjZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0RW51bVJlc291cmNlKHZhbHVlLCBlbnVtTmFtZSkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgbG9jYWxpemUgPSBpMThuOwogICAgICB2YXIga2V5ID0gbWUuZ2V0RW51bVRleHQodmFsdWUsIGVudW1OYW1lKTsKICAgICAgdmFyIHJlc291cmNlS2V5ID0gZW51bU5hbWUgKyAiLiIgKyBrZXk7CiAgICAgIHZhciB0ZXh0ID0gbG9jYWxpemUudCgiaTE4bkVudW0uIiArIHJlc291cmNlS2V5KTsKICAgICAgcmV0dXJuIHRleHQ7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSBlbnVtc291cmNlIHbhu5tpIHTDqm4gZW51bSB0cnV54buBbiB2w6BvDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGVudW1OYW1lIFTDqm4gZW51bSB0cm9uZyBlbnVtZXJhdGlvbg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHZhbHVlcyBEYW5oIHPDoWNoIGPDoWMgZW51bSBs4bqleSByYSAobuG6v3UgY+G6p24gY2jhu4kgxJHhu4tuaCksIG7hur91IGtow7RuZyB0aMOsIHPhur0gbOG6pXkgdOG6pXQgY+G6ow0KICAgICAqIEBwYXJhbSB7Qm9vbGVhbn0gcHJlZml4SWR4IEPDsyBrw6htIHRoZW8gdGnhu4FuIHThu5EgaW5kZXgga2jDtG5nOiB0cnVlIC0gY8OzLCBmYWxzZSAtIGtow7RuZyAoTeG6t2MgxJHhu4tuaCBraMO0bmcpDQogICAgICogVkQ6IGdldEVudW1Tb3VyY2UoIkVudW1DQUJBUmVhc29uVHlwZSIsWzEwLDExLDEyLDEzXSkNCiAgICAgKiBDcmVhdGVkQnk6IFBES0lFTiAxNS8wOC8yMDE5DQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEVudW1Tb3VyY2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEVudW1Tb3VyY2UoZW51bU5hbWUsIHZhbHVlcywgcHJlZml4SWR4KSB7CiAgICAgIHZhciBlID0gTVNFbnVtW2VudW1OYW1lXSwKICAgICAgICAgIGFyciA9IFtdLAogICAgICAgICAgbG9jYWxpemUgPSBpMThuOwoKICAgICAgaWYgKGUpIHsKICAgICAgICB2YXIgaWR4ID0gMDsKCiAgICAgICAgZm9yICh2YXIga2V5IGluIGUpIHsKICAgICAgICAgIGlmIChlLmhhc093blByb3BlcnR5KGtleSkpIHsKICAgICAgICAgICAgdmFyIHYgPSBlW2tleV0sCiAgICAgICAgICAgICAgICBpeCA9IC0xOwoKICAgICAgICAgICAgaWYgKCF2YWx1ZXMgfHwgKGl4ID0gdmFsdWVzLmluZGV4T2YodikpID4gLTEpIHsKICAgICAgICAgICAgICAvKg0KICAgICAgICAgICAgICAgKiBz4butYSBs4bqhaSBjw6FjaCBs4bqleSBk4buvIGxp4buHdSB0aGVvIGVudW0NCiAgICAgICAgICAgICAgICogcHZkdXkgMDIvMDIvMjAyMA0KICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICB2YXIgZW51bVRleHQgPSBsb2NhbGl6ZS50KCJpMThuRW51bS4iICsgZW51bU5hbWUgKyAiLiIgKyBrZXkpOwoKICAgICAgICAgICAgICBpZiAocHJlZml4SWR4KSB7CiAgICAgICAgICAgICAgICBlbnVtVGV4dCA9ICsraWR4ICsgIi4gIiArIGVudW1UZXh0OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7CiAgICAgICAgICAgICAgICBlbnVtVmFsdWU6IHYsCiAgICAgICAgICAgICAgICBlbnVtS2V5OiBrZXksCiAgICAgICAgICAgICAgICBlbnVtVGV4dDogZW51bVRleHQKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoaXggPiAtMSkgewogICAgICAgICAgICAgICAgLy8gRFZRVUFOOiBz4butYSBs4bqhaSBjw6FjaCBs4bqleSBlbnVtIHNvdXJjZSB24bubaSB0csaw4budbmcgaOG7o3AgOSB2w6AgOTkgPT4ga2jDtG5nIGzhuqV5IMSRxrDhu6NjIDEgdHJvbmcgMgogICAgICAgICAgICAgICAgaWYgKGFycltpeF0pIHsKICAgICAgICAgICAgICAgICAgYXJyW2Fyci5sZW5ndGhdID0gaXRlbTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGFycltpeF0gPSBpdGVtOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBhcnIucHVzaChpdGVtKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiBhcnI7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSB0aGFtIHPhu5EgdHLDqm4gcXVlcnkgc3RyaW5nDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFVybFBhcmFtcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0VXJsUGFyYW1zKCkgewogICAgICB2YXIgc2VhcmNoOwoKICAgICAgaWYgKHdpbmRvdy5sb2NhdGlvbi5oYXNoKSB7CiAgICAgICAgc2VhcmNoID0gd2luZG93LmxvY2F0aW9uLmhhc2guc3Vic3RyKDEpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlYXJjaCA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2g7CiAgICAgIH0KCiAgICAgIHZhciB0ZW1wID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhzZWFyY2gpOwogICAgICB2YXIgcmVzdWx0ID0ge307CgogICAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIodGVtcC5rZXlzKCkpLAogICAgICAgICAgX3N0ZXA7CgogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgIHJlc3VsdFt2YWx1ZV0gPSB0ZW1wLmdldCh2YWx1ZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICBfaXRlcmF0b3IuZShlcnIpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIF9pdGVyYXRvci5mKCk7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioNCiAgICAgKiBCdWlsZCBxdWVyeSBzdHJpbmcgcGFyYW0NCiAgICAgKiBAcGFyYW0geyp9IHBhcmFtcw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJidWlsZFF1ZXJ5U3RyaW5nUGFyYW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBidWlsZFF1ZXJ5U3RyaW5nUGFyYW1zKHBhcmFtcykgewogICAgICB2YXIgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXJhbXMpOwogICAgICByZXR1cm4gc2VhcmNoUGFyYW1zLnRvU3RyaW5nKCk7CiAgICB9CiAgICAvKioNCiAgICAgKiDEkMSDbmcgeHXhuqV0IGto4buPaSDhu6luZyBk4bulbmcNCiAgICAgKiBURE5HSElBIDQvNC8yMDIyIHPhu61hIGzhuqFpIG7hur91IMSRbmFnIOG7nyBtw7RpIHRyxrDhu51uZyBwaMOhdCB0cmnhu4NuIHRow6wgduG7gSB0cmFuZyBkZXYtbG9naW4NCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAibG9nb2ZmIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBsb2dvZmYoKSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gImRldmVsb3BtZW50IikgewogICAgICAgIHRoaXMucmVkaXJlY3QoIi9kZXYtbG9naW4iKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnJlZGlyZWN0KCIvbG9nb3V0Iik7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIFJlZGlyZWN0IOG7qW5nIGThu6VuZyB04bubaSBtw6BuIGjDrG5oIGtow6FjDQogICAgICogQHBhcmFtIHtzdHJpbmd9IHVybA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZWRpcmVjdCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVkaXJlY3QodXJsKSB7CiAgICAgIGxvY2F0aW9uLmhyZWYgPSB1cmw7CiAgICB9CiAgICAvKioNCiAgICAgKiBEb3dubG9hZA0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBsaW5rDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRvd25sb2FkTGluayIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZG93bmxvYWRMaW5rKGxpbmspIHsKICAgICAgdmFyIGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYWRvd25sb2FkIik7CiAgICAgIGEuaHJlZiA9IGxpbms7CiAgICAgIGEuY2xpY2soKTsKICAgIH0KICAgIC8qKg0KICAgICAqIEfDoW4gY29va2llDQogICAgICovCgogIH0sIHsKICAgIGtleTogInNldENvb2tpZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29va2llKG5hbWUsIHZhbHVlLCBob3VycykgewogICAgICB2YXIgZXhwaXJlcyA9ICIiOwoKICAgICAgaWYgKGhvdXJzKSB7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgIGRhdGUuc2V0VGltZShkYXRlLmdldFRpbWUoKSArIGhvdXJzICogNjAgKiA2MCAqIDEwMDApOwogICAgICAgIGV4cGlyZXMgPSAiOyBleHBpcmVzPSIgKyBkYXRlLnRvVVRDU3RyaW5nKCk7CiAgICAgIH0KCiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAiPSIgKyAodmFsdWUgfHwgIiIpICsgZXhwaXJlcyArICI7IHBhdGg9LyI7CiAgICB9CiAgICAvKioNCiAgICAgKiDEkOG7jWMgY29va2llDQogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvb2tpZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIHsKICAgICAgdmFyIG5hbWVFUSA9IG5hbWUgKyAiPSI7CiAgICAgIHZhciBjYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgiOyIpOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYS5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjID0gY2FbaV07CgogICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PSAiICIpIHsKICAgICAgICAgIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWVFUSkgPT0gMCkgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWVFUS5sZW5ndGgsIGMubGVuZ3RoKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioNCiAgICAgKiBYw7NhIGNvb2tpZQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVDb29raWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlbW92ZUNvb2tpZShuYW1lKSB7CiAgICAgIGRvY3VtZW50LmNvb2tpZSA9IG5hbWUgKyAiPTsgUGF0aD0vOyBFeHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDEgR01UOyI7CiAgICB9CiAgICAvKioNCiAgICAgKiBY4butIGzDvSBk4buvIGxp4buHdSB0cuG6oyB24buBIHThu6sgc2VydmVyDQogICAgICovCgogIH0sIHsKICAgIGtleTogInByb2Nlc3NTZXJ2ZXJSZXNwb25zZURhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByb2Nlc3NTZXJ2ZXJSZXNwb25zZURhdGEoZGF0YSkgewogICAgICBpZiAoZGF0YSkgewogICAgICAgIHZhciByZyA9IC9cZHs0fS1bMDFdXGQtWzAtM11cZFRbMC0yXVxkOlswLTVdXGQ6WzAtNV1cZC87CgogICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkgewogICAgICAgICAgaWYgKGRhdGFbaV0pIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhW2ldID09PSAic3RyaW5nIiAmJiBpLmluZGV4T2YoIkRhdGUiKSA+IC0xICYmIHJnLnRlc3QoZGF0YVtpXSkpIHsKICAgICAgICAgICAgICBkYXRhW2ldID0gbmV3IERhdGUoZGF0YVtpXSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoX3R5cGVvZihkYXRhW2ldKSA9PT0gIm9iamVjdCIgJiYgT2JqZWN0LmtleXMoZGF0YVtpXS5sZW5ndGggPiAwKSkgewogICAgICAgICAgICAgIHRoaXMucHJvY2Vzc1NlcnZlclJlc3BvbnNlRGF0YShkYXRhW2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogTOG6pXkgdGV4dCBoaeG7g24gdGjhu4sgY+G7p2EgdHLGsOG7nW5nIHRow7RuZyB0aW4NCiAgICAgKiBAcGFyYW0geyp9IGZpZWxkIDogVMOqbiB0csaw4budbmcNCiAgICAgKiBAcGFyYW0geyp9IG5hbWVzcGFjZSA6IG3DoyDEkeG7gyB4ZW0gY8OzIGN1c3RvbSBs4bqhaSBraMO0bmcsIG7hur91IGtow7RuZyB0aMOsIGzhuqV5IG3hurdjIMSR4buLbmgNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29sdW1uVGV4dCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29sdW1uVGV4dChmaWVsZCwgbmFtZXNwYWNlKSB7CiAgICAgIHZhciBsb2NhbGl6ZSA9IGkxOG4sCiAgICAgICAgICBjb21tb24gPSBsb2NhbGl6ZS5tZXNzYWdlc1tsb2NhbGl6ZS5sb2NhbGVdWyJpMThuQ29sdW1uIl0sCiAgICAgICAgICBjdXN0b20gPSBuYW1lc3BhY2UgPyBjb21tb25bbmFtZXNwYWNlXSA6IG51bGw7CgogICAgICBpZiAoY3VzdG9tICYmIGN1c3RvbS5oYXNPd25Qcm9wZXJ0eShmaWVsZCkpIHsKICAgICAgICByZXR1cm4gY3VzdG9tW2ZpZWxkXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbW1vbltmaWVsZF07CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSB0ZXh0IGhp4buDbiB0aOG7iyBj4bunYSBi4bqjbmcNCiAgICAgKiBAcGFyYW0geyp9IHRhYmxlIDogVMOqbiBi4bqjbmcNCiAgICAgKiBAcGFyYW0geyp9IG5hbWVzcGFjZSA6IG3DoyDEkeG7gyB4ZW0gY8OzIGN1c3RvbSBs4bqhaSBraMO0bmcsIG7hur91IGtow7RuZyB0aMOsIGzhuqV5IG3hurdjIMSR4buLbmgNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0VGFibGVUZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUYWJsZVRleHQodGFibGUsIG5hbWVzcGFjZSkgewogICAgICB2YXIgbG9jYWxpemUgPSBpMThuLAogICAgICAgICAgY29tbW9uID0gbG9jYWxpemUubWVzc2FnZXNbbG9jYWxpemUubG9jYWxlXVsiaTE4blRhYmxlIl0sCiAgICAgICAgICBjdXN0b20gPSBuYW1lc3BhY2UgPyBjb21tb25bbmFtZXNwYWNlXSA6IG51bGw7CgogICAgICBpZiAoY3VzdG9tICYmIGN1c3RvbS5oYXNPd25Qcm9wZXJ0eSh0YWJsZSkpIHsKICAgICAgICByZXR1cm4gY3VzdG9tW3RhYmxlXTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbW1vblt0YWJsZV07CiAgICB9CiAgICAvKioNCiAgICAgKiBNYXBpbmcgdOG7qyBodG1sIGVsZW1lbnQgdGjDoG5oIMSR4buRaSB0xrDhu6NuZyB2dWVqcyDEkeG7gyB0aGFvIHTDoWMNCiAgICAgKiBAcGFyYW0ge29iamVjdH0gZG9tIGh0bWwgZG9tZSBlbGVtZW50DQogICAgICovCgogIH0sIHsKICAgIGtleTogIm1hcERvbVRvVnVlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBtYXBEb21Ub1Z1ZShkb20pIHsKICAgICAgcmV0dXJuIGRvbS5fX3Z1ZV9fOwogICAgfQogICAgLyoqDQogICAgICogQ2h1eeG7g24gdGnhur9uZyB2aeG7h3QgY8OzIGThuqV1IHRow6BuaCBraMO0bmcgZOG6pXUNCiAgICAgKiBAYXV0aG9yIMSQVlRoaSAwOS8wMy8yMDIxDQogICAgICovCgogIH0sIHsKICAgIGtleTogInJlbW92ZVZpZXRuYW1lc2VUb25lcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlVmlldG5hbWVzZVRvbmVzKHN0cikgewogICAgICBpZiAoc3RyKSB7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OgfMOhfOG6oXzhuqN8w6N8w6J84bqnfOG6pXzhuq184bqpfOG6q3zEg3zhurF84bqvfOG6t3zhurN84bq1L2csICJhIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OofMOpfOG6uXzhurt84bq9fMOqfOG7gXzhur984buHfOG7g3zhu4UvZywgImUiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw6x8w6184buLfOG7iXzEqS9nLCAiaSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DsnzDs3zhu4184buPfMO1fMO0fOG7k3zhu5F84buZfOG7lXzhu5d8xqF84budfOG7m3zhu6N84buffOG7oS9nLCAibyIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DuXzDunzhu6V84bunfMWpfMawfOG7q3zhu6l84buxfOG7rXzhu68vZywgInUiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgv4buzfMO9fOG7tXzhu7d84bu5L2csICJ5Iik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8SRL2csICJkIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OAfMOBfOG6oHzhuqJ8w4N8w4J84bqmfOG6pHzhuqx84bqofOG6qnzEgnzhurB84bqufOG6tnzhurJ84bq0L2csICJBIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8OIfMOJfOG6uHzhurp84bq8fMOKfOG7gHzhur584buGfOG7gnzhu4QvZywgIkUiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgvw4x8w4184buKfOG7iHzEqC9nLCAiSSIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DknzDk3zhu4x84buOfMOVfMOUfOG7knzhu5B84buYfOG7lHzhu5Z8xqB84bucfOG7mnzhu6J84buefOG7oC9nLCAiTyIpOwogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC/DmXzDmnzhu6R84bumfMWofMavfOG7qnzhu6h84buwfOG7rHzhu64vZywgIlUiKTsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZSgv4buyfMOdfOG7tHzhu7Z84bu4L2csICJZIik7CiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoL8SQL2csICJEIik7IC8vIFNvbWUgc3lzdGVtIGVuY29kZSB2aWV0bmFtZXNlIGNvbWJpbmluZyBhY2NlbnQgYXMgaW5kaXZpZHVhbCB1dGYtOCBjaGFyYWN0ZXJzCiAgICAgICAgLy8gTeG7mXQgdsOgaSBi4buZIGVuY29kZSBjb2kgY8OhYyBk4bqldSBtxaksIGThuqV1IGNo4buvIG5oxrAgbeG7mXQga8OtIHThu7EgcmnDqm5nIGJp4buHdCBuw6puIHRow6ptIGhhaSBkw7JuZyBuw6B5CgogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cdTAzMDB8XHUwMzAxfFx1MDMwM3xcdTAzMDl8XHUwMzIzL2csICIiKTsgLy8gzIAgzIEgzIMgzIkgzKMgIGh1eeG7gW4sIHPhuq9jLCBuZ8OjLCBo4buPaSwgbuG6t25nCgogICAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cdTAyQzZ8XHUwMzA2fFx1MDMxQi9nLCAiIik7IC8vIMuGIMyGIMybICDDgiwgw4osIMSCLCDGoCwgxq8KICAgICAgICAvLyBSZW1vdmUgZXh0cmEgc3BhY2VzCiAgICAgICAgLy8gQuG7jyBjw6FjIGtob+G6o25nIHRy4bqvbmcgbGnhu4FuIG5oYXUKCiAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoLyArIC9nLCAiICIpOwogICAgICAgIHN0ciA9IHN0ci50cmltKCk7IC8vIFJlbW92ZSBwdW5jdHVhdGlvbnMKICAgICAgICAvLyBC4buPIGThuqV1IGPDonUsIGvDrSB04buxIMSR4bq3YyBiaeG7h3QKICAgICAgICAvL3N0ciA9IHN0ci5yZXBsYWNlKC8hfEB8JXxcXnxcKnxcKHxcKXxcK3xcPXxcPHxcPnxcP3xcL3wsfFwufFw6fFw7fFwnfFwifFwmfFwjfFxbfFxdfH58XCR8X3xgfC18e3x9fFx8fFxcL2csIiAiKTsKCiAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gIiI7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJidWlsZEZpbHRlclBhcmFtIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBidWlsZEZpbHRlclBhcmFtKGZpbHRlcnMpIHsKICAgICAgdmFyIG1lID0gdGhpcywKICAgICAgICAgIHNGaWx0ZXIgPSAiIjsKCiAgICAgIGlmIChmaWx0ZXJzICYmICEoZmlsdGVycyBpbnN0YW5jZW9mIEFycmF5KSkgewogICAgICAgIGZpbHRlcnMgPSBbZmlsdGVyc107CiAgICAgIH0KCiAgICAgIHZhciBsZW5ndGggPSBmaWx0ZXJzLmxlbmd0aDsKCiAgICAgIGlmIChsZW5ndGggPiAwKSB7CiAgICAgICAgdmFyIGksCiAgICAgICAgICAgIGFycmF5RmlsdGVycyA9IFtdLAogICAgICAgICAgICBzSm9pbiA9ICIsIjsKCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICB2YXIgZmlsdGVyID0gZmlsdGVyc1tpXSwKICAgICAgICAgICAgICBzQ2hpbGRGaWx0ZXIgPSAiIiwKICAgICAgICAgICAgICBvcGVyYW5kQ2hpbGQgPSAiYW5kIjsKCiAgICAgICAgICBpZiAoZmlsdGVyLmNoaWxkcmVucyBpbnN0YW5jZW9mIEFycmF5ICYmIGZpbHRlci5jaGlsZHJlbnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICB2YXIgY2hpbGRGaXJzdCA9IGZpbHRlci5jaGlsZHJlbnNbMF07CgogICAgICAgICAgICBpZiAoY2hpbGRGaXJzdC5vcGVyYW5kKSB7CiAgICAgICAgICAgICAgb3BlcmFuZENoaWxkID0gY2hpbGRGaXJzdC5vcGVyYW5kOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzQ2hpbGRGaWx0ZXIgPSBtZS5idWlsZEZpbHRlclBhcmFtKGZpbHRlci5jaGlsZHJlbnMpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBzID0gJyInICsgZmlsdGVyLnByb3BlcnR5ICsgJyIsJyArIChmaWx0ZXIub3BlcmF0b3IgPyAnIicgKyBmaWx0ZXIub3BlcmF0b3IgKyAnIiwnIDogIiIpLAogICAgICAgICAgICAgIC8vTeG6t2MgxJHhu4tuaCBvcGVyYW5kIGzDoCBgYW5kYAogICAgICAgICAgb3BlcmFuZCA9ICciYW5kIic7CiAgICAgICAgICBzICs9IG1lLm5vbWFsaXplRmlsdGVyVmFsdWUoZmlsdGVyLm9wZXJhdG9yLCBmaWx0ZXIudmFsdWUpOyAvL3jhu60gbMO9IHTDrG5oIGh14buRbmcgbXXDtG4gZmlsdGVyID0gMC9mYWxzZSBuaMawbmcgbXXhu5FuIGzhu41jIHJhIGPhuqMgY8OhYyBnacOhIHRy4buLIG51bGwKCiAgICAgICAgICBpZiAoZmlsdGVyLm51bGxUb0ZhaWwgJiYgKGZpbHRlci52YWx1ZSA9PT0gMCB8fCBmaWx0ZXIudmFsdWUgPT09IGZhbHNlKSkgewogICAgICAgICAgICBzICs9ICIsdHJ1ZSI7CiAgICAgICAgICB9CgogICAgICAgICAgcyA9ICJbIiArIHMgKyAiXSI7CgogICAgICAgICAgaWYgKHNDaGlsZEZpbHRlcikgewogICAgICAgICAgICBzID0gIlsiICsgcyArICcsIicgKyBvcGVyYW5kQ2hpbGQgKyAnIiwnICsgc0NoaWxkRmlsdGVyICsgIl0iOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChpICE9PSAwKSB7CiAgICAgICAgICAgIGlmIChmaWx0ZXIub3BlcmFuZCkgewogICAgICAgICAgICAgIG9wZXJhbmQgPSAnIicgKyBmaWx0ZXIub3BlcmFuZCArICciJzsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXJyYXlGaWx0ZXJzLmFkZChvcGVyYW5kKTsKICAgICAgICAgIH0KCiAgICAgICAgICBhcnJheUZpbHRlcnMuYWRkKHMpOwogICAgICAgIH0KCiAgICAgICAgc0ZpbHRlciA9IGFycmF5RmlsdGVycy5qb2luKHNKb2luKTsKCiAgICAgICAgaWYgKGxlbmd0aCA+IDEpIHsKICAgICAgICAgIHNGaWx0ZXIgPSAiWyIgKyBzRmlsdGVyICsgIl0iOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNGaWx0ZXI7CiAgICB9CiAgfSwgewogICAga2V5OiAibm9tYWxpemVGaWx0ZXJWYWx1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbm9tYWxpemVGaWx0ZXJWYWx1ZShvcGVyYXRvciwgdmFsdWUpIHsKICAgICAgdmFyIHJldCA9ICIiOwoKICAgICAgc3dpdGNoIChvcGVyYXRvcikgewogICAgICAgIGNhc2UgImluIjoKICAgICAgICBjYXNlICJub3RpbiI6CiAgICAgICAgICByZXQgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHJldCA9IHZhbHVlLnRvU3RyaW5nKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgIHJldCA9IHZhbHVlOwogICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERhdGUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlLmdldEhvdXJzKCkgPT09IDAgJiYgdmFsdWUuZ2V0TWludXRlcygpID09PSAwICYmIHZhbHVlLmdldFNlY29uZHMoKSA9PT0gMCkgewogICAgICAgICAgICAgIHJldCA9IFsnIicsIG1vbWVudCh2YWx1ZSkuZm9ybWF0KCJZWVlZLU1NLUREIiksICdUMDA6MDA6MDAiJ10uam9pbigiIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmV0ID0gWyciJywgbW9tZW50KHZhbHVlKS5mb3JtYXQoIllZWVktTU0tRERUaGg6bW06c3MiKSwgJyInXS5qb2luKCIiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0ID0gWyciJywgdmFsdWUsICciJ10uam9pbigiIik7CiAgICAgICAgICB9CgogICAgICB9CgogICAgICByZXR1cm4gcmV0OwogICAgfQogICAgLyoqDQogICAgICogWOG7rSBsw70gdGhhbSBz4buRIHRyxrDhu5tjIGtoaSBn4buNaSBsw6puIHNlcnZlciBsb2FkIGThu68gbGnhu4d1IGNobyBjb21ib2JveA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwcm9jZXNzQ29tYm9ib3hQYXJhbVJlcXVlc3QiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHByb2Nlc3NDb21ib2JveFBhcmFtUmVxdWVzdChwYXJhbSkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgZm9yICh2YXIgaSBpbiBwYXJhbSkgewogICAgICAgIHZhciB2YWx1ZSA9IHBhcmFtW2ldOwoKICAgICAgICBzd2l0Y2ggKGkpIHsKICAgICAgICAgIGNhc2UgImZpbHRlciI6CiAgICAgICAgICAgIC8vY2h14bqpbiBow7NhIHRoYW0gc+G7kSBmaWx0ZXIKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICB2YWx1ZSA9IG1lLmJ1aWxkRmlsdGVyUGFyYW0odmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKCiAgICAgICAgICBjYXNlICJjb25kaXRpb24iOgogICAgICAgICAgICAvL3N0cmluZ2dpZnkgY29uZGl0aW9uIMSR4buDIGJ1aWxkIHRyw6puIGMjCiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiBPYmplY3Qua2V5cyh2YWx1ZSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBicmVhazsKICAgICAgICB9CgogICAgICAgIHBhcmFtW2ldID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJzZXRMb2NhbFN0b3JhZ2UiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNldExvY2FsU3RvcmFnZShrZXksIHZhbHVlKSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKHRoaXMucHJvY2Vzc0xvY2FsU3RvcmFnZUtleShrZXkpLCB2YWx1ZSk7CiAgICB9CiAgfSwgewogICAga2V5OiAiZ2V0TG9jYWxTdG9yYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMb2NhbFN0b3JhZ2Uoa2V5KSB7CiAgICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSh0aGlzLnByb2Nlc3NMb2NhbFN0b3JhZ2VLZXkoa2V5KSk7CiAgICB9CiAgfSwgewogICAga2V5OiAicmVtb3ZlTG9jYWxTdG9yYWdlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVMb2NhbFN0b3JhZ2Uoa2V5KSB7CiAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKHRoaXMucHJvY2Vzc0xvY2FsU3RvcmFnZUtleShrZXkpKTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJwcm9jZXNzTG9jYWxTdG9yYWdlS2V5IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBwcm9jZXNzTG9jYWxTdG9yYWdlS2V5KGtleSkgewogICAgICByZXR1cm4gW3dpbmRvdy5fYXBwQ29uZmlnLnN0b3JhZ2VLZXksIGtleV0uam9pbigiXyIpOwogICAgfQogIH0sIHsKICAgIGtleTogInNsZWVwIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzbGVlcChtcykgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICByZXR1cm4gc2V0VGltZW91dChyZXNvbHZlLCBtcyk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogImNoZWNrRnVsbE1vbnRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja0Z1bGxNb250aChmcm9tRGF0ZSwgdG9EYXRlKSB7CiAgICAgIHZhciBzaG9ydFRleHQgPSAiIiwKICAgICAgICAgIGxvY2FsaXplID0gaTE4bjsKCiAgICAgIGlmIChmcm9tRGF0ZSAmJiB0b0RhdGUpIHsKICAgICAgICBpZiAoZnJvbURhdGUuZ2V0RGF0ZSgpID09IDEpIHsKICAgICAgICAgIHZhciBmcm9tWWVhciA9IGZyb21EYXRlLmdldEZ1bGxZZWFyKCksCiAgICAgICAgICAgICAgZnJvbU1vbnRoID0gZnJvbURhdGUuZ2V0TW9udGgoKTsKICAgICAgICAgIHZhciB0b1llYXIgPSB0b0RhdGUuZ2V0RnVsbFllYXIoKSwKICAgICAgICAgICAgICB0b01vbnRoID0gdG9EYXRlLmdldE1vbnRoKCk7CiAgICAgICAgICB2YXIgZGF5c09mTW9udGggPSAzMiAtIG5ldyBEYXRlKHRvWWVhciwgdG9Nb250aCwgMzIpLmdldERhdGUoKTsKCiAgICAgICAgICBpZiAodG9EYXRlICYmIGRheXNPZk1vbnRoID09IHRvRGF0ZS5nZXREYXRlKCkpIHsKICAgICAgICAgICAgaWYgKGZyb21Nb250aCA9PSB0b01vbnRoICYmIGZyb21ZZWFyID09IHRvWWVhcikgewogICAgICAgICAgICAgIHNob3J0VGV4dCA9IGxvY2FsaXplLnQoImkxOG5SZXBvcnQuUmVwb3J0VGVybSIpLmZvcm1hdChmcm9tTW9udGggKyAxLCBmcm9tWWVhcik7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZnJvbU1vbnRoIDwgdG9Nb250aCAmJiBmcm9tWWVhciA9PSB0b1llYXIpIHsKICAgICAgICAgICAgICBzaG9ydFRleHQgPSBsb2NhbGl6ZS50KCJpMThuUmVwb3J0LlJlcG9ydFRlcm1SYW5nZSIpLmZvcm1hdChmcm9tTW9udGggKyAxLCB0b01vbnRoICsgMSwgZnJvbVllYXIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2hvcnRUZXh0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNob3J0VGV4dDsKICAgIH0KICAgIC8qKg0KICAgICAqIEjDoG0gZ+G7jWkgbGluayBoZWxwIHRydXnhu4FuIHbDoG8gxJHGsOG7nW5nIGThuqtuIMSR4bq/biB04burbmcgbcOgbiBow6xuaA0KICAgICAqIEBwYXJhbSB7Kn0gaGVscElkIA0KICAgICAqIEByZXR1cm5zIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoZWxwQW1zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBoZWxwQW1zKGhlbHBJZCkgewogICAgICByZXR1cm4gW3dpbmRvdy5fYXBwQ29uZmlnLmhlbHBVUkwsIGhlbHBJZF0uam9pbigiIik7CiAgICB9CiAgICAvKioNCiAgICAgKiBIw6BtIGJ1aWxkIGxpbmsgaGVscCB24bubaSBJRChzY3JlZW5jb2RlKSB0cnV54buBbiB2w6BvDQogICAgICogQHBhcmFtIHsqfSBoZWxwSWQga2nhu4NtIHRyYSB2w6AgdXBwZXJjYXNlIGvDvSB04buxIMSR4bqndSBsw6puIMSR4buDIGdow6lwIHbDoG8gZW51bQ0KICAgICAqIEByZXR1cm5zIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRMaW5rSGVscENlZ292IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRMaW5rSGVscENlZ292KGhlbHBJZCkgewogICAgICB2YXIgaGVscElkQ29udmVydGVkID0gaGVscElkLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgaGVscElkLnNsaWNlKDEpOwogICAgICByZXR1cm4gW3dpbmRvdy5fYXBwQ29uZmlnLmhlbHBVUkwsIE1TRW51bS5IZWxwSURbaGVscElkQ29udmVydGVkXV0uam9pbigiIik7CiAgICB9CiAgICAvKioNCiAgICAgKiBGdW5jIGLhu48gZOG6pXUgdGnhur9uZyB2aeG7h3QNCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc3RyDQogICAgICogQGF1dGhvciBOQ1RoYW5oMQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVVbmljb2RlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVVbmljb2RlKHN0cikgewogICAgICB2YXIgdG1wID0gc3RyOwogICAgICB0bXAgPSB0bXAudG9Mb3dlckNhc2UoKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL8OgfMOhfOG6oXzhuqN8w6N8w6J84bqnfOG6pXzhuq184bqpfOG6q3zEg3zhurF84bqvfOG6t3zhurN84bq1L2csICJhIik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/DqHzDqXzhurl84bq7fOG6vXzDqnzhu4F84bq/fOG7h3zhu4N84buFL2csICJlIik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/DrHzDrXzhu4t84buJfMSpL2csICJpIik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/DsnzDs3zhu4184buPfMO1fMO0fOG7k3zhu5F84buZfOG7lXzhu5d8xqF84budfOG7m3zhu6N84buffOG7oS9nLCAibyIpOwogICAgICB0bXAgPSB0bXAucmVwbGFjZSgvw7l8w7p84bulfOG7p3zFqXzGsHzhu6t84bupfOG7sXzhu6184buvL2csICJ1Iik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC/hu7N8w7184bu1fOG7t3zhu7kvZywgInkiKTsKICAgICAgdG1wID0gdG1wLnJlcGxhY2UoL8SRL2csICJkIik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC8hfEB8JXxcXnxcKnxcKHxcKXxcK3xcPXxcPHxcPnxcP3xcL3wsfFwufFw6fFw7fFwnfFwifFwmfFwjfFxbfFxdfH58XCR8X3xgfC18e3x9fFx8fFxcL2csICIgIik7CiAgICAgIHRtcCA9IHRtcC5yZXBsYWNlKC8gKyAvZywgIiAiKTsKICAgICAgdG1wID0gdG1wLnRyaW0oKTsKICAgICAgcmV0dXJuIHRtcDsKICAgIH0KICAgIC8qKg0KICAgICAqIExvYWQgZOG7ryBsaeG7h3UgY29tYm9ib3gNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q2FjaGVDb21ib2JveERhdGEiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldENhY2hlQ29tYm9ib3hEYXRhKHR5cGUsIHBheWxvYWQsIGxvYWRQcm9taXNlLCBsb2FkU2NvcGUpIHsKICAgICAgdmFyIGtleSA9IFt0eXBlLCBKU09OLnN0cmluZ2lmeShwYXlsb2FkKV0uam9pbigiXyIpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICBjYWNoZSA9IHdpbmRvdy5fY2JvRGF0YVtrZXldOwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICBpZiAoY2FjaGUpIHsKICAgICAgICAgIHJlc29sdmUoY2FjaGUpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbG9hZFByb21pc2UuY2FsbChsb2FkU2NvcGUsIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkgewogICAgICAgICAgd2luZG93Ll9jYm9EYXRhW2tleV0gPSByZXN1bHQ7CiAgICAgICAgICByZXNvbHZlKHJlc3VsdCk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICogTG9hZCBk4buvIGxp4buHdSBjb21ib2JveA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVDYWNoZUNvbWJvYm94RGF0YSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQ2FjaGVDb21ib2JveERhdGEoa2V5KSB7CiAgICAgIHZhciBjYWNoZXMgPSB3aW5kb3cuX2Nib0RhdGE7CgogICAgICBpZiAoY2FjaGVzKSB7CiAgICAgICAgdmFyIGtleXMgPSBbXTsKCiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoa2V5KSkgewogICAgICAgICAga2V5cyA9IGtleTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBrZXkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAga2V5cy5wdXNoKFN0cmluZyhrZXkpKTsKICAgICAgICB9CgogICAgICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgdmFyIGtleSA9IFtpdGVtLCAiIl0uam9pbigiXyIpLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgcmVtb3ZlS2V5cyA9IFtdOwoKICAgICAgICAgIGZvciAodmFyIGkgaW4gY2FjaGVzKSB7CiAgICAgICAgICAgIGlmIChpLmluZGV4T2Yoa2V5KSA9PT0gMCkgewogICAgICAgICAgICAgIHJlbW92ZUtleXMucHVzaChpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCByZW1vdmVLZXlzLmxlbmd0aDsgX2krKykgewogICAgICAgICAgICB2YXIgY2FjaGVLZXkgPSByZW1vdmVLZXlzW19pXTsKICAgICAgICAgICAgZGVsZXRlIGNhY2hlc1tjYWNoZUtleV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIC8qKg0KICAgICAqIFTDoWNoIHThu6sga2jDs2EgdMOsbSBraeG6v20gdGjDoG5oIGPDoWMgdOG7qyB0aGVvIHF1eSB04bqvYw0KICAgICAqIDEuIE7hur91IGPDsyBuZ2/hurdjIGvDqXAgIiIgdGjDrCB0w6xtIMSRw7puZyBrw60gdOG7sSB0cm9uZyBuZ2/hurdjIGvDqXANCiAgICAgKiAyLiBO4bq/dSBraMO0bmcgdGjDrCBjaOG7iSBj4bqnbiBjaOG7qWEgY+G6oyAyIGvDrSB04buxIGzDoCDEkeG7pw0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXl3b3JkIHThu6sga2jDs2EgdMOsbSBraeG6v20NCiAgICAgKiBAYXV0aG9yIE5WTEFNIDIzLjExLjIwMjANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAic3BsaXRLZXlXb3JkIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBzcGxpdEtleVdvcmQoa2V5d29yZCkgewogICAgICB2YXIgd29yZEFyciA9IFtdOwoKICAgICAgaWYgKHR5cGVvZiBrZXl3b3JkICE9PSAic3RyaW5nIikgewogICAgICAgIGtleXdvcmQgPSBfLnRvU3RyaW5nKGtleXdvcmQpOwogICAgICB9CgogICAgICB2YXIgZmlyc3REb3VibGVRdW90ZUlkeCA9IGtleXdvcmQuaW5kZXhPZignIicpLAogICAgICAgICAgbGFzdERvdWJsZVF1b3RlSWR4ID0ga2V5d29yZC5sYXN0SW5kZXhPZignIicpOwogICAgICAvKioNCiAgICAgICAqIEPDoWMgVEggdMOsbSBraeG6v20gZnVsbCB0ZXh0DQogICAgICAgKiAxLiDEkMOieSBsw6AgZm9vDQogICAgICAgKiAyLiAixJDDonkgbMOgIGZvbw0KICAgICAgICogMy4gxJDDonkgImzDoCBmb28iDQogICAgICAgKiA0LiAixJDDonkgbMOgIiBmb28NCiAgICAgICAqLwoKICAgICAgaWYgKGZpcnN0RG91YmxlUXVvdGVJZHggPT09IC0xIHx8IGZpcnN0RG91YmxlUXVvdGVJZHggPT09IGxhc3REb3VibGVRdW90ZUlkeCB8fCBmaXJzdERvdWJsZVF1b3RlSWR4ICE9PSAwIHx8IGxhc3REb3VibGVRdW90ZUlkeCAhPT0ga2V5d29yZC5sZW5ndGggLSAxKSB7CiAgICAgICAgd29yZEFyciA9IGtleXdvcmQuc3BsaXQoL1xzKy8pOyAvL3TDoWNoIHRoZW8gZOG6pXUgY8OhY2gKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZnVsbFRleHQgPSBrZXl3b3JkLnNsaWNlKGZpcnN0RG91YmxlUXVvdGVJZHggKyAxLCBsYXN0RG91YmxlUXVvdGVJZHgpOwoKICAgICAgICBpZiAoIV8uaXNFbXB0eShmdWxsVGV4dCkpIHsKICAgICAgICAgIHdvcmRBcnIucHVzaChmdWxsVGV4dCk7CiAgICAgICAgfQogICAgICB9IC8vIGZvciAobGV0IGkgPSAwOyBpIDwgd29yZEFyci5sZW5ndGg7ICsraSkgewogICAgICAvLyAgICAgd29yZEFycltpXSA9IHdvcmRBcnJbaV0ucmVwbGFjZSgvW15hLXpcZF0vZywgJ1xcJCYnKTsvL2Now6huIHRow6ptIDEga8OtIHThu6sKICAgICAgLy8gfQoKCiAgICAgIHJldHVybiB3b3JkQXJyOwogICAgfQogICAgLyoqDQogICAgICogaMOgbSBzZWFyY2ggbG9jYWwNCiAgICAgKiBwcm9wZXJ0aWVzOiBkYW5oIHPDoWNoIGPDoWMgdHLGsOG7nW5nIGPhuqduIHNlYXJjaA0KICAgICAqIHNlYXJjaFRleHQ6IHRleHQgbmjhuq1wIOG7nyDDtCBzZWFyY2gNCiAgICAgKiBzb3VyY2U6IGThu68gbGnhu4d1IGfhu5FjIGTDuW5nIMSR4buDIGZpbHRlcg0KICAgICAqIGdyaWQ6IGdyaWQgZmlsdGVyDQogICAgICogTlRBbmgyOiB0aMOqbSBub3RTZWFyY2hUZXh0ID0gdHJ1ZSDEkeG7gyBs4buNYyB04burIGPDoWMgbcOgbiBow6xuaCBkYW5oIHPDoWNoIGThuqFuZyB0cmVlDQogICAgICovCgogIH0sIHsKICAgIGtleTogImZpbHRlckZuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmaWx0ZXJGbihwcm9wZXJ0aWVzLCBzb3VyY2UsIGdyaWQsIHNlYXJjaFRleHQsIGZvcm0pIHsKICAgICAgdmFyIG5vdFNlYXJjaFRleHQgPSBhcmd1bWVudHMubGVuZ3RoID4gNSAmJiBhcmd1bWVudHNbNV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s1XSA6IGZhbHNlOwogICAgICB2YXIgZGF0YSA9IFtdLAogICAgICAgICAgbWUgPSB0aGlzOwogICAgICB2YXIgc291cmNlVGVtcCA9IFtdOwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlKSkgewogICAgICAgIE9iamVjdC5hc3NpZ24oc291cmNlVGVtcCwgc291cmNlKTsgLy8gTlRBbmgyOiB0aMOqbSBub3RTZWFyY2hUZXh0IHPhu61hIGJ1ZyBraMO0bmcgbOG7jWMgxJHGsOG7o2MgY+G7mXQgdOG7qyBjw6FjIG3DoG4gaMOsbmggZGFuaCBzw6FjaCB0cuG6oW5nIHRyZWUgZMO5bmcgZmlsdGVyIGxvY2FsCgogICAgICAgIGlmIChzZWFyY2hUZXh0ICYmIHNlYXJjaFRleHQgIT0gIiIgfHwgbm90U2VhcmNoVGV4dCA9PSB0cnVlKSB7CiAgICAgICAgICBzb3VyY2VUZW1wLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgaWYgKG1lLmNoZWNrU2VhcmNoVGV4dChpdGVtLCBwcm9wZXJ0aWVzLCBzZWFyY2hUZXh0KSAmJiBtZS5jaGVja0ZpbHRlckhlYWRlcihpdGVtLCBncmlkKSAmJiBmb3JtLmNoZWNrRmlsdGVyR3JpZFRyZWVDdXN0b20oaXRlbSwgcHJvcGVydGllcywgc2VhcmNoVGV4dCkpIHsKICAgICAgICAgICAgICBpZiAoZGF0YS5pbmRleE9mKGl0ZW0pID09PSAtMSkgewogICAgICAgICAgICAgICAgZGF0YS5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGdyaWQgJiYgZ3JpZC5pc0dyaWRUcmVlKSB7CiAgICAgICAgICAgICAgICBtZS5maW5kUGFyZW50Tm9kZShzb3VyY2UsIGRhdGEsIGl0ZW0sIGZvcm0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRhdGEgPSBzb3VyY2VUZW1wOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKGZvcm0uZmlsdGVySGVhZGVyICYmIGZvcm0uZmlsdGVySGVhZGVyLmxlbmd0aCA+IDApIHsKICAgICAgICBncmlkLmRhdGFUZW1wID0gZGF0YTsKICAgICAgfSBlbHNlIHsKICAgICAgICBncmlkLmRhdGFUZW1wID0gc291cmNlOwogICAgICB9CgogICAgICByZXR1cm4gZGF0YTsKICAgIH0KICAgIC8qDQogICAgICogIEjDoG0gdMOsbSBraeG6v20gY8OhYyBub2RlIGNoYSBraGkgdGjhu7FjIGhp4buHbiB0w6xtIGtp4bq/bSBk4buvIGxp4buHdS4NCiAgICAgKiAgcHZkdXkgMDYvMDEvMjAyMQ0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmaW5kUGFyZW50Tm9kZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZmluZFBhcmVudE5vZGUoaXRlbXMsIGZpbHRlckl0ZW1zLCBpdGVtQ2hpbGQsIGZvcm0pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGtleSA9ICIiLAogICAgICAgICAgcGFyZW50S2V5ID0gIlBhcmVudElEIjsKCiAgICAgIGlmIChmb3JtICYmIGZvcm0uZ3JpZCAmJiBmb3JtLmdyaWQuaWRQcm9wZXJ0eSkgewogICAgICAgIGtleSA9IGZvcm0uZ3JpZC5pZFByb3BlcnR5OwogICAgICB9CgogICAgICBpZiAoZm9ybSAmJiBmb3JtLmdyaWQgJiYgZm9ybS5ncmlkLnBhcmVudElkUHJvcGVydHkpIHsKICAgICAgICBwYXJlbnRLZXkgPSBmb3JtLmdyaWQucGFyZW50SWRQcm9wZXJ0eTsKICAgICAgfQoKICAgICAgaXRlbXMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIGlmIChpdGVtW2tleV0gPT0gaXRlbUNoaWxkW3BhcmVudEtleV0gJiYgIWZpbHRlckl0ZW1zLmZpbmQoZnVuY3Rpb24gKHgpIHsKICAgICAgICAgIHJldHVybiB4W2tleV0gPT0gaXRlbVtrZXldOwogICAgICAgIH0pKSB7CiAgICAgICAgICBpZiAoZmlsdGVySXRlbXMuaW5kZXhPZihpdGVtKSA9PT0gLTEpIHsKICAgICAgICAgICAgZmlsdGVySXRlbXMucHVzaChpdGVtKTsKICAgICAgICAgIH0KCiAgICAgICAgICBtZS5maW5kUGFyZW50Tm9kZShpdGVtcywgZmlsdGVySXRlbXMsIGl0ZW0sIGZvcm0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICAvKioNCiAgICAgKiBow6BtIGZpbHRlciBjb2wNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY2hlY2tGaWx0ZXJIZWFkZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNoZWNrRmlsdGVySGVhZGVyKGl0ZW0sIGdyaWQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIGxpc3RGaWx0ZXJIZWFkZXIgPSBbXSwKICAgICAgICAgIGNoZWNrID0gdHJ1ZTsKICAgICAgbGlzdEZpbHRlckhlYWRlciA9IGdyaWQuZ2V0RmlsdGVySGVhZGVyKHRydWUpOwoKICAgICAgaWYgKGxpc3RGaWx0ZXJIZWFkZXIubGVuZ3RoID4gMCkgewogICAgICAgIGxpc3RGaWx0ZXJIZWFkZXIuZm9yRWFjaChmdW5jdGlvbiAoZmlsdGVyKSB7CiAgICAgICAgICB2YXIgdmFsdWUgPSBmaWx0ZXIudmFsdWUgPyAoZmlsdGVyLnZhbHVlICsgIiIpLnRvTG93ZXJDYXNlKCkgOiAiIjsKCiAgICAgICAgICBzd2l0Y2ggKGZpbHRlci5vcGVyYXRvcikgewogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuQ29udGFpbnM6CiAgICAgICAgICAgICAgaWYgKCEoaXRlbVtmaWx0ZXIucHJvcGVydHldID8gaXRlbVtmaWx0ZXIucHJvcGVydHldLnRvTG93ZXJDYXNlKCkgOiAiIikuY29udGFpbnModmFsdWUpKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuTm90Y29udGFpbnM6CiAgICAgICAgICAgICAgaWYgKChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPyBpdGVtW2ZpbHRlci5wcm9wZXJ0eV0udG9Mb3dlckNhc2UoKSA6ICIiKS5jb250YWlucyh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5TdGFydHNXaXRoOgogICAgICAgICAgICAgIGlmICghKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA/IGl0ZW1bZmlsdGVyLnByb3BlcnR5XS50b0xvd2VyQ2FzZSgpIDogIiIpLnN0YXJ0c1dpdGgodmFsdWUpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5FbmRzV2l0aDoKICAgICAgICAgICAgICBpZiAoIShpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPyBpdGVtW2ZpbHRlci5wcm9wZXJ0eV0udG9Mb3dlckNhc2UoKSA6ICIiKS5lbmRzd2l0aCh2YWx1ZSkpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5FcXVhbHM6CiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSAhPSBmaWx0ZXIudmFsdWUpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5Ob3RFcXVhbHM6CiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA9PSBmaWx0ZXIudmFsdWUpIHsKICAgICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgIGNhc2UgTVNFbnVtLkZpbHRlckhlYWRlci5HcmVhdGVyVGhhbjoKICAgICAgICAgICAgICBpZiAoaXRlbVtmaWx0ZXIucHJvcGVydHldIDw9IGZpbHRlci52YWx1ZSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAvLyBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuR3JlYXRlclRoYW46CiAgICAgICAgICAgIC8vICAgaWYoaXRlbVtmaWx0ZXIucHJvcGVydHldIDwgZmlsdGVyLnZhbHVlKXsKICAgICAgICAgICAgLy8gICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgIC8vICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIC8vICAgfQogICAgICAgICAgICAvLyAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkxlc3NUaGFuOgogICAgICAgICAgICAgIGlmIChpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPj0gZmlsdGVyLnZhbHVlKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuTGVzc1RoYW5FcXVhbHM6CiAgICAgICAgICAgICAgaWYgKGl0ZW1bZmlsdGVyLnByb3BlcnR5XSA+IGZpbHRlci52YWx1ZSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgY2FzZSBNU0VudW0uRmlsdGVySGVhZGVyLkJldHdlZW46CiAgICAgICAgICAgICAgLy9pZihpdGVtW2ZpbHRlci5wcm9wZXJ0eV0gPiBmaWx0ZXIudmFsdWUpewogICAgICAgICAgICAgIGNoZWNrID0gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOyAvL30KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuTnVsbDoKICAgICAgICAgICAgICBpZiAoaXRlbVtmaWx0ZXIucHJvcGVydHldKSB7CiAgICAgICAgICAgICAgICBjaGVjayA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICBjYXNlIE1TRW51bS5GaWx0ZXJIZWFkZXIuTm90TnVsbDoKICAgICAgICAgICAgICBpZiAoIWl0ZW1bZmlsdGVyLnByb3BlcnR5XSkgewogICAgICAgICAgICAgICAgY2hlY2sgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gY2hlY2s7CiAgICB9CiAgICAvKioNCiAgICAgKiBow6BtIHNlYXJjaCB0aGVvIHRleHQNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiY2hlY2tTZWFyY2hUZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja1NlYXJjaFRleHQoaXRlbSwgcHJvcGVydGllcywgc2VhcmNoVGV4dCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgY2hlY2sgPSBmYWxzZTsKCiAgICAgIGlmIChzZWFyY2hUZXh0KSB7CiAgICAgICAgdmFyIHRleHQgPSBzZWFyY2hUZXh0LnRvTG93ZXJDYXNlKCk7CgogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHByb3BlcnRpZXMpKSB7CiAgICAgICAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7CiAgICAgICAgICAgIGlmIChpdGVtW2ZpZWxkXSAmJiBpdGVtW2ZpZWxkXS50b0xvd2VyQ2FzZSgpLmNvbnRhaW5zKHRleHQpKSB7CiAgICAgICAgICAgICAgY2hlY2sgPSB0cnVlOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CgogICAgICByZXR1cm4gY2hlY2s7CiAgICB9CiAgICAvKioNCiAgICAgKiBM4bqleSB0aMO0bmcgdGluIGNoYW5uZWwgY2h1bmcgxJHhu4MgZ+G7rWkvbmjhuq1uIHRow7RuZyBiw6FvIGdp4buvYSBjw6FjIHRhYg0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRCcm9hZGNhc3RDaGFubmVsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRCcm9hZGNhc3RDaGFubmVsKCkgewogICAgICBpZiAoIXdpbmRvdy5fX2JjKSB7CiAgICAgICAgd2luZG93Ll9fYmMgPSBuZXcgQnJvYWRjYXN0Q2hhbm5lbCh3aW5kb3cuX2FwcENvbmZpZy5icm9hZGNhc3RDaGFubmVsKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHdpbmRvdy5fX2JjOwogICAgfQogICAgLyoqDQogICAgICogVEROR0hJQQ0KICAgICAqIDIyLzkvMjAyMQ0KICAgICAqIGNvbnZlcnQgdOG7qyBzdHJpbmcgc2FuZyBraeG7g3UgZGF0ZQ0KICAgICAqIEBwYXJhbSB7Kn0gZGF0ZVN0cmluZyBzdHJpbmcgdHJ1eeG7gW4gdsOgbyB2w60gZOG7pTogJzE4LzA3LzE5OTknDQogICAgICogZm9ybWF0VHlwZSA9IDEgbMOgIGNodeG7l2kgxJFhbmcgdGhlbyBraeG7g3UgZGQvbW0veXl5eSAyIGzDoCBraeG7g3UgeXl5eS9tbS9kZCAzIGzDoCBraeG7g3UgbW0vZGQveXl5DQogICAgICogdOG7sSB0aMOqbSBjw6FjIGNhc2Ugc2F1IG7hur91IGfhurdwIHRow6ptDQogICAgICogY2hhclNwbGl0IGzDoCBrw70gdOG7sSBzcGxpdA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJjb252ZXJ0U3RyaW5nVG9EYXRlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb252ZXJ0U3RyaW5nVG9EYXRlKGRhdGVTdHJpbmcsIGNoYXJTcGxpdCwgZm9ybWF0VHlwZSkgewogICAgICBpZiAodHlwZW9mIGRhdGVTdHJpbmcgIT09ICJzdHJpbmciKSB7CiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCk7CiAgICAgIH0KCiAgICAgIHZhciBkYXRlUGFydCA9IGRhdGVTdHJpbmcuc3BsaXQoY2hhclNwbGl0ID8gY2hhclNwbGl0IDogIi8iKTsKICAgICAgdmFyIHJlc3VsdDsKCiAgICAgIHN3aXRjaCAoZm9ybWF0VHlwZSkgewogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJlc3VsdCA9IG5ldyBEYXRlKGRhdGVQYXJ0WzJdLCBwYXJzZUludChkYXRlUGFydFsxXSkgLSAxLCBkYXRlUGFydFswXSk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAyOgogICAgICAgICAgcmVzdWx0ID0gbmV3IERhdGUoZGF0ZVBhcnRbMF0sIHBhcnNlSW50KGRhdGVQYXJ0WzFdKSAtIDEsIGRhdGVQYXJ0WzNdKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmVzdWx0ID0gbmV3IERhdGUoZGF0ZVBhcnRbMl0sIHBhcnNlSW50KGRhdGVQYXJ0WzFdKSAtIDEsIGRhdGVQYXJ0WzBdKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqDQogICAgICogSMOgbSBjb252ZXJ0IHThu6sgRGF0ZVRpbWUgc2FuZyBzdHJpbmcgZm9ybWF0IGThuqFuZyBkZC9tbS95eXl5DQogICAgICogQHBhcmFtIHsqfSBkYXRlIGRhdGUgdHJ1eeG7gW4gZOG6oW5nIERhdGVUaW1lDQogICAgICovCgogIH0sIHsKICAgIGtleTogImNvbnZlcnREYXRlVG9TdHJpbmciLAogICAgdmFsdWU6IGZ1bmN0aW9uIGNvbnZlcnREYXRlVG9TdHJpbmcoZGF0ZSkgewogICAgICBpZiAodHlwZW9mIGRhdGUgIT09ICJzdHJpbmciICYmIGRhdGUpIHsKICAgICAgICB2YXIgZGQgPSBTdHJpbmcoZGF0ZS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICIwIik7CiAgICAgICAgdmFyIG1tID0gU3RyaW5nKGRhdGUuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICIwIik7IC8vSmFudWFyeSBpcyAwIQoKICAgICAgICB2YXIgeXl5eSA9IGRhdGUuZ2V0RnVsbFllYXIoKTsKICAgICAgICByZXR1cm4gZGQgKyAiLyIgKyBtbSArICIvIiArIHl5eXk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRhdGUgPT09ICJzdHJpbmciICYmIGRhdGUpIHsKICAgICAgICByZXR1cm4gZGF0ZTsKICAgICAgfQoKICAgICAgcmV0dXJuICIiOwogICAgfQogICAgLyoqDQogICAgICogQnVpbGQgY29kZSB04burIGNodeG7l2kgbmjhuq1wIHbDoG8NCiAgICAgKiBWRDogVHLhuqduIMSQ4bqhaSBOZ2jEqWEgPT4gVERODQogICAgICogVEROR0hJQSA3LzEwLzIwMjENCiAgICAgKiBAcGFyYW0geyp9IG5hbWUgY2h14buXaSB2w6BvDQogICAgICogQHBhcmFtIHsqfSBtYXhMZW5ndGggxJHhu5kgZMOgaSBnaeG7m2kgaOG6oW4NCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2VuZXJhdGVGaXJzdENoYXJhY3RlciIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2VuZXJhdGVGaXJzdENoYXJhY3RlcihuYW1lLCBtYXhMZW5ndGgpIHsKICAgICAgdmFyIHN0ckNvZGUgPSAiIjsKCiAgICAgIGlmIChuYW1lKSB7CiAgICAgICAgdmFyIGFycldvcmQgPSBuYW1lLnNwbGl0KCIgIik7CgogICAgICAgIGlmIChhcnJXb3JkLmxlbmd0aCA+IDApIHsKICAgICAgICAgIC8vTOG6t3AgcXVhIGPDoWMgdOG7qwogICAgICAgICAgYXJyV29yZC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgIC8vTG/huqFpIGLhu48gY8OhYyB04burIHLhu5VuZyAoY8OzIG5oaeG7gXUgY8OhY2ggdHLhu5FuZykKICAgICAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAvL2zhurdwIHF1YSBjw6FjIGvDvSB04buxIMSR4buDIGzhuqV5IHbhu4Ega8O9IHThu7EgxJHhuqd1IHRpw6puCiAgICAgICAgICAgICAgdmFyIGFyckNoYXIgPSBlbGVtZW50LnNwbGl0KCIiKTsKCiAgICAgICAgICAgICAgaWYgKGFyckNoYXIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgc3RyQ29kZSArPSBhcnJDaGFyWzBdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoc3RyQ29kZSkgewogICAgICAgIC8vTG/huqFpIGLhu48ga8O9IHThu7EgdGnhur9uZyB2aeG7h3QKICAgICAgICBzdHJDb2RlID0gdGhpcy5yZW1vdmVWaWV0bmFtZXNlVG9uZXMoc3RyQ29kZSk7IC8vY2h1eeG7g24gdGjDoG5oIGNo4buvIGhvYQoKICAgICAgICBzdHJDb2RlID0gc3RyQ29kZS50b1VwcGVyQ2FzZSgpOyAvLyBjaGVjayBydWxlIG1heCBsZW5ndGgsIGPhuq90IGNodeG7l2kgxJFpIG7hur91IHRo4burYQoKICAgICAgICBpZiAoc3RyQ29kZSAmJiBtYXhMZW5ndGggJiYgc3RyQ29kZS5sZW5ndGggPiBtYXhMZW5ndGgpIHsKICAgICAgICAgIHN0ckNvZGUgPSBzdHJDb2RlLnN1YnN0cigwLCBtYXhMZW5ndGgpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHN0ckNvZGU7CiAgICB9CiAgICAvKioNCiAgICAgKiBIw6BtIHNvcnQgYXJyIHRoZW8gbW9kZQ0KICAgICAqIFRETkdISUEgMzEvMTAvMjAyMQ0KICAgICAqIEBwYXJhbSB7Kn0gbW9kZQ0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YQ0KICAgICAqIEBwYXJhbSB7Kn0gZGF0YUZpZWxkDQogICAgICogQHBhcmFtIHsqfSBpc0Nhc3RUb0RhdGUgdHJvbmcgdHLGsOG7nW5nIGjhu6NwIHBo4bqjaSBjYXN0IHbhu4EgZGF0ZSBt4bubaSBzbyBzw6FuaCDEkcaw4bujYyB0aMOsIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJzb3J0QXJyYXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNvcnRBcnJheShtb2RlLCBkYXRhLCBkYXRhRmllbGQsIGlzQ2FzdFRvRGF0ZSkgewogICAgICAvL2jDoG0gc29ydAogICAgICBmdW5jdGlvbiBjb21wYXJlKGEsIGIpIHsKICAgICAgICB2YXIgZmlyc3QgPSBhW2RhdGFGaWVsZF0sCiAgICAgICAgICAgIHNlY29uZCA9IGJbZGF0YUZpZWxkXTsKCiAgICAgICAgaWYgKGlzQ2FzdFRvRGF0ZSkgewogICAgICAgICAgZmlyc3QgPSBuZXcgRGF0ZShhW2RhdGFGaWVsZF0pLmdldFRpbWUoKTsKICAgICAgICAgIHNlY29uZCA9IG5ldyBEYXRlKGJbZGF0YUZpZWxkXSkuZ2V0VGltZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGZpcnN0IDwgc2Vjb25kKSByZXR1cm4gbW9kZSA9PSBNU0VudW0uU29ydFN0YXR1cy5kZXNjID8gMSA6IC0xOwogICAgICAgIGlmIChmaXJzdCA+IHNlY29uZCkgcmV0dXJuIG1vZGUgPT0gTVNFbnVtLlNvcnRTdGF0dXMuYXNjID8gMSA6IC0xOwogICAgICAgIHJldHVybiAwOwogICAgICB9CgogICAgICByZXR1cm4gZGF0YS5zb3J0KGNvbXBhcmUpOwogICAgfQogICAgLyoqDQogICAgICogZGlzdGluY3QgbeG6o25nIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcGFyYW0geyp9IGFycmF5IG3huqNuZyBj4bqnbiBkaXN0aW5jdA0KICAgICAqIEBwYXJhbSB7Kn0ga2V5IGZpZWxkTmFtZSBkaXN0aW5jdA0KICAgICAqIFRETkdISUEgMzEvMTAvMjAyMQ0KICAgICAqIEByZXR1cm5zDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRpc3RpbmN0QXJyYXkiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc3RpbmN0QXJyYXkoYXJyYXksIGtleSkgewogICAgICB2YXIgYXJyYXlVbmlxdWVCeUtleSA9IF90b0NvbnN1bWFibGVBcnJheShuZXcgTWFwKGFycmF5Lm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBbaXRlbVtrZXldLCBpdGVtXTsKICAgICAgfSkpLnZhbHVlcygpKTsKCiAgICAgIHJldHVybiBhcnJheVVuaXF1ZUJ5S2V5OwogICAgfQogICAgLyoqDQogICAgICogVOG6o2kgZmlsZSB24buBLCBjaG8gdsOgbyBpZnJhbWUNCiAgICAgKiBOVERJRU0gMDMuMTIuMjAyMQ0KICAgICAqIEBwYXJhbSB7dXJsfSB1cmwgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImRvd25sb2FkRmlsZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZG93bmxvYWRGaWxlKHVybCkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHZhciBpc1Nob3dMb2FkaW5nID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB0cnVlOwogICAgICB2YXIgaWZyYW1lSWQgPSAnZG93bmxvYWRJZnJhbWUnOwogICAgICB2YXIgaWZyYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWZyYW1lSWQpOwoKICAgICAgdmFyIGNoZWNrTG9hZGVkID0gZnVuY3Rpb24gY2hlY2tMb2FkZWQoKSB7CiAgICAgICAgdmFyIGlmcmFtZURvYyA9IGlmcmFtZS5jb250ZW50RG9jdW1lbnQgfHwgaWZyYW1lLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQ7IC8vIGtp4buDbSB0cmEgxJHDoyBkb3dubG9hZCB4b25nIGNoxrBhCgogICAgICAgIGlmIChpZnJhbWVEb2MucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7CiAgICAgICAgICBfdGhpczMudW5tYXNrKCk7CgogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gLy8gY2hlY2sgdHLhuqFuZyB0aMOhaSBt4buXaSAyMDBtcwoKCiAgICAgICAgc2V0VGltZW91dChjaGVja0xvYWRlZCwgMjAwKTsKICAgICAgfTsgLy8gTk1UVUFOMiAwOC4wNC4yMDIyOiBsdcO0biB4b8OhIGPDoWkgaWZyYW1lIGPFqSDEkWkgxJHhu4Mgc2hvdyBtYXNrCgoKICAgICAgaWYgKGlmcmFtZSkgewogICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoaWZyYW1lKTsKICAgICAgfSAvLyBOTVRVQU4yIDE0LjA0LjIwMjI6IGx1w7RuIHThuqFvIG3hu5tpIGPDoWkgaWZyYW1lCgoKICAgICAgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7CiAgICAgIGlmcmFtZS5pZCA9IGlmcmFtZUlkOwogICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdzcmMnLCB1cmwpOwogICAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdjbGFzcycsICdoaWRkZW4nKTsKCiAgICAgIGlmIChpc1Nob3dMb2FkaW5nKSB7CiAgICAgICAgdGhpcy5tYXNrKCk7CiAgICAgIH0KCiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoaWZyYW1lKTsKCiAgICAgIGlmIChpc1Nob3dMb2FkaW5nKSB7CiAgICAgICAgY2hlY2tMb2FkZWQoKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogSMOgbSByZW1vdmUgY8OhYyBrw70gaGnhu4d1IGh0bWwgdOG7qyBjaHXhu5dpIHRydXnhu4FuIHbDoG8NCiAgICAgKiBAcGFyYW0ge0NodeG7l2kgbuG7mWkgZHVuZyB0cnV54buBbiB2w6BvfSBjb250ZW50U3RyaW5nIA0KICAgICAqIEByZXR1cm5zIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJyZW1vdmVIVE1MIiwKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVIVE1MKGNvbnRlbnRTdHJpbmcpIHsKICAgICAgcmV0dXJuIGNvbnRlbnRTdHJpbmcucmVwbGFjZSgvKDwoW14+XSspPikvaWcsICIiKTsKICAgIH0KICAgIC8qKg0KICAgICAqIEjDoG0gZW5jb2RlIGPDoWMga8O9IGhp4buHdSwgc2NyaXB0IMSR4buDIGdp4buvIG5ndXnDqm4gbuG7mWkgZHVuZyB0ZXh0DQogICAgICogQHBhcmFtIHtDaHXhu5dpIG7hu5lpIGR1bmcgdHJ1eeG7gW4gdsOgb30gY29udGVudFN0cmluZyANCiAgICAgKiBWRDogIjxiPkLDoGk8L2I+IHRvw6FuIHR14buVaSB0aMahIiA9PiAiJmx0O0LDoGk7Jmx0Oy9iJmd0OyB0b8OhbiB0deG7lWkgdGjGoSINCiAgICAgKiBz4butIGThu6VuZyBu4bq/dSBwaOG6o2kgbOG6pXkgdGV4dCBuZ3V5w6puIGPDoWMgdGjhursgc2NyaXB0DQogICAgICogQHJldHVybnMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImVuY29kZUhUTUwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGVuY29kZUhUTUwoY29udGVudFN0cmluZykgewogICAgICB2YXIgdHh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKICAgICAgdHh0LmlubmVySFRNTCA9IGNvbnRlbnRTdHJpbmc7CiAgICAgIGNvbnRlbnRTdHJpbmcgPSB0eHQuaW5uZXJIVE1MOwogICAgICB0eHQgPSBudWxsOwogICAgICByZXR1cm4gY29udGVudFN0cmluZzsKICAgIH0KICAgIC8qKg0KICAgICogSMOgbSBkZWNvZGUgY8OhYyBrw70gaGnhu4d1LCBzY3JpcHQgxJHhu4MgZ2nhu68gbmd1ecOqbiBu4buZaSBkdW5nIHRleHQNCiAgICAqIEBwYXJhbSB7Q2h14buXaSBu4buZaSBkdW5nIHRydXnhu4FuIHbDoG99IGNvbnRlbnRTdHJpbmcgDQogICAgKiBWRDogIiZsdDtCw6BpOyZsdDsvYiZndDsgdG/DoW4gdHXhu5VpIHRoxqEiID0+ICI8Yj5Cw6BpPC9iPiB0b8OhbiB0deG7lWkgdGjGoSINCiAgICAqIHPhu60gZOG7pW5nIG7hur91IGzhuqV5IHJhIGdpw6EgdHLhu4sgY2jhu6lhIGPDoWMgdGjhurssIGvDvSBoaeG7h3UgxJHDoyDEkcaw4bujYyBlbmNvZGUNCiAgICAqIEByZXR1cm5zIA0KICAgICovCgogIH0sIHsKICAgIGtleTogImRlY29kZUhUTUwiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlY29kZUhUTUwoY29udGVudFN0cmluZykgewogICAgICB2YXIgdHh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsKICAgICAgdHh0LmlubmVySFRNTCA9IGNvbnRlbnRTdHJpbmc7CiAgICAgIHJldHVybiBjb250ZW50U3RyaW5nID0gdHh0LnZhbHVlOwogICAgfQogICAgLyoqDQogICAgICogVEROR0hJQSAxMC8xMi8yMDIxDQogICAgICogZm9ybWF0IGzhuqFpIG5nw6B5IHRow6FuZyBuxINtIHRoZW8gdGVtcGxhdGUgdHJ1eeG7gW4gdsOgbyBt4bq3YyDEkeG7i25oIGzDoCBkZC9tbS95eXl5DQogICAgICogQHBhcmFtIHtHacOhIHRy4buLIG5nw6B5IHRow6FuZ30gdmFsdWUgDQogICAgICogQHBhcmFtIHtLaeG7g3UgZm9ybWF0fSBmb3JtYXRUeXBlIA0KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJmb3JtYXREYXRlVGltZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZm9ybWF0RGF0ZVRpbWUodmFsdWUsIGZvcm1hdFR5cGUpIHsKICAgICAgcmV0dXJuIG1vbWVudCh2YWx1ZSkuZm9ybWF0KGZvcm1hdFR5cGUgPyBmb3JtYXRUeXBlIDogIkREL01NL1lZWVkiKTsKICAgIH0KICAgIC8qKiBESFBISSAyNC8xMi8yMDIxDQogICAgICogdGjDqm0gZOG6pXUgdsOgbyBz4buRIGThuqFuZyB04burIHh4eHggPT4geC54eHh4IA0KICAgICAqIEBwYXJhbSB7U+G7kSB0cnV54buBbiB2w6BvfSBudW1iZXIgDQogICAgICogQHBhcmFtIHtMb+G6oWkgZOG6pXUgbXXhu5FuIHRow6ptIHbDoG8sIG3hurdjIMSR4buLbmggbMOgIGThuqV1ICcuJ30gdHlwZUNvbW1hcyANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZm9ybWF0TnVtYmVyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmb3JtYXROdW1iZXIobnVtYmVyLCB0eXBlQ29tbWFzKSB7CiAgICAgIHJldHVybiBudW1iZXIudG9TdHJpbmcoKS5yZXBsYWNlKC9cQig/PShcZHszfSkrKD8hXGQpKS9nLCB0eXBlb2YgdHlwZUNvbW1hcyAhPT0gJ3VuZGVmaW5lZCcgPyB0eXBlQ29tbWFzIDogJy4nKTsKICAgIH0KICAgIC8qKg0KICAgICAqIEzhuqV5IHRow7RuZyB0aW4gbG9nIGZpcmViYXNlIGtoaSB1cGRhdGUNCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqIEBwYXJhbSB7Kn0gbWVudU5hbWVDdXJyZW50IFTDqm4gbWVudSBoaeG7h24gdOG6oWkgKHRyw7luZyB24bubaSBuYW1lIHRyb25nIHJvdXRlcikNCiAgICAgKiBAcGFyYW0geyp9IGNvbnRleHQgDQogICAgICogQHJldHVybnMgDQogICAgICovCgogIH0sIHsKICAgIGtleTogImxvZ0RhdGFGaXJlQmFzZVVwZGF0ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9nRGF0YUZpcmVCYXNlVXBkYXRlKG1lbnVOYW1lQ3VycmVudCwgY29udGV4dCkgewogICAgICB2YXIgZ3JvdXBUeXBlID0gbnVsbCwKICAgICAgICAgIGJ1c2luZXNzVHlwZSA9IG51bGwsCiAgICAgICAgICBtZW51SXRlbXMgPSB3aW5kb3cubWVudUl0ZW1zLAogICAgICAgICAgLy9UaMO0bmcgdGluIGPDoWMgbWVudSBjaGEKICAgICAgYWxsQ2hpbGRNZW51ID0gd2luZG93LmFsbENoaWxkTWVudSwKICAgICAgICAgIC8vVGjDtG5nIHRpbiBjw6FjIG1lbnUgY29uCiAgICAgIHJvdXRlcnMgPSB3aW5kb3cuaW5mb3JSb3V0ZXJzOyAvL1Row7RuZyB0aW4gcm91dGVyCiAgICAgIC8vTOG6pXkgdHJvbmcgbWVudSBjaGEKCiAgICAgIHZhciBtZW51UGFyZW50ID0gbWVudUl0ZW1zLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gaXRlbS5uYW1lID09IG1lbnVOYW1lQ3VycmVudDsKICAgICAgfSk7IC8vTOG6pXkgdHJvbmcgbWVudSBjb24KCiAgICAgIHZhciBtZW51Q2hpbGQgPSBhbGxDaGlsZE1lbnUuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHJldHVybiBpdGVtLm5hbWUgPT0gbWVudU5hbWVDdXJyZW50OwogICAgICB9KTsKCiAgICAgIGlmIChtZW51UGFyZW50IHx8IG1lbnVDaGlsZCkgewogICAgICAgIGlmIChtZW51UGFyZW50KSB7CiAgICAgICAgICAvL07hur91IGPDsyB0aMOsIGzhuqV5IG1lbnUga2jDtG5nIGPDsyBtZW51IGNvbiAoZ3JvdXBUeXBlID0gQnVzaW5lc3NUeXBlKQogICAgICAgICAgaWYgKCFtZW51UGFyZW50Lmhhc0NoaWxkKSB7CiAgICAgICAgICAgIGdyb3VwVHlwZSA9IGJ1c2luZXNzVHlwZSA9IG1lbnVQYXJlbnQudGV4dDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnVzaW5lc3NUeXBlID0gbWVudUNoaWxkLnRleHQ7CiAgICAgICAgICBncm91cFR5cGUgPSBtZW51SXRlbXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICByZXR1cm4gbWVudUNoaWxkLnBhcmVudCA9PSBpdGVtLm5hbWU7CiAgICAgICAgICB9KS50ZXh0OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvL0tow7RuZyBjw7MgdHJvbmcgbWVudSB0aMOsIHTDrG0gdHJvbmcgcm91dGVyCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3V0ZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZiAocm91dGVyc1tpXS5jaGlsZHJlbikgewogICAgICAgICAgICB2YXIgcm91dGVyID0gcm91dGVyc1tpXS5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0ubmFtZSA9PSBtZW51TmFtZUN1cnJlbnQ7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHJvdXRlcikgewogICAgICAgICAgICAgIG1lbnVOYW1lQ3VycmVudCA9IHJvdXRlcnNbaV0ubmFtZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5sb2dEYXRhRmlyZUJhc2VVcGRhdGUobWVudU5hbWVDdXJyZW50LCBjb250ZXh0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmIChncm91cFR5cGUgJiYgYnVzaW5lc3NUeXBlKSB7Ly8gRmlyZWJhc2UubG9nRGF0YUZpcmVCYXNlKAogICAgICAgIC8vICAgZ3JvdXBUeXBlLAogICAgICAgIC8vICAgYnVzaW5lc3NUeXBlLAogICAgICAgIC8vICAgTVNFbnVtLkZpcmVCYXNlQWN0aW9uVHlwZS5VcGRhdGUsCiAgICAgICAgLy8gICBjb250ZXh0CiAgICAgICAgLy8gKTsKICAgICAgfQogICAgfQogICAgLyoqDQogICAgICogVGjDqm0gY8OhYyB0aMO0bmcgYsOhbyB04bubaSBjw6FjIMSRxqFuIHbhu4sNCiAgICAgKiBOTVRVQU4zIDA4LzAzLzIwMjINCiAgICAgKiBAcGFyYW0ge0FycmF5fSBub3RpZmljYXRpb25zIG3huqNuZyBkYW5oIHPDoWNoIGPDoWMgdGjDtG5nIGLDoW8sIHRow7RuZyBiw6FvIGzDoCBvYmplY3QgDQogICAgICogew0KICAgICAqICAgIE9yZ2FuaXphdGlvbklEOiBJRCDEkcahbiB24buLIG5o4bqtbiBob+G6t2MgdOG6oW8gdGjDtG5nIGLDoW8NCiAgICAgKiAgICBDb250ZW50OiBO4buZaSBkdW5nIGPDonUgdGjDtG5nIGLDoW8NCiAgICAgKiAgICBUeXBlOiBLaeG7g3UgdGjDtG5nIGLDoW8gcGjhu6VjIHbhu6UgaGnhu4NuIHRo4buLDQogICAgICogICAgRXh0cmFEYXRhOiBE4buvIGxp4buHdSBi4buVIHN1bmcNCiAgICAgKiB9DQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHN1YlN5c3RlbUNvZGUgZW51bSBkw7luZyDEkeG7gyBs4bqleSBjw6J1IHNxbCBpbnNlcnQgdGjDtG5nIGLDoW8NCiAgICAgKiANCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaW5zZXJ0Tm90aWZpY2F0aW9ucyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gaW5zZXJ0Tm90aWZpY2F0aW9ucyhub3RpZmljYXRpb25zLCBzdWJTeXN0ZW1Db2RlKSB7CiAgICAgIHZhciBwYXlsb2FkID0gewogICAgICAgIE5vdGlmaWNhdGlvbnM6IG5vdGlmaWNhdGlvbnMsCiAgICAgICAgU3ViU3lzdGVtQ29kZTogc3ViU3lzdGVtQ29kZQogICAgICB9OwogICAgICBub3RpZmljYXRpb25BUEkuaW5zZXJ0KHBheWxvYWQpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIENvbW1vbkZ1bmN0aW9uOwp9KCk7CgpleHBvcnQgZGVmYXVsdCBuZXcgQ29tbW9uRnVuY3Rpb24oKTs="},null]}
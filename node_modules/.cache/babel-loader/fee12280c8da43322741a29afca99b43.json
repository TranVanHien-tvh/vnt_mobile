{"remainingRequest":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js!D:\\VNT_vue\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\VNT_vue\\src\\views\\base\\BaseListPopup.js","dependencies":[{"path":"D:\\VNT_vue\\src\\views\\base\\BaseListPopup.js","mtime":1661569492764},{"path":"D:\\VNT_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\VNT_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\VNT_vue\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIkQ6L1ZOVF92dWUvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICJEOi9WTlRfdnVlL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9vYmplY3RTcHJlYWQyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuam9pbi5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltLmpzIjsKaW1wb3J0ICJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiOwppbXBvcnQgQmFzZUxpc3QgZnJvbSAiQC92aWV3cy9iYXNlL0Jhc2VMaXN0IjsKaW1wb3J0IHsgcGVybWlzc2lvbiB9IGZyb20gIkAvbWl4aW5zL2NvbW1vbi9wZXJtaXNzaW9uIjsKaW1wb3J0IHsgbWFwU3RhdGUsIG1hcEFjdGlvbnMsIG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IHsgTW9kdWxlTGF5b3V0VGVtcGxhdGUsIE1vZHVsZUNvbnRleHQsIE1vZHVsZU9yZ2FuaXphdGlvbiB9IGZyb20gIkAvc3RvcmVzL21vZHVsZS1jb25zdCI7IC8vIGltcG9ydCBleHBvcnRBcGkgZnJvbSAiQC9hcGlzL2V4cG9ydEFQSSI7CgppbXBvcnQgTVNKc29uIGZyb20gIkAvY29tbW9ucy9qc29uIjsKaW1wb3J0IHsgc2hvcnRrZXlTdGF0dXNiYXIgfSBmcm9tICJAL21peGlucy9jb21tb24vc2hvcnRrZXlTdGF0dXNiYXIiOwppbXBvcnQgcG9wdXBVdGlsIGZyb20gIkAvY29tbW9ucy9wb3B1cFV0aWwiOwppbXBvcnQgY29tbW9uRm4gZnJvbSAiQC9jb21tb25zL2NvbW1vbkZ1bmN0aW9uIjsKZXhwb3J0IGRlZmF1bHQgewogIGV4dGVuZHM6IEJhc2VMaXN0LAogIG5hbWU6ICJCYXNlTGlzdFBvcHVwIiwKICBtaXhpbnM6IFtwZXJtaXNzaW9uLCBzaG9ydGtleVN0YXR1c2Jhcl0sCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIC8qKg0KICAgICAgICogQWN0aW9uIGPhu6dhIHThu6tuZyBi4bqjbiBnaGkga2hpIGFjdGl2ZQ0KICAgICAgICovCiAgICAgIHJvd0FjdGlvbnM6IFtdLAoKICAgICAgLyoqDQogICAgICAgKiBUw6puIGtleSBt4bqrdQ0KICAgICAgICovCiAgICAgIGxheW91dFRhZzogbnVsbCwKCiAgICAgIC8qKg0KICAgICAgICogQ8OhYyBhY3Rpb24ga2hpIGNo4buNbiBuaGnhu4F1DQogICAgICAgKi8KICAgICAgYWN0aW9uTXVsdGk6IFtdLAoKICAgICAgLyoqDQogICAgICAgKiByZWZuYW1lIGNvbnRyb2wgaGnhu4NuIHRo4buLIGFjdGlvbiBraGkgY2jhu41uIG5oaeG7gXUgYuG6o24gZ2hpDQogICAgICAgKi8KICAgICAgYWN0aW9uTXV0aWxSZWY6ICJhY3Rpb25NdWx0aSIsCgogICAgICAvKioNCiAgICAgICAqIHJlZm5hbWUgY29udHJvbCBoaeG7g24gdGjhu4sgYWN0aW9uIGtoaSBjaOG7jW4gbmhp4buBdSBi4bqjbiBnaGkgKCBtw6BuIGjDrG5oIHRvIGjGoW4gMTIwMCkNCiAgICAgICAqLwogICAgICBhY3Rpb25NdXRpbFJlZkJpZ1NjcmVlbjogImFjdGlvbk11bHRpQmlnU2NyZWVuIiwKICAgICAgbGF5b3V0OiB7fSwKICAgICAgdGl0bGU6ICIiLAoKICAgICAgLyoqDQogICAgICAgKiBjw7Mgc2hvdyB04bqldCBj4bqjIGljb24gZmlsdGVyIGhlYWRlciBncmlkIGzDqm4gaw0KICAgICAgICovCiAgICAgIHNob3dBbGxJY29uRmlsdGVyOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogU2hvdyBmaWx0ZXIgYm94DQogICAgICAgKi8KICAgICAgaXNTaG93RmlsdGVyOiBmYWxzZSwKCiAgICAgIC8qKg0KICAgICAgICogU2hvdyBtb3JlIGFjdGlvbiBib3gNCiAgICAgICAqLwogICAgICBpc1Nob3dBY3Rpb25Hcm91cDogZmFsc2UKICAgIH07CiAgfSwKICBjb21wdXRlZDogX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEdldHRlcnMoTW9kdWxlQ29udGV4dCwgWyJDb250ZXh0Il0pKSwgbWFwR2V0dGVycyh7CiAgICBvcmdzOiBNb2R1bGVPcmdhbml6YXRpb24gKyAiL3RyZWUiCiAgfSkpLCB7fSwgewogICAgLyoqDQogICAgICogxJDhu5FpIHTGsOG7o25nIHN0YXRlIGPhu6dhIHN0b3JlDQogICAgICovCiAgICBzdG9yZVN0YXRlOiBmdW5jdGlvbiBzdG9yZVN0YXRlKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGVbdGhpcy5tb2R1bGVdOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBLaMO0bmcgY8OzIGThu68gbGnhu4d1IHRyb25nIGLhuqNuZw0KICAgICAqIETDuW5nIGPhu50gbsOgeSDEkeG7gyBoaeG7g24gdGjhu4sgbeG6t2MgaMOsbmggdHLhu5FuZyB0csOqbiBkYW5oIHPDoWNoDQogICAgICovCiAgICBlbXB0eTogZnVuY3Rpb24gZW1wdHkoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0b3JlU3RhdGUuZW1wdHk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEThu68gbGnhu4d1IGhp4buDbiB0aOG7iw0KICAgICAqLwogICAgaXRlbXM6IGZ1bmN0aW9uIGl0ZW1zKCkgewogICAgICByZXR1cm4gdGhpcy5zdG9yZVN0YXRlLml0ZW1zOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBU4buVbmcgc+G7kQ0KICAgICAqLwogICAgdG90YWw6IGZ1bmN0aW9uIHRvdGFsKCkgewogICAgICByZXR1cm4gdGhpcy5zdG9yZVN0YXRlLnRvdGFsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBTdW1tYXJ5IGPhu6dhIGdyaWQNCiAgICAgKi8KICAgIHN1bW1hcnk6IGZ1bmN0aW9uIHN1bW1hcnkoKSB7CiAgICAgIHJldHVybiB0aGlzLnN0b3JlU3RhdGUuc3VtbWFyeTsKICAgIH0sCgogICAgLyoqDQogICAgICogbG9hZGluZw0KICAgICAqLwogICAgbG9hZGluZzogZnVuY3Rpb24gbG9hZGluZygpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RvcmVTdGF0ZS5sb2FkaW5nOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBsb2FkaW5nIHN1bW1hcnkNCiAgICAgKi8KICAgIGxvYWRpbmdTdW1tYXJ5OiBmdW5jdGlvbiBsb2FkaW5nU3VtbWFyeSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RvcmVTdGF0ZS5sb2FkaW5nU3VtbWFyeTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ+G7mXQgdGhlbyBj4bqldSBow6xuaCBj4bunYSBt4bqrdQ0KICAgICAqLwogICAgbGF5b3V0Q29sdW1uczogZnVuY3Rpb24gbGF5b3V0Q29sdW1ucygpIHsKICAgICAgcmV0dXJuIHRoaXMuJHN0b3JlLnN0YXRlW01vZHVsZUxheW91dFRlbXBsYXRlXS5hcHBseTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ29udHJvbCBoaeG7g24gdGjhu4sgYWN0aW9uIGtoaSBjaOG7jW4gbmhp4buBdSBi4bqjbiBnaGkNCiAgICAgKi8KICAgIGFjdGlvbk11bHRpQ29tcG9uZW50OiBmdW5jdGlvbiBhY3Rpb25NdWx0aUNvbXBvbmVudCgpIHsKICAgICAgcmV0dXJuIHRoaXMuJHJlZnNbdGhpcy5hY3Rpb25NdXRpbFJlZl07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENvbnRyb2wgaGnhu4NuIHRo4buLIGFjdGlvbiBraGkgY2jhu41uIG5oaeG7gXUgYuG6o24gZ2hpIChtw6BuIGjDrG5oIGzhu5tuKQ0KICAgICAqLwogICAgYWN0aW9uTXVsdGlCaWdTY3JlZW5Db21wb25lbnQ6IGZ1bmN0aW9uIGFjdGlvbk11bHRpQmlnU2NyZWVuQ29tcG9uZW50KCkgewogICAgICByZXR1cm4gdGhpcy4kcmVmc1t0aGlzLmFjdGlvbk11dGlsUmVmQmlnU2NyZWVuXTsKICAgIH0KICB9KSwKICBjcmVhdGVkOiBmdW5jdGlvbiBjcmVhdGVkKCkge30sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHZhciBtZSA9IHRoaXM7CiAgICB3aW5kb3cuX3h4ID0gdGhpczsgLy9pbml0IGxheW91dAoKICAgIG1lLmluaXRMYXlvdXQoKTsgLy9pbml0IGV2ZW50CgogICAgbWUuaW5pdEV2ZW50KCk7CiAgfSwKICBtZXRob2RzOiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIG1hcEFjdGlvbnMoewogICAgbG9hZEFwcGx5TGF5b3V0OiBNb2R1bGVMYXlvdXRUZW1wbGF0ZSArICIvbG9hZEFwcGx5IgogIH0pKSwge30sIHsKICAgIC8qKg0KICAgICAqIEzhuqV5IGPhuqV1IGjDrG5oIGPhu5l0IHRoZW8gbeG6q3Ugw6FwIGThu6VuZw0KICAgICAqLwogICAgZ2V0TGF5b3V0VGVtcGxhdGU6IGZ1bmN0aW9uIGdldExheW91dFRlbXBsYXRlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgbWUsIGNhY2hlTGF5b3V0VGVtcGxhdGU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLmdldENhY2hlTGF5b3V0VGVtcGxhdGUoKTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgY2FjaGVMYXlvdXRUZW1wbGF0ZSA9IF9jb250ZXh0LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCFjYWNoZUxheW91dFRlbXBsYXRlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA2OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjYWNoZUxheW91dFRlbXBsYXRlKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgX3RoaXMubGF5b3V0Q29sdW1uc1tfdGhpcy5sYXlvdXRUYWddKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBY4butIGzDvSBj4bqldSBow6xuaCBt4bqrdSBj4bunYSBmb3JtDQogICAgICovCiAgICBpbml0TGF5b3V0OiBmdW5jdGlvbiBpbml0TGF5b3V0KCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKCkgewogICAgICAgIHZhciBtZSwgbGF5b3V0LCBjb2x1bW5zOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzMjsKCiAgICAgICAgICAgICAgICBpZiAoIW1lLmxheW91dFRhZykgewogICAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDEyOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuZ2V0TGF5b3V0VGVtcGxhdGUoKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgbGF5b3V0ID0gX2NvbnRleHQyLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoIWxheW91dCB8fCBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gImRldmVsb3BtZW50IikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDg7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUubG9hZEFwcGx5TGF5b3V0KG1lLmxheW91dFRhZyk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIGxheW91dCA9IF9jb250ZXh0Mi5zZW50OwoKICAgICAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgICAgICBtZS5sYXlvdXQgPSBtZS5jb252ZXJ0VG9MYXlvdXRUZW1wbGV0ZShsYXlvdXQpOwogICAgICAgICAgICAgICAgY29sdW1ucyA9IG1lLmdldExheW91dENvbHVtbihsYXlvdXQpOwogICAgICAgICAgICAgICAgbWUuZ3JpZC5pbml0Q29sdW1ucyhjb2x1bW5zKTsKCiAgICAgICAgICAgICAgY2FzZSAxMjoKICAgICAgICAgICAgICAgIC8vbG9hZCBk4buvIGxp4buHdSBs4bqnbiDEkeG6p3UKICAgICAgICAgICAgICAgIG1lLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIG1lLnJlbG9hZCgpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTIpOwogICAgICB9KSkoKTsKICAgIH0sCiAgICBjb252ZXJ0VG9MYXlvdXRUZW1wbGV0ZTogZnVuY3Rpb24gY29udmVydFRvTGF5b3V0VGVtcGxldGUobGF5b3V0KSB7CiAgICAgIHZhciBsYXlvdXRUZW1wbGV0ZSA9IHt9OwoKICAgICAgaWYgKGxheW91dCkgewogICAgICAgIGxheW91dFRlbXBsZXRlLkxheW91dFRlbXBsYXRlSUQgPSBsYXlvdXQuTGF5b3V0VGVtcGxhdGVJRDsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5MYXlvdXRUYWcgPSBsYXlvdXQuTGF5b3V0VGFnOwogICAgICAgIGxheW91dFRlbXBsZXRlLlVzZXJJRCA9IGxheW91dC5Vc2VySUQgfHwgdGhpcy5Db250ZXh0LlVzZXJJRDsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5Jc1N5c3RlbSA9IGxheW91dC5Jc1N5c3RlbTsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5MYXlvdXRDb25maWcgPSBsYXlvdXQuQ29sdW1uczsKICAgICAgICBsYXlvdXRUZW1wbGV0ZS5MYXlvdXRUZW1wbGF0ZU5hbWUgPSBsYXlvdXQuTGF5b3V0VGVtcGxhdGVOYW1lOwogICAgICB9CgogICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgbGF5b3V0VGVtcGxldGUpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0aMO0bmcgdGluIGNvbHVtbiByZW5kZXIgdOG7qyB0aMO0bmcgdGluIGPhu6dhIG3huqt1DQogICAgICovCiAgICBnZXRMYXlvdXRDb2x1bW46IGZ1bmN0aW9uIGdldExheW91dENvbHVtbihsYXlvdXQpIHsKICAgICAgaWYgKGxheW91dCAhPSB1bmRlZmluZWQpIHsKICAgICAgICB2YXIgbWUgPSB0aGlzOwogICAgICAgIHZhciBjb2x1bW5zID0gSlNPTi5wYXJzZShsYXlvdXQuQ29sdW1ucyk7IC8vbuG6v3UgbMOgIG3huqt1IG3hurdjIMSR4buLbmggdsOgIG5nw7RuIG5n4buvIGtow6FjIHRp4bq/bmcgdmnhu4d0IC0+IGPhuq1wIG5o4bqtdCBjYXB0aW9uL3RpdGxlIHRoZW8gbmfDtG4gbmfhu68KCiAgICAgICAgaWYgKGxheW91dC5Jc1N5c3RlbSkgewogICAgICAgICAgbWUubG9jYWxpemF0aW9uQ29sdW1uKGNvbHVtbnMpOwogICAgICAgIH0gLy9ubmxhbTogb3JkZXJieSBs4bqhaSB0aGVvIHNvcnRfb3JkZXIgdsOgIGxvY2suCgoKICAgICAgICBjb2x1bW5zID0gXyhjb2x1bW5zKS5jaGFpbigpLnNvcnRCeSgic29ydF9vcmRlciIpLnNvcnRCeShmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgICAgICByZXR1cm4gIWNvbHVtbi5sb2NrOwogICAgICAgIH0pLnZhbHVlKCk7CiAgICAgICAgcmV0dXJuIGNvbHVtbnM7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogR+G7jWkgcmVxdWVzdCBsb2FkIGThu68gbGnhu4d1DQogICAgICogR+G7jWkgdsOgbyBjcnVkLWJhc2UNCiAgICAgKi8KICAgIHJlcXVlc3RMb2FkRGF0YTogZnVuY3Rpb24gcmVxdWVzdExvYWREYXRhKHBheWxvYWQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZS5ncmlkICYmIG1lLmdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQobWUubW9kdWxlLCAiL2xvYWRMaXN0VHJlZSIpLCBwYXlsb2FkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KG1lLm1vZHVsZSwgIi9sb2FkIiksIHBheWxvYWQpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgLyoqDQogICAgICAgICAgICogZGVsYXkgxJHhu4MgxJHhu6NpIGdyaWQgc2VsZWN0IGTDsm5nIMSR4bqndQ0KICAgICAgICAgICAqIE5NVFVBTjIgMDQuMTIuMjAyMQ0KICAgICAgICAgICAqLwogICAgICAgICAgaWYgKG1lLmlzU2VhcmNoaW5nKSB7CiAgICAgICAgICAgIG1lLmlzU2VhcmNoaW5nID0gZmFsc2U7CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIGlmIChtZS5zZWFyY2hCb3ggJiYgbWUuc2VhcmNoQm94LiRyZWZzLmlucHV0KSB7CiAgICAgICAgICAgICAgICBtZS5zZWFyY2hCb3guJHJlZnMuaW5wdXQuZm9jdXMoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogR+G7jWkgcmVxdWVzdCBsb2FkIHN1bW1hcnkNCiAgICAgKi8KICAgIHJlcXVlc3RMb2FkRGF0YVN1bW1hcnk6IGZ1bmN0aW9uIHJlcXVlc3RMb2FkRGF0YVN1bW1hcnkocGF5bG9hZCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKG1lLmdyaWQgJiYgIW1lLmdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQobWUubW9kdWxlLCAiL2xvYWRTdW1tYXJ5IiksIHBheWxvYWQpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGRiY2xpY2sgYuG6o24gZ2hpIHRyw6puIGdyaWQNCiAgICAgKi8KICAgIGdyaWRSb3dEYkNsaWNrOiBmdW5jdGlvbiBncmlkUm93RGJDbGljayhyZWNvcmQsIGUpIHsKICAgICAgdGhpcy5lZGl0KHJlY29yZCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHPhu7Ega2nhu4duIOG6pW4gdsOgbyBjw6FjIGFjdGlvbiB0csOqbiBmb3JtDQogICAgICovCiAgICBidXR0b25DbGljazogZnVuY3Rpb24gYnV0dG9uQ2xpY2soY29tbWFuZCwgZSkge30sCgogICAgLyoqDQogICAgICogVGjDqm0NCiAgICAgKi8KICAgIGFkZDogZnVuY3Rpb24gYWRkKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFtZS5jaGVja0FjdGlvblBlcm1pc3Npb25BbGVydChtZS4kdCgiaTE4blBlcm1pc3Npb24uU3ViU3lzdGVtQ29kZS5Db2RlLkFERCIpKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhcmFtID0gbWUuZ2V0RGV0YWlsUGFyYW1ldGVyKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5BZGQpOwogICAgICBtZS5zaG93RGV0YWlsKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5BZGQsIHBhcmFtKTsKICAgIH0sCgogICAgLyoqDQogICAgICogU+G7rSBk4bulbmcgY2hvIHPhu7Ega2nhu4duIGRibGljayB2w6BvIGTDsm5nIHRyw6puIGdyaWQgxJHhu4Mgc2hvdyBmb3JtIHTGsMahbmcg4bupbmcNCiAgICAgKiAqLwogICAgZWRpdDogZnVuY3Rpb24gZWRpdChyZWNvcmQpIHsKICAgICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogIkVESVQiOwogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgaWYgKCFtZS5jaGVja0FjdGlvblBlcm1pc3Npb25BbGVydChhY3Rpb24pKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGFyYW0gPSBtZS5nZXREZXRhaWxQYXJhbWV0ZXIobWUuZm9ybURldGFpbE5hbWUsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsIHJlY29yZCk7CiAgICAgIG1lLnNob3dEZXRhaWwobWUuZm9ybURldGFpbE5hbWUsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkVkaXQsIHBhcmFtLCB7CiAgICAgICAgc3VibWl0OiBmdW5jdGlvbiBzdWJtaXQoc2F2ZVJlc3VsdCwgc2F2ZVBhcmFtKSB7CiAgICAgICAgICBpZiAoc2F2ZVJlc3VsdC5TdWNjZXNzKSB7CiAgICAgICAgICAgIG1lLmFmdGVyU2F2ZUVkaXQocmVjb3JkLCBzYXZlUmVzdWx0LCBzYXZlUGFyYW0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIHB2ZHV5IDI3LzAyLzIwMjE6IHRow6ptIGThu68gbGnhu4d1IGNobyBtb2RlIHZpZXcNCiAgICAgKiAqLwogICAgdmlldzogZnVuY3Rpb24gdmlldyhyZWNvcmQpIHsKICAgICAgdmFyIGFjdGlvbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogIldBVENIIjsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmICghbWUuY2hlY2tBY3Rpb25QZXJtaXNzaW9uQWxlcnQoYWN0aW9uKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdmFyIHBhcmFtID0gbWUuZ2V0RGV0YWlsUGFyYW1ldGVyKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5WaWV3LCByZWNvcmQpOwogICAgICBtZS5zaG93RGV0YWlsKG1lLmZvcm1EZXRhaWxOYW1lLCB0aGlzLiRtcy5lbnVtLkZvcm1TdGF0ZS5WaWV3LCBwYXJhbSwgewogICAgICAgIHN1Ym1pdDogZnVuY3Rpb24gc3VibWl0KHNhdmVSZXN1bHQsIHNhdmVQYXJhbSkgewogICAgICAgICAgaWYgKHNhdmVSZXN1bHQuU3VjY2VzcykgewogICAgICAgICAgICBtZS5hZnRlclNhdmVWaWV3KHJlY29yZCwgc2F2ZVJlc3VsdCwgc2F2ZVBhcmFtKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBOaMOibiBi4bqjbiBi4bqjbiBnaGkNCiAgICAgKiAqLwogICAgZHVwbGljYXRlOiBmdW5jdGlvbiBkdXBsaWNhdGUocmVjb3JkKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICBpZiAoIW1lLmNoZWNrQWN0aW9uUGVybWlzc2lvbkFsZXJ0KG1lLiR0KCJpMThuUGVybWlzc2lvbi5TdWJTeXN0ZW1Db2RlLkNvZGUuQUREIikpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB2YXIgcGFyYW0gPSBtZS5nZXREZXRhaWxQYXJhbWV0ZXIobWUuZm9ybURldGFpbE5hbWUsIHRoaXMuJG1zLmVudW0uRm9ybVN0YXRlLkR1cGxpY2F0ZSwgcmVjb3JkKTsKICAgICAgbWUuc2hvd0RldGFpbChtZS5mb3JtRGV0YWlsTmFtZSwgdGhpcy4kbXMuZW51bS5Gb3JtU3RhdGUuRHVwbGljYXRlLCBwYXJhbSk7CiAgICB9LAogICAgcmVmcmVzaENsaWNrOiBmdW5jdGlvbiByZWZyZXNoQ2xpY2soKSB7CiAgICAgIHRoaXMucmVmcmVzaCgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBkcmlsbGRvd24ga2hpIGNsaWNrIHbDoG8gZ3JpZA0KICAgICAqICovCiAgICBkcmlsbGRvd25DbGljazogZnVuY3Rpb24gZHJpbGxkb3duQ2xpY2sobWV0YURhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZXRhRGF0YS5kYXRhUm93KSB7CiAgICAgICAgbWUuZWRpdChtZXRhRGF0YS5kYXRhUm93KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkVycm9yIikpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBhdXRob3IgVFZMT0kgMjAuMDUuMjAyMQ0KICAgICAqIGRyaWxsZG93biB2w6BvIGNoaSB0aeG6v3Qga2hpIOG6pW4gdsOgbyBjw6FjIGPhu5l0IGPDsyBk4bqhbmcgxJHhuqFpIGRp4buHbiBjaG8gc+G7kSBuaGnhu4F1KE5oaeG7gXUgZMOybmcgY2hpIHRp4bq/dCkNCiAgICAgKiAqLwogICAgdmlld01vcmVEZXRhaWxzOiBmdW5jdGlvbiB2aWV3TW9yZURldGFpbHMobWV0YURhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChtZXRhRGF0YS5kYXRhUm93KSB7CiAgICAgICAgbWUudmlldyhtZXRhRGF0YS5kYXRhUm93KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkVycm9yIikpOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjDs2ENCiAgICAgKi8KICAgIGRlbGV0ZTogZnVuY3Rpb24gX2RlbGV0ZShyZWNvcmQsIHN1YikgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICAgIHZhciBtZSwgY29uZmlnTWVzc2FnZSwgYW5zd2VyLCB0ZW1wLCBkcm9wZWRDb2x1bW5zLCBfbG9vcCwgaSwgYXVkaXRpbmdMb2csIHBhcmFtLCByZXN1bHQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzMzsKCiAgICAgICAgICAgICAgICBpZiAobWUuY2hlY2tBY3Rpb25QZXJtaXNzaW9uQWxlcnQoc3ViICE9PSBudWxsICYmIHN1YiAhPT0gdm9pZCAwID8gc3ViIDogbWUuJHQoImkxOG5QZXJtaXNzaW9uLlN1YlN5c3RlbUNvZGUuQ29kZS5ERUxFVEUiKSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIGlmIChtZS52YWxpZGF0ZUJlZm9yZURlbGV0ZShyZWNvcmQsIHN1YikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5nZXREZWxldGVDb25maXJtTWVzc2FnZShyZWNvcmQpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICBjb25maWdNZXNzYWdlID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDEwOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRtcy5tc2dCb3guc2hvd1F1ZXN0aW9uKGNvbmZpZ01lc3NhZ2UpOwoKICAgICAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICAgICAgYW5zd2VyID0gX2NvbnRleHQzLnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoYW5zd2VyID09ICJZZXMiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0ZW1wID0ge307IC8vQuG7jyBi4bubdCBjw6FjIHRow7RuZyB0aW4gZ+G7rWkgbMOqbiBzdi4KCiAgICAgICAgICAgICAgICBkcm9wZWRDb2x1bW5zID0gbWUuZ2V0SWdub3JlZENvbHVtbnMoKTsKCiAgICAgICAgICAgICAgICBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKGkpIHsKICAgICAgICAgICAgICAgICAgdmFyIGlzRHJvcGVkQ29sdW1uID0gZHJvcGVkQ29sdW1ucy5maW5kKGZ1bmN0aW9uIChfKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8gPT0gaTsKICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICBpZiAoIWlzRHJvcGVkQ29sdW1uKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcFtpXSA9IHJlY29yZFtpXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBmb3IgKGkgaW4gcmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIF9sb29wKGkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGF1ZGl0aW5nTG9nID0gewogICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogTVNKc29uLnNlcmlhbGl6ZShtZS5nZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2cocmVjb3JkKSksCiAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UocmVjb3JkKSwKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBtZS5hY3Rpb25BdWRpdGluZ0xvZywKICAgICAgICAgICAgICAgICAgZW50aXR5OiBtZS5nZXRFbnRpdHlUeXBlKCkgfHwgbWUubW9kdWxlLAogICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogW3RlbXBdLAogICAgICAgICAgICAgICAgICBCeVBhc3NWYWxpZGF0ZTogbnVsbCwKICAgICAgICAgICAgICAgICAgQXVkaXRpbmdMb2c6IE1TSnNvbi5zZXJpYWxpemUoYXVkaXRpbmdMb2cpLAogICAgICAgICAgICAgICAgICBUeXBlOiBtZS4kbXMuZW51bS5EZWxldGVUeXBlLlNpbmdsZQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHBhcmFtID0gbWUuY3VzdG9tRGVsZXRlUGFyYW0ocmVjb3JkLCBwYXJhbSk7CiAgICAgICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4ubWFzaygpOwogICAgICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSAyMjsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5yZXF1ZXN0RGVsZXRlRGF0YShyZWNvcmQsIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSAyMjoKICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0My5zZW50OwogICAgICAgICAgICAgICAgbWUuJG1zLmNvbW1vbkZuLnVubWFzaygpOwogICAgICAgICAgICAgICAgbWUuYWZ0ZXJEZWxldGUocmVjb3JkLCByZXN1bHQpOyAvL0xvZyBmaXJlYmFzZQogICAgICAgICAgICAgICAgLy8gbWUubG9nRGF0YUZpcmVCYXNlKCk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGjDtG5nIHRpbiBsb2cgZmlyZWJhc2UNCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqLwogICAgbG9nRGF0YUZpcmVCYXNlOiBmdW5jdGlvbiBsb2dEYXRhRmlyZUJhc2UoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CgogICAgICB0cnkgewogICAgICAgIHZhciBtZW51TmFtZUN1cnJlbnQgPSBudWxsOwogICAgICAgIHZhciBwYXJlbnQgPSBtZS4kcGFyZW50OwoKICAgICAgICBpZiAobWUuJHJvdXRlciB8fCBtZS4kJHJvdXRlcikgewogICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gbWUuJHJvdXRlID8gbWUuJHJvdXRlLm5hbWUgOiBtZS4kJHJvdXRlLm5hbWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChwYXJlbnQgJiYgKHBhcmVudC4kcm91dGVyIHx8IHBhcmVudC4kJHJvdXRlcikpIHsKICAgICAgICAgICAgbWVudU5hbWVDdXJyZW50ID0gcGFyZW50LiRyb3V0ZXIgPyBwYXJlbnQuJHJvdXRlLm5hbWUgOiBwYXJlbnQuJCRyb3V0ZS5uYW1lOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKG1lbnVOYW1lQ3VycmVudCkgewogICAgICAgICAgY29tbW9uRm4ubG9nRGF0YUZpcmVCYXNlVXBkYXRlKG1lbnVOYW1lQ3VycmVudCwgbWUuY29udGV4dCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIGNvbnNvbGUubG9nKGV4KTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBH4buNaSByZXF1ZXN0IHjDs2ENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgcmVxdWVzdERlbGV0ZURhdGE6IGZ1bmN0aW9uIHJlcXVlc3REZWxldGVEYXRhKHJlY29yZCwgcGFyYW0pIHsKICAgICAgdmFyIF90aGlzNCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgICB2YXIgbWU7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM0OwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQoX3RoaXM0Lm1vZHVsZSwgIi9kZWxldGUiKSwgcGFyYW0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQ0LnNlbnQpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTQpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogb3ZlcnJpZGVhYmxlIMSR4buDIGNoZWNrIG3hu5l0IHbDoGkgY2FzZSB2YWxpZGF0ZSDEkcaw4bujYyBuZ2F5IHRyw6puIGNsaWVudA0KICAgICAqIEByZXR1cm5zDQogICAgICogVEROR0hJQSAyNy8xMC8yMDIxDQogICAgICovCiAgICB2YWxpZGF0ZUJlZm9yZURlbGV0ZTogZnVuY3Rpb24gdmFsaWRhdGVCZWZvcmVEZWxldGUocmVjb3JkcykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRhYmxlIFRy4bqjIHbhu4Egbmjhu69uZyB0csaw4budbmcga2jDtG5nIG114buRbiBn4butaSBsw6puIHNlcnZlIMSR4buDIHjDs2ENCiAgICAgKiBAYXV0aG9yIFRWTG9pIDE5LjA2LjIwMjENCiAgICAgKi8KICAgIGdldElnbm9yZWRDb2x1bW5zOiBmdW5jdGlvbiBnZXRJZ25vcmVkQ29sdW1ucygpIHsKICAgICAgdmFyIG1lID0gdGhpczsgLy9kZWZhdWx0IDEgc+G7kSBj4buZdCBt4bq3YyDEkeG7i25oIGtow7RuZyBn4butaSBsw6puLgoKICAgICAgdmFyIGNvbHVtbnNJZ25vcmVkID0gWyJwYXJlbnROb2RlIiwgImlzSGlkZSIsICJpc1NlbGVjdGVkIiwgImxldmVsIiwgIl9fdktleVZhbHVlIiwgIl9pc1NlbGVjdGVkTXVsdGlwbGUiLCAiZXhwYW5kZWQiXTsKICAgICAgdmFyIGN1c3RvbUlnbm9yZWRDb2x1bW5zID0gbWUuZ2V0Q3VzdG9tSWdub3JlZENvbHVtbnNCZWZvcmVEZWxldGUoKTsKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KGN1c3RvbUlnbm9yZWRDb2x1bW5zKSAmJiBjdXN0b21JZ25vcmVkQ29sdW1ucy5sZW5ndGggPiAwKSB7CiAgICAgICAgY3VzdG9tSWdub3JlZENvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgY29sdW1uc0lnbm9yZWQucHVzaChpdGVtKTsKICAgICAgICB9KTsKICAgICAgfQoKICAgICAgcmV0dXJuIGNvbHVtbnNJZ25vcmVkOwogICAgfSwKICAgIC8vQ3VzdG9tQ29sdW1ucyBrbyBn4butaSBsw6puCiAgICBnZXRDdXN0b21JZ25vcmVkQ29sdW1uc0JlZm9yZURlbGV0ZTogZnVuY3Rpb24gZ2V0Q3VzdG9tSWdub3JlZENvbHVtbnNCZWZvcmVEZWxldGUoKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBbXTsKICAgIH0sCgogICAgLyoqDQogICAgICogdGhhbSBjaGnhur91IG5o4bqtdCBrw70gKGzGsHUgZOG6oW5nIGpzb24gOiB7a2V5OiBrZXksIGNvZGU6IGNvZGUsIG5hbWU6IG5hbWV9KQ0KICAgICAqIGtleToga2jDs2EgY2jDrW5oIGPhu6dhIGLhuqNuZyBtb2R1bGUsIGTDuW5nIMSR4buDIGRyaWxkb3duIGtoaSBjbGljayB2w6BvDQogICAgICogY29kZSwgbmFtZTogbcOjLCB0w6puIMSR4buDIGhp4buDdSB0aOG7iyDhu58gY+G7mXQgdGhhbSBjaGnhur91IGtoaSB4ZW0gbG9nOiB2w60gZOG7pTogUXXhuqF0IMSRaeG7h24gKFFEMDAwMDEpDQogICAgICovCiAgICBidWlsZFJlZmVyZW5jZTogZnVuY3Rpb24gYnVpbGRSZWZlcmVuY2UocmVjb3JkcykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgZmllbGQgPSB0aGlzLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CgogICAgICBpZiAoZmllbGQpIHsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShyZWNvcmRzKSkgewogICAgICAgICAgdmFyIHJlZmVyZW5jZSA9IFtdOwogICAgICAgICAgcmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHsKICAgICAgICAgICAgcmVmZXJlbmNlLnB1c2goewogICAgICAgICAgICAgIGtleTogcmVjb3JkW2ZpZWxkLmtleV0sCiAgICAgICAgICAgICAgY29kZTogcmVjb3JkW2ZpZWxkLmNvZGVdLAogICAgICAgICAgICAgIG5hbWU6IHJlY29yZFtmaWVsZC5uYW1lXQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pOwogICAgICAgICAgcmV0dXJuIE1TSnNvbi5zZXJpYWxpemUocmVmZXJlbmNlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIE1TSnNvbi5zZXJpYWxpemUoewogICAgICAgICAgICBrZXk6IHJlY29yZHNbZmllbGQua2V5XSwKICAgICAgICAgICAgY29kZTogcmVjb3Jkc1tmaWVsZC5jb2RlXSwKICAgICAgICAgICAgbmFtZTogcmVjb3Jkc1tmaWVsZC5uYW1lXQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFNpbmggbcO0IHThuqMgY+G7p2Egbmjhuq10IGvDvQ0KICAgICAqIENyZWF0ZWRCeTogbm5sYW0gMjQvMDMvMjAyMQ0KICAgICAqLwogICAgZ2VuZXJhdGVEZXNjcmlwdGlvbkF1ZGl0aW5nTG9nOiBmdW5jdGlvbiBnZW5lcmF0ZURlc2NyaXB0aW9uQXVkaXRpbmdMb2cocmVjb3JkcykgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgbGlzdERlc2NyaXB0aW9uID0gewogICAgICAgIG1hc3RlcjogW10KICAgICAgfTsKICAgICAgdmFyIGZpZWxkID0gdGhpcy4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkOwoKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVjb3JkcykpIHsKICAgICAgICByZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCkgewogICAgICAgICAgdmFyIG9iakRlc2NyaXB0aW9uID0ge307CiAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5jb2RlXSA9IHJlY29yZFtmaWVsZC5jb2RlXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQuY29kZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLmNvZGVdfTsKCiAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5uYW1lXSA9IHJlY29yZFtmaWVsZC5uYW1lXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLm5hbWVdfTsKCiAgICAgICAgICBpZiAoZmllbGQucXVhbnRpdHkpIHsKICAgICAgICAgICAgb2JqRGVzY3JpcHRpb25bZmllbGQucXVhbnRpdHldID0gcmVjb3JkW2ZpZWxkLnF1YW50aXR5XTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQucXVhbnRpdHldIHx8IDEsIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLnF1YW50aXR5XX07CiAgICAgICAgICB9CgogICAgICAgICAgbGlzdERlc2NyaXB0aW9uLm1hc3Rlci5wdXNoKG9iakRlc2NyaXB0aW9uKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgb2JqRGVzY3JpcHRpb24gPSB7fTsKICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5jb2RlXSA9IHJlY29yZHNbZmllbGQuY29kZV07IC8ve25ld1ZhbHVlOm1lLmN1cnJlbnRJdGVtW2ZpZWxkLmNvZGVdLCBzd2l0Y2hDYXB0aW9uOiBtZS5zd2l0Y2hDYXB0aW9uLm1hc3RlcltmaWVsZC5jb2RlXX07CgogICAgICAgIG9iakRlc2NyaXB0aW9uW2ZpZWxkLm5hbWVdID0gcmVjb3Jkc1tmaWVsZC5uYW1lXTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQubmFtZV0sIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLm5hbWVdfTsKCiAgICAgICAgaWYgKGZpZWxkLnF1YW50aXR5KSB7CiAgICAgICAgICBvYmpEZXNjcmlwdGlvbltmaWVsZC5xdWFudGl0eV0gPSByZWNvcmRzW2ZpZWxkLnF1YW50aXR5XTsgLy97bmV3VmFsdWU6bWUuY3VycmVudEl0ZW1bZmllbGQucXVhbnRpdHldIHx8IDEsIHN3aXRjaENhcHRpb246IG1lLnN3aXRjaENhcHRpb24ubWFzdGVyW2ZpZWxkLnF1YW50aXR5XX07CiAgICAgICAgfQoKICAgICAgICBsaXN0RGVzY3JpcHRpb24ubWFzdGVyLnB1c2gob2JqRGVzY3JpcHRpb24pOwogICAgICB9CgogICAgICByZXR1cm4gbGlzdERlc2NyaXB0aW9uOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBjw6J1IHRow7RuZyBiw6FvIGtoaSB4w7NhDQogICAgICovCiAgICBnZXREZWxldGVDb25maXJtTWVzc2FnZTogZnVuY3Rpb24gZ2V0RGVsZXRlQ29uZmlybU1lc3NhZ2UocmVjb3JkcykgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICAgIHZhciBtZSwgbW9kdWxlTmFtZSwgdGFyZ2V0TmFtZSwgbWVzLCBkZWxldGVNdWx0aU1zZywgcmVjb3JkLCBkZWxldGVNc2c7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM1OwogICAgICAgICAgICAgICAgbW9kdWxlTmFtZSA9IG1lLmdldE1vZHVsZU5hbWUoKSB8fCAiIjsKICAgICAgICAgICAgICAgIHRhcmdldE5hbWUgPSAiIjsKICAgICAgICAgICAgICAgIG1lcyA9ICIiOwoKICAgICAgICAgICAgICAgIGlmIChyZWNvcmRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlTXVsdGlNc2cgPSBtZS5nZXREZWxldGVNdWx0aU1zZygpOwogICAgICAgICAgICAgICAgICBtZXMgPSBkZWxldGVNdWx0aU1zZy5mb3JtYXQocmVjb3Jkcy5sZW5ndGggPiA5ID8gcmVjb3Jkcy5sZW5ndGggOiAiMCIgKyByZWNvcmRzLmxlbmd0aCwgbW9kdWxlTmFtZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzOwoKICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVjb3JkcykpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzWzBdOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0TmFtZSA9IG1lLmdldERlbGV0ZVNpbmdsZU1lc0NvbnRlbnQocmVjb3JkKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgZGVsZXRlTXNnID0gbWUuZ2V0RGVsZXRlTXNnKHJlY29yZHMpOwogICAgICAgICAgICAgICAgICBtZXMgPSBkZWxldGVNc2cuZm9ybWF0KG1lLiRtcy5jb21tb25Gbi5lbmNvZGVIVE1MKHRhcmdldE5hbWUpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICB0aXRsZTogbWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkNvbmZpcm1EZWxldGVUaXRsZSIpLmZvcm1hdChtb2R1bGVOYW1lKSwKICAgICAgICAgICAgICAgICAgbWVzc2FnZTogbWVzCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU1KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEN1c3RvbSBjw6J1IG7hu5lpIGR1bmcgeMOzYSBuaGnhu4F1DQogICAgICogTlRCQU86IDI1LjExLjIwMjENCiAgICAgKiBAcmV0dXJucw0KICAgICAqLwogICAgZ2V0RGVsZXRlTXVsdGlNc2c6IGZ1bmN0aW9uIGdldERlbGV0ZU11bHRpTXNnKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuJHQoImkxOG5CYXNlRm9ybS5NZXNzYWdlLkNvbmZpcm1EZWxldGVNdXRpVGl0bGVDZWdvdiIpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDdXN0b20gY8OidSBu4buZaSBkdW5nIHjDs2EgxJHGoW4NCiAgICAgKiBOVEJBTzogMjUuMTEuMjAyMQ0KICAgICAqIEByZXR1cm5zDQogICAgICovCiAgICBnZXREZWxldGVNc2c6IGZ1bmN0aW9uIGdldERlbGV0ZU1zZyhyZWNvcmRzKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZVNob3J0Iik7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IG7hu5lpIGR1bmcgeMOzYQ0KICAgICAqLwogICAgZ2V0RGVsZXRlU2luZ2xlTWVzQ29udGVudDogZnVuY3Rpb24gZ2V0RGVsZXRlU2luZ2xlTWVzQ29udGVudChyZWNvcmQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgcmV0dXJuIHJlY29yZFttZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLm5hbWVdIHx8IHJlY29yZFttZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLmNvZGVdOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSB0w6puIMSR4buRaSB0xrDhu6NuZyBj4bunYSBmb3JtDQogICAgICovCiAgICBnZXRNb2R1bGVOYW1lOiBmdW5jdGlvbiBnZXRNb2R1bGVOYW1lKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICByZXR1cm4gbWUuJHQoImkxOG5Db21tb24ubW9kdWxlLiIgKyBtZS5tb2R1bGUudG9Mb3dlckNhc2UoKSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IHNhdSBraGkgeMOzYQ0KICAgICAqLwogICAgYWZ0ZXJEZWxldGU6IGZ1bmN0aW9uIGFmdGVyRGVsZXRlKHJlY29yZCwgcmVzdWx0KSB7CiAgICAgIHZhciBfdGhpczYgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoKSB7CiAgICAgICAgdmFyIG1lLCBkZWxldGVSZWNvcmQsIF9tZSRnZXRGaWVsZHMsIENPREUsIG1vZHVsZU5hbWUsIGZpZWxkLCBsaXN0QXJpc2VuZCwgY29uZmlnTWVzc2FnZSwgYW5zd2VyLCBpc0FyaXNlTXVsdGksIG5hbWUsIG9iaiwgaW5hY3RpdmVBcmlzZSwgZGVsZXRlTm9BcmlzZSwgcmVjb3Jkc0luYWN0aXZlLCByZWNvcmRzRGVsZXRlLCBrZXlGaWVsZDsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM2OwoKICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LlN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBjbG9uZSBs4bqhaSBnacOhIHRy4buLIHjDs2EgZMO5bmcgY2hvIHZp4buHYyBjdXN0b20KICAgICAgICAgICAgICAgIC8vIE5UQkFPOiAwNy4xMS4yMDIxCiAgICAgICAgICAgICAgICBkZWxldGVSZWNvcmQgPSBfLmNsb25lKHJlY29yZCk7CiAgICAgICAgICAgICAgICBtZS4kdG9hc3Quc3VjY2VzcyhtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuRGVsZXRlU3VjY2VzcyIpKTsKICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIG7hur91IHhvw6EgYuG6o24gZ2hpIMSRxrDhu6NjIHTDrWNoIHRow6wgxJFhbmcga2jDtG5nIHThu7EgY+G6rXAgbmjhuq10IOG7nyBzZWxlY3RlZA0KICAgICAgICAgICAgICAgICAqIG7Dqm4gcGjhuqNpIHRo4buxYyBoaeG7h24geG/DoSBraOG7j2kgc2VsZWN0ZWQgKGNo4buJIHThu7EgxJHhu5luZyBraGkgeG/DoSB0csOqbiBkw7JuZyBj4bunYSBncmlkRWRpdG9yKQ0KICAgICAgICAgICAgICAgICAqIGLhuq10IGNoYW5nZSB2w6BvIGPDoWMgYuG6o24gZ2hpIGPDsm4gxJHGsOG7o2MgdMOtY2gNCiAgICAgICAgICAgICAgICAgKiBOTVRVQU4yIDI4LjExLjIwMjENCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBtZS5zZWxlY3RlZC5yZW1vdmUocmVjb3JkKTsKICAgICAgICAgICAgICAgIG1lLnNlbGVjdGlvbkNoYW5nZShtZS5zZWxlY3RlZCk7CiAgICAgICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAgICAgKiBIw6BtIGN1c3RvbSB44butIGzDvSB0aMOqbQ0KICAgICAgICAgICAgICAgICAqIE5UQkFPIDAyLjExLjIwMjENCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBtZS5jdXN0b21BZnRlckRlbGV0ZShkZWxldGVSZWNvcmQsIHJlc3VsdCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDYxOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgOToKICAgICAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICAgICAqIFPhu61hIGzhu5dpIGtoaSB4w7NhIG5oaeG7gXUgYuG6o24gZ2hpDQogICAgICAgICAgICAgICAgICogTW9kaWZpeUJ5OiBOVEFuaCAoMDkvMDMvMjAyMSkNCiAgICAgICAgICAgICAgICAgKiBNb2RpZml5Qnk6IE5UVEhBTkgxICgyMC8xMS8yMDIxKQ0KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7CiAgICAgICAgICAgICAgICBtb2R1bGVOYW1lID0gbWUuZ2V0TW9kdWxlTmFtZSgpLCBmaWVsZCA9IChfbWUkZ2V0RmllbGRzID0gbWUuZ2V0RmllbGRzKCkpICE9PSBudWxsICYmIF9tZSRnZXRGaWVsZHMgIT09IHZvaWQgMCA/IF9tZSRnZXRGaWVsZHMgOiBfdGhpczYuJHN0b3JlLnN0YXRlW21lLm1vZHVsZV0uX2NvbmZpZy5maWVsZCwgbGlzdEFyaXNlbmQgPSBbXTsgLy9CaeG6v24gxJHDoW5oIGThuqV1IG5oaeG7gXUgYuG6o24gZ2hpIHBow6F0IHNpbmgKICAgICAgICAgICAgICAgIC8vIE5oaeG7gXUgYuG6o24gxJHDoyBjw7MgcGjDoXQgc2luaAoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuRGF0YSAmJiByZXN1bHQuRGF0YS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgIGlzQXJpc2VNdWx0aSA9IHRydWU7CgogICAgICAgICAgICAgICAgICBpZiAoZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQuRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyBs4bqleSB1bmlxdWUgaG/hurdjIG5hbWUKICAgICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gZmllbGQudW5pcXVlIHx8IGZpZWxkLm5hbWU7CiAgICAgICAgICAgICAgICAgICAgICBsaXN0QXJpc2VuZC5wdXNoKGVsZW1lbnQuRW50aXR5W25hbWVdKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAvLyAxIGLhuqNuIGdoaSBjw7MgcGjDoXQgc2luaDoKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICBpc0FyaXNlTXVsdGkgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgbmFtZSA9IGZpZWxkLnVuaXF1ZSB8fCBmaWVsZC5uYW1lOwogICAgICAgICAgICAgICAgICBvYmogPSByZXN1bHQuRGF0YVswXTsKICAgICAgICAgICAgICAgICAgbGlzdEFyaXNlbmQucHVzaChvYmouRW50aXR5W25hbWVdKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDYudDAgPSByZXN1bHQuQ29kZTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gX2NvbnRleHQ2LnQwID09PSBDT0RFLkRlbGV0ZU11bHRpQXJpc2VuZWQgPyAxNSA6IF9jb250ZXh0Ni50MCA9PT0gQ09ERS5BcmlzZW5lZCA/IDM3IDogX2NvbnRleHQ2LnQwID09PSBDT0RFLlBhcnRJbnZhbGlkRGF0YSA/IDQ3IDogNTU7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICAgIGlmICghZmllbGQuaXNJbmFjdGl2ZUFuZERlbGV0ZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDM1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0No4buJIHRow7RuZyBiw6FvIG5n4burbmcgc+G7rSBk4bulbmcgdsOgIHjDs2EgduG7m2kgY8OhYyBtw6BuIGRhbmggbeG7pWMKICAgICAgICAgICAgICAgIGNvbmZpZ01lc3NhZ2UgPSBtZS5nZXRBcmlzZUNvbmZpcm1NZXNhZ2UobW9kdWxlTmFtZSwgbGlzdEFyaXNlbmQsIENPREUuRGVsZXRlTXVsdGlBcmlzZW5lZCk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRtcy5tc2dCb3guc2hvd1F1ZXN0aW9uKGNvbmZpZ01lc3NhZ2UpOwoKICAgICAgICAgICAgICBjYXNlIDE5OgogICAgICAgICAgICAgICAgYW5zd2VyID0gX2NvbnRleHQ2LnNlbnQ7CgogICAgICAgICAgICAgICAgaWYgKCEoYW5zd2VyID09ICJZZXMiKSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDMzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBr4bq/dCBxdeG6oyB4w7NhCiAgICAgICAgICAgICAgICAvL05n4burbmcgc+G7rSBk4bulbmcgYuG6o24gZ2hpIHBow6F0IHNpbmgKICAgICAgICAgICAgICAgIHJlY29yZHNJbmFjdGl2ZSA9IFtdOyAvL23huqNuZyBi4bqjbiBnaGkgY+G6p24gbmfhu6tuZyBz4butIGThu6VuZwoKICAgICAgICAgICAgICAgIHJlc3VsdC5EYXRhLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgcmVjb3Jkc0luYWN0aXZlLnB1c2goZWxlbWVudC5FbnRpdHkpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDI1OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLnNldEluYWN0aXZlQXJpc2UocmVjb3Jkc0luYWN0aXZlKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIGluYWN0aXZlQXJpc2UgPSBfY29udGV4dDYuc2VudDsKICAgICAgICAgICAgICAgIC8vWMOzYSBi4bqjbiBnaGkga2jDtG5nIHBow6F0IHNpbmgKICAgICAgICAgICAgICAgIHJlY29yZHNEZWxldGUgPSBbXTsgLy9t4bqjbmcgYuG6o24gZ2hpIGPhuqduIHjDs2EKCiAgICAgICAgICAgICAgICBpZiAoIShyZWNvcmQubGVuZ3RoID4gcmVjb3Jkc0luYWN0aXZlLmxlbmd0aCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy9O4bq/dSBjw7MgYuG6o24gZ2hpIGtow7RuZyBwaMOhdCBzaW5oIHRow6wgbXMgeMOzYQogICAgICAgICAgICAgICAgcmVjb3JkLmZpbHRlcihmdW5jdGlvbiAoaXRlbVJlY29yZCkgewogICAgICAgICAgICAgICAgICB2YXIgcmVjb3JkRHVwbGljYXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJlY29yZHNJbmFjdGl2ZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW1SZWNvcmRzSW5hY3RpdmUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbVJlY29yZHNJbmFjdGl2ZVtmaWVsZC5rZXldID09IGl0ZW1SZWNvcmRbZmllbGQua2V5XSkgewogICAgICAgICAgICAgICAgICAgICAgcmVjb3JkRHVwbGljYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgICAgaWYgKCFyZWNvcmREdXBsaWNhdGUpIHsKICAgICAgICAgICAgICAgICAgICByZWNvcmRzRGVsZXRlLnB1c2goaXRlbVJlY29yZCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAzMTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5kZWxldGVNdXRpUm93c05vQ29uZmlybShyZWNvcmRzRGVsZXRlKTsKCiAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgIGRlbGV0ZU5vQXJpc2UgPSBfY29udGV4dDYuc2VudDsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICAgIC8vU2hvdyB0b2FzdCB0aMO0bmcgYsOhbwogICAgICAgICAgICAgICAgaWYgKHJlY29yZHNEZWxldGUubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAvL05n4burbmcgc+G7rSBk4bulbmcgdsOgIHjDs2EKICAgICAgICAgICAgICAgICAgaWYgKGluYWN0aXZlQXJpc2UuU3VjY2VzcyAmJiBkZWxldGVOb0FyaXNlLlN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICBtZS4kdG9hc3Quc3VjY2VzcyhtZS4kdCgiaTE4bkJhc2VGb3JtLlNhdmVTdWNjZXNzTWVzc2FnZSIpKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtZS4kdG9hc3QuZXJyb3IobWUuJHQoImkxOG5CYXNlRm9ybS5TYXZlRXJyb3JNZXNzYWdlIikpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvL0No4buJIG5n4burbmcgc+G7rSBk4bulbmcKICAgICAgICAgICAgICAgICAgaWYgKGluYWN0aXZlQXJpc2UuU3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIG1lLiR0b2FzdC5zdWNjZXNzKG1lLiR0KCJpMThuQmFzZUZvcm0uU2F2ZVN1Y2Nlc3NNZXNzYWdlIikpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLlNhdmVFcnJvck1lc3NhZ2UiKSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY2FzZSAzMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0Ni5uZXh0ID0gMzY7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd1dhcm5pbmcobWUuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5DYW5Ob3REZWxldGVBcmlzZSIpKTsKCiAgICAgICAgICAgICAgY2FzZSAzNjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDYuYWJydXB0KCJicmVhayIsIDU4KTsKCiAgICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICAgIGlmICghZmllbGQuaXNJbmFjdGl2ZUFuZERlbGV0ZSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvL0No4buJIHRow7RuZyBiw6FvIG5n4burbmcgc+G7rSBk4bulbmcgdsOgIHjDs2EgduG7m2kgY8OhYyBtw6BuIGRhbmggbeG7pWMKICAgICAgICAgICAgICAgIGNvbmZpZ01lc3NhZ2UgPSBtZS5nZXRBcmlzZUNvbmZpcm1NZXNhZ2UobW9kdWxlTmFtZSwgbGlzdEFyaXNlbmQsIENPREUuQXJpc2VuZWQpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0MTsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kbXMubXNnQm94LnNob3dRdWVzdGlvbihjb25maWdNZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSA0MToKICAgICAgICAgICAgICAgIGFuc3dlciA9IF9jb250ZXh0Ni5zZW50OwoKICAgICAgICAgICAgICAgIGlmIChhbnN3ZXIgPT0gIlllcyIpIHsKICAgICAgICAgICAgICAgICAgLy9OZ+G7q25nIHPhu60gZOG7pW5nIGLhuqNuIGdoaSBwaMOhdCBzaW5oCiAgICAgICAgICAgICAgICAgIG1lLnNldEFjdGl2ZU11dGlSb3dzKHJlc3VsdC5EYXRhWzBdLkVudGl0eSwgImluYWN0aXZlIik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA0NjsKICAgICAgICAgICAgICAgIGJyZWFrOwoKICAgICAgICAgICAgICBjYXNlIDQ1OgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZyhtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkNhbk5vdERlbGV0ZUFyaXNlIikpOwoKICAgICAgICAgICAgICBjYXNlIDQ2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoImJyZWFrIiwgNTgpOwoKICAgICAgICAgICAgICBjYXNlIDQ3OgogICAgICAgICAgICAgICAgaWYgKCFpc0FyaXNlTXVsdGkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1MjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZyhtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkVycm9yRGVsZXRlTXVsdGkiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgiYnJlYWsiLCA1OCk7CgogICAgICAgICAgICAgIGNhc2UgNTI6CiAgICAgICAgICAgICAgICAvL21lLiR0b2FzdC5lcnJvcihtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLk5ld01lc3NhZ2VEZWxldGUiKS5mb3JtYXQobW9kdWxlTmFtZSwgY29kZXMpKTsKICAgICAgICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd1dhcm5pbmcobWUuJHQoImkxOG5CYXNlRm9ybS5WYWxpZGF0ZS5FcnJvckRlbGV0ZU11bHRpIikpOwoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuRGF0YSkgewogICAgICAgICAgICAgICAgICBrZXlGaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQua2V5OwogICAgICAgICAgICAgICAgICByZWNvcmQuZm9yRWFjaChmdW5jdGlvbiAoaSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5EYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpW2tleUZpZWxkXSAhPSBpdGVtLkVudGl0eVtrZXlGaWVsZF0gJiYgaVtrZXlGaWVsZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWUuZ3JpZC5kYXRheC5yZW1vdmUoaSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSAvLyByZWNvcmQgPSBbXTsKICAgICAgICAgICAgICAgIC8vbWUuc2VsZWN0aW9uQ2hhbmdlKHJlY29yZCk7CiAgICAgICAgICAgICAgICAvLyBtZS5zZWxlY3RlZCA9IFtdOwogICAgICAgICAgICAgICAgLy9tZS5yZWxvYWQoKTsKCgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoImJyZWFrIiwgNTgpOwoKICAgICAgICAgICAgICBjYXNlIDU1OgogICAgICAgICAgICAgICAgaWYgKCFpc0FyaXNlTXVsdGkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA1ODsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbWUuJG1zLm1zZ0JveC5zaG93V2FybmluZyhtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkVycm9yRGVsZXRlTXVsdGkiKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgiYnJlYWsiLCA1OCk7CgogICAgICAgICAgICAgIGNhc2UgNTg6CiAgICAgICAgICAgICAgICByZWNvcmQgPSBbXTsKICAgICAgICAgICAgICAgIG1lLnNlbGVjdGVkID0gW107CiAgICAgICAgICAgICAgICBtZS5yZWxvYWQoKTsKCiAgICAgICAgICAgICAgY2FzZSA2MToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNik7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBDw6J1IHRow7RuZyBiw6FvIGtoaSBjw7MgcGjDoXQgc2luaCBk4buvIGxp4buHdQ0KICAgICAqIE5UVEhBTkgxDQogICAgICovCiAgICBnZXRBcmlzZUNvbmZpcm1NZXNhZ2U6IGZ1bmN0aW9uIGdldEFyaXNlQ29uZmlybU1lc2FnZShtb2R1bGVOYW1lLCBsaXN0QXJpc2VuZCwgY29kZSkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICB2YXIgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7CiAgICAgIHZhciB0aXRsZU5hbWUgPSBtZS4kdCgiaTE4bkJhc2VGb3JtLk1lc3NhZ2UuQ29uZmlybURlbGV0ZVRpdGxlIikuZm9ybWF0KG1vZHVsZU5hbWUpLAogICAgICAgICAgbWVzLAogICAgICAgICAgbWVzTGlzdEFyaXNlOyAvL0J1aWxkIGPDonUgdGjDtG5nIGLDoW8KCiAgICAgIG1lc0xpc3RBcmlzZSA9IGxpc3RBcmlzZW5kLmxlbmd0aCA+IDIgPyAiPGI+Ii5jb25jYXQobGlzdEFyaXNlbmRbMF0sICI8L2I+LCA8Yj4iKS5jb25jYXQobGlzdEFyaXNlbmRbMV0sICI8L2I+IHZceEUwIDxiPiIpLmNvbmNhdChsaXN0QXJpc2VuZC5sZW5ndGggLSAyLCAiPC9iPiAiKS5jb25jYXQobW9kdWxlTmFtZSwgIiBraFx4RTFjIikgOiAiPGI+Ii5jb25jYXQobGlzdEFyaXNlbmQuam9pbigiPC9iPiwgPGI+IiksICI8L2I+Iik7CiAgICAgIG1lcyA9IG1lLmdldEFyaXNlTWVzc2FnZShjb2RlLCBsaXN0QXJpc2VuZCwgbWVzTGlzdEFyaXNlLCBtb2R1bGVOYW1lKTsgLy9Db25maWcgY8OhYyBidXR0b24KCiAgICAgIHZhciBidG5Db25maWcgPSBbewogICAgICAgIGtleTogIk5vIiwKICAgICAgICB0YXJnZXQ6ICJSaWdodCIsCiAgICAgICAgdGV4dDogIkjhu6d5IiwKICAgICAgICB0eXBlQnV0dG9uOiAic2Vjb25kYXJ5IgogICAgICB9LCB7CiAgICAgICAga2V5OiAiWWVzIiwKICAgICAgICB0YXJnZXQ6ICJSaWdodCIsCiAgICAgICAgdGV4dDogIsSQ4buTbmcgw70iLAogICAgICAgIGZvY3VzOiB0cnVlLAogICAgICAgIHR5cGVCdXR0b246ICJibHVlIgogICAgICB9XTsKICAgICAgcmV0dXJuIHsKICAgICAgICB0aXRsZTogdGl0bGVOYW1lLAogICAgICAgIG1lc3NhZ2U6IG1lcywKICAgICAgICBidG5Db25maWc6IGJ0bkNvbmZpZwogICAgICB9OwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBjw6J1IHRow7RuZyBiw6FvIGtoaSBwaMOhdCBzaW5oDQogICAgICogVmnhur90IHJpw6puZyByYSDEkeG7gyBvdmVycmlkZSBs4bqhaSB2w6wgbeG7mXQgc+G7kSBtw6BuIGPDsyBjw6J1IHRow7RuZyBiw6FvIGzDoCBOZ+G7q25nIHRoZW8gZMO1aSB0aGF5IHbDrCBOZ+G7q25nIHPhu60gZOG7pW5nDQogICAgICogQHBhcmFtIHsqfSBjb2RlDQogICAgICogTlRESUVNIDE1LjEyLjIwMjENCiAgICAgKi8KICAgIGdldEFyaXNlTWVzc2FnZTogZnVuY3Rpb24gZ2V0QXJpc2VNZXNzYWdlKGNvZGUsIGxpc3RBcmlzZW5kLCBtZXNMaXN0QXJpc2UsIG1vZHVsZU5hbWUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIG1lcyA9ICIiOwogICAgICB2YXIgQ09ERSA9IG1lLiRtcy5lbnVtLlNlcnZpY2VSZXNwb25zZUNvZGU7CgogICAgICBzd2l0Y2ggKGNvZGUpIHsKICAgICAgICBjYXNlIENPREUuRGVsZXRlTXVsdGlBcmlzZW5lZDoKICAgICAgICAgIG1lcyA9IG1lLiR0KCJpMThuQmFzZUZvcm0uVmFsaWRhdGUuRGVsZXRlTXVsdGlIYXNNdWx0aUFyaXNlbmVkIikuZm9ybWF0KG1vZHVsZU5hbWUsIG1lc0xpc3RBcmlzZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICAvLyB4w7NhIDEgYuG6o24gZ2hpIHbDoCBi4bqjbiBnaGkgxJHDsyBi4buLIGPDsyBwaMOhdCBzaW5oOgoKICAgICAgICBjYXNlIENPREUuQXJpc2VuZWQ6CiAgICAgICAgICBtZXMgPSBtZS4kdCgiaTE4bkJhc2VGb3JtLlZhbGlkYXRlLkRlbGV0ZUFyaXNlIikuZm9ybWF0KG1vZHVsZU5hbWUsIGxpc3RBcmlzZW5kWzBdKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CgogICAgICByZXR1cm4gbWVzOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBOZ+G7q25nIHPhu60gZOG7pW5nIGLhuqNuIGdoaSBwaMOhdCBzaW5oIGThu68gbGnhu4d1DQogICAgICogTlRUSEFOSDENCiAgICAgKi8KICAgIHNldEluYWN0aXZlQXJpc2U6IGZ1bmN0aW9uIHNldEluYWN0aXZlQXJpc2UocmVjb3JkcykgewogICAgICB2YXIgX3RoaXM3ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICAgIHZhciBtZSwgaW5hY3RpdmUsIGZpZWxkLCBsaXN0SUQsIHBhcmFtOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBtZSA9IF90aGlzNzsKICAgICAgICAgICAgICAgIGluYWN0aXZlID0gMTsKCiAgICAgICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkocmVjb3JkcykpIHsKICAgICAgICAgICAgICAgICAgcmVjb3JkcyA9IFtyZWNvcmRzXTsKICAgICAgICAgICAgICAgIH0gLy9zaG93IG1hc2sKICAgICAgICAgICAgICAgIC8vIG1lLmxvYWRpbmcgPSB0cnVlOwoKCiAgICAgICAgICAgICAgICBmaWVsZCA9IG1lLiRzdG9yZS5zdGF0ZVttZS5tb2R1bGVdLl9jb25maWcuZmllbGQ7CiAgICAgICAgICAgICAgICBsaXN0SUQgPSByZWNvcmRzLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVtmaWVsZC5rZXldOwogICAgICAgICAgICAgICAgfSkuam9pbigiLCIpOwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIFRhYmxlTmFtZTogZmllbGQudGFibGUsCiAgICAgICAgICAgICAgICAgIEtleUZpZWxkOiBmaWVsZC5rZXksCiAgICAgICAgICAgICAgICAgIFZhbHVlOiBpbmFjdGl2ZSwKICAgICAgICAgICAgICAgICAgTGlzdElEOiBsaXN0SUQsCiAgICAgICAgICAgICAgICAgIE9yZ2FuaXphdGlvbklEOiBtZS5nZXRPcmdhbml6YXRpb25GaWx0ZXIoKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Ny5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kc3RvcmUuZGlzcGF0Y2goIiIuY29uY2F0KF90aGlzNy5tb2R1bGUsICIvdXBkYXRlU3RhdHVzIiksIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0Ny5zZW50KTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3KTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjDs2Egbmhp4buBdSBi4bqjbiBnaGkga2jDtG5nIGPhuqduIHBvdXAgdGjDtG5nIGLDoW8NCiAgICAgKiBOVFRIQU5IMQ0KICAgICAqLwogICAgZGVsZXRlTXV0aVJvd3NOb0NvbmZpcm06IGZ1bmN0aW9uIGRlbGV0ZU11dGlSb3dzTm9Db25maXJtKHJlY29yZHMpIHsKICAgICAgdmFyIF90aGlzOCA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOCgpIHsKICAgICAgICB2YXIgbWUsIHRlbXBzLCBhdWRpdGluZ0xvZywgcGFyYW07CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIG1lID0gX3RoaXM4OwogICAgICAgICAgICAgICAgdGVtcHMgPSBbXTsKICAgICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0ge307IC8vQuG7jyBi4bubdCBjw6FjIHRow7RuZyB0aW4gZ+G7rWkgbMOqbiBzdi4KCiAgICAgICAgICAgICAgICAgIHZhciBkcm9wZWRDb2x1bW5zID0gbWUuZ2V0SWdub3JlZENvbHVtbnMoKTsKCiAgICAgICAgICAgICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoaSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0Ryb3BlZENvbHVtbiA9IGRyb3BlZENvbHVtbnMuZmluZChmdW5jdGlvbiAoXykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8gPT0gaTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3BlZENvbHVtbikgewogICAgICAgICAgICAgICAgICAgICAgdGVtcFtpXSA9IHJlY29yZFtpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlY29yZCkgewogICAgICAgICAgICAgICAgICAgIF9sb29wMihpKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGVtcHMucHVzaCh0ZW1wKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXVkaXRpbmdMb2cgPSB7CiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNU0pzb24uc2VyaWFsaXplKG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhyZWNvcmRzKSksCiAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UocmVjb3JkcyksCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogbWUuYWN0aW9uQXVkaXRpbmdMb2csCiAgICAgICAgICAgICAgICAgIGVudGl0eTogbWUubW9kdWxlLAogICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogdGVtcHMsCiAgICAgICAgICAgICAgICAgIEJ5UGFzc1ZhbGlkYXRlOiBudWxsLAogICAgICAgICAgICAgICAgICBBdWRpdGluZ0xvZzogTVNKc29uLnNlcmlhbGl6ZShhdWRpdGluZ0xvZyksCiAgICAgICAgICAgICAgICAgIFR5cGU6IG1lLiRtcy5lbnVtLkRlbGV0ZVR5cGUuTXVsdGkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gbWUuJHN0b3JlLmRpc3BhdGNoKCIiLmNvbmNhdChfdGhpczgubW9kdWxlLCAiL2RlbGV0ZSIpLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDguc2VudCk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIGN1c3RvbSBkw7luZyBjaG8geOG7rSBsw70gdGjDqm0gc2F1IGtoaSB4w7NhDQogICAgICogTlRCQU8gMDIuMTEuMjAyMQ0KICAgICAqLwogICAgY3VzdG9tQWZ0ZXJEZWxldGU6IGZ1bmN0aW9uIGN1c3RvbUFmdGVyRGVsZXRlKGRlbGV0ZVJlY29yZCwgcmVzdWx0KSB7fSwKICAgIGdldEZpZWxkczogZnVuY3Rpb24gZ2V0RmllbGRzKCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGhhbSBz4buRIGtoaSBt4bufIGZvcm0gY2hpIHRp4bq/dA0KICAgICAqICovCiAgICBnZXREZXRhaWxQYXJhbWV0ZXI6IGZ1bmN0aW9uIGdldERldGFpbFBhcmFtZXRlcihmb3JtTmFtZSwgbW9kZSwgZGVmYXVsdERhdGEpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHBhcmFtID0gewogICAgICAgIGRhdGE6IGRlZmF1bHREYXRhIHx8IG51bGwKICAgICAgfTsKCiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uRm9ybVN0YXRlLkR1cGxpY2F0ZToKICAgICAgICBjYXNlIG1lLiRtcy5lbnVtLkZvcm1TdGF0ZS5FZGl0OgogICAgICAgIGNhc2UgbWUuJG1zLmVudW0uRm9ybVN0YXRlLlZpZXc6CiAgICAgICAgICB2YXIga2V5RmllbGQgPSBtZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkLmtleTsKCiAgICAgICAgICBpZiAoa2V5RmllbGQpIHsKICAgICAgICAgICAgcGFyYW0uaWQgPSBkZWZhdWx0RGF0YVtrZXlGaWVsZF07CiAgICAgICAgICB9CgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KCiAgICAgIHBhcmFtLm1vZGUgPSBtb2RlOwogICAgICBtZS5jdXN0b21EZXRhaWxQYXJhbShwYXJhbSk7CiAgICAgIHJldHVybiBwYXJhbTsKICAgIH0sCiAgICBjdXN0b21EZXRhaWxQYXJhbTogZnVuY3Rpb24gY3VzdG9tRGV0YWlsUGFyYW0ocGFyYW0pIHt9LAoKICAgIC8qKg0KICAgICAqIGhvdmVyIGLhuqNuIGdoaSAtPiBoaeG7g24gdGjhu4sgbWVudQ0KICAgICAqLwogICAgZ3JpZFJvd0hvdmVyOiBmdW5jdGlvbiBncmlkUm93SG92ZXIoKSB7fSwKCiAgICAvKioNCiAgICAgKiBjbGljayBi4bqjbiBnaGkgLT4gaGnhu4NuIHRo4buLIG1lbnUNCiAgICAgKi8KICAgIGdyaWRSb3dPdmVyOiBmdW5jdGlvbiBncmlkUm93T3ZlcihyZWNvcmQsIGUpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgbWUucm93QWN0aW9ucyA9IG1lLmdldFJlY29yZEFjdGlvbnMocmVjb3JkKTsKICAgIH0sCgogICAgLyoqDQogICAgICogbOG6pXkgZGFuaCBzw6FjaCBhY3Rpb24gY+G7p2EgYuG6o24gZ2hpDQogICAgICovCiAgICBnZXRSZWNvcmRBY3Rpb25zOiBmdW5jdGlvbiBnZXRSZWNvcmRBY3Rpb25zKHJlY29yZCkgewogICAgICByZXR1cm4gW3sKICAgICAgICBjb21tYW5kOiAiRWRpdCIsCiAgICAgICAgaWNvbjogImVkaXQiLAogICAgICAgIHRleHQ6IHRoaXMuJHQoImkxOG5Db21tb24uY29tbWFuZC5lZGl0IikKICAgICAgfSwgewogICAgICAgIGNvbW1hbmQ6ICJEZWxldGUiLAogICAgICAgIGljb246ICJkZWxldGUiLAogICAgICAgIHRleHQ6IHRoaXMuJHQoImkxOG5Db21tb24uY29tbWFuZC5kZWxldGUiKQogICAgICB9XTsKICAgIH0sCgogICAgLyoqDQogICAgICogY2xpY2sgYWN0aW9uIHJvdw0KICAgICAqLwogICAgZ3JpZFJvd0FjdGlvbkNsaWNrOiBmdW5jdGlvbiBncmlkUm93QWN0aW9uQ2xpY2soY29tbWFuZCwgcmVjb3JkLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAiRWRpdCI6CiAgICAgICAgICBtZS5lZGl0KHJlY29yZCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAiRGVsZXRlIjoKICAgICAgICAgIG1lLmRlbGV0ZShyZWNvcmQpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgIkR1cGxpY2F0ZSI6CiAgICAgICAgICBtZS5kdXBsaWNhdGUocmVjb3JkKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJWaWV3IjoKICAgICAgICAgIG1lLnZpZXcocmVjb3JkKTsKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBjYXNlICJhY3RpdmUiOgogICAgICAgIGNhc2UgImluYWN0aXZlIjoKICAgICAgICAgIG1lLnNldEFjdGl2ZU11dGlSb3dzKHJlY29yZCwgY29tbWFuZCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIG1lLiRtcy5tc2dCb3guc2hvd0luZm8obWUuJHQoImkxOG5Db21tb24uRmVhdHVyZXNJc0RldmVsb3BpbmciKSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBUaGF5IMSR4buVaSBi4bqjbiBnaGkgY2jhu41uDQogICAgICovCiAgICBzZWxlY3Rpb25DaGFuZ2U6IGZ1bmN0aW9uIHNlbGVjdGlvbkNoYW5nZShyZWNvcmRzKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHZhciBhY3Rpb25zID0gW107CgogICAgICBpZiAocmVjb3Jkcy5sZW5ndGggPj0gMSkgewogICAgICAgIGFjdGlvbnMgPSBtZS5nZXRBY3Rpb25NdWx0aShyZWNvcmRzLCBtZS5zZWxlY3RBbGxQYWdlKTsKICAgICAgfQoKICAgICAgbWUuYWN0aW9uTXVsdGkgPSBhY3Rpb25zOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBkYW5oIHPDoWNoIGFjdGlvbiB44butIGzDvSBraGkgbmhp4buBdSBi4bqjbiBnaGkgxJHGsOG7o2MgY2jhu41uDQogICAgICogVEROR0hJQSAxMC8xMC8yMDIxDQogICAgICogbeG6t2MgxJHhu4tuaCBjaOG7iSBj4bqnbiB4w7NhIG5oaeG7gXUgdGjDtGksIG3DoG4gbsOgbyB0aMOqbSB0w61uaCBuxINuZyB0aMOsIHBo4bqjaSBvdmVycmlkZSBs4bqhaQ0KICAgICAqLwogICAgZ2V0QWN0aW9uTXVsdGk6IGZ1bmN0aW9uIGdldEFjdGlvbk11bHRpKHJlY29yZHMsIHNlbGVjdEFsbFBhZ2UpIHsKICAgICAgcmV0dXJuIFt7CiAgICAgICAgY29tbWFuZDogImFjdGl2ZSIsCiAgICAgICAgdGV4dDogIlRoZW8gZMO1aSIsCiAgICAgICAgY2xzOiAic2Vjb25kYXJ5LW91dGxpbmUiCiAgICAgIH0sIHsKICAgICAgICBjb21tYW5kOiAiaW5hY3RpdmUiLAogICAgICAgIHRleHQ6ICJOZ+G7q25nIHRoZW8gZMO1aSIsCiAgICAgICAgY2xzOiAicHJpbWFyeS1vdXRsaW5lIgogICAgICB9LCB7CiAgICAgICAgY29tbWFuZDogImRlbGV0ZSIsCiAgICAgICAgdGV4dDogIljDs2EiLAogICAgICAgIGNsczogInNlY29uZGFyeS1vdXRsaW5lLXJlZCIKICAgICAgfV07CiAgICB9LAoKICAgIC8qKg0KICAgICAqIENsaWNrIHbDoG8gYWN0aW9uIGNo4buNbiBuaGnhu4F1IGLhuqNuIGdoaQ0KICAgICAqLwogICAgbXVsdGlTZWxlY3RBY3Rpb25DbGljazogZnVuY3Rpb24gbXVsdGlTZWxlY3RBY3Rpb25DbGljayhjb21tYW5kLCByZWNvcmRzLCBzZWxlY3RBbGxQYWdlLCBldmVudCkgewogICAgICB2YXIgbWUgPSB0aGlzOwoKICAgICAgc3dpdGNoIChjb21tYW5kKSB7CiAgICAgICAgY2FzZSAiZGVsZXRlIjoKICAgICAgICAgIG1lLmRlbGV0ZU11dGlSb3dzKHJlY29yZHMpOwogICAgICAgICAgYnJlYWs7CgogICAgICAgIGNhc2UgImFjdGl2ZSI6CiAgICAgICAgY2FzZSAiaW5hY3RpdmUiOgogICAgICAgICAgbWUuc2V0QWN0aXZlTXV0aVJvd3MocmVjb3JkcywgY29tbWFuZCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSwKCiAgICAvKg0KICAgICAqICBIw6BtIHjDs2Egbmhp4buBdSBi4bqjbiBnaGkuDQogICAgICogQG1vZGlmaWVkIGJ5IFRWTG9pIDIxLjA2LjIwMjEuIGzGsOG7o2MgYuG7jyAxIHPhu5EgdGjDtG5nIHRpbiB0csaw4bubYyBraGkgZ+G7rWkgYuG6o24gZ2hpIGzDqm4gc2VydmUNCiAgICAgKi8KICAgIGRlbGV0ZU11dGlSb3dzOiBmdW5jdGlvbiBkZWxldGVNdXRpUm93cyhyZWNvcmRzKSB7CiAgICAgIHZhciBfdGhpczkgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoKSB7CiAgICAgICAgdmFyIG1lLCBjb25maWdNZXNzYWdlLCBhbnN3ZXIsIHRlbXBzLCBhdWRpdGluZ0xvZywgcGFyYW0sIHJlc3VsdDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczk7CgogICAgICAgICAgICAgICAgaWYgKG1lLmNoZWNrQWN0aW9uUGVybWlzc2lvbkFsZXJ0KG1lLiR0KCJpMThuUGVybWlzc2lvbi5TdWJTeXN0ZW1Db2RlLkNvZGUuREVMRVRFIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBpZiAobWUudmFsaWRhdGVCZWZvcmVEZWxldGUocmVjb3JkcykpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSA1OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF9jb250ZXh0OS5uZXh0ID0gNzsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5nZXREZWxldGVDb25maXJtTWVzc2FnZShyZWNvcmRzKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgY29uZmlnTWVzc2FnZSA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAxMDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS4kbXMubXNnQm94LnNob3dRdWVzdGlvbihjb25maWdNZXNzYWdlKTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICAgIGFuc3dlciA9IF9jb250ZXh0OS5zZW50OwoKICAgICAgICAgICAgICAgIGlmICghKGFuc3dlciA9PSAiWWVzIikpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyNDsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGVtcHMgPSBbXTsKICAgICAgICAgICAgICAgIHJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAocmVjb3JkKSB7CiAgICAgICAgICAgICAgICAgIHZhciB0ZW1wID0ge307IC8vQuG7jyBi4bubdCBjw6FjIHRow7RuZyB0aW4gZ+G7rWkgbMOqbiBzdi4KCiAgICAgICAgICAgICAgICAgIHZhciBkcm9wZWRDb2x1bW5zID0gbWUuZ2V0SWdub3JlZENvbHVtbnMoKTsKCiAgICAgICAgICAgICAgICAgIHZhciBfbG9vcDMgPSBmdW5jdGlvbiBfbG9vcDMoaSkgewogICAgICAgICAgICAgICAgICAgIHZhciBpc0Ryb3BlZENvbHVtbiA9IGRyb3BlZENvbHVtbnMuZmluZChmdW5jdGlvbiAoXykgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF8gPT0gaTsKICAgICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Ryb3BlZENvbHVtbikgewogICAgICAgICAgICAgICAgICAgICAgdGVtcFtpXSA9IHJlY29yZFtpXTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIHJlY29yZCkgewogICAgICAgICAgICAgICAgICAgIF9sb29wMyhpKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgdGVtcHMucHVzaCh0ZW1wKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYXVkaXRpbmdMb2cgPSB7CiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBNU0pzb24uc2VyaWFsaXplKG1lLmdlbmVyYXRlRGVzY3JpcHRpb25BdWRpdGluZ0xvZyhyZWNvcmRzKSksCiAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZTogbWUuYnVpbGRSZWZlcmVuY2UocmVjb3JkcyksCiAgICAgICAgICAgICAgICAgIGFjdGlvbjogbWUuYWN0aW9uQXVkaXRpbmdMb2csCiAgICAgICAgICAgICAgICAgIGVudGl0eTogbWUubW9kdWxlLAogICAgICAgICAgICAgICAgICB0aW1lOiBuZXcgRGF0ZSgpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgcGFyYW0gPSB7CiAgICAgICAgICAgICAgICAgIEVudGl0eTogdGVtcHMsCiAgICAgICAgICAgICAgICAgIEJ5UGFzc1ZhbGlkYXRlOiBudWxsLAogICAgICAgICAgICAgICAgICBBdWRpdGluZ0xvZzogTVNKc29uLnNlcmlhbGl6ZShhdWRpdGluZ0xvZyksCiAgICAgICAgICAgICAgICAgIFR5cGU6IG1lLiRtcy5lbnVtLkRlbGV0ZVR5cGUuTXVsdGkKICAgICAgICAgICAgICAgIH07IC8vIEN1c3RvbSBs4bqhaSBwYXJhbSB4w7NhCgogICAgICAgICAgICAgICAgcGFyYW0gPSBtZS5jdXN0b21EZWxldGVQYXJhbShyZWNvcmRzLCBwYXJhbSk7CiAgICAgICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4ubWFzaygpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAyMDsKICAgICAgICAgICAgICAgIHJldHVybiBtZS5yZXF1ZXN0RGVsZXRlRGF0YShyZWNvcmRzLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICByZXN1bHQgPSBfY29udGV4dDkuc2VudDsKICAgICAgICAgICAgICAgIG1lLiRtcy5jb21tb25Gbi51bm1hc2soKTsKICAgICAgICAgICAgICAgIG1lLmFmdGVyRGVsZXRlKHJlY29yZHMsIHJlc3VsdCk7IC8vbG9nIGZpcmViYXNlCgogICAgICAgICAgICAgICAgbWUubG9nRGF0YUZpcmVCYXNlKCk7CgogICAgICAgICAgICAgIGNhc2UgMjQ6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTkpOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSBjdXN0b20gZGVsZXRlIHBhcmFtDQogICAgICogTlRCQU86IDA3LjEyLjIwMjENCiAgICAgKiBAcGFyYW0geyp9IHBhcmFtDQogICAgICogQHJldHVybnMNCiAgICAgKi8KICAgIGN1c3RvbURlbGV0ZVBhcmFtOiBmdW5jdGlvbiBjdXN0b21EZWxldGVQYXJhbShyZWNvcmQsIHBhcmFtKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiBwYXJhbTsKICAgIH0sCgogICAgLyoqDQogICAgICogQ2xpY2sgdsOgbyBhY3Rpb24gY2jhu41uIG5oaeG7gXUgYuG6o24gZ2hpOiBDaOG7jW4gdOG6pXQgY+G6ow0KICAgICAqLwogICAgbXVsdGlTZWxlY3RBbGxDbGljazogZnVuY3Rpb24gbXVsdGlTZWxlY3RBbGxDbGljaygpIHsKICAgICAgdGhpcy5zZWxlY3RBbGxQYWdlID0gIXRoaXMuc2VsZWN0QWxsUGFnZTsKCiAgICAgIGlmICghdGhpcy5zZWxlY3RBbGxQYWdlKSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZCA9IFtdOwogICAgICAgIHRoaXMuZ3JpZC5jaGVja2FsbCA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZ3JpZC5jaGVja2FsbCA9IHRydWU7CiAgICAgICAgdGhpcy5ncmlkLiRlbWl0KCJpbnB1dCIsIHRoaXMuZ3JpZC5kYXRheCk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogQuG7jyB0w61jaCBjaOG7jW4gY8OhYyBi4bqjbiBnaGkNCiAgICAgKi8KICAgIG11bHRpU2VsZWN0VW5jaGVjazogZnVuY3Rpb24gbXVsdGlTZWxlY3RVbmNoZWNrKCkgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBtZS5zZWxlY3RlZCA9IFtdOyAvLyBOTVRVQU4yIDI4LjExLjIwMjE6IGLhu48gdMOtY2ggY2jhu41uIHRyw6puIGdyaWRFZGl0b3IKCiAgICAgIGlmIChBcnJheS5pc0FycmF5KG1lLmdyaWQubGlzdFJvd1NlbGVjdGVkKSkgewogICAgICAgIG1lLmdyaWQubGlzdFJvd1NlbGVjdGVkID0gW107CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogS2hhaSBiw6FvIHPhu7Ega2nhu4duIGPhu6dhIGZvcm0NCiAgICAgKi8KICAgIGluaXRFdmVudDogZnVuY3Rpb24gaW5pdEV2ZW50KCkgewogICAgICB2YXIgbWUgPSB0aGlzLAogICAgICAgICAgZ3JpZCA9IG1lLmdyaWQsCiAgICAgICAgICBhY3Rpb25NdWx0aSA9IG1lLmFjdGlvbk11bHRpQ29tcG9uZW50LAogICAgICAgICAgYWN0aW9uTXVsdGlCaWdTY3Jlbm4gPSBtZS5hY3Rpb25NdWx0aUJpZ1NjcmVlbkNvbXBvbmVudDsKCiAgICAgIGlmIChncmlkKSB7CiAgICAgICAgZ3JpZC4kb24oImxvYWREYXRhIiwgbWUubG9hZERhdGEpOwogICAgICAgIGdyaWQuJG9uKCJkYmxjbGljayIsIG1lLmdyaWRSb3dEYkNsaWNrKTsKICAgICAgICBncmlkLiRvbigicm93bW91c2VvdmVyIiwgbWUuZ3JpZFJvd092ZXIpOwogICAgICAgIGdyaWQuJG9uKCJyb3dhY3Rpb25jbGljayIsIG1lLmdyaWRSb3dBY3Rpb25DbGljayk7CiAgICAgICAgZ3JpZC4kb24oImlucHV0IiwgbWUuc2VsZWN0aW9uQ2hhbmdlKTsKICAgICAgICBncmlkLiRvbigiY2hhbmdlcGFnZXNpemUiLCBtZS5ncmlkQ2hhbmdlUGFnZVNpemUpOwoKICAgICAgICBpZiAoIWdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgICAgZ3JpZC4kb24oImZpbHRlciIsIG1lLnJlbG9hZCk7CiAgICAgICAgfQoKICAgICAgICBncmlkLiRvbigicmVzaXplQ29sIiwgbWUuZ3JpZFJlc2l6ZUNvbCk7CiAgICAgIH0KCiAgICAgIGlmIChhY3Rpb25NdWx0aSkgewogICAgICAgIGFjdGlvbk11bHRpLiRvbigiYWN0aW9uY2xpY2siLCBtZS5tdWx0aVNlbGVjdEFjdGlvbkNsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aS4kb24oInNlbGVjdGFsbCIsIG1lLm11bHRpU2VsZWN0QWxsQ2xpY2spOwogICAgICAgIGFjdGlvbk11bHRpLiRvbigidW5jaGVjayIsIG1lLm11bHRpU2VsZWN0VW5jaGVjayk7CiAgICAgIH0KCiAgICAgIGlmIChhY3Rpb25NdWx0aUJpZ1NjcmVubikgewogICAgICAgIGFjdGlvbk11bHRpQmlnU2NyZW5uLiRvbigiYWN0aW9uY2xpY2siLCBtZS5tdWx0aVNlbGVjdEFjdGlvbkNsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aUJpZ1NjcmVubi4kb24oInNlbGVjdGFsbCIsIG1lLm11bHRpU2VsZWN0QWxsQ2xpY2spOwogICAgICAgIGFjdGlvbk11bHRpQmlnU2NyZW5uLiRvbigidW5jaGVjayIsIG1lLm11bHRpU2VsZWN0VW5jaGVjayk7CiAgICAgIH0KICAgIH0sCgogICAgLyoqDQogICAgICogcmVtb3ZlIGV2ZW50IGFkZCDEkeG7mW5nDQogICAgICovCiAgICByZW1vdmVFdmVudDogZnVuY3Rpb24gcmVtb3ZlRXZlbnQoKSB7CiAgICAgIHZhciBtZSA9IHRoaXMsCiAgICAgICAgICBncmlkID0gbWUuZ3JpZCwKICAgICAgICAgIGFjdGlvbk11bHRpID0gbWUuYWN0aW9uTXVsdGlDb21wb25lbnQsCiAgICAgICAgICBhY3Rpb25NdWx0aUJpZ1NjcmVubiA9IG1lLmFjdGlvbk11bHRpQmlnU2NyZWVuQ29tcG9uZW50OwoKICAgICAgaWYgKGdyaWQpIHsKICAgICAgICBncmlkLiRvZmYoImxvYWREYXRhIiwgbWUubG9hZERhdGEpOwogICAgICAgIGdyaWQuJG9mZigiZGJsY2xpY2siLCBtZS5ncmlkUm93RGJDbGljayk7CiAgICAgICAgZ3JpZC4kb2ZmKCJyb3dtb3VzZW92ZXIiLCBtZS5ncmlkUm93Q2xpY2spOwogICAgICAgIGdyaWQuJG9mZigicm93YWN0aW9uY2xpY2siLCBtZS5ncmlkUm93QWN0aW9uQ2xpY2spOwogICAgICAgIGdyaWQuJG9mZigiaW5wdXQiLCBtZS5zZWxlY3Rpb25DaGFuZ2UpOwogICAgICAgIGdyaWQuJG9mZigiY2hhbmdlcGFnZXNpemUiLCBtZS5ncmlkQ2hhbmdlUGFnZVNpemUpOwoKICAgICAgICBpZiAoIWdyaWQuaXNHcmlkVHJlZSkgewogICAgICAgICAgZ3JpZC4kb2ZmKCJmaWx0ZXIiLCBtZS5yZWxvYWQpOwogICAgICAgIH0KCiAgICAgICAgZ3JpZC4kb2ZmKCJyZXNpemVDb2wiLCBtZS5ncmlkUmVzaXplQ29sKTsKICAgICAgfQoKICAgICAgaWYgKGFjdGlvbk11bHRpKSB7CiAgICAgICAgYWN0aW9uTXVsdGkuJG9mZigiYWN0aW9uY2xpY2siLCBtZS5tdWx0aVNlbGVjdEFjdGlvbkNsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aS4kb2ZmKCJzZWxlY3RhbGwiLCBtZS5tdWx0aVNlbGVjdEFsbENsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aS4kb2ZmKCJ1bmNoZWNrIiwgbWUubXVsdGlTZWxlY3RVbmNoZWNrKTsKICAgICAgfQoKICAgICAgaWYgKGFjdGlvbk11bHRpQmlnU2NyZW5uKSB7CiAgICAgICAgYWN0aW9uTXVsdGlCaWdTY3Jlbm4uJG9mZigiYWN0aW9uY2xpY2siLCBtZS5tdWx0aVNlbGVjdEFjdGlvbkNsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aUJpZ1NjcmVubi4kb2ZmKCJzZWxlY3RhbGwiLCBtZS5tdWx0aVNlbGVjdEFsbENsaWNrKTsKICAgICAgICBhY3Rpb25NdWx0aUJpZ1NjcmVubi4kb2ZmKCJ1bmNoZWNrIiwgbWUubXVsdGlTZWxlY3RVbmNoZWNrKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBYdeG6pXQga2jhuql1IGV4Y2VsDQogICAgICovCiAgICBleHBvcnRFeGNlbDogZnVuY3Rpb24gZXhwb3J0RXhjZWwoKSB7CiAgICAgIHZhciBfdGhpczEwID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMCgpIHsKICAgICAgICB2YXIgbWUsIHBhcmFtOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczEwOwoKICAgICAgICAgICAgICAgIGlmIChfdGhpczEwLmNoZWNrQWN0aW9uUGVybWlzc2lvbkFsZXJ0KG1lLiR0KCJpMThuUGVybWlzc2lvbi5TdWJTeXN0ZW1Db2RlLkNvZGUuRVhQT1JUIikpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDM7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIik7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF9jb250ZXh0MTAubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMxMC5nZXRFeHBvcnRFeGNlbFBhcmFtKCk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHBhcmFtID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gODsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpczEwLmN1c3RvbVBhcmFtQmVmb3JlRXhwb3J0KHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTApOwogICAgICB9KSkoKTsKICAgIH0sCgogICAgLyoqDQogICAgICogTOG6pXkgdGhhbSBz4buRIHh14bqldCBraOG6qXUNCiAgICAgKi8KICAgIGdldEV4cG9ydEV4Y2VsUGFyYW06IGZ1bmN0aW9uIGdldEV4cG9ydEV4Y2VsUGFyYW0oKSB7CiAgICAgIHZhciBfdGhpczExID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMSgpIHsKICAgICAgICB2YXIgcGFyYW0sIGNvbnRyb2xsZXI7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBwYXJhbSA9IF90aGlzMTEuZ2V0R3JpZEV4cG9ydFBhcmFtZXRlcihfdGhpczExLmdyaWQpOwogICAgICAgICAgICAgICAgcGFyYW0uRmlsZVR5cGUgPSAieGxzeCI7CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSA0OwogICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTEuJHN0b3JlLmRpc3BhdGNoKCIiLmNvbmNhdChfdGhpczExLm1vZHVsZSwgIi9nZXRDb250cm9sbGVyIikpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjb250cm9sbGVyID0gX2NvbnRleHQxMS5zZW50OwogICAgICAgICAgICAgICAgcGFyYW0uR2V0RGF0YVVybCA9IFtjb250cm9sbGVyLCAibGlzdCJdLmpvaW4oIi8iKTsKICAgICAgICAgICAgICAgIHBhcmFtLkdldERhdGFNZXRob2QgPSAiUE9TVCI7CiAgICAgICAgICAgICAgICBwYXJhbS5SZXBvcnRUaXRsZSA9IF90aGlzMTEuZ2V0VGl0bGVFeHBvcnQoKTsKICAgICAgICAgICAgICAgIHBhcmFtLkZpbGVOYW1lID0gX3RoaXMxMS5nZXRGaWxlTmFtZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBwYXJhbSk7CgogICAgICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDExLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMSk7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBs4bqleSB0acOqdSDEkeG7gSBmaWxlIGV4Y2VsDQogICAgICogQHJldHVybnMgdGnDqnUgxJHhu4EgZGFuaCBzw6FjaA0KICAgICAqLwogICAgZ2V0VGl0bGVFeHBvcnQ6IGZ1bmN0aW9uIGdldFRpdGxlRXhwb3J0KCkgewogICAgICB2YXIgdGl0bGUgPSAiIjsKICAgICAgdmFyIGVsID0gdGhpcy4kZWwucXVlcnlTZWxlY3RvcigiLmxpc3QtdGl0bGUiKTsKCiAgICAgIGlmIChlbCAmJiB0eXBlb2YgZWwuaW5uZXJIVE1MID09PSAic3RyaW5nIikgewogICAgICAgIHRpdGxlID0gZWwuaW5uZXJIVE1MLnRyaW0oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aXRsZSA9IHRoaXMudGl0bGUgPyB0aGlzLnRpdGxlLnRyaW0oKSA6ICIiOwogICAgICB9CgogICAgICByZXR1cm4gdGl0bGU7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEzhuqV5IHTDqm4gZmlsZSBraGkgeHXhuqV0IGto4bqpdQ0KICAgICAqIEByZXR1cm5zIHTDqm4gZmlsZSA6IG7hur91IMSR4buDIHRy4buRbmcgdGjDrCBt4bq3YyDEkeG7i25oIGzhuqV5IHRpw6p1IMSR4buBDQogICAgICovCiAgICBnZXRGaWxlTmFtZTogZnVuY3Rpb24gZ2V0RmlsZU5hbWUoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIG3hu58gcG9wdXAgc+G7rWEgbeG6q3UNCiAgICAgKi8KICAgIG9wZW5Qcm90b3R5cGU6IGZ1bmN0aW9uIG9wZW5Qcm90b3R5cGUoKSB7CiAgICAgIHRoaXMuc2hvd0RldGFpbCgiTXNDb25maWdMaXN0TGF5b3V0IiwgdGhpcy4kbXMuZW51bS5Gb3JtU3RhdGUuQWRkLCB7CiAgICAgICAgbGF5b3V0OiB0aGlzLmxheW91dCwKICAgICAgICBwYXJlbnQ6IHRoaXMKICAgICAgfSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEBhdXRob3IgdnZraWV0IC0gMTguMDMuMjAyMQ0KICAgICAqIEjDoG0gY3VzdG9tIGzhuqFpIHBhcmFtIHRyxrDhu5tjIGtoaSB4deG6pXQgZXhjZWwNCiAgICAgKi8KICAgIGN1c3RvbVBhcmFtQmVmb3JlRXhwb3J0OiBmdW5jdGlvbiBjdXN0b21QYXJhbUJlZm9yZUV4cG9ydChwYXJhbSkgewogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMik7CiAgICAgIH0pKSgpOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDE0LjA0LjIwMjENCiAgICAgKiBIw6BtIHjhu60gbMO9IGV4dERhdGENCiAgICAgKi8KICAgIGRlY29kZUV4dERhdGE6IGZ1bmN0aW9uIGRlY29kZUV4dERhdGEoZGF0YSkgewogICAgICB2YXIgbWUgPSB0aGlzOyAvLyBY4butIGzDvSBk4buvIGxp4buHdSBt4bufIHLhu5luZwoKICAgICAgdmFyIG9yaWdpbkZpZWxkcyA9IFtdOwoKICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoIkV4dERhdGEiKSkgewogICAgICAgIC8vIERhbmggc8OhY2ggY8OhYyB0csaw4budbmcgZOG7ryBsaeG7h3UgZ+G7kWMgY+G7p2EgZOG7ryBsaeG7h3UKICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHsKICAgICAgICAgIG9yaWdpbkZpZWxkcy5wdXNoKGkpOwogICAgICAgIH0gLy8gTWFwIGThu68gbGnhu4d1IG3hu58gcuG7mW5nCgoKICAgICAgICBpZiAoZGF0YS5FeHREYXRhICYmIHR5cGVvZiBkYXRhLkV4dERhdGEgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICB2YXIgZXh0RGF0YSA9IEpTT04ucGFyc2UoZGF0YS5FeHREYXRhKTsKCiAgICAgICAgICBpZiAoZXh0RGF0YSkgewogICAgICAgICAgICBtZS4kbXMuY29tbW9uRm4ucHJvY2Vzc1NlcnZlclJlc3BvbnNlRGF0YShleHREYXRhKTsKCiAgICAgICAgICAgIGZvciAodmFyIG0gaW4gZXh0RGF0YSkgewogICAgICAgICAgICAgIC8vIENo4buJIG1hcCBjw6FjIHRyxrDhu51uZyBraMO0bmcgY8OzIHRyb25nIGThu68gbGnhu4d1IGfhu5FjCiAgICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YVttXSkgewogICAgICAgICAgICAgICAgZGF0YVttXSA9IGV4dERhdGFbbV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8qKg0KICAgICAqIFjhu60gbMO9IGThu68gbGnhu4d1IHNhdSBraGkgc+G7rWENCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZCBi4bqjbiBnaGkgZ+G7kWMNCiAgICAgKiBAcGFyYW0geyp9IHNhdmVSZXN1bHQgYuG6o24gZ2hpIHRyw6puIHNlcnZlciB0cuG6oyB24buBDQogICAgICogQG92ZXJyaWRlDQogICAgICovCiAgICBhZnRlclNhdmVFZGl0OiBmdW5jdGlvbiBhZnRlclNhdmVFZGl0KHJlY29yZCwgc2F2ZVJlc3VsdCkge30sCgogICAgLyoqDQogICAgICogWOG7rSBsw70gZOG7ryBsaeG7h3Ugc2F1IGtoaSBz4butYSB04bqhaSBtb2RlIHZpZXcNCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZCBi4bqjbiBnaGkgZ+G7kWMNCiAgICAgKiBAcGFyYW0geyp9IHNhdmVSZXN1bHQgYuG6o24gZ2hpIHRyw6puIHNlcnZlciB0cuG6oyB24buBDQogICAgICogQG92ZXJyaWRlDQogICAgICovCiAgICBhZnRlclNhdmVWaWV3OiBmdW5jdGlvbiBhZnRlclNhdmVWaWV3KHJlY29yZCwgc2F2ZVJlc3VsdCkge30sCgogICAgLyoqDQogICAgICogSMOgbSBzaG93IEFsbCBpY29uZmlsdGVyDQogICAgICogQHBhcmFtIHsqfSByZWNvcmQgYuG6o24gZ2hpIGfhu5FjDQogICAgICogQHBhcmFtIHsqfSBzYXZlUmVzdWx0IGLhuqNuIGdoaSB0csOqbiBzZXJ2ZXIgdHLhuqMgduG7gQ0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqLwogICAgZnVuU2hvd0FsbEljb25GaWx0ZXI6IGZ1bmN0aW9uIGZ1blNob3dBbGxJY29uRmlsdGVyKCkgewogICAgICAvL3RoaXMuJG5leHRUaWNrKCgpPT57CiAgICAgIHRoaXMuc2hvd0FsbEljb25GaWx0ZXIgPSAhdGhpcy5zaG93QWxsSWNvbkZpbHRlcjsKICAgICAgdGhpcy4kcmVmc1t0aGlzLnZpZXdSZWZdLmZ1blNob3dBbGxJY29uRmlsdGVyKHRoaXMuc2hvd0FsbEljb25GaWx0ZXIpOyAvL30pCiAgICB9LAoKICAgIC8qKg0KICAgICAqIGN1c3RvbSDEkWnhu4F1IGtp4buHbiBs4buNYy9zZWFyY2ggbcOgbiBow6xuaCBncmlkIHRyZWUNCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZCBi4bqjbiBnaGkgY2hlY2sNCiAgICAgKiBAcGFyYW0gcHJvcGVydGllcyBkYW5oIHPDoWNoIGZpZWxkIGPhuqduIGNoZWNrIMSRaw0KICAgICAqIEBwYXJhbSBzZWFyY2hUZXh0IMSRb+G6oW4gdGV4dCBuaOG6rXAg4bufIMO0IHTDrG0ga2nhur9tDQogICAgICogTeG6t2MgxJHhu4tuaCB0cuG6oyB24buBIHRydWUNCiAgICAgKi8KICAgIGNoZWNrRmlsdGVyR3JpZFRyZWVDdXN0b206IGZ1bmN0aW9uIGNoZWNrRmlsdGVyR3JpZFRyZWVDdXN0b20ocmVjb3JkLCBwcm9wZXJ0aWVzLCBzZWFyY2hUZXh0KSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBIw6BtIHNob3cgY8OhYyBwb3B1cCB0aGVvIHTDqm4gbOG6pXkgxJHGsOG7nW5nIGThuqtuIHThu6sgaMOgbSBnZXRQb3B1cG9tcG9uZW50DQogICAgICogQHBhcmFtIG5hbWUgdMOqbiBj4bunYSBjb21wb25lbnQNCiAgICAgKiBDcmVhdGVkIGJ5IExUREFUKDE3LjA2LjIwMjApDQogICAgICovCiAgICBzaG93RGV0YWlsOiBmdW5jdGlvbiBzaG93RGV0YWlsKG5hbWUsIG1vZGUsIGRhdGEsIG9wdGlvbikgewogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBwb3B1cFV0aWwuc2hvdyhtZSwgbmFtZSwgZGF0YSwgbWUuZ2V0UG9wdXBPcHRpb24obmFtZSwgb3B0aW9uKSk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEF1dGhvcjogxJBWVGhpDQogICAgICogQ3JlYXRlIGRhdGU6IDExLzAzLzIwMjENCiAgICAgKiBDaG8gcGjDqXAgZGV0YWlsIGfhu41pIHThu5tpIHN1Ym1pdERldGFpbENhbGxiYWNrIGPhu6dhIGRhbmggc8OhY2ggc2F1IGtoaSBj4bqldCB4b25nDQogICAgICovCiAgICBnZXRQb3B1cE9wdGlvbjogZnVuY3Rpb24gZ2V0UG9wdXBPcHRpb24obmFtZSwgb3B0aW9uKSB7CiAgICAgIHZhciBtZSA9IHRoaXM7CiAgICAgIHJldHVybiB7CiAgICAgICAgc3VibWl0OiBtZS5zdWJtaXREZXRhaWxDYWxsYmFjaywKICAgICAgICBzaW5nbGU6IHRydWUKICAgICAgfTsKICAgIH0sCgogICAgLyoqDQogICAgICogQXV0aG9yOiDEkFZUaGkNCiAgICAgKiBDcmVhdGUgZGF0ZTogMTEvMDMvMjAyMQ0KICAgICAqIENobyBwaMOpcCBkZXRhaWwgZ+G7jWkgdOG7m2kgc3VibWl0RGV0YWlsQ2FsbGJhY2sgY+G7p2EgZGFuaCBzw6FjaCBzYXUga2hpIGPhuqV0IHhvbmcNCiAgICAgKi8KICAgIHN1Ym1pdERldGFpbENhbGxiYWNrOiBmdW5jdGlvbiBzdWJtaXREZXRhaWxDYWxsYmFjayhyZXN1bHQsIHBhcmFtLCBhY3Rpb24pIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgIH0sCgogICAgLyoqDQogICAgICogQG92ZXJyaWRlDQogICAgICovCiAgICBnZXRDb25kaXRpb25QYXJhbWV0ZXI6IGZ1bmN0aW9uIGdldENvbmRpdGlvblBhcmFtZXRlcigpIHsKICAgICAgdmFyIG1lID0gdGhpczsKICAgICAgdmFyIHJlc3VsdCA9IG1lLnN1cGVyKCJnZXRDb25kaXRpb25QYXJhbWV0ZXIiKTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0sCgogICAgLyoqDQogICAgICogSMOgbSB0aOG7sWMgaGnhu4duIGN1c3RvbSBlbnRpdHkgxJHhu5FpIHbhu5tpIG5naGnhu4dwIHbhu6UgxJHhurdjIHRow7kNCiAgICAgKiBAYXV0aG9yIHZ2a2lldCAtIDI3LjA3LjIwMjENCiAgICAgKi8KICAgIGdldEVudGl0eVR5cGU6IGZ1bmN0aW9uIGdldEVudGl0eVR5cGUoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBzaG93IGZpbHRlciBwb3B1cA0KICAgICAqLwogICAgc2hvd0FjdGlvbkJveDogZnVuY3Rpb24gc2hvd0FjdGlvbkJveCgpIHsKICAgICAgaWYgKHRoaXMuaXNTaG93QWN0aW9uR3JvdXAgPT0gdHJ1ZSkgewogICAgICAgIHRoaXMuaXNTaG93QWN0aW9uR3JvdXAgPSBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlzU2hvd0FjdGlvbkdyb3VwID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBoaWRlIGZpbHRlciBwb3B1cA0KICAgICAqLwogICAgaGlkZGVuQWN0aW9uQm94OiBmdW5jdGlvbiBoaWRkZW5BY3Rpb25Cb3goZXZlbnQpIHsKICAgICAgdGhpcy5pc1Nob3dBY3Rpb25Hcm91cCA9IGZhbHNlOwogICAgfSwKCiAgICAvKioNCiAgICAgKiBD4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaSBjw6FjIGLhuqNuIGdoaSDEkcaw4bujYyBjaOG7jW4NCiAgICAgKiBURE5HSElBIDEyLzExLzIwMjENCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZHMNCiAgICAgKiBAcGFyYW0geyp9IGNvbW1hbmQNCiAgICAgKi8KICAgIHNldEFjdGl2ZU11dGlSb3dzOiBmdW5jdGlvbiBzZXRBY3RpdmVNdXRpUm93cyhyZWNvcmRzLCBjb21tYW5kKSB7CiAgICAgIHZhciBfdGhpczEyID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMygpIHsKICAgICAgICB2YXIgbWUsIGluYWN0aXZlLCBmaWVsZCwgbGlzdElELCBwYXJhbSwgcmVzdWx0OwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgbWUgPSBfdGhpczEyOwogICAgICAgICAgICAgICAgaW5hY3RpdmUgPSBjb21tYW5kID09ICJhY3RpdmUiID8gMCA6IDE7CgogICAgICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlY29yZHMpKSB7CiAgICAgICAgICAgICAgICAgIHJlY29yZHMgPSBbcmVjb3Jkc107CiAgICAgICAgICAgICAgICB9IC8vc2hvdyBtYXNrCiAgICAgICAgICAgICAgICAvLyBtZS5sb2FkaW5nID0gdHJ1ZTsKCgogICAgICAgICAgICAgICAgZmllbGQgPSBtZS4kc3RvcmUuc3RhdGVbbWUubW9kdWxlXS5fY29uZmlnLmZpZWxkOwogICAgICAgICAgICAgICAgbGlzdElEID0gcmVjb3Jkcy5tYXAoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bZmllbGQua2V5XTsKICAgICAgICAgICAgICAgIH0pLmpvaW4oIiwiKTsKICAgICAgICAgICAgICAgIHBhcmFtID0gewogICAgICAgICAgICAgICAgICBUYWJsZU5hbWU6IGZpZWxkLnRhYmxlLAogICAgICAgICAgICAgICAgICBLZXlGaWVsZDogZmllbGQua2V5LAogICAgICAgICAgICAgICAgICBWYWx1ZTogaW5hY3RpdmUsCiAgICAgICAgICAgICAgICAgIExpc3RJRDogbGlzdElELAogICAgICAgICAgICAgICAgICBPcmdhbml6YXRpb25JRDogbWUuZ2V0T3JnYW5pemF0aW9uRmlsdGVyKCkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBfY29udGV4dDEzLm5leHQgPSA4OwogICAgICAgICAgICAgICAgcmV0dXJuIG1lLiRzdG9yZS5kaXNwYXRjaCgiIi5jb25jYXQoX3RoaXMxMi5tb2R1bGUsICIvdXBkYXRlU3RhdHVzIiksIHBhcmFtKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQxMy5zZW50OwogICAgICAgICAgICAgICAgbWUuYWZ0ZXJVcGRhdGVTdGF0dXMocmVjb3JkcywgcmVzdWx0KTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEzKTsKICAgICAgfSkpKCk7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIGPhuq1wIG5o4bqtdCBzYXUga2hpIHVwZGF0ZSBzdGF0dXMNCiAgICAgKiBAcGFyYW0geyp9IHJlY29yZA0KICAgICAqIEBwYXJhbSB7Kn0gcmVzdWx0DQogICAgICovCiAgICBhZnRlclVwZGF0ZVN0YXR1czogZnVuY3Rpb24gYWZ0ZXJVcGRhdGVTdGF0dXMocmVjb3JkLCByZXN1bHQpIHsKICAgICAgdmFyIG1lID0gdGhpczsKCiAgICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LlN1Y2Nlc3MpIHsKICAgICAgICBtZS4kdG9hc3Quc3VjY2VzcyhtZS4kdCgiaTE4bkJhc2VGb3JtLlNhdmVTdWNjZXNzTWVzc2FnZSIpKTsKICAgICAgICBtZS5zZWxlY3RlZCA9IFtdOwogICAgICAgIG1lLnJlbG9hZCgpOwogICAgICAgIG1lLmN1c3RvbUFmdGVyVXBkYXRlKHJlY29yZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbWUuJHRvYXN0LmVycm9yKG1lLiR0KCJpMThuQmFzZUZvcm0uTWVzc2FnZS5FcnJvciIpKTsKICAgICAgfQogICAgfSwKCiAgICAvKioNCiAgICAgKiBM4bqleSBvcmdhbml6YXRpb25JRCDEkeG7gyB1cGRhdGUgc3RhdHVzLC4uLg0KICAgICAqIFRETkdISUEgMTYvMTEvMjAyMQ0KICAgICAqIEByZXR1cm5zDQogICAgICovCiAgICBnZXRPcmdhbml6YXRpb25GaWx0ZXI6IGZ1bmN0aW9uIGdldE9yZ2FuaXphdGlvbkZpbHRlcigpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAoKICAgIC8qKg0KICAgICAqIEjDoG0gY3VzdG9tIHjhu60gbMO9IHNhdSBraGkgY+G6rXAgbmjhuq10IHRy4bqhbmcgdGjDoWkNCiAgICAgKiBOTVRVQU4zIDE1LzMvMjAyMg0KICAgICAqIEBwYXJhbSB7Kn0gcmVjb3JkIGLhuqNuIGdoaSBj4bqtcCBuaOG6rXQgdHLhuqFuZyB0aMOhaQ0KICAgICAqLwogICAgY3VzdG9tQWZ0ZXJVcGRhdGU6IGZ1bmN0aW9uIGN1c3RvbUFmdGVyVXBkYXRlKHJlY29yZCkge30KICB9KSwKICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5yZW1vdmVFdmVudCgpOwogIH0KfTs="},null]}